<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Alternamorphs - Harlowe Build - Twee Import</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" name="' attr(name) '">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=""]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 50%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0.25) 0%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' "' attr(name) '"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:"..."}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:"↓"}tw-debugger th[data-col][data-order=desc]::after{content:"↑"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=""]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=" color"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=" color"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=" color"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=" color"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media(min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:"▶"}tw-folddown.open::after{content:"▼"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play Alternamorphs - Harlowe Build - Twee Import.</tw-noscript></noscript></tw-story>
<tw-storydata name="Alternamorphs - Harlowe Build - Twee Import" startnode="180" creator="Twine" creator-version="2.10.0" format="Harlowe" format-version="3.3.9" ifid="0ec0eb97-610f-4a37-9e97-dd2fefdfbfc3" options="" tags="" zoom="0.3" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">tw-passage, tw-passage *, body, p {
  font-family: "News Gothic MT", "Libre Franklin", "Arial", sans-serif;
}

h1, h2 {
  font-family: "Escafil", "Ramiz", "Oswald", "Orbital";
}


/*
  Reposition the Sidebar 'footer' tagged passage.
*/
tw-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 20%; /* padding-right of the tw-story element. */
  max-height: 100%;
  margin-top: 5%; /* padding-top of the tw-story element. */
  padding: 0 1.5em 0.5em 0.5em;
  text-align: right;
  background-color: transparent;
  font-size: smaller;
}

tw-link {
  font-family: "Escafil", "Ramiz", "Oswald", "Orbital";
}

li {
  font-family: "Escafil", "Ramiz", "Oswald", "Orbital";
}

tw-hook[name="escafilfont"] tw-hook tw-link {
  font-family: "News Gothic MT", "Libre Franklin", "Arial", sans-serif !important;
}

tw-icon {
  display: none;
}


img {
  max-height: 250px;
  background-color: red;
}</style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-tag name="Meta" color="red"></tw-tag><tw-tag name="Reboot-Ending" color="green"></tw-tag><tw-tag name="penultimate" color="blue"></tw-tag><tw-tag name="TRUE-END" color="red"></tw-tag><tw-passagedata pid="1" name="Sidebar" tags="footer" position="5400,300" size="100,100">(append: ?SideBar)[
(link: &quot;Save Game&quot;)[
    (save-game: &quot;slot1&quot;)
    (alert: &quot;Game saved!&quot;)
]

(link: &quot;Load Game&quot;)[
    (load-game: &quot;slot1&quot;)
]

Endings Discovered: &lt;div&gt;(print: (count: $normalEndings, true)) out of 48&lt;/div&gt;
Secret Endings Discovered: &lt;div&gt;(print: (count: $secretEndings, true)) out of 8&lt;/div&gt;
True Ending Discovered? &lt;div&gt;(if: $c125ending)[Yes](else: )[No].&lt;/div&gt;
]</tw-passagedata><tw-passagedata pid="2" name="Chapter 1" tags="" position="6475,1200" size="100,100">(set: $axman to false, $cassie to false, $jake to false, $marco to false, $rachel to false, $tobias to false)

You&#39;re not yourself today.

You knew it the moment you awoke. You could feel it in your limbs, which were the wrong length; in your breath, which was the wrong depth. You only became more certain when you opened your eyes, rolled over, and stared into a mirror that wasn&#39;t yours. The lanky, dark-skinned teenage girl with the long loose curls is not you. The Hanson poster hanging over not-your-bed isn&#39;t yours either, and the inspirational quote scrawled over the face of some kid called Jeremy Jason McCole definitely isn&#39;t.

And yet they fit. You wouldn&#39;t have recognised the girl&#39;s face five minutes ago, but as soon as you see it, it&#39;s as if you&#39;ve lived with it your whole life. You close your eyes and you can recall the room you just saw in perfect detail, as if it had been yours for years. As soon as you see the name &#39;Lorraine&#39; scrawled across the front of an exercise book in the corner, adorned with hearts and smiley faces, you know that it&#39;s yours.

There&#39;s a knock on your door. “Lorrie! You have to get up!” With the voice comes a name: Kayla. Your little sister. “Mom says if you don&#39;t get up now you&#39;ll be late!” Mom. Single parent. Works. She&#39;ll head off to her job about ten minutes after you leave for school.

Which means that you need to hurry up and get ready to leave. Or you could avoid school altogether and use the time to figure out what the hell is going on.

[[Go to school-&gt;Chapter 2]]

[[Fake sick-&gt;Chapter 3]]

(if: (count: $normalEndings, true) is 48)[[.OpEN	&amp;#47;	&amp;#47;yo..uRE	&amp;#91;ye	&amp;#47;	&amp;#47;S...	&amp;#93; (Secret Path)-&gt;Chapter 42]]</tw-passagedata><tw-passagedata pid="3" name="Chapter 10" tags="" position="3825,825" size="100,100">The mall isn&#39;t hard to find, which means that the construction site isn&#39;t hard to find. You approach from the mall side and find a hole in the fence. This must be where the Animorphs crept in to cut through the site. You crawl in and walk between half-assembled buildings now covered in graffiti and filled with garbage and old beer cans. Where were they, when they first saw Elfangor&#39;s ship? The sky is too cloudy today to see anything.

You hear a kid laughing, not far off. He must be cutting school, too. He walks into view, idly kicking a stone. He&#39;s average height, with blonde hair and something large and pale blue tucked under one arm. You quickly back through a doorway out of sight and find yourself in a very small room, barely wide enough for you to stretch out both arms. What was this going to be, originally? A closet? But you know this space; somehow, it fits into your memories. There&#39;s a heavy piece of fallen-in concrete in one corner, with just enough room for a kid like you to stick their arm under. Working on vague, uncertain memories, you do so. Yes, this fits; what&#39;s next? The wire lever. You find and pull the wire lever.

In eerie silence, the piece of concrete lifts up, creating a much larger gap. A gap large enough to crawl through.

[[Crawl blindly into the darkness-&gt;Chapter 20]]

[[Find the kid again instead-&gt;Chapter 21]]</tw-passagedata><tw-passagedata pid="4" name="Chapter 100" tags="penultimate" position="5750,2725" size="100,100">You explain who you are and what&#39;s going on, starting with the fact that David has the Escafil Device and ending with an elaborate explanation of how you know what that is and how to find her. Throughout your story, her expression shifts between doubt, puzzlement and confusion. She gives no hint that she believes you, or even that she understands much of what you&#39;re saying, but her expression sharpens when you use the term “Animorph” and she starts to ask occasional questions. How long ago did you find yourself in Lorraine&#39;s body? Can you describe a Kandrona? Have you ever heard of the Ellimist?

Intent as you are, you don&#39;t notice when David walks away, but Cassie does. She dashes after him as he heads for the door and grabs his arm. “Where do you think you&#39;re going?”

David rolls his eyes. “This is garbage. I was promised money, not some nut ranting about stories.”

“Stay,” she says. “Please.”

He pulls out of her grip and turns back to the barn door, but before he can take a step, her knife is at his throat. “Don&#39;t scream. I don&#39;t want to hurt you. But I can&#39;t let you leave, not when I don&#39;t know how either of you know this much.”

You feel the need to interrupt. “You don&#39;t want to do this,” you insist.

“No,” she says, “I don&#39;t. But I will.” She turns to look at you and in her eyes you see not the puzzled, inquisitive girl you were talking to moments before, but the soldier who has killed countless innocents out of sheer necessity. There is no quiver in her knife-wielding hand and no uncertainty in her expression. “Please,” she says, “keep calm and do as I say. I&#39;d rather not have to kill anyone.”

David&#39;s face is drawn up in a strange mix of anger, disbelief and fear. He looks moments away from shouting. Cassie pulls the knife tighter against his throat.

“Get into that stall, please,” she says quietly, nodding to one of the barn stalls. “Quietly. And no sudden moves.”

[[Comply-&gt;Chapter 101]]

[[Tackle her and save David-&gt;Chapter 102]]</tw-passagedata><tw-passagedata pid="5" name="Chapter 101" tags="" position="5975,2725" size="100,100">Cassie waves you into the stall and ties you both with the lengths of twine she&#39;d cut, binding your hands and feet together and then binding your hands to each others&#39; hands so that you are back-to-back. Your feet are also secured to each other, forcing you both onto your knees. Every tie is with a separate piece of twine, meaning that you&#39;d have to deal with several different bonds to escape, each just loose enough to allow for circulation but not loose enough to slip. Once you&#39;re too entangled to escape, she searches you and empties your pockets. Finally, she ties each of your upper arms to David&#39;s before standing back to view her handiwork.

She nods.

“I won&#39;t be long,” she says. “Stay here and stay quiet.”

And then she&#39;s gone.

It&#39;s about a minute before David speaks. “Where&#39;s she going?” he asks, a hint of panic in his voice. “What&#39;s the crazy bitch planning?”

“She&#39;s getting the others,” you tell him dully. You reflect that you should have told them all together, so this part wasn&#39;t necessary. Of course you spooked her. “They won&#39;t be long; they&#39;ll view this as an emergency.”

“Then we don&#39;t have long to get the hell out of here!” David pulls on your bonds, cutting twine into your arms. “Don&#39;t just sit there, find a way out!” You feel him pulling your arms down, searching for the knots on the ankle bonds, but they&#39;re tucked around the front out of reach.

“And go where?” you ask. “The police are full of Controllers. I know it doesn&#39;t seem like it, but these are the good guys.”

“I have had it with your goddamn alien stories!” David shouts. You shush him. He laughs. “Why be quiet? In case we accidentally summon help? Help!” He starts shouting, screaming for Cassie&#39;s parents.

[[Try to attract help with David-&gt;Chapter 103]]

[[Ignore David and let him shout-&gt;Chapter 104]]

[[Silence David with physical force-&gt;Chapter 105]]</tw-passagedata><tw-passagedata pid="6" name="Chapter 102" tags="Reboot-Ending" position="4000,1600" size="100,100">(set: $c102ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You leap forward, but Cassie doesn&#39;t toss David aside to deal with you. Instead, her knife drags across his throat, slicing him open before your eyes. He gurgles, trying to scream as she tosses him aside, an uncontrollable side element dealt with, and comes forward to meet you.

Too late, you remember that Cassie has had much, much more combat experience than you have.

It doesn&#39;t matter much whether you fight or run. The knife plunges into your gut and then she&#39;s there sinking teeth into your neck; teeth that change shape in an elongating jaw even as she bites down. There is no flinch or hesitation in the movements. You fall, bleeding profusely from the throat, and in your last moments you realise she&#39;s not even looking at you, not even acknowledging that your life is ending right in front of her. She&#39;s reaching for a tarp, already planning how to dispose of the bodies.

//Interesting choice. These humans always seem to think themselves invulnerable. I suppose there is nothing for it but to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="7" name="Chapter 103" tags="penultimate" position="6275,2375" size="100,100">You shout along with David, trying to attract attention. You struggle, too, but that doesn&#39;t seem to help much.

Then again, neither does shouting. All it does is make the two of you hoarse and worn out long before the Animorphs arrive. You can hear them approaching the barn.

“What if your parents had found them?” a male voice asks, a voice that you suddenly have vague memories of as belonging to a kid called Jake.

“They&#39;re out all night,” Cassie responds.

“And they left you home alone?” Marco. You remember that voice making unhelpful, smart-alec comments in math class.

“It&#39;s a farm. What&#39;s gonna happen? Some burglar decides that working in the city is just too convenient? I&#39;m gonna hold a secret party and have all my friends bus out here at night?” Five kids in tight, skimpy clothing enter the barn, four of whom you recognise. You look up, and see the bird settle into the rafters.

The appearance of the Animorphs has given David a second wind, and he starts swearing. For a guy who has no idea what&#39;s going on and clearly thinks you&#39;re insane, he&#39;s showing a fair bit of courage. He pulls against his ropes, which cut into your wrists. Tobias stares at him a moment and then looks to Cassie.

“And tying them up was a good idea why, exactly? Look. He&#39;s all freaked out.”

“What was I supposed to do, just leave them here?”

“I would&#39;ve brought them inside and made some tea, but whatever.”

“It may not have given the best first impression,” Jake agrees as he and Rachel crouch down to untie you.

“I panicked,” Cassie says apologetically.

&amp;lt;Perhaps we should have a… a sort of standing plan for if this sort of thing happens again?&gt; Tobias asks. The thought-speak startles you a little, words blooming in your mind in an unfamiliar voice, but not nearly as much as it startles David, who visibly flinches and scrambles away from everyone the moment he can move. The Animorphs immediately back away and adopt nonthreatening poses, except Tobias, who just glares from the rafters, and Ax, who blinks at him curiously.

“All of you stay away from me,” David demands, backing up. “You&#39;re all nuts.”

“Listen,” Jake says placatingly. “David, is it? We just – ”

“You&#39;re getting nothing out of me, understand? Nothing. My dad will find me, and he&#39;ll kick all your asses, and you&#39;ll end up in jail for life with whatever shady creeps you work for and if you even think of trying to hurt me it&#39;ll be a million times worse for you.”

“Protocol,” Rachel tells Tobias calmly. “The word you wanted was protocol.”

&amp;lt;Oh, right. Thanks.&gt;

“All we require from you is the Escafil device, human,” Ax says.

“The blue box you found,” Cassie clarifies.

“Oh, sure, this is all about some random junk from an abandoned construction site. I got a better idea; how about I walk on out of here and you guys don&#39;t all spend life in prison.”

“Technically, only Cassie&#39;s committed a crime here,” Maco points out.

“Great loyalty to the team there, Marco, I really appreciate it,” Cassie replies wryly.

“Don&#39;t mention it.”

“We got off on the wrong foot here,” Jake tries again, “but really, we just want the box from you. Mostly we want to talk to her.” He jerks a thumb at you.

“So if I give you this box, I&#39;m out of here and I don&#39;t have to deal with you any more? Is that it?”

Jake hesitates. “It&#39;s a bit more complicated – ”

“Yeah, thought so.”

“There are issues of secrecy here. Important issues. We need to make sure you understand what&#39;s safe to – ”

“Why, because of the aliens? All of you are nuts. Aliens aren&#39;t real.”

Jake nods. “Ax?”

“As you wish, Prince Jake.”

You have read descriptions of morphing before, but seeing it with your own eyes is somewhat unsettling. Ax stumbles forward a little as his legs suddenly duplicate, four human legs holding up a wobbly human body. The distance between front and back legs increases as spine and ribcage grow between them, and blue fur sprouts all over his body. Knees and ankles move up, forcing him onto four tiptoes moments before toenails fuse into hooves. While you were distracted by the legs, Ax&#39;s face changed shape, the mouth disappearing and nostrils lengthening, and as you watch, two tendrils sprout from the top of his head. Bulbs form on the ends which open into brilliant green eyes. His spine lengthens into a bladed tail as some of his delicate fingers duplicate, and soon, you&#39;re looking at an Andalite.

The image fits into your memory, familiar. Not this particular Andalite, but you&#39;ve seen an Andalite before.

David, naturally, freaks out. He bolts past the Animorphs and through the door. They let him go. Tobias takes off after him.

“Well,” Marco remarks, “that could have gone better.”

“He&#39;ll calm down,” Cassie says.

“I&#39;m not entirely sure that&#39;s true. I&#39;m not sure if you&#39;ve noticed, Cassie, but our lives are sometimes a little bit weird.”

Cassie glances at the door. “I should...”

“You&#39;re the one who tied him up,” Rachel reminds her.

“Right. Yeah.”

“How about we deal with the one who hasn&#39;t bolted?” She looks at you. “You know, the one who seems to know all our secrets for no real reason.”

You launch back into your explanation of your situation, finding yourself trapped in a children&#39;s book series. About halfway through, David strolls back in, looking still wary but a fair bit calmer, with a teenaged boy you don&#39;t recognise but who, judging by how awkward he seems in his own body and the fact that none of the others comment on his presence, must be Tobias.

The Animorphs listen. They ask questions to verify your story. They listen some more. There&#39;s a long silence.

David says, “Okay, you guys aren&#39;t insane. She&#39;s insane. That&#39;s way dumber than aliens.”

“And yet she learned these things somehow,” Cassie says thoughtfully. “There&#39;s something important here.”

“Aren&#39;t you that chick who ended up in a coma a little while back?” Marco asks. “Not to be rude or anything, but if you&#39;re… confused…”

“Wait, she was in a coma?” Jake asks. “Wow, people don&#39;t wake up from those very often.”

&amp;lt;She is young,&gt; Ax points out, &amp;lt;and quite possibly restless. I believe this increases one&#39;s chance of surviving comatose states, aeroplane crashes, and voyages lost at sea.&gt;

“Who&#39;s been showing Ax TV?” Marco asks.

“Guys,” Jake says wearily, “the extremely important mysteries in front of us?”

Ax looks thoughtful. &amp;lt;There is a possibility that she is indeed from the future and has, due to brain damage, mischaracterized things that she has read about,&gt; he says. &amp;lt;As for the Escafil device, I have no idea how that could remain undetected at the landing site for so long. The Yeerks should have thoroughly cleaned the site; if it was not destroyed, they at least would have found and kept it.&gt;

Rachel goes pale. “Wow, we dodged a bullet there, huh? We could&#39;ve been fighting morphing Yeerks right now.”

&amp;lt;If the Yeerks had the device, we would not be fighting them. They would already have won.&gt;

“Now there&#39;s a happy thought.”

“But we have it,” Cassie says with a grin. “Well, he has it.” She turns her grin on David, who takes a step back, rubbing the rope burns on his wrists.

“We also have someone with mysterious knowledge of us, and we don&#39;t know how, which means we don&#39;t know if the Yeerks also have it,” Jake points out, rubbing his temples. “And if Ax is right about the future, then that just raises more questions.”

“Or gives us one answer,” Tobias points out grimly, crossing his arms. “Time travel, right at the same time as this morphing cube impossibly shows up? Anybody think that&#39;s a coincidence?”

“As opposed to what?” Marco asks, frowning. “Nobody&#39;s shooting lasers at experimental bug fighters.” He turns to you. “You didn&#39;t happen to be in a laser battle in an experimental bug fighter recently, right?”

&amp;lt;I do not believe that Tobias is referring to a Sario Rip effect,&gt; Ax says grimly, &amp;lt;but perhaps to somebody known for… more refined time travel and related coincidences.&gt;

“You think that that ellimist is screwing with us again?” Cassie asks. “Aren&#39;t his people pretty much all-powerful? I&#39;m sure he has better things to do.”

“He used us to create a free colony of humans and a free colony of Hork-Bajir,” Rachel shrugs. “Maybe some other species needs a nature preserve.”

“We don&#39;t even know whether ellimists can time travel,” Marco points out.

“Yeah we do,” Rachel counters. “That one took us to the future and showed us doomed Earth, remember?”

“He pretended to take us to the future. Didn&#39;t we decide that that future was garbage? With bits that didn&#39;t make sense? We&#39;ve seen him freeze time, we haven&#39;t seen him reverse time. Ax, can ellimists time travel?”

Ax looks uncomfortable. &amp;lt;The stories say so, yes. But the stories say… many things, some of them contradictory. The stories say that the ellimists built a true time machine, a subtemporally grounded time machine, which they would not need if they could time travel on their own, but in many of the stories they do not have access to the machine; it is lost in some way. However, they are just stories. Many of them are probably not true.&gt;

“Still,” Tobias says. “If there are a lot of stories about time travelling ellimists, then that&#39;s a pretty strong indication.”

“Unless they just fake it, like with fake future,” Marco counters.

“They could equally be faking it here,” Cassie points out, “by giving Lorraine fake memories. After all, we know she&#39;s been going to our school for forever; it&#39;s not like the just showed up yesterday like you&#39;d expect from a time traveller.”

“What,” David asks in the voice of somebody whose last shred of patience is being slowly destroyed, “is an ellimist?”

“Like Q from Star Trek,” Jake explains, “but less of a jerk.”

“More of a jerk,” Tobias corrects him.

“Like Q from Star Trek but a different kind of jerk,” Jake amends.

“Never mind. Forget I asked.”

“Look,” Jake says wearily, “this is a big tangled mess and we need to get to the bottom of it. I hate to say it, but I think our current mission just fell off the priority list. Again. We have a couple of things to chase up here; securing the morphing cube, and figuring out Lorraine&#39;s book series thing.” He looks at David. “Where&#39;s the box? Is it easy to get?”

David crosses his arms. “Why should I tell you?”

Jake frowns. “Did you not get the whole aliens taking over the world thing?”

“I got it. I just don&#39;t know whether to believe it or not.”

“You saw me morph,” Tobias points out. “And you saw Ax demorph. He&#39;s standing right there. Being an alien.”

“Oh, yeah, the aliens are clearly real, but how do I know you&#39;re the good guys? You&#39;ve just shown you&#39;re shapeshifters; how do I know you&#39;re not evil aliens invading Earth? Reptilians or something?”

“What,” Rachel asks, “is a Reptilian?”

“Oh, you&#39;re missing out,” Marco says. “There&#39;s this theory, right, that – ”

“Nobody&#39;s a Reptilian,” Tobias says. “The enemy are the Yeerks. Interplanetary slavers.”

“You say that, but I haven&#39;t seen a Yeerk,” David says reasonably. “All I&#39;ve seen are you guys, and the first thing you did was tie me up in a barn. How do I know the Yeerks aren&#39;t defenders of humanity and the blue box isn&#39;t some of their technology that you&#39;re trying to steal?” He looks around at all the Animorphs. “And, okay, even if I do accept you&#39;re humans and you&#39;re being honest, how do you know you aren&#39;t being played by his people?” He gestures at Ax, who bristles.

&amp;lt;The Andalites are honourable defenders of freedom, human,&gt; Ax spits, as much as a telepathic tone can be considered spitting. &amp;lt;I will not stand here and hear you slander my people&#39;s – my brother&#39;s – good name.&gt;

“Or what? You&#39;ll cut my head off?” He looks around at the Animorphs again. “Are you even sure the Yeerks are the bad guys here or did you just believe the first alien you met?”

“The part where their leader ate that alien alive in front of us was a pretty big clue,” Rachel growls.

“And then Chapman ordered us to be beheaded,” Marco adds. “Remember that? Not a good day. Good thing he never recognised us.”

“Chapman?” David blinks. “You mean the assistant principal?”

“One and the same,” Marco says.

“No kidding?”

“Just tell me this,” Jake says patiently, “is the morphing cube well-hidden? Somewhere that the Yeerks won&#39;t stumble across it?”

“Well, duh. As soon as I heard it could be worth money I hid it.”

“Properly?”

“I do know how to hide things.”

“Okay,” Jake says, “let&#39;s put a pin in that one for now. Let everyone sleep on it. Give David and Lorraine a chance to get their feet. Now, issue number two. Lorraine.”

“I guess the big thing is figuring out if your knowledge is from something that isn&#39;t easily reproducible, like the ellimist, or from some mundane source,” Cassie says. “If it&#39;s something from, well, here, the Yeerks might find it as well. That&#39;s an issue.”

“Did you guys even think that she might be a Yeerk?” David asks.

“Neither of you are Yeerks,” Marco says. “If you were, you wouldn&#39;t be here. You,” he points to David, “would&#39;ve handed the cube to Visser Three and got an enormous promotion, and you,” he points to you, “probably would&#39;ve just went to our houses and infested us in our sleep or something.”

&amp;lt;You all realise that we cannot let either of them be captured,&gt; Ax says.

“No different to any of us, then,” Rachel shrugs. “This would be so much simpler if we weren&#39;t fighting mind readers.”

“A lot of things would be,” Cassie says wistfully.

“Any ideas on how to figure this out?” Jake asks.

[[Suggest checking your hospital records-&gt;Chapter 88]]

[[Remain silent and let the animorphs figure something out-&gt;Chapter 89]]</tw-passagedata><tw-passagedata pid="8" name="Chapter 104" tags="penultimate" position="5975,2100" size="100,100">You do your best to ignore David&#39;s shouting and struggling. He is hoarse and worn out long before the Animorphs arrive. You can hear them approaching the barn.

“What if your parents had found them?” a male voice asks, a voice that you suddenly have vague memories of as belonging to a kid called Jake.

“They&#39;re out all night,” Cassie responds.

“And they left you home alone?” Marco. You remember that voice making unhelpful, smart-alec comments in math class.

“It&#39;s a farm. What&#39;s gonna happen? Some burglar decides that working in the city is just too convenient? I&#39;m gonna hold a secret party and have all my friends bus out here at night?” Five kids in tight, skimpy clothing enter the barn, four of whom you recognise. You look up, and see the bird settle into the rafters.

The appearance of the Animorphs has given David a second wind, and he starts swearing. For a guy who has no idea what&#39;s going on and clearly thinks you&#39;re insane, he&#39;s showing a fair bit of courage. He pulls against his ropes, which cut into your wrists. Tobias stares at him a moment and then looks to Cassie.

“And tying them up was a good idea why, exactly? Look. He&#39;s all freaked out.”

“What was I supposed to do, just leave them here?”

“I would&#39;ve brought them inside and made some tea, but whatever.”

“It may not have given the best first impression,” Jake agrees as he and Rachel crouch down to untie you.

“I panicked,” Cassie says apologetically.

&amp;lt;Perhaps we should have a… a sort of standing plan for if this sort of thing happens again?&gt; Tobias asks. The thought-speak startles you a little, words blooming in your mind in an unfamiliar voice, but not nearly as much as it startles David, who visibly flinches and scrambles away from everyone the moment he can move. The Animorphs immediately back away and adopt nonthreatening poses, except Tobias, who just glares from the rafters, and Ax, who blinks at him curiously.

“All of you stay away from me,” David demands, backing up. “You&#39;re all nuts.”

“Listen,” Jake says placatingly. “David, is it? We just – ”

“You&#39;re getting nothing out of me, understand? Nothing. My dad will find me, and he&#39;ll kick all your asses, and you&#39;ll end up in jail for life with whatever shady creeps you work for and if you even think of trying to hurt me it&#39;ll be a million times worse for you.”

“Protocol,” Rachel tells Tobias calmly. “The word you wanted was protocol.”

&amp;lt;Oh, right. Thanks.&gt;

“All we require from you is the Escafil Device, human,” Ax says.

“The blue box you found,” Cassie clarifies.

“Oh sure, this is all about some random junk from an abandoned construction site. I got a better idea; how about I walk on out of here and you guys don&#39;t all spend life in prison.”

“Technically, only Cassie&#39;s committed a crime here,” Maco points out.

“Great loyalty to the team there, Marco, I really appreciate it,” Cassie replies wryly.

“Don&#39;t mention it.”

“We got off on the wrong foot here,” Jake tries again, “but really, we just want the box from you. Mostly we want to talk to her.” He jerks a thumb at you.

“So if I give you this box, I&#39;m out of here and I don&#39;t have to deal with you any more? Is that it?”

Jake hesitates. “It&#39;s a bit more complicated – ”

“Yeah, thought so.”

“There are issues of secrecy here. Important issues. We need to make sure you understand what&#39;s safe to – ”

“Why, because of the aliens? All of you are nuts. Aliens aren&#39;t real.”

Jake nods. “Ax?”

“As you wish, Prince Jake.”

You have read descriptions of morphing before, but seeing it with your own eyes is somewhat unsettling. Ax stumbles forward a little as his legs suddenly duplicate, four human legs holding up a wobbly human body. The distance between front and back legs increases as spine and ribcage grow between them, and blue fur sprouts all over his body. Knees and ankles move up, forcing him onto four tiptoes moments before toenails fuse into hooves. While you were distracted by the legs, Ax&#39;s face changed shape, the mouth disappearing and nostrils lengthening, and as you watch, two tendrils sprout from the top of his head. Bulbs form on the ends which open into brilliant green eyes. His spine lengthens into a bladed tail as some of his delicate fingers duplicate, and soon, you&#39;re looking at an Andalite.

The image fits into your memory, familiar. Not this particular Andalite, but you&#39;ve seen an Andalite before.

David, naturally, freaks out. He bolts past the Animorphs and through the door. They let him go. Tobias takes off after him.

“Well,” Marco remarks, “that could have gone better.”

“He&#39;ll calm down,” Cassie says.

“I&#39;m not entirely sure that&#39;s true. I&#39;m not sure if you&#39;ve noticed, Cassie, but our lives are sometimes a little bit weird.”

Cassie glances at the door. “I should...”

“You&#39;re the one who tied him up,” Rachel reminds her.

“Right. Yeah.”

“How about we deal with the one who hasn&#39;t bolted?” She looks at you. “You know, the one who seems to know all our secrets for no real reason.”

You launch back into your explanation of your situation, finding yourself trapped in a children&#39;s book series. About halfway through, David strolls back in, looking still wary but a fair bit calmer, with a teenaged boy you don&#39;t recognise but who, judging by how awkward he seems in his own body and the fact that none of the others comment on his presence, must be Tobias.

The Animorphs listen. They ask questions to verify your story. They listen some more. There&#39;s a long silence.

David says, “Okay, you guys aren&#39;t insane. She&#39;s insane. That&#39;s way dumber than aliens.”

“And yet she learned these things somehow,” Cassie says thoughtfully. “There&#39;s something important here.”

“Aren&#39;t you that chick who ended up in a coma a little while back?” Marco asks. “Not to be rude or anything, but if you&#39;re… confused…”

“Wait, she was in a coma?” Jake asks. “Wow, people don&#39;t wake up from those very often.”

&amp;lt;She is young,&gt; Ax points out, &amp;lt;and quite possibly restless. I believe this increases one&#39;s chance of surviving comatose states, aeroplane crashes, and voyages lost at sea.&gt;

“Who&#39;s been showing Ax TV?” Marco asks.

“Guys,” Jake says wearily, “the extremely important mysteries in front of us?”

Ax looks thoughtful. &amp;lt;There is a possibility that she is indeed from the future and has, due to brain damage, mischaracterized things that she has read about,&gt; he says. &amp;lt;As for the Escafil Device, I have no idea how that could remain undetected at the landing site for so long. The Yeerks should have thoroughly cleaned the site; if it was not destroyed, they at least would have found and kept it.&gt;

Rachel goes pale. “Wow, we dodged a bullet there, huh? We could&#39;ve been fighting morphing Yeerks right now.”

&amp;lt;If the Yeerks had the device, we would not be fighting them. They would already have won.&gt;

“Now there&#39;s a happy thought.”

“But we have it,” Cassie says with a grin. “Well, he has it.” She turns her grin on David, who takes a step back, rubbing the rope burns on his wrists.

“We also have someone with mysterious knowledge of us, and we don&#39;t know how, which means we don&#39;t know if the Yeerks also have it,” Jake points out, rubbing his temples. “And if Ax is right about the future, then that just raises more questions.”

“Or gives us one answer,” Tobias points out grimly, crossing his arms. “Time travel, right at the same time as this morphing cube impossibly shows up? Anybody think that&#39;s a coincidence?”

“As opposed to what?” Marco asks, frowning. “Nobody&#39;s shooting lasers at experimental bug fighters.” He turns to you. “You didn&#39;t happen to be in a laser battle in an experimental bug fighter recently, right?”

&amp;lt;I do not believe that Tobias is referring to a Sario Rip effect,&gt; Ax says grimly, &amp;lt;but perhaps to somebody known for… more refined time travel and related coincidences.&gt;

“You think that that ellimist is screwing with us again?” Cassie asks. “Aren&#39;t his people pretty much all-powerful? I&#39;m sure he has better things to do.”

“He used us to create a free colony of humans and a free colony of Hork-Bajir,” Rachel shrugs. “Maybe some other species needs a nature preserve.”

“We don&#39;t even know whether ellimists can time travel,” Marco points out.

“Yeah we do,” Rachel counters. “That one took us to the future and showed us doomed Earth, remember?”

“He pretended to take us to the future. Didn&#39;t we decide that that future was garbage? With bits that didn&#39;t make sense? We&#39;ve seen him freeze time, we haven&#39;t seen him reverse time. Ax, can ellimists time travel?”

Ax looks uncomfortable. &amp;lt;The stories say so, yes. But the stories say… many things, some of them contradictory. The stories say that the ellimists built a true time machine, a subtemporally grounded time machine, which they would not need if they could time travel on their own, but in many of the stories they do not have access to the machine; it is lost in some way. However, they are stories. Many of them are probably not true.&gt;

“Still,” Tobias says. “If there are a lot of stories about time travelling ellimists, then that&#39;s a pretty strong indication.”

“Unless they just fake it, like with fake future,” Marco counters.

“They could equally be faking it here,” Cassie points out, “by giving Lorraine fake memories. After all, we know she&#39;s been going to our school for forever, it&#39;s not like the just showed up yesterday like you&#39;d expect from a time traveller.”

“What,” David asks in the voice of somebody whose last shred of patience is being slowly destroyed, “is an ellimist?”

“Like Q from Star Trek,” Jake explains, “but less of a jerk.”

“More of a jerk,” Tobias corrects him.

“Like Q from Star Trek but a different kind of jerk,” Jake amends.

“Never mind. Forget I asked.”

“Look,” Jake says wearily, “this is a big tangled mess and we need to get to the bottom of it. I hate to say it, but I think our current mission just fell off the priority list. Again. We have a couple of things to chase up here; securing the morphing cube, and figuring out Lorraine&#39;s book series thing.” He looks at David. “Where&#39;s the box? Is it easy to get?”

David crosses his arms. “Why should I tell you?”

Jake frowns. “Did you not get the whole aliens taking over the world thing?”

“I got it. I just don&#39;t know whether to believe it or not.”

“You saw me morph,” Tobias points out. “And you saw Ax demorph. He&#39;s standing right there. Being an alien.”

“Oh, yeah, the aliens are clearly real, but how do I know you&#39;re the good guys? You&#39;ve just shown you&#39;re shapeshifters, how do I know you&#39;re not evil aliens invading Earth? Reptilians or something?”

“What,” Rachel asks, “is a Reptilian?”

“Oh, you&#39;re missing out,” Marco says. “There&#39;s this theory, right, that – ”

“Nobody&#39;s a Reptilian,” Tobias says. “The enemy are the Yeerks. Interplanetary slavers.”

“You say that, but I haven&#39;t seen a Yeerk,” David says reasonably. “All I&#39;ve seen are you guys, and the first thing you did was tie me up in a barn. How do I know the Yeerks aren&#39;t defenders of humanity and the blue box isn&#39;t some of their technology that you&#39;re trying to steal?” He looks around at all the Animorphs. “And, okay, even if I do accept you&#39;re humans and you&#39;re being honest, how do you know you aren&#39;t being played by his people?” He gestures at Ax, who bristles.

&amp;lt;The Andalites are honourable defenders of freedom, human,&gt; Ax spits, as much as a telepathic tone can be considered spitting. &amp;lt;“I will not stand here and hear you slander my people&#39;s – my brother&#39;s – good name.&gt;

“Or what? You&#39;ll cut my head off?” He looks around at the Animorphs again. “Are you even sure the Yeerks are the bad guys here or did you just believe the first alien you met?”

“The part where their leader ate that alien alive in front of us was a pretty big clue,” Rachel growls.

“And then Chapman ordered us to be beheaded,” Marco adds. “Remember that? Not a good day. Good thing he never recognised us.”

“Chapman?” David blinks. “You mean the assistant principal?”

“One and the same,” Marco says.

“No kidding?”

“Just tell me this,” Jake says patiently, “is the morphing cube well-hidden? Somewhere that the Yeerks won&#39;t stumble across it?”

“Well, duh. As soon as I heard it could be worth money I hid it.”

“Properly?”

“I do know how to hide things.”

“Okay,” Jake says, “let&#39;s put a pin in that one for now. Let everyone sleep on it. Give David and Lorraine a chance to get their feet. Now, issue number two. Lorraine.”

“I guess the big thing is figuring out if your knowledge is from something that isn&#39;t easily reproducible, like the ellimist, or from some mundane source,” Cassie says. “If it&#39;s something from, well, here, the Yeerks might find it as well. That&#39;s an issue.”

“Did you guys even think that she might be a Yeerk?” David asks.

“Neither of you are Yeerks,” Marco says. “If you were, you wouldn&#39;t be here. You,” he points to David, “would&#39;ve handed the cube to Visser Three and got an enormous promotion, and you,” he points to you, “probably would&#39;ve just went to our houses and infested us in our sleep or something.”

&amp;lt;You all realise that we cannot let either of them be captured,&gt; Ax says.

“No different to any of us, then,” Rachel shrugs. “This would be so much simpler if we weren&#39;t fighting mind readers.”

“A lot of things would be,” Cassie says wistfully.

“Any ideas on how to figure this out?” Jake asks.

[[Suggest checking your hospital records-&gt;Chapter 88]]

[[Remain silent and let the Animorphs figure something out-&gt;Chapter 89]]</tw-passagedata><tw-passagedata pid="9" name="Chapter 105" tags="" position="6075,3525" size="100,100">You are tied up in Cassie&#39;s barn. Cassie&#39;s parents could find you at any moment. And if they do, it won&#39;t be good. If they&#39;re Controllers, you&#39;ll be infested, and they&#39;ll know all about the Animorphs and the Chee and the Star Defenders; if they&#39;re not, they&#39;ll call the police, the Controller-infested police, and they&#39;ll take Cassie.

And David is screaming for help.

He doesn&#39;t listen to your pleas for silence, to your attempts to explain. Tied as you are, you can&#39;t cover his mouth. To avoid losing the Earth to the Yeerks, there is only one thing that you can do.

Positioned as you are in the stall, the edge of an old water trough is near David&#39;s head.

You throw all your weight against him, slamming his head into the trough. He screams louder. You do it again and again, trying to knock him out; a fourth strike, and there is a sickening crack. And David is silent.

He doesn&#39;t respond when you say his name. You can&#39;t tell if he&#39;s breathing. You try to turn to look at him, but Cassie&#39;s bonds are too secure; no matter how you twist, he just slumps, motionless, against your back. His hands don&#39;t move when you pinch them. He doesn&#39;t correct his posture when you move yours. There is a strong smell of urine and faeces in the confined stall.

It feels like forever before the Animorphs arrive.

Cassie dashes for the stall as soon as she enters the barn, her face a mask of horror. As Marco cuts your bonds, you babble about how he wouldn&#39;t stop screaming, about how you couldn&#39;t make him quiet, about how you were going to be found and everything would be over. Jake looks like he&#39;s about to be sick. Ax immediately turns and walks out. Cassie covers her mouth with both hands.

“I should have gagged them,” she moans. “This is my fault, I should have gagged them. I didn&#39;t think!”

“Your parents were out,” Rachel points out, looking sick herself. “Nobody could&#39;ve heard them.”

“They didn&#39;t know that,” Cassie whispers back, eyes wide. David falls away from you and you turn, wondering why Cassie is just standing there, not checking his vitals, not doing something medical… and you see him, and you know why. The trough has split his face in several places, but the most severe wound, the one that must have quieted him, is a crack right between his eyes. It&#39;s deep, very deep. You can see chips of bone through the torn flesh where his skull has partly imploded. His eyes are glassy and unmoving.

Rachel clears her throat. “The body,” she says.

Cassie nods. “A tarp, over there.” She points to something out of your view. “Wrap it up, I&#39;ll go horse and carry him.”

“We go out to the forest,” Jake says, “where nobody will find it. Tobias, you scout for us. Marco, you&#39;re on guard duty with Ax.” He indicates you.

You let the Animorphs lead you out to the forest. A grave… a shallow pit… is dug, and you help. David&#39;s body is weighed down under stones so that animals cannot dig it up before the hole is filled. By the time the last of the dirt is piled on top, everyone is exhausted. Everyone turns their hollow gazes to you.

“Right,” Jake says. “The important thing. The crazy girl. Here&#39;s the thing: Cassie doesn&#39;t think you&#39;re with the Yeerks, or you would&#39;ve gone straight to them. And your story sounds ridiculous. But you definitely know something, so the question is, how do you know what you know?”

“That might be the second most important thing here,” Cassie says quietly.

“What&#39;s more important than finding out how some random knows everything about us?” Rachel asks.

“The reason she came to us.” Cassie spreads several photos in front of you. They show a blue cube. A very familiar blue cube. “These were in the… the boy&#39;s pockets. Is this the cube you claimed he&#39;d found?”

You nod.

Marco looks at the photos. He grins. “That&#39;s it. That&#39;s the morphing cube. With that, we could… oh, man, we could win this war in a week.” He frowns, considering his own words.

“That is a pretty big deal,” Jake says. “But which is more important, this information leak, or the power of the morphing cube?”

[[Focus on finding out how you know what you know-&gt;Chapter 106]]

[[Focus on finding the morphing cube-&gt;Chapter 107]]</tw-passagedata><tw-passagedata pid="10" name="Chapter 106" tags="Reboot-Ending" position="4400,1600" size="100,100">(set: $c106ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

After briefly going over your history, the Animorphs decide that the best place to begin is the hospital. It&#39;s a Yeerk-controlled facility, you spent some time there in a coma, and while nobody can figure out any real logical way to connect those things, it&#39;s really the only thing they&#39;ve got.

You&#39;re searched a second time before the Animorphs split up; Cassie and Tobias escort you up to the Hork-Bajir valley for safety while the others head off to search the hospital records.

The journey takes a long time. Cassie morphs horse and carries you there, but she has to stop frequently to rest or demorph. It&#39;s past nightfall when you finally step into the valley. Tobias has flown ahead to explain matters, so Ket and Jara are waiting when you arrive.

They don&#39;t look quite how you always imagined Hork-Bajir to look – the blades are shaped differently, their stance is different – but as soon as you see them, they fit into you mind, settling into your memories as something you know. Ket peers closely into your eyes while Jara and Cassie have a hushed conversation.

You awkwardly introduce yourself. Ket nods.

“Am Ket Halpak,” she says. She points to Jara. “Jara Hamee.” She points to a tree branch above you, where a much smaller Hork-Bajir you didn&#39;t notice previously peers down at you. “Toby Halmee.” She points to you. “Friend of fellana, friend of Ket. We help.”

You&#39;re left with the Hork-Bajir. The Animorphs return the next day with food and clothing for you, telling you that they haven&#39;t found out much yet, but will keep looking. A few days later, they return and tell you the same thing.

After a month, you start a garden. There&#39;s not much else you can do – the valley is partway up a mountain in the middle of a forest. You have no way to get home and no way to contact anybody. Ket and Jara refuse to help. They do help you with the garden, though. They&#39;re pretty good at it.

The Animorphs have long since stopped giving you updates on the mission. They only ever show up long enough to drop off food and clothing. All in all, you think, it could be worse.

You could be buried in a ditch in the forest with your skull cracked open.

//We&#39;ll learn nothing further from this thread. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="11" name="Chapter 107" tags="penultimate" position="5925,2500" size="100,100">“We have to find the cube,” you say. “I think he left it in his house.”

“Which is where?” Rachel asks.

You shrug. You don&#39;t know.

Cassie pulls a wallet out of her pocket and withdraws a library card. She hands it to Jake.

“Right,” Jake says. He holds it up so that Tobias can see.

&amp;lt;I know where that is,&gt; Tobias says. &amp;lt;It&#39;s just a few blocks from the construction site.&gt;

“Everyone make excuses with your parents,” Jake says. “We meet up there in an hour.”

“What about her?” Marco jerks a thumb towards you. Six pairs of eyes settle on you.

“… Rachel&#39;s going with you,” Jake tells you. “You try to betray us in any way and she&#39;ll make sure you can&#39;t.”

You tell your mother that you want to sleep over at a friend&#39;s house, and she&#39;s happy enough that you&#39;re spending time with friends that she doesn&#39;t question it.

You meet with the Animorphs a couple of houses down the road from David&#39;s, in clean clothes that don&#39;t have the mud and blood from David&#39;s burial on them. The Animorphs quickly hash out a plan for searching the house. You, lacking morphing powers, are left on lookout, and after the inevitable argument where everybody tries to figure out whether you&#39;re part of a trap designed to ambush them once they&#39;ve found it and hand it to the Yeerks, the more suspicious Animorphs begrudgingly accept this.

They enter the house as planned, leaving you to hide in the bushes and keep watch. About ten minutes after they enter, a car pulls up in the driveway and a man in a suit gets out. He&#39;s carrying a handgun like he knows how to use it.

Right. The burglar alarm. David&#39;s secret service father.

You hesitate. You&#39;re supposed to be watching for this exact thing but… now what? Do you sneak in and warn them? You don&#39;t have a fancy healing factor. If you get shot, it could be the end.

[[Warn the Animorphs-&gt;Chapter 111]]

[[Stay hidden-&gt;Chapter 112]]</tw-passagedata><tw-passagedata pid="12" name="Chapter 108" tags="" position="6525,3000" size="100,100">Erek takes your hand and his hologram extends around you. “Just walk with me,” he says quietly. “I&#39;ll handle the rest.”

Protected by the hologram, you walk out, into the biofilter, up into the sunlight. You walk back to Erek&#39;s house and down into the basement. Chee are waiting in the dog park. Erek has a quick conversation with them before turning back to you.

“You&#39;ll have to wait here for a bit until we figure this out,” he explains. “This might take a week or two. If you give us your address, we can [[handle things at your home-&gt;Chapter 37]].”</tw-passagedata><tw-passagedata pid="13" name="Chapter 109" tags="Reboot-Ending" position="4700,1600" size="100,100">(set: $c109ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You step back, out of Erek&#39;s reach. You can&#39;t trust him. You can&#39;t trust anyone. You can&#39;t trust yourself. You have to… seek help from your people, or destroy them and save the Earth, or…

Decisions can wait. Now, you need information. You have to get away from the Chee, figure out how to avoid your host being identified, then come back and investigate, learn who hid your identity and why. You run away from Erek, around the Yeerk Pool, and head for the nearest exit. You head into the corridor and make briskly for the surface. If Erek&#39;s following you, he&#39;s keeping himself hidden. You keep moving.

The passage heads up at a fairly steady incline for a while, then evens out. A little while later, there are some stairs. Then more flat ground. You keep moving. Onward, onward. Farther from the Pool, closer to the surface.

Eventually, you run out of breath. Your feet start to hurt. You pause to rest.

It occurs to you that you haven&#39;t seen anybody else in this passage.

It occurs to you that this passage is very, very long. Much longer than any passage to the Yeerk Pool really should be.

It occurs to you that Chee are very, very good at holograms.

You turn to face Erek.

“You must understand,” he says carefully, steadily, “that our secrets must be protected. For the sake of this planet. You&#39;re not in any danger here – the Yeerks, they might be a danger to you, but we aren&#39;t. We can protect you. We can help you. You won&#39;t be hurt.”

You know that there is nowhere to run. You can turn run from him, further down the passage while he creates more of it with his holograms and waits for you to tire out, but you&#39;ll give up eventually. Even if you don&#39;t, you&#39;ll have to sleep eventually. You need rest; Chee don&#39;t. He merely has to wait for you to close your eyes before gently picking you up and carrying you away. Whether you go with him now or later, willingly or unwillingly, the end will be the same. You will be protected. You won&#39;t be hurt.

In all the uncertainty in this world, you can be completely certain of that – you won&#39;t be hurt.

//This scenario seems uninformative from this point. I think we should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="14" name="Chapter 11" tags="Reboot-Ending" position="4775,1350" size="100,100">Annie nods and smiles throughout your explanation. While you talk, she types away at her computer. You&#39;re halfway through explaining how you don&#39;t even know where your locker is when she suddenly freezes, frowning at the screen.

“What is it?” you ask.

“Nothing, nothing. I just saw how much you&#39;ve been through recently. You were warned that there might be effects on your memory, weren&#39;t you?”

“Effects of what?”

“Of the car accident.” Annie stands up and circles around her desk to crouch next to you and put a comforting arm around your shoulders. “I&#39;m going to call the hospital for you, okay? They should know about this.”

You open your mouth to reply, but there is a sudden sharp, paralysing pain in your neck. You can&#39;t move. You can&#39;t even breathe. You can do nothing but stare as Annie stands up, pockets the small metal cylinder she just pressed to your neck, and calls an ambulance. Her voice on the phone is tearful and panicky, but from the smirk she spares you, you know that there is no way the ambulance will make it in time.

//Interesting choice. It trusts the counsellor? Perhaps it thought that giving only mundane details would be safe. I suppose there is nothing to do but [[try again-&gt;Chapter 1]]//</tw-passagedata><tw-passagedata pid="15" name="Chapter 110" tags="" position="3575,1375" size="100,100">Cassie introduces you to her parents as a new member of her environmental activist group. With a quick call to your mother, you arrange to stay the night. Mr and Mrs Williams are friendly and ask you a lot of questions about your life, but politely back off when you explain your recent accident-related memory problems. Cassie&#39;s father starts to inquire about your symptoms with great interest, but stops halfway through his first question when her mother shoots him a withering glare.

It&#39;s not dinner time yet, so Cassie leads you up to her room. It&#39;s a little messy, with the bed unmade and a pile of dirty clothes in one corner, but not extremely so, if only because Cassie doesn&#39;t seem to own much stuff except books and magazines. She has a lot of those, almost all of them about animals, from little collectible paperbacks about wolves and owls made for little children to serious-looking tomes with titles like “On The Development Of The Canid Mind”. Most of them have at least one or two sticky notes in them.

Cassie self-consciously shoves a bunch of stuff off her bed to make room and sits on it, patting the space next to her. “Come on. Let&#39;s get to work.” She pulls out her notebook. “I think we should start by going through everything again, from the beginning.”

You start from the beginning. You talk about the mall, about Jake describing the Animorphs (Cassie blushes as you explain Jake&#39;s crush on her). About cutting through the construction site.

&#39;&#39;DO YOU REALLY THINK THAT IT WILL BE THIS EASY?&#39;&#39;

You talk about Tobias pointing out the light in the sky. About the ship landing.

&#39;&#39;YOU BELIEVE THAT YOU CAN REWRITE TIME TO YOUR WHIM? THAT YOU CAN TAKE A TIMELINE AND LOOP IT BACK ON ITSELF UNTIL YOU CAN SCRIPT EVERY ACTION, BUILD EVERY OUTCOME?&#39;&#39;

You talk of Elfangor getting out of the ship. His explanation. The morphing cube.

&#39;&#39;HOW MANY TIMES HAVE YOU RUN THE SCENARIO?&#39;&#39;

You explain the Animorphs agreeing to accept the power. Touching the cube.

&#39;&#39;WHO ARE YOU TO MEDDLE IN THIS WORLD IN SUCH A WAY? TO TELL ITS OWN IMMUNE SYSTEM OF HER BIRTH? ARE YOU TRULY ARROGANT ENOUGH TO BELIEVE THAT SHE WILL NOT CATCH YOU?
&#39;&#39;
Cassie looks up, frowns, as if sensing something strange. And then she is gone. The room is gone. You are gone.

You are not yourself today. You are not anybody today.

You are the universe. Or at least, there is the universe. There is no you to be separate from it; it is inside of you. It is not you. It is somebody else. It is speaking to you, to nobody, but not with words; there are no words.

There is only outrage. Sheer, concentrated outrage, and a hint of… fear? Panic? Both?

Who are you to be here, to meddle in this way? To dip your mind, your intent, yourself into this story, this world in which you have no part? Why are you here? What did you hope to achieve? You knew, going in, that you can do nothing here; you KNOW you can have no effect on this story, because if you did, you&#39;d kill it. There are approximately forty or fifty books left. What impact could you possibly have that could carry through this story;, that could touch these characters? In what practical way could such a thing be incorporated into this timeline? Is this a game to you, a cheap bit of entertainment built on the pain of these children? Any impact you could possibly have would be to kill the story. Otherwise, you&#39;re pointless.

Why are you here?

“Stop it, you&#39;ll scare them.”

The voice is shrill, almost screechy. Mocking. But it&#39;s a voice;, a thing that exists. You exist. You, Lorraine, you turn and it&#39;s there; a short being, shorter than you, bipedal and with two shrunken, fragile-looking arms. It&#39;s skin is violet and wrinkled, and its face unsettlingly humanoid for such an inhuman body. It grins with a mouthful of sharp teeth.

“Look at you, then,” it says with a chuckle. “The mystery. The one who doesn&#39;t belong, trying so desperately to matter.”

&#39;&#39;LEAVE, DRODE.
&#39;&#39;
“Why? So you can have this tasty morsel all to yourself? Look at you, big guardian of the universe.” The purple alien squints at you. “Who are you, then?”

You don&#39;t reply.

“Do you know? Do you even know?”

&#39;&#39;IT CONCEALS ITS MIND. LEAVE, OR YOUR MASTER MAY LACK A SERVANT.
&#39;&#39;
“And that&#39;ll just cause so much annoying deal-making between the two of you, won&#39;t it. Conceals its mind, or doesn&#39;t have it? What are you, little time puppet?”

You don&#39;t reply.

“We could play the silent game all day, but I bore easily.”

You start doing the macarena.

The Drode watches you for several seconds, and then begins to cackle wildly. It&#39;s a jarringly human sound, hacking breaths and shrieks of amusement while you dance. “Ellimist, look! It really is a puppet! It&#39;s not in control. You&#39;re frightened of some bit of spacetime driftwood with absolutely no control.”

You stop doing the macarena and start doing the Time Warp.

In front of you, the universe coalesces into a humanoid figure. Its features are indistinct, but you know that it is watching you. You stop dancing.

&#39;&#39;CURIOUS.&#39;&#39;

No fear, this time. But caution.

“Prod it,” the Drode urges. “See what it does.”

&#39;&#39;THIS IS AS MUCH YOUR MASTER&#39;S PROBLEM AS MINE.&#39;&#39;

“But my master isn&#39;t here, and I&#39;m not leaving and missing the fun. Go on, go on, poke it.”

The Ellimist is frowning at you. &#39;&#39;LIMITED CONTROL?&#39;&#39;

“A choice. You&#39;re good at choices.” It cocks its head. “Binary, binary, binary. One zero one zero one zero. That is the ultimate answer. That is the place to go.”

&#39;&#39;BINARY&#39;&#39;, the Ellimist agrees, and gives you the choice.

[[If you flip a coin and get heads-&gt;Chapter 160]]

[[If you flip a coin and get tails-&gt;Chapter 161]]</tw-passagedata><tw-passagedata pid="16" name="Chapter 111" tags="Reboot-Ending" position="3900,1700" size="100,100">(set: $c111ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

Shapeshifter or not, you have a job to do.

You sneak up to a window that the Animorphs opened to get in and peek into what is clearly a boy&#39;s bedroom. No Animorphs – it&#39;s clear they&#39;ve moved into the rest of the house. Dammit. Nothing for it; you climb in.

You&#39;re halfway through the window when the door is kicked open and suddenly filled with David&#39;s father, gun raised and aimed at you.

“Stay there,” he growls. You freeze.

Unfortunately, the Animorphs themselves are not used to dealing with reasonable people attempting to defend their homes, but enemies attempting to kill them. Most people would leave a gunman alone when they had somebody in their sights – unless, of course, they had a long history of dealing with people who they fully expected to shoot to kill.

You don&#39;t see who exactly tackles David&#39;s father, because the moment he&#39;s tackled, the gun fires, putting a bullet quite neatly between your eyes. You die before you have a chance to reflect on how horribly unsafe it is to point a loaded gun at somebody you don&#39;t want to kill in the first place.

//Too many extraneous factors this time – how were they supposed to know the danger? We should have a cleaner run and [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="17" name="Chapter 112" tags="Reboot-Ending" position="4000,1700" size="100,100">(set: $c112ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

If this is anything like the books, a whole bunch of Controllers will probably turn up soon. You can&#39;t afford to get caught in a firefight; the Animorphs would only be slowed down trying to protect you and if you got captured, the Yeerks would have all their secrets. You stay hidden as the chaos starts, and as more vehicles start to tear around the corner, you have no option but to get away from the house.

Rachel and Cassie catch up with you the next day at school. You don&#39;t notice them coming up behind you in the near-deserted yard until Rachel grabs your arm and spins you around.

“Nice warning there,” she snaps. “We could&#39;ve gotten killed.”

“Rachel,” Cassie says reasonably, “we didn&#39;t think through the situation properly. She can&#39;t thought-speak. How was she supposed to warn us?”

“The door was unlocked!”

“There were guns! She could&#39;ve been identified and captured! What then?”

“We always manage to figure it out!”

“We can heal from almost any injury and we&#39;ve been fighting this war a long time. It&#39;s not the same thing.” Cassie looks to you. “It was a mistake to involve you so closely in this. I&#39;m sorry. Our priority should be getting you somewhere safe, away from the Yeerks.”

You point out that you have a family, but Cassie shakes her head. “We&#39;ve talked the issue over. We&#39;ll protect your family; that&#39;s our trade for your cooperation. But we can&#39;t have you here. It leaves us one step away from full discovery, and we just can&#39;t risk that;, not when you can&#39;t defend yourself properly. We don&#39;t want to hurt you, do you understand? Nobody has to get hurt here.”

The Animorphs buy you a bus ticket. They give you an address and a code phrase and you&#39;re packed off to meet Rachel&#39;s father. He&#39;s not happy about having somebody so young away from her parents, and makes no attempt to hide the fact. You suspect that if you asked him to, he&#39;d probably send you straight home – but you don&#39;t want to know what the Animorphs will try next to protect their secrets.

You never see your family again. Did you have a father? Aunts or uncles? How close were you to your grandparents? Without seeing faces or hearing voices, there’s nothing to fit into your mind. No way to access those memories.

Rachel&#39;s dad can&#39;t have a suspicious-looking child around for too long, and you end up in the foster system, far away from the Animorphs&#39; hometown. Occasionally they call you for advice on a mission, asking if it&#39;s something you remember, and what happened. Sometimes you remember it from the book series, sometimes you don&#39;t. They seem to be doing okay.

You just have to hope that in the end, everything will work out.

//I see no further avenue for learning on this track. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="18" name="Chapter 113" tags="" position="3625,1975" size="100,100">You leave with them. The group reconvenes out of earshot of the shack.

“He’s waking up,” Jake says. “I should – ”

“No,” Rachel says.

“You don’t get it, Rachel. I’ve been there. I’ve been in that shack and had one of those things die in my head. I know what he’s going to go through. I just need to morph and – ”

“No,” Cassie says.

“They’re right, dude.” Marco puts a hand on his friend’s shoulder. “You’re too close to this. He’s too close to you. Until we’re absolutely certain he’s going to be free forever, y6ou have to keep your distance.”

“You of all people are telling me this, Marco? You? You’ve had whole conversations with Visser One in your real body!”

Marco’s eyes darken.

&amp;lt;Dude,&gt; Tobias says, &amp;lt;that’s different.&gt;

“No,” Marco says. “It’s not different;, it’s the same situation. But I hadn’t seen my mother for years, Jake, and I had a good cover. Tom knows you’re not a Controller and he definitely knows you’re not an Andalite. You wanna risk that?”

“What, you think you can do it but I can’t? You think you’re more disciplined than I am, Marco, is that it? You think being a smartass means you – ”

“This is a bad time for this,” Cassie says. “We can’t leave him alone for too long.”

Jake nods. “Ax, go watch Tom.” Ax leaves. “The rest of you,” Jake continues, “need to back off. My brother needs me, this is something I’ve done and none of you have. None of you have a clue about this, okay? I know what’s happening, I know what he’s feeling, and I am going to help my brother!”

&amp;lt;Volume,&gt; Tobias cautions.

“Oh, shut up, Tobias.”

&amp;lt;That’s what I’m suggesting you do,&gt; Tobias replies, preening a wing. &amp;lt;Unless you want the Yeerk to hear your voice screaming about your brother.&gt;

Jake glares at him.

Ax’s thoughtspeak rings in your head. &amp;lt;Prince Jake! The Controller is gone!&gt;

&amp;lt;Impossible,&gt; Tobias says. &amp;lt;I would have heard him!&gt; But he is already airborne, eyes scanning the forest.

Jake nods. “Wings, everyone. Lorraine, search the shack thoroughly while we scan the forest, in case he’s hiding.”

You don’t protest this transparent attempt to get you out of the way; after all, you can’t fly. You head back. Ax is already gone. Tom is, however, there, tied up in a chair exactly as you left him.

He opens his eyes. He looks right at you, his gaze intense and sharp.

He grins.

“They&#39;re not watching,” he tells you. “Not even the bird. Hardly doing a good job of protecting you, are they?”

He gets up from the chair, ropes falling away still knotted, and stretches his arms. He catches your expression and grins wider. “Didn&#39;t you think it was a bit too easy? Didn&#39;t you think that if holding a Controller were this simple, the Fearless Leader would have attempted to free his brother months ago? No, I just wanted a chance to watch you. Look at you. I can&#39;t decide whether you know too much or nothing at all.” He frowns, distracted. “Oh boy, the meddler is here. What a twist.” He whistles, the sort of whistle you would use to call a dog. “Come on, come closer. You&#39;ll scare it.”

Part of the world opens up, and before you stands a woman who was always there, but who you hadn&#39;t noticed before. She&#39;s dressed like a fairly typical nineties housewife in pale pastels with dangly hoop earrings, her straight blonde hair cut just below her jaw. She looks to be somewhere in her mid- to late- thirties. She doesn&#39;t seem the sort to stand out in the world you currently find yourself, but the universe wraps around her somehow, and when she looks at you, you see that her eyes are full of stars.

She looks very, very angry.

“Who are you?” she demands. “What have you done to this timeline?”

“So you don&#39;t know, either?” Tom chirps. “Oh, no, what a pity. A rogue element knocking over all your precious pieces. Whatever shall be done.”

The Ellimist glares at him. “Leave or be constructive, Drode.”

“Why should I? I&#39;m having far too much fun.” But Tom – the Drode – sees something in your expression. He frowns and grabs your chin, pulling you close to look carefully into your eyes. “I think it knows who I am,” he says, interested. “Curious. How would a being such as you come across such information? I&#39;ve never spoken to these pawns.”

“What corruption have you seeded here?” the Ellimist asks. “Who sent you?”

You say nothing.

“Answer me,” she snaps. “You do not want me to gain this information by force.”

“By force, Ellimist?” the Drode giggles. “Now, now, now, you know the rules.”

“We have negotiated nothing for this being.”

“Look closer. It’s not of this world. I believe there are standing protocols?” The Drode flashes a nasty grin. “Wouldn’t want to step too far off those lines, would you? After all, the rules exist for a reason.”

“Go and get your master.”

“And miss out on the fun? I don’t think so. Why don’t you call him?”

“I am not leaving.”

“Ooh, you don’t trust me? Surely in your infinite wisdom you know I’d not disrupt something so hilari – oh.” the Drode cackles. “It isn’t me that you don’t trust, is it? Are you scared?”

“You’re projecting, Drode. You’re afraid to lose your master to this thing. Do you think that you can protect him by keeping him absent?”

“This is getting us nowhere.” The Drode pokes you. You continue to stand passively and observe. “Come on. Do something.”

You do the chicken dance.

The Ellimist and the Drode frown.

“It’s not in control,” the Ellimist breathes.

“Another little puppet,” the Drode giggles. “It got all the way here, though. Some control. I was watching.”

“Key choices?”

“We could find out. Binary. One zero one zero one zero. That’s the answer. That’s the place to go.”

The Ellimist produces a coin. “Heads or tails?”

[[Choose Heads-&gt;Chapter 160]]

[[Choose Tails-&gt;Chapter 161]]</tw-passagedata><tw-passagedata pid="19" name="Chapter 114" tags="" position="3700,1525" size="100,100">Tom stirs. He opens his eyes. He looks right at you, his gaze intense and sharp.

He grins.

“They&#39;re not watching,” he tells you. “Not even the bird. They&#39;re off having some petty argument about family and responsibility. Hardly doing a good job of protecting you, are they?”

He gets up from the chair, ropes falling away still knotted, and stretches his arms. He catches your expression and grins wider. “Didn&#39;t you think it was a bit too easy? Didn&#39;t you think that if holding a Controller were this simple, the Fearless Leader would have attempted to free his brother months ago? Look at you. I can&#39;t decide whether you know too much or nothing at all.” He frowns, distracted. “Oh, boy, the meddler is here. What a twist.” He whistles, the sort of whistle you would use to call a dog. “Come on, come closer. You&#39;ll scare it.”

Part of the world opens up, and before you stands a woman who was always there, but who you hadn&#39;t noticed before. She&#39;s dressed like a fairly typical nineties housewife in pale pastels with dangly hoop earrings, her straight blonde hair cut just below her jaw. She looks to be somewhere in her mid- to late-thirties. She doesn&#39;t seem the sort to stand out in the world you currently find yourself, but the universe wraps around her somehow, and when she looks at you, you see that her eyes are full of stars.

She looks very, very angry.

“Who are you?” she demands. “What have you done to this timeline?”

“So you don&#39;t know either?” Tom chirps. “Oh no, what a pity. A rogue element knocking over all your precious pieces. Whatever shall be done.”

The Ellimist glares at him. “Leave or be constructive, Drode.”

“Why should I? I&#39;m having far too much fun.” But Tom – the Drode – sees something in your expression. He frowns and grabs your chin, pulling you close to look carefully into your eyes. “I think it knows who I am,” he says, interested. “Curious. How would a being such as you come across such information? I&#39;ve never spoken to these pawns.”

“What corruption have you seeded here?” the Ellimist asks. “Who sent you?”

You say nothing.

“Answer me,” she snaps. “You do not want me to gain this information by force.”

“By force, Ellimist?” the Drode giggles. “Now, now, now, you know the rules.”

“We have negotiated nothing for this being.”

“Look closer. It’s not of this world. I believe there are standing protocols?” The Drode flashes a nasty grin. “Wouldn’t want to step too far off those lines, would you? After all, the rules exist for a reason.”

“Go and get your master.”

“And miss out on the fun? I don’t think so. Why don’t you call him?”

“I am not leaving.”

“Ooh, you don’t trust me? Surely in your infinite wisdom you know I’d not disrupt something so hilari – oh.” the Drode cackles. “It isn’t me that you don’t trust, is it? Are you scared?”

“You’re projecting, Drode. You’re afraid to lose your master to this thing. Do you think that you can protect him by keeping him absent?”

“This is getting us nowhere.” The Drode pokes you. You continue to stand passively and observe. “Come on. Do something.”

You do the chicken dance.

The Ellimist and the Drode frown.

“It’s not in control,” the Ellimist breathes.

“Another little puppet,” the Drode giggles. “It got all the way here, though. Some control. I was watching.”

“Key choices?”

“We could find out. Binary. One zero one zero one zero. That’s the answer. That’s where we need to take it.”

The Ellimist produces a coin. “Heads or tails?”

[[Choose Heads-&gt;Chapter 160]]

[[Choose Tails-&gt;Chapter 161]]</tw-passagedata><tw-passagedata pid="20" name="Chapter 115" tags="" position="6100,3800" size="100,100">Tobias swoops in. He lands next to you and ventures a couple of feet into the gap. You see his body warp and change slightly as he morphs to owl.

After about thirty seconds, he trots out and demorphs. &amp;lt;Yeerk Pool entrance,&gt; he says, and as he says it, you know it to be true. &amp;lt;We can&#39;t go forward, there might be a biofilter, and on the other side is hell. I&#39;ll add it to the list. We should get back and report to the others.&gt;

But something about the entrance captivates you. It&#39;s familiar; not as familiar as your own name or your mother&#39;s face, but you&#39;ve been here before. You&#39;ve moved that switch before. Have you crawled into that hole before? Impossible to know. Unless you do it.

[[Crawl in-&gt;Chapter 116]]

[[Go report to the others-&gt;Chapter 93]]</tw-passagedata><tw-passagedata pid="21" name="Chapter 116" tags="penultimate" position="5825,3350" size="100,100">You brush Tobias aside and crawl in.

&amp;lt;Hey! Where are you going?!&gt;

You ignore him. The passage is familiar. You drop neatly onto your feet in a space about the size of an elevator. Tobias swoops in just before a large metal door clanks shut and a dim light comes on, and you realise that you knew the size of the space even in the dark. You remember standing here before.

There is a low humming sound. Then an alarm.

BrrrrEEEEET! BrrrrEEEEET! &quot;Unauthorized life-form detected.&quot; BrrrrEEEEET BrrrrEEEEET! &quot;Unauthorized life-form detected.&quot; The robotic voice is not familiar, but Tobias flings himself against the door.

&amp;lt;We have to get out of here!&gt;

“It&#39;s one-way,” you tell him calmly, because you can&#39;t seem to feel anything but calm about this situation.

&amp;lt;It&#39;s going to kill us!&gt;

BrrrrEEEEET! BrrrrEEEEET! “Please close your eyes to protect against retinal damage from the Gleet Biofilter.”

You pull Tobias under your coat and squeeze your eyes shut.

Pain erupts all over your body, like hot candle wax being dripped onto your skin. Tobias squirms in your arms. One of his talons slices your forearm open, and you let him go as the pain worms its way into the cut. You gasp, fighting not to cry out.

And then it stops.

You check Tobias. You&#39;re both alive and upright.

You check yourself. There are no burns, and your body seems to work normally except for your right hand. The long, deep slice down your right forearm makes it difficult to move your fingers. It pours blood freely, although you don&#39;t think it&#39;s cut an artery. How can you tell?

&amp;lt;Sorry,&gt; Tobias says awkwardly. He starts preening a wing. &amp;lt;We should get out of here and get you to hospital.&gt;

“It&#39;s one-way,” you repeat, knowing this to be true. The only way out is forward, into the Yeerk Pool.

Tobias curses very creatively.

You ignore his questions about why you thought it was a good idea to come down here, his warnings that the Yeerks can&#39;t be allowed to take either of you alive, and press on. The door leading back to the construction site is sealed, but a door on the other side of the small room opens up into a long, sloping passage. You can hear something from down the passage. It might be the moving through a long tunnel. It might be screaming.

&amp;lt;We&#39;re going to die,&gt; Tobias says in the tone of one trying to stay calm and completely failing. &amp;lt;They know we&#39;re here, there&#39;s no way out, and you can&#39;t morph.&gt;

You point out that the biofilter should&#39;ve killed any insects, and it&#39;s a construction site. This probably happened all the time. There was no reason for any suspicion on behalf of the Yeerks.

&amp;lt;Right, right. So walk in like we own the place, stroll out another exit, head home. Easy.&gt; Tobias morphs cockroach and sits in your sleeve. You begin the journey downwards.

The passage branches a few times, heading off into offices and small storage rooms, but your feet know the way down. You follow them.

The vast cavern opens up before you. The storage sheds, the cages, the food court, the private meeting rooms down one side, and in the middle, the Pool itself, ringed by a semicircle of cages. Piers stretch over it from both sides; Yeerks exiting their hosts on the far side, reinfesting on the near side. And everywhere, people. Humans and Hork-Bajir being dragged onto the piers from cages, struggling. Others walking around the food court, chatting casually, eating, laughing, trying to ignore the Pool area. Guards at the Pool, and a few scattered at various entrances. It isn&#39;t hard to pick out who is and isn&#39;t infested; people leaving the far pier are either taken immediately to a cage or head directly to the food court.

The Controllers mostly look nervous. Guards keep a hand on their weapons, but they&#39;re not watching the cages. A pair of Controllers carrying a crate from one warehouse to another keep glancing at the sheds they pass. A lot of Controllers are watching you. They don&#39;t look aggressive, but they&#39;re paying attention.

Oh, right. You tripped an alarm. They&#39;re waiting to see if they&#39;re being attacked.

&amp;lt;What&#39;s going on?&gt; Tobias asks. You have no way of answering him.

[[Head directly for an exit-&gt;Chapter 117]]

[[Find an activity that makes it look like you&#39;re supposed to be there-&gt;Chapter 118]]</tw-passagedata><tw-passagedata pid="22" name="Chapter 117" tags="" position="5975,3050" size="100,100">Tobias-the-cockroach in your sleeve, you walk into the Yeerk Pool proper. The things around you slot into your memory, fitting in as if you&#39;ve known about them for years. Pool, cafeteria, cages, storage sheds. You see them, and you remember them. Something to think about later, when you&#39;re not in danger.

You pick an exit way over the other side of the Pool and head over. If anyone&#39;s going to keep an eye on you for the whole journey, they&#39;ll have to physically follow you.

A couple of guards do. They keep enough distance to avoid looking threatening, but they don&#39;t try to hide their intentions. They stop you as you&#39;re about to exit, suspicious.

They search you. They don&#39;t find Tobias, and you have nothing else incriminating. They ask you to step into a small chamber. You look at the small glass booth, about the size of a phone booth, the inside clearly visible from any angle, and it fits into your mind. You know what this is; it&#39;s another biofilter. A “just in case” measure.

And you have no non-suspicious way of warning Tobias.

[[Drop Tobias-&gt;Chapter 144]]

[[Take Tobias with you and hope for the best-&gt;Chapter 145]]</tw-passagedata><tw-passagedata pid="23" name="Chapter 118" tags="Reboot-Ending" position="4600,1700" size="100,100">(set: $c118ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You try to look like you&#39;re at the Pool for a reason, skirting around it and past the cafeteria, and heading for some random shed near one wall. You approach the sheds and, trying to look like you know what you&#39;re doing, go to enter one. It&#39;s locked.

Suddenly, you&#39;re surrounded by guards.

“That shed&#39;s restricted,” one of them says.

You apologise and try to leave. They don&#39;t let you.

“Why were you trying to get in there?” the guard presses. “Need your oatmeal fix, do you?” His hand drifts to a Dracon beam on his belt. “Why is it always the ones with teenaged hosts?”

“She might be able to tell us something about the distribution ring,” another suggests.

Tobias is sending you panicked thoughtspeak messages, asking what&#39;s going on. You can&#39;t answer. The guards demand that you exit your host. You can&#39;t do that, either. They call for backup, and you&#39;re escorted to a small room with a single chair and a very heavy, very lock-laden door. You lose Tobias somewhere along the way.

You&#39;re sat down. Strapped down. They demand again that you exit your host. You can&#39;t comply. They begin asking questions. Where do you get your oatmeal from? Who&#39;s supplying the school? They&#39;ve blocked every commercial outlet in town they can find, so where is left? When you can&#39;t give names, they take out knives, lasers, finger-crushing implements, and ask more forcefully.

You don&#39;t know how to answer a lot of their questions. But you do know some useful information, information worth a break in the pain, information that could greatly help the Yeerk Empire. You hold out as long as you can, but eventually, you start talking.

Somewhere out in the Yeerk Pool, chaos reigns. You hear a tiger roar, an elephant trumpet. The Animorphs have arrived. If they&#39;re lucky, they might yet still protect their secrets.

But it&#39;s too late to save you.

//An unfortunate result. Perhaps we will see more caution if we [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="24" name="Chapter 119" tags="Reboot-Ending" position="4700,1700" size="100,100">(set: $c119ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell the Animorphs that you can&#39;t agree to that. They don&#39;t seem surprised.

&amp;lt;Then you must wait here,&gt; Jake says. &amp;lt;We will be back. But we can&#39;t have an unknown element running about.&gt;

They leave you in the cabin, off to their mysterious mission. You wait.

And wait.

It is true that you don&#39;t need Kandrona rays in your current form. Your host, however, does need food and water. After a few days it becomes clear that the Animorphs, whether captured or killed, are not able to come back for you. You wonder, vaguely, where exactly Kiri and Dahvin are searching desperately for you. But you don&#39;t have the capacity to wonder for long.

//An unfortunate end. Well, we should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="25" name="Chapter 12" tags="" position="2025,2150" size="100,100">Annie nods politely and looks vaguely puzzled as you explain that neither she nor the school exists. She doesn&#39;t interrupt you as you point out that you&#39;re in the wrong millennium and that everything around you is impossible. But as you start to explain what Google is, you suddenly have her full attention.

She asks you to explain it again. You do. She asks you to explain how the internet works. You do, to the best of your ability. You explain modern phones and tablets and she pulls out a notepad and asks you to draw them. After a little while, she starts making corrections to you drawings. She&#39;s right every time. But before you can ask how she knows, she&#39;s pointing some kind of gun at you, and then everything goes black.

It&#39;s mostly dark when you awaken. You&#39;re in some kind of metal room, the only light streaming in through a little grate high in the wall. You are sitting in a chair, and some subtle attempts to get up confirm that you are, in fact, tied to said chair. Annie is talking quietly to somebody over the other side of the room. She&#39;s pacing; he&#39;s sitting on a small plastic barrel.

“She knows our tech,” Annie explains. “I had her draw it;, explain it. She gives things weird names, but she knows it.”

“So?” her companion replies. “If it&#39;s a security leak, eliminate it and move on.”

“Not until we know where the leak is. Besides...” Annie hesitates. “She said she was from the future. She made all this stuff out to sound commonplace on Earth. What if...?”

“Humans can&#39;t see the future, Temrash.”

“Not that we know of! But we might have missed something!”

“If humans could see the future, they would have seen us coming. Have you checked her records?”

“Not yet. I want to get one of ours in there to have a look around.”

“... Fine. Approved. But if this goes wrong, you will be held responsible.”

“Understood, sir.”

The man gets up and leaves through a door in the wall behind him. There is the brief sound of laughter and chatter as he opens the door, and dead silence when it is closed once more. Annie turns to you and smiles.

“You&#39;re a very special girl, Lorraine,” she tells you. “And you&#39;ve been chosen to join a very special society; to become a part of something bigger. No, don&#39;t speak,” she adds as you open your mouth. “I&#39;ve honestly had enough listening to teenage humans today. You can scream, if you want; nobody will hear you in here. I&#39;m supposed to try to get your cooperation, but frankly I think you&#39;ll be valuable enough even if we have to fight for you. And I&#39;m sure my friend Atan will appreciate the challenge.” She drags the little plastic barrel over and pulls the top off with one hand. Inside is water; no, not water – some kind of mud. There&#39;s something moving in there, swimming about. You can&#39;t see what it is, but knowing where you are, it doesn&#39;t take a genius to figure it out.

Annie pays absolutely no attention to anything you say or do as she dips her hand in and pulls out the Yeerk. She holds it gently in one hand while she grabs your jaw in the other to hold your face still while she raises the Yeerk to your right ear. It&#39;s impossible to move away; there&#39;s little you can do as you feel something push its way into your ear, followed by a sudden, intense pain deep in your head. You can see Annie&#39;s expression become puzzled, then worried. She takes the Yeerk away and twists your head to peer into your ear.

“How are you doing that?” she asks you, panic in her voice. “How are you stopping him from getting in? How are you protecting yourse – ” she&#39;s cut off by the sound of the door slamming open. She spins to face the intruder, releasing you to reach for her weapon, but a hole appears in her face before she can aim it. She falls to the ground, smelling of burned flesh.

The girl in the doorway lowers her Dracon beam and gives you a nod before stepping aside. A second girl rushes in and pulls a pocket knife out to sever your bonds. Both girls are dressed in off-white leotards, their faces masked. Their bearing suggests that they know exactly what they&#39;re doing.

“I&#39;m Lizard,” the girl says as she frees your hands. “Door duty over there is Eagle. Welcome to the Star Defenders. If you want to live, you should probably come with us.”

[[Go with the Star Defenders-&gt;Chapter 50]]

[[Run off on your own-&gt;Chapter 51]]</tw-passagedata><tw-passagedata pid="26" name="Chapter 120" tags="Reboot-Ending" position="4475,3275" size="100,100">(set: $c120ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

You dash to the other end of the room to free the baby. It&#39;s naked, lying on a cushion, and doesn&#39;t seem more than a couple of months old. The box has some kind of bolt on each corner; it quickly becomes obvious that you&#39;ll have to deconstruct the whole box.

You are so absorbed in the task that you&#39;ve lifted the child into your arms by the time you notice the two aliens strolling towards you down the hall. You raise your gun, aim… and realise that you have no idea how to use it. The aliens, however, do.

//Hook it back in… re-initiating… [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="27" name="Chapter 121" tags="penultimate" position="4800,4025" size="100,100">The cage isn&#39;t difficult to open. As soon as the door is open, the dog-thing snarls and leaps straight at you. You don&#39;t have time to flinch away before its long needle teeth sink into the weapon in your hands. The gun is crushed into fragments, which begin to melt.

**She does not like the weapons,** the thing in the tank points out mildly. **If you release me I will translate for you.**

The tank, too, is fairly easy to open. The being inside climbs out, the open air giving it no apparent trouble, and drops onto the dog-thing&#39;s back, wrapping its long sloth arms around the dog-thing&#39;s throat. She doesn&#39;t seem to mind.

You look around for somebody else to free, but two of the large-eyed grey aliens are headed down the hall towards you.

Your doglike companion dashed forward and leaps up to knock one of the aliens down. She crouches on its chest, snarling.

**She asks you to drop the guns,** the squid-thing says mildly. The aliens do.

The squid-thing looks to you. **This is your escape. Where now?**

[[Demand to be taken to an escape pod-&gt;Chapter 124]]

[[Demand to be taken to the cockpit-&gt;Chapter 125]]</tw-passagedata><tw-passagedata pid="28" name="Chapter 122" tags="Reboot-Ending" position="5200,3600" size="100,100">(set: $c122ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

You dash to the other end of the room to free the baby. It&#39;s naked, lying on a cushion, and doesn&#39;t seem more than a couple of months old. The box has some kind of bolt on each corner; it quickly becomes obvious that you&#39;ll have to deconstruct the whole box.

You are so absorbed in the task that you&#39;ve lifted the child into your arms by the time you notice the two aliens strolling towards you down the hall. You barely have time to put the baby down safely before everything goes black.

//Hook it back in… re-initiating… [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="29" name="Chapter 123" tags="penultimate" position="5075,4025" size="100,100">The cage isn&#39;t difficult to open. As soon as the door is open, the dog-thing snarls and dashes past you. She glares down the corridor, snarling.

**She smells the captors,** the thing in the tank points out mildly. **If you release me I will translate for you.**

The tank, too, is fairly easy to open. The being inside climbs out, the open air giving it no apparent trouble, and drops onto the dog-thing&#39;s back, wrapping its long sloth arms around the dog-thing&#39;s throat. She doesn&#39;t seem to mind.

You look around for somebody else to free, but two of the large-eyed grey aliens are headed down the hall towards you.

Your doglike companion dashed forward and leaps up to knock one of the aliens down. She crouches on its chest, snarling.

**She asks you to drop the guns,** the squid-thing says mildly. The aliens do.

The squid-thing looks to you. **This is your escape. Where now?**

[[Demand to be taken to an escape pod-&gt;Chapter 124]]

[[Demand to be taken to the cockpit-&gt;Chapter 125]]</tw-passagedata><tw-passagedata pid="30" name="Chapter 124" tags="Reboot-Ending" position="4900,3850" size="100,100">(set: $c124ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

You demand to be taken to an escape pod. The captive alien, after some hesitation, seems to decide that losing a few prisoners is better than having their throat torn out. The other alien bolts, presumably going for help. You have to move fast.

The escape pods are fairly close. You and your companions climb in, bringing your hostage. Earth is clearly visible, out in space; your companions don&#39;t protest as you order your hostage to take you there. You suppose that you&#39;ll have to find a way to help them get home later.

Your hostage flips some switches in the cramped little pod. It disengages from the ship. You begin to drift towards the Earth. You can see the ship of your kidnappers slowly receding; it&#39;s a big disk, like a frisbee or a UFO from a bad 80&#39;s scifi movie. It doesn&#39;t seem to be levelling any weapons at you.

Looks like you&#39;re home free.

Then, suddenly, your jellyfish-like companion falls unconscious.

Your doglike companion growls, but sluggishly. Her eyes begin to close. You don&#39;t see what happens next, because your own eyes are closing against your will as you fight the sudden, overpowering urge to sleep.

You manage to stay awake long enough to see your captive turn the pod back around. The spaceship comes back into view, and then you see nothing.

//They are stable. We should hook it back in, quickly. We will need to reset. Time to [[try again-&gt;Chapter 1]]. //</tw-passagedata><tw-passagedata pid="31" name="Chapter 125" tags="TRUE-END" position="5050,4275" size="100,100">(set: $c125ending to true)\

You demand to be taken to the cockpit. Your captors are very reluctant to do this. The one still standing tries to bolt; when your companion swiftly tears the throat out of her captive and pulls down the fleeing alien instead, it&#39;s much happier to comply.

You are led a little way further down the curved corridor, then down a straight narrow corridor that meets it at a right angle. You intersect several other curved corridors on your journey. It&#39;s not difficult to build a map of the area; the curved corridors form several concentric circles intersected by the narrower, straight corridors, like the spokes of a wheel. If your mental map is correct, then you are heading for the center.

About halfway down the corridor, you cross a much wider curved corridor that is very brightly lit by fast-moving lights on the ceiling, zooming down it from right to left. Your squidlike companion warns the grey alien not to try anything tricky as the four of you nervously traverse the space. You move on.

The center of the ship is dominated by a large, domelike room. The doors are not locked; they slide open easily. The room is, however, occupied; a dozen or so grey aliens point weapons at you as you enter.

The reaction of your companions is immediate. Your squidlike companion throws themselves at you. They aren&#39;t heavy, but the unexpected weight pushes you over, behind some sort of computer terminal. Your doglike companion has leapt into action before you land, taking down the aliens one by one. Several of their shots hit her, and the smell of burning fur fills the room, but she doesn&#39;t slow. Your eyes are covered with tentacles; you a told in a soothing, coaxing voice to stay down.

It&#39;s over very, very quickly.

Trying to ignore the blood (blood like no blood you&#39;ve ever seen) in the suddenly quiet room, you move to inspect the computers. Your squidlike companion seems to be a natural with them; a claw on the right button and the doors all close, a tentacle across a sensor and the screens light up. You are very close to Earth. You can make it to Earth. From there? Well, the ship would require some repairs before it could get your companions home, but it could be done. Or you could turn them over to the government of your choice, if you were selfish enough. You&#39;d have all the time in the world. You&#39;d be home. In your body. In your world.

You breathe with lungs that are just the right capacity, move limbs that are just the right length. You tell your companions to take you back to Earth. You have to think. To plan. But you have time.

You are going home.

&#39;&#39;THE END&#39;&#39;

&lt;img src=&quot;https://wmbsaltworks.neocities.org/images/writing/twine/tenor.gif&quot;&gt;</tw-passagedata><tw-passagedata pid="32" name="Chapter 126" tags="penultimate" position="4900,1000" size="100,100">You let the man pull you into a narrow corridor, sloping downwards into the ground. You walk for about two minutes before he pulls you through one of many doors lining the sides. You find yourself in a fairly small room, dimly lit with old fluorescent lighting. The man relaxes, pulls out a phone, and seems to text someone.

A modern phone. It looks a bit like an iPhone. The image of him holding it in that way, a little too close to his face, with his shoulders hunched as he pecks at the screen with his thumbs, fits as comfortably into your mind as his face does. He&#39;s as familiar as your mother, as familiar as your name.

You ask him who he is. He looks at you with pain and fear in his eyes.

“You&#39;ve lost your memory again?” he asks.

Again.

“I&#39;ve informed Dahvin,” he says, waving the phone. “He&#39;ll be here any moment. Your name is Mana 087. I&#39;m Kiri 554. Is any of this familiar?”

It is. Kiri looks relieved.

“This is getting better,” he says. “I swear it&#39;s getting better. We thought… we thought maybe you wouldn&#39;t lose your memories this time, and we were wrong, clearly, but you lasted longer than – ”

He&#39;s interrupted by the door opening. The tall black man, maybe in his late teens and dressed in scruffy pants and a basketball shirt, is equally familiar as he enters. You suppose this must be Dahvin, and as you do, the name fits neatly into your memory. This is indeed Dahvin.

He reaches forward and tips your chin up, looking into your eyes. The concern in his expression is familiar.

“Mana,” he says, “are you…?”

“She&#39;s lost her memory again,” Kiri tells him.

“Again?” Dahvin shakes his head. “This is too dangerous. We have to get her out of here.”

“To where? If we can&#39;t keep an eye on her – ”

“If Visser Three finds her, he will kill her! She can&#39;t lay low if she can&#39;t remember to lay low!”

“And if she loses her memory out somewhere else, without us? Do you really think that&#39;s any less dangerous for her? She&#39;d waltz back into town following some thread of inquiry with nobody to warn her of the danger.”

“She got this far without us warning her! Without time to properly monitor this – ”

You shuffle your feet. The two men seem to remember your presence.

“Mana, I&#39;m so sorry about this,” Kiri says. “This will get better, I promise. It&#39;s not as bad as it sounds.”

“She has no idea what you&#39;re talking about,” Dahvin reminds him.

“Right. Yes. Right.” Kiri runs a hand through his hair. “From the beginning, then. You&#39;re Mana 087 of the Nen Menirr Pool. You&#39;ve been stationed on Earth for two years. You had fairly basic monitoring duty, young human host, part of a takeover of a local high school.” As he says these words, you know them to be true. They fit. “We were… we… worked together a fair bit, the three of us, and we… anyway, you had some kind of secret side project going. Said you were investigating something monumental with a friend. Said you couldn&#39;t tell us who or what, yet, for our own safety, but said it could change the whole war. Even more than my oatmeal research, you said; we had a bet going on that, one I guess that&#39;ll never be resolved now.”

“There was a car accident,” Dahvin adds, putting a hand on your shoulder. “You were out on the edge of town doing this secret project thing and you were hit. It should&#39;ve been fine, right? A waste of a host, sure, if the injuries were too bad, but you were doing well; you probably would&#39;ve been bumped up the waiting list.”

“I had you put in my ward as soon as I heard,” Kiri says. “I was worried. You seemed fine on the scans, but… well, your host wouldn&#39;t wake up. You were shut off from us. You wouldn&#39;t exit your host; I don&#39;t know if you couldn&#39;t, or if you just couldn&#39;t hear us and didn&#39;t realise the danger, but the coma seemed like it might be permanent, and…” he shrugged.

“We couldn&#39;t just let you die,” Dahvin adds gently. “Not after everything. And not via starvation.”

“There was no way to get you out of there and into a Pool, and the higher-ups didn&#39;t care,” Kiri growls. “Why would they? You&#39;re of medium clearance without any high level of profession; you were… replaceable.” He spits the word. “We only had one possible avenue to stop you from dying horribly and painfully, understand? We didn&#39;t want to do it, but it was our only shot. And it worked.”

“Kiri&#39;s area of research is chemical engineering,” Dahvin says. “I was on supply control. We were… the opportunity was obvious. He&#39;d been… we&#39;d been… experimenting with maple and ginger oatmeal extracts, trying to find the addictive, useful and… deleterious compounds. Our research wasn&#39;t complete, but with what we had...”

“We injected our best-guess compound to keep you alive,” Kiri admits wearily. “And it worked. Your host woke, eventually, but every brain scan has shown that its brain is quiet; it&#39;s not conscious, it can&#39;t think, there&#39;s just you. But you couldn&#39;t seem to disengage. Whether it was the car or the compound, I don&#39;t know, but you were stuck in there.”

“We were working on trying to find a way to get you out when you lost your memory the first time,” Dahvin adds. “This is the third time it&#39;s happened. But… you seem to be getting better. We&#39;re… kind of hoping you&#39;ll recover well on your own. Even if… well...” he exchanges a glance with Kiri.

“We don&#39;t think you&#39;re making memories in your own, you know, mind,” Kiri adds reluctantly. “There have been… delusions… trying to fill the gaps. You seem to just be using your host&#39;s brain tissue to store memories, and that tissue is damaged, so when something slips...” he shrugs. “But in our last scan it seemed to be recovering. Sorry, we&#39;re… we&#39;re going through this way too fast. It&#39;s not as bleak as it sounds. I really do think it won&#39;t be long now before you&#39;re able to disengage and swim in the Pool again, and everything else we&#39;ll figure out as we go. But we need to keep you out of sight of the Empire as a whole, because they think you&#39;re dead.”

“We need a success story before we can let any of this be known,” Dahvin adds. “Otherwise they&#39;ll – ”

He&#39;s interrupted by the door opening and a Hork-Bajir, hunching over in the small space, bustling in. He largely ignores you, focusing instead on Kiri and giving an unsettling Hork-Bajir grin.

Kiri frowns. “What do you – ” his expression goes stony as a woman enters the room. She looks to be in her mid-forties, well-dressed but not overdressed in a neat blouse and skirt, mostly grey hair pulled back into a bun and held in place with bobby pins. She looks vaguely familiar, but not particularly familiar. You can&#39;t tell whether you know her or not.

“Kiri,” she says, with a nod.

“Alsam. Were you… spying on me?”

“Obviously. And it looks to be worth the effort.” Her eyes rest on you, bright with triumph. “You&#39;re given control over this oatmeal research and you use it to create illegal research projects where you supply junkies?”

“She&#39;s not a junkie! She&#39;s – ”

“Really? Just how much did you dose her with?”

“I am...fairly sure that we have isolated the addictive element.”

“Fairly sure? Can you prove it?” Alsam inspects her fingernails. “No matter. I assure you, your research won&#39;t die. I&#39;ll go through your notes when I have the project in hand, and if the addictive element is resolved, than I can present that information to the Visser.” She smiles. “I am sure that that knowledge will comfort you.”

“This is about the project.” Kiri narrows his eyes. “Do you really think you can pull my work out from under me?”

“Apparently, yes.” Alsam gestures towards you with one hand. “This is, technically, treason.”

“It&#39;s a side experiment.”

“So if I go through the computer records, I&#39;ll find your friend here and her host appropriately documented as test subjects? I won&#39;t find any coincidental misfiling of inaccurate death notices?”

Kiri was silent.

“Thought so. Well, have fun at your trial.” She nods to the Hork-Bajir. “Arrest them.”

Dahvin grabs your left hand, Kiri your right. But there&#39;s nothing much that can be done. For the two of them, there&#39;s nowhere to go; even if they could escape the Hork-Bajir, they&#39;re tied, like all Yeerks, to the Pool.

All Yeerks except you.

[[Attempt to flee-&gt;Chapter 127]]

[[Go quietly-&gt;Chapter 128]]</tw-passagedata><tw-passagedata pid="33" name="Chapter 127" tags="Reboot-Ending" position="4500,1800" size="100,100">(set: $c127ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

There&#39;s nowhere for Kiri or Dahvin to go, but you have the world. You duck past Alsam and the Hork-Bajir, who are too taken aback to stop you, and bolt down the corridor back towards the surface, back towards light.

Unfortunately, Hork-Bajir are a lot faster than you are.

//Panic. Somewhat of a flaw in the design. I suppose we must [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="34" name="Chapter 128" tags="penultimate" position="5775,1350" size="100,100">You won&#39;t abandon your friends. Besides, your chances of getting past a Hork-Bajir are miniscule at best. You give each of their hands a reassuring squeeze before the three of you are led out of the room.

You are taken down to the Yeerk pool. Now that you know what&#39;s going on, the way things seem to fit into your mind is a lot less disconcerting. The Pool itself is familiar. The piers are familiar. The little fast food area is familiar. You sort of think you can remember the sensation of swimming in the Pool with your comrades, but you might be imagining it.

The cages are definitely familiar; your host has spent a fair amount of time in these. The three of you are ushered into one, with one hand cuffed to the bars, which is unusual. You think you might be able to slip your narrow, teenage-girl hand out of the cuff it you had to, but with no way of getting through the bars, what would be the point?

The other people in the cage, the temporarily uninfested Controllers, stay away from you. They&#39;re silent, but a couple of them glare at you murderously. Most of them look at your with fear. Normally, the cages have more shouting and crying than this.

The three of you sit down to wait. Your reminisce about old times, old stories that Kiri and Dahvin remember and you don&#39;t. Some of them slot into your memory as they tell them. Others don&#39;t. How much have you lost? They try to reassure you, and each other. There&#39;s a way out of this. There has to be a way out of this.

You don&#39;t ask them most of the questions you still have. Too many witnesses. The humans in your cage are going to remember what you say and do, and other Yeerks will see those memories. Kiri had already told you that delusions were normal, so maybe your other life, your future life, was all in your mind, born of a mishmash of current Yeerk technology and current social norms and everything that didn&#39;t fit was just remembered as some old book. Maybe. But that doesn&#39;t explain how you know about the Chee. The Animorphs. The Star Defenders. That doesn&#39;t explain how you know things that will happen next in the “book series”. Perhaps knowing the future, too, is a delusion, but what about the other groups? Are there Yeerks that know about these things and have to keep them secret for some reason? Are you one of them?

Is this information that you&#39;re supposed to keep from Kiri and Dahvin, too?

About four hours pass. You can estimate the time frame based on the rotation of humans going in and out of the cages. You know it&#39;s time when a sense of overwhelming fear and dread creeps into your mind, growing stronger by the second; it fits into your memories. You&#39;ve felt this before, many times.

Visser Three walks into view. He seems distracted, annoyed. Not a good sign. You suppose that you might be interrupting something. It&#39;d be just your luck if he decided not to waste time with a proper hearing and just beheaded all three of you before getting on with his day.

In fact, that sounds exactly like something Visser Three might do.

He approaches the cage, and it&#39;s impossible to tell how much fear is your own actual fear and how much is induced by his thoughtspeak emotional aura. He gives each of you a casual scan with a stalk eye and says, in a bored tone, &amp;lt;Explain.&gt;

“Visser,” Kiri says hurriedly, “Alsam is trying to build a fatuous case for personal gain at the expense of the Empire – ”

&amp;lt;I have no time for posturing today, Kiri Five Five Four. Explain to me why this creature, who I know to be reported as dead, is alive and in one of my cages.&gt;

Kiri nods. “Yes, Visser. She is part of a plan to capture the Andalite Bandits.”

&amp;lt;… Explain.&gt;

“They have weaponised oatmeal against us. We can do the same. As you know, Visser, I have been researching – ”

&amp;lt;Skip the parts that I know,&gt; Visser Three snaps irritably, &amp;lt;or I will simply save time and move straight to your execution.&gt;

“Uh, yes, Visser. Mana doesn&#39;t need Kandrona rays, but unlike most… victims of the oatmeal issue, she retains one hundred per cent control of her host.”

Visser Three narrows his eyes. &amp;lt;How? No, do not explain; I will have one of my scientists go through your reports later. You are sure of this?&gt;

“Yes, Visser. Her host is… well, functionally dead, as a result of brain damage. Alive enough to control, but permanently unconscious. As far as we can tell.”

&amp;lt;As far as you can tell.&gt;

“Yes, Visser.”

&amp;lt;Very well. Tell me of this plan.&gt;

Kiri swallows nervously. “Well, Visser, the bandits have shown a willingness to starve us to death before. The woman whose form they used to infiltrate with the oatmeal; that girl who was kidnapped – ”

&amp;lt;I am aware of the cases.&gt;

“Right. If we set up something important-seeming and allow the bandits to learn that Mana here has some vital security codes or some such thing, we can entice them into holding her for three days and &#39;starving&#39; her. She can then pretend to be human and pass on any false information that we like without suspicion. We can use this to lure them into a trap and take down them all; even if that doesn&#39;t work, she should be able to learn important secrets from them.”

&amp;lt;Andalites are unlikely to share important secrets with a human captive. However, your plan has potential. If you can bring me the Andalite Bandits, I might forgive your previous deceptions.&gt; He thinks a moment. &amp;lt;Very well. You have two weeks to bring me the Andalites, or information valuable enough to be worth your lives. I will make some Hork-Bajir available for your use.&gt; He turns and walks away.

A few minutes later, somebody comes along to let you out of the cage.

“Good thinking, Kiri,” Dahvin says, sounding relieved. “I guess we have a trap to plan, huh? And we can&#39;t afford to fail.”

A trap. A way out; if you go along with the trap plan and get captured by the Animorphs, you can tell them everything. Maybe they&#39;ll help you escape, but that would be a death sentence for Kiri and Dahvin, who gave so much to keep you alive. Or you can capture the Animorphs, and buy life and political recognition for all three of you. Of course, if you really want to eliminate the Animorphs, there&#39;s a much easier way to go about it than with a complicated trap.

Because you know who they are. You know – vaguely – where they live. And for them, that&#39;s risky. If you find them…

[[Go along with the trap plan for now-&gt;Chapter 129]]

[[Tell Kiri and Dahvin everything you know about the Animorphs-&gt;Chapter 130]]</tw-passagedata><tw-passagedata pid="35" name="Chapter 129" tags="" position="6150,1575" size="100,100">Setting a trap is fairly easy. Your team takes control of an office building, puts double flyscreen on all the windows, and puts a suspiciously sized round-the-clock guard on it. You stick a big vault in it with a long, complicated code, make sure you&#39;re the only one who knows it, and make sure that several people are aware of this. Several friends who thought you were dead are delighted but confused over your reappearance; you pretend to remember who they are and explain that you had to fake your death as part of this top secret mission.

The details are more complicated. Kiri and Dahvin don&#39;t understand your insistence on the thoroughness of the guard patrols, but you know that a Chee could probably break into the safe if they could get in and out without alerting a guard, so somebody needs to stand directly in front of the safe. Even without the Chee, even if you get the Animorphs in there, they have a remarkable ability to survive things that they, by all rights, shouldn&#39;t. Whatever happens, if you go through with this trap, there will be a bloodbath.

You make sure that Erek knows that you have the codes to The Project. You visit the Yeerk Pool every three days and hang around for awhile in case you&#39;re being watched. You wait. You spend a lot of time wandering around alone on the edge of town, in places where it would be easy to abduct you without witnesses. Your deadline ticks closer.

Then, one night, it happens. A tailblade is pressed to your throat and the mental voice of an Andalite boy hisses &amp;lt;Do not move, Yeerk.&gt;

You don&#39;t move.

The “Andalite Bandits” pull you into an alleyway and start their intimidating posturing. You refuse to talk. They threaten you with more force. You keep refusing. Eventually, they decide to do the obvious thing; to tie you up somewhere. They have indeed been watching you; they know you have twenty four hours left on your clock before you&#39;re supposed to visit the Yeerk pool again.

And then they debate exactly where they&#39;re supposed to keep you, and how. They&#39;re all too young to drive. Cassie in horse morph would take too long to get you anywhere isolated; in fact, the only isolated place they have is a broken-down shack way off in the woods. They could take the bus almost to Cassie&#39;s farm, but that would involve riding a bus with a prisoner who might call for help at any moment.

Getting abducted by this group is frustratingly difficult.

Eventually, they go with the horse plan, Cassie demorphing and remorphing out of your sight while the others do their best to act like Andalites. You put up enough of a fight to be realistic before letting them threaten you into cooperation.

The trip out to the shack takes three and a half hours. Cassie swaps out for somebody else halfway. You don&#39;t know who. They take you inside, shove a bunch of camping gear off an old chair, and tie you to it.

This is your chance. You need to decide who to trust and who to help: your fellow Yeerks, or the Animorphs? Or can you trust neither?

[[Tell the Animorphs everything and ask for their help-&gt;Chapter 131]]

[[Stick to the plan and capture the Animorphs-&gt;Chapter 132]]

[[Trust nobody, pretend to go along with the plan but strike out on your own at the earliest opportunity-&gt;Chapter 133]]</tw-passagedata><tw-passagedata pid="36" name="Chapter 13" tags="" position="2250,1700" size="100,100">You make up some stuff about school stress and get back to class. Next point of order: find the Animorphs.

The Animorphs aren&#39;t hard to spot. They cluster together at a table at lunch; four students who you know by sight. It&#39;s probably not a great idea to approach them at school, but in passing you hear Marco use the words &#39;barn&#39; and &#39;tonight&#39;. Perfectly innocuous terms to most people, but enough for you to go on.

Finding out where Cassie&#39;s farm actually is is a little trickier in a world without Google maps, but not impossible; the Wildlife Rehabilitation Clinic has a clearly listed address in the phone book. You give them a head start before heading out there yourself.

You take the bus, which brings you within walking distance of the Clinic. You suppose that if Cassie&#39;s parents see you you can claim to be looking for somewhere to volunteer or something.

The Animorphs are clearly deep in discussion as you approach the barn. You can&#39;t make out many words, but the tones are urgent. You hesitate before leaning a little closer to the door, trying to make out the conversation.

And then somebody grabs you from behind.

There&#39;s little point in struggling; whoever it is is either very strong or simply doesn&#39;t care as they rearrange their grip to hold you in a headlock. It&#39;s a girl, judging by the manicured nails, but you can&#39;t turn your head enough to be sure as a second person grabs your arms and forces them behind your back at a painful angle. You&#39;re dragged into the shed and thrown to the straw-laden concrete floor.

The five pairs of feet in front of you are all bare. You look up further to see five teenagers. Jake stands in the middle of the group, looking down at you calmly, arms crossed. Rachel inspects her nails and spares a glare for you, as if any damage to them is your fault. Marco, as you watch, deliberately circles around you to block the door. Cassie bites her lip and looks like she wants to help you up. You don&#39;t know the fifth teenager, a cute multi-racial boy who could be the brother of any of the others, but it&#39;s not hard to guess his identity.

From the rafters, a hawk glares down at you. Of course he would have heard you coming.

“So we have a spy,” Rachel growls. “How much do they know?”

“It&#39;ll be better if you just talk,” Marco advises. “You don&#39;t want to make her mad.”

“I&#39;m not a spy,” you insist. “I need your help. I can explain.”

“You probably should,” Jake says.

[[Explain that you know all about the Animorphs but don&#39;t know how-&gt;Chapter 14]] 

[[Explain that you&#39;re trapped in a children&#39;s book series from the 90s-&gt;Chapter 15]]</tw-passagedata><tw-passagedata pid="37" name="Chapter 130" tags="Reboot-Ending" position="3800,1900" size="100,100">(set: $c130ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell Kiri and Dahvin that there&#39;s a simpler way. And then you tell them everything that you know.

The new plan requires a lot of troops, as several things have to happen at the same time if you want to take down all of the disparate groups. The Star Defenders are low priority, but the Chee are an unavoidable asset that will vanish the moment they realise you&#39;ve pegged them, and you can&#39;t attack them first for fear of alerting the Animorphs. In the end, Dahvin plans a Sharing event on a school night, just an inoffensive welcome barbecue, and has Erek and Jenny rostered to help. While he arranges that little ambush, you and Kiri plan the simultaneous takedown of the Animorphs. Kiri calls in every favour he has, promising hosts to friends of friends in his vast social network, while you track down the Animorphs&#39; addresses and advise the troops on Animorphs activity and likely reactions.

The plan is detailed. Rachel and Cassie&#39;s mothers are easily taken at their respective places of work mere hours before the attack, and Tom&#39;s Yeerk is pulled into the plan to take Jake. Fully aware of just how much of Visser Three&#39;s wrath is likely to befall him for not noticing he&#39;d been living with one of the &#39;Andalite Bandits&#39; for so long, he is very eager to cooperate. Each of the agents takes a Dracon beam and a friend in a jar, and stuns and infests an Animorph in their sleep.

Cassie calls an emergency meeting at the barn without telling Tobias or Ax. The three Controller Animorphs are easily able to stun and overcome Marco. And with that, it&#39;s out to Ax&#39;s scoop.

You neglected to warn the troops about the proximity alarms Ax set up in case of Taxxon bloodhounds, so he is warned by the approach of the backup soldiers. But alone, he&#39;s no match for four Animorphs. Tobias shows up to the fight too late, just in time to see Ax go down. Ax tries very hard to fight to the death, and almost succeeds. But in the end, you take him, and Tobias is forced to flee.

Tobias proves impossible to track down. You sweep through the Star Defenders while you wait for him to show himself, managing to pick up about half of them. The modular nature of their organisation was designed to resist this sort of infiltration, and about half of them manage to escape, some with and some without their families, but none with any real power to resist you. Kiri&#39;s engineers are hard at work reverse-engineering Chee technology and trying to decode their memories, but it&#39;s a difficult job. Dahvin takes control of the new Animorph Controllers, using them to tie up any loose ends and root out any further problems in their memories. The traitor Aftran is found and executed before her poisonous ideology can spread. Something about her is very familiar to you, fitting into your memories, but you never figure out enough to be sure exactly why her execution bothers you so much.

There are still loose ends. Tobias is out there, presumably gathering forces. The free Hork-Bajir made a getaway before your troops made it to their valley. You found David, but he died before he could be infested and you don&#39;t know where to even begin looking for the Escafil Device. And all the distinctions and promotions that come with being the Yeerks who destroyed the Andalite Bandits just bring the three of you closer and closer to Visser Three&#39;s taiblade should he have a bad day. Especially you; the damaged Yeerk who survived only by the illegal use of an illegal drug. The three of you are offered an assignment off Earth. Visser One has personally requested the three of you to work directly under her. It&#39;s a massive promotion, and you can see the politics behind it – if the people who solved Visser Three&#39;s biggest, most embarrassing problem are her people…

Kiri and Dahvin insist that you take it, if only for your safety. Visser One doesn&#39;t have such a reputation for beheading underlings who embarrass or mildly inconvenience her. The three of you move to Anati, a beautiful planet with lush rainforests and huge crystalline mountains, and work to prepare its sublimination to the Yeerk Empire.

Thanks to you, the Empire is more powerful than ever. Thanks to you, the Yeerks, your people, might just come out of this war on top.

//Interesting choice. Even with the memories of a human life, it chose the Yeerks. These beings merit further study. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="38" name="Chapter 131" tags="penultimate" position="6025,1775" size="100,100">You start talking. Ax immediately dismisses your protests as &amp;lt;petty Yeerk lies&gt;, but three days later, when you&#39;re sticking to the same story, they&#39;re forced to accept the truth – you don&#39;t need Kandrona rays, and this is all too coincidental to not be a trap.

Unfortunately, this doesn&#39;t convince them to automatically trust you. A group of dangerous animals gather in the shack and don&#39;t bother to hide their conversation from you.

&amp;lt;So it doesn&#39;t need the Kandrona,&gt; Marco shrugs. &amp;lt;That&#39;s about the worst news ever, if you ask me. Kandrona rays are the Yeerks&#39; big weakness. Without them, they&#39;d take over the Earth like that.&gt;

&amp;lt;Or not,&gt; Cassie says thoughtfully. &amp;lt;The Kandrona keeps them trapped. Not just by us, by their own government. Yeerks have nowhere else to go, which is probably why their government so easily controls them. Who knows how many rebel factions, how many dissenters, how many Yeerks looking for a better way, there would be if they weren&#39;t at the mercy of an Empire-controlled food source their whole lives?&gt;

&amp;lt;How many planets would fall to their tyranny if they were not slowed by their need to establish Pools,&gt; Ax counters.

&amp;lt;How many innocent species would get caught in the crossfire,&gt; Rachel adds.

&amp;lt;Aren&#39;t we kind of missing the point here?&gt; Tobias asks. &amp;lt;Isn&#39;t the whole deal with the oatmeal that it drives the Yeerks insane? We already used it knowing this Kandrona independence could happen.&gt;

&amp;lt;Oh, man.&gt; Cassie flattens her wolf ears. &amp;lt;This is going to make freeing hosts so much more complicated.&gt;

&amp;lt;We weren&#39;t freeing all that many to begin with,&gt; Jake points out.

&amp;lt;Okay, fair point.&gt;

&amp;lt;Are you nuts?&gt; Marco asks you, not even bothering to try to sound more like an Andalite.

&amp;lt;How would she know?&gt; Tobias asks.

&amp;lt;George Edelman exhibited signs of varied control,&gt; Ax points out. &amp;lt;I have noticed no such signs in this host.&gt;

&amp;lt;Better question,&gt; Marco says. &amp;lt;Nuts or not, how do we know if we can trust her?&gt;

They ask you to explain the trap again. You do. They start to discuss ways to reverse it. Ways to turn the situation to their advantage. But the trap was built well – there&#39;s nothing of value in that building, nothing to gain.

&amp;lt;I say we evacuate her and forget this whole thing,&gt; Tobias proposes.

&amp;lt;And endanger our evacuation pipeline if she&#39;s a spy?&gt; Rachel asks.

&amp;lt;Right. Sorry. Bad idea.&gt;

&amp;lt;She could get us into the Yeerk Pool,&gt; Rachel points out.

&amp;lt;Why?&gt; Marco asks.

&amp;lt;Surprise attack. Do some damage. We have to keep them on the run, keep them always guessing. Do this right in the middle of this oatmeal thing, have them doubt their own people.&gt;

&amp;lt;Nuh-uh.&gt; Marco shakes his gorilla head. &amp;lt;Last time we were down there, we nearly died. We always nearly die. In fact, last time after we got out, it lead directly to Cas – to one of our own ending up in that forest thing, remember?&gt;

Your mind goes silent as the Animorphs switch to private conversation. You wait. They seem to be debating something, but without being able to hear the conversation, it&#39;s impossible to tell which vaguely agitated animal is on what side. Eventually, Jake turns his tiger glare on you.

&amp;lt;Let me be clear, Yeerk,&gt; he growls in your mind, &amp;lt;we do not trust you. But we are willing to give you a chance to prove yourself. You have warned up about this trap, after all, and that counts for something.&gt; His tail swishes. &amp;lt;We have a mission coming up for which you might be helpful. But we can&#39;t tell you the details, not when you might be a spy. So here&#39;s a simple question – can you, and will you, obey orders without question, whether or not they make obvious sense at the time? If not, say so now, rather than in a situation where you might get killed.&gt;

[[Agree to help the Animorphs-&gt;Chapter 94]]

[[Refuse-&gt;Chapter 119]]</tw-passagedata><tw-passagedata pid="39" name="Chapter 132" tags="Reboot-Ending" position="4000,1900" size="100,100">(set: $c132ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You let the Animorphs tie you up. You sulk a lot and curse them occasionally. Three days pass, and you scream, struggle, and pretend to die. You open your eyes and thank them for freeing you.

You give your rescuers the codes and details that they want. They untie you, take you to Cassie&#39;s barn, and tell you that they have a way to get you out of the city, just as soon as they finish this mission.

You don&#39;t stick around and wait for them to come back.

Animorphs, you know, are good at getting out of traps. But most of those traps weren&#39;t built by people who know all their secrets. You know the team, know how they operate; you know how to take them apart.

In the end, the trap doesn&#39;t destroy the &#39;Andalite Bandits&#39;. But it does kill two of them, a far greater victory than any other Yeerk attempt. It&#39;s enough to earn you a promotion and sweep charges of treason and oatmeal addiction under the rug. (Curiously, even knowing what Dahvin and Kiri did to you, you don&#39;t have any particular urge to try instant maple and ginger oatmeal.) With this victory, you can look forward to a long, profitable career in the Yeerk Empire.

Unless some random Animorph raid or Visser Three temper tantrum gets you killed, of course.

//Even with human memories, it chose to kill them. Fascinating. This merits further study. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="40" name="Chapter 133" tags="penultimate" position="5950,1650" size="100,100">You let the Animorphs tie you up. You sulk a lot and curse them occasionally. Three days pass, and you scream, struggle, and pretend to die. You open your eyes and thank them for freeing you.

You give your rescuers false information; false enough that they&#39;ll avoid the trap. They untie you, take you to Cassie&#39;s barn, and tell you that they have a way to get you out of the city, just as soon as they finish this mission.

You are alone. But… something niggles at your memory. Something about the barn. With other people in it and things going on, you didn&#39;t notice, but as soon as they leave you alone in the quiet, dark space, you realise it.

This place fits into your memory. It fits like your host&#39;s mother&#39;s face, like Kiri&#39;s eyes. It&#39;s vague, something you haven&#39;t seen much before… but you&#39;ve been here. No, not here… in that stall, the far stall. Watching.

[[Investigate this further-&gt;Chapter 149]]

[[Get out of there before the Animorphs come back-&gt;Chapter 150]]</tw-passagedata><tw-passagedata pid="41" name="Chapter 134" tags="penultimate" position="4625,2675" size="100,100">You turn left, and head towards the doctors&#39; offices.

Your path leads you, unsurprisingly, to a doctors&#39; office. It is very familiar, but a cursory search reveals no useful information.

[[Take the middle path-&gt;Chapter 135]]

[[Take the right path-&gt;Chapter 136]]</tw-passagedata><tw-passagedata pid="42" name="Chapter 135" tags="penultimate" position="4850,2650" size="100,100">You take the middle path. With each step, you become sure of the next. You walk forward. You take an elevator down. You duck through a fire exit. Marco asks repeatedly where you&#39;re going.

You find a janitor&#39;s closet.

“Oh,” Marco says. “Good. I thought the floors looked like they needed cleaning. Let&#39;s get on that.”

You go to step inside. Ax puts a hand on your shoulder. “Do not. Not-tuh. Go in theerrrrrre.”

“Why shouldn&#39;t she?” Marco asks.

“We are underground-duh. Grrrrrowne-duh. On the base-ment-tuh lev-vul. This is a confined space-suh with a door.”

“Yeerk pool entrance?” Marco mutters.

“Likely.”

The two look at you suspiciously. Very suspiciously. You back up quickly. You&#39;d better find the information you need before they decide they can&#39;t trust you.

[[Take the left path-&gt;Chapter 134]]

[[take the right path-&gt;Chapter 136]]</tw-passagedata><tw-passagedata pid="43" name="Chapter 136" tags="Reboot-Ending" position="4400,1900" size="100,100">(set: $c136ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You take the right path. You know the way. Down the corridor. Turn left. Elevator up two floors. You don&#39;t know what&#39;s at the end of your path, but you know where you&#39;re going. Marco asks where you&#39;re going at first, but seems to decide against trying to shake you out of it.

That proves to be the right decision, because soon, you are opening the door to a room full of computers.

To you, it&#39;s unimpressive. To Marco the Nineties Kid, it probably looks like NASA. He grins broadly as he enters, notices a couple of Controllers tapping away at computers, and makes an effort to look serious.

Ax brusquely walks in as if he&#39;s meant to be there, sits down, and starts typing. You and Marco loiter and try to look busy. You peek at Ax&#39;s screen, but you don&#39;t recognise most of the words on it. After awhile, he stands up and gives you a small, very serious nod.

You don&#39;t ask him to explain in front of the Controllers, but you can&#39;t help the extra spring in your step as you exit the hospital and find an alley suitably far from the Yeerk-controlled building for Ax to refresh his morph and explain what&#39;s going on. He demorphs completely before he deigns to say anything.

You ask him if he has answers, if he learned what happened to you.

&amp;lt;Yes,&gt; he says, narrowing his eyes. &amp;lt;I know exactly what you are.&gt; And then his tailblade whips forward, towards your throat.

Andalite tails really are very fast.

//It trusted the Andalite? Well, I suppose it had no reason to know better. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="44" name="Chapter 137" tags="Reboot-Ending" position="4500,1900" size="100,100">(set: $c137ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You fire. Ax stumbles, falls as another leg disappears from under him. The Hork-Bajir pile onto him, hacking and slicing without mercy.

The Animorphs used the other exit make a clean getaway. You don&#39;t, and are quickly arrested. You&#39;re under a lot of suspicion for your role in the attack, but giving up key details on the Animorphs that you claim to have learned in captivity is enough to absolve you. Four Animorphs made it out of the Pool – you&#39;re not sure what happened to Marco, but he never made it home. Neither did Tom Berenson; the bottom half of his body was found in the tunnel they&#39;d used. They never found his top half.

The Animorphs are driven into hiding, and the information on their identities earns you a promotion. You&#39;re not sure how to find the Animorphs again, now that they&#39;re in hiding, but maybe you can get work doing something a bit safer. Kiri and Dahvin are safe; nobody feels the need to execute you for anything right now; there&#39;s a lot of work to be done and a lot of decisions to make, but the whole universe is in front of you.

//Interesting choice. It took such a risk to save one person? These beings merit further study. [[Start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="45" name="Chapter 138" tags="Reboot-Ending" position="4600,1900" size="100,100">(set: $c138ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell the Yeerk that your name is Esplin 057. She gives you a small, embarrassed smile.

“Sorry,” she says. “It&#39;s just that your host… one of my friends used to have that host. Before she died. And the way you pilot it is… really familiar.” She gets a distant look in her eyes. “This oatmeal&#39;s taken too many of us. I hope you have better luck.” And then she leaves.

Marco looks up from behind the desk and gives you a shrewd, suspicious look before getting back to work. A few minutes later, he has an address in hand.

“Come on,” he says, “let&#39;s go rob this kid.”

The two of you return to the barn and meet up with the others. Marco gathers everyone together.

“She,” he says, pointing a finger at you, “is a Controller.”

The reaction is instant. Rachel grabs your arm and twists it behind your back; Ax reaches for a scalpel.

&amp;lt;Impossible,&gt; Tobias says. &amp;lt;She would&#39;ve just turned us all in.&gt;

“One of the Controllers at the school recognised her. Specifically said that she knew the last Yeerk in Lorraine&#39;s body. She brushed it off, but how many people do you know just walking around who used to be prisoners of the Yeerks?”

“There must be a bigger game being played here,” Cassie says thoughtfully. “She needs us for something. Some reason they can&#39;t find the blue box without us, perhaps?”

“You will tell us everything, Yeerk,” Ax snarls, levelling the scalpel threateningly at you.

But you don&#39;t have anything to say. You don&#39;t know anything.

“Right,” Jake says, “this is probably a trap. We send her to the Hork-Bajir while we investigate it.”

&amp;lt;And compromise the location of the colony?&gt; Tobias asks.

“The shack,” Cassie says. “We tie her there.”

Marco looks at you coldly. “It might even take three days,” he says tonelessly. “I bet Lorraine herself will be much more eager to chat with us.”

Any protests that you are Lorraine fall on deaf ears as the Animorphs take you out into the forest on horseback. There&#39;s no doubt that any attempt to run or fight would get you killed, so you let them take you into a rundown shack and tie you to a chair. Then they leave, posting Rachel as a guard. She doesn&#39;t talk to you.

The sun sets. The sun rises. Guards change frequently. They bring you food and water. Three days pass.

Nothing, of course, happens.

The Animorphs wait for some change in your demeanour, some evidence of sudden freedom, for three and a half days. You try to convince them that you were uninfested all along. It doesn&#39;t work.

Cassie looks at you with tears in her eyes. “Oatmeal,” she says sadly. “This is our fault. It&#39;s our fault for putting it in the school like this. I&#39;m so sorry, Lorraine. There&#39;s just no way to free you.”

“It&#39;s war,” Rachel says, but she doesn&#39;t look happy about it.

Jake runs a hand through his hair nervously. “We have to… somebody has to...” He looks away. “She knows way too much.”

&amp;lt;I will do it, Prince Jake,&gt; Ax says.

“You don&#39;t have to, Ax.”

&amp;lt;As you said. Somebody has to. And I am the only one who chose this war. Who is trained to do this.&gt;

Jake swallows and nods. He looks away. “I&#39;m sorry,” he says quietly. You can&#39;t tell if he&#39;s talking to you or Ax.

And then the Animorphs leave, leaving just you and Ax in the shack together. Ax doesn&#39;t apologise. He doesn&#39;t say anything. He just brings his tailblade forward, through your neck.

//An abrupt end. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="46" name="Chapter 139" tags="penultimate" position="4350,2625" size="100,100">You tackle the Controller, clamping a hand over her mouth. She tries to call out, struggling, her adult body rather stronger than your teenaged one. You hold on. Thirty seconds later, a monstrosity rises from behind the desk where Marco had hid himself. It&#39;s not quite a gorilla. It&#39;s a furry being of mismatched body parts, huge muscled arms on a tiny human torso, big lumbering feet on skinny human legs. It drags itself over, raises one massive fist, and drops it straight onto the Controller&#39;s head.

&amp;lt;That didn&#39;t have to happen,&gt; Marco chides you as he demorphs, &amp;lt;but any day I get to conk Controllers on the head is a good day.&gt; One minute later, he has David&#39;s address, and you return to the rest of the Animorphs.

You head over to David&#39;s, making a plan on the way. The Animorphs will sneak in while you, not having alien shapeshifting powers, play lookout. Nobody&#39;s home when you arrive, so you find some bushes to hide in while the Animorphs head inside.

They&#39;ve barely been searching ten minutes when a car pulls into the driveway and a man steps out. Probably David&#39;s father, judging by the age. He heads towards the door, cautious and purposeful, and you notice something in his hand, something he&#39;s raising as he heads inside.

He&#39;s holding a gun.

[[Try to warn the Animorphs-&gt;Chapter 111]]

[[Stay hidden-&gt;Chapter 112]]</tw-passagedata><tw-passagedata pid="47" name="Chapter 14" tags="" position="2650,1175" size="100,100">In the least threatening manner possible, you explain that you know who they are and where they live. The Animorphs interject with occasional questions and snarky comments as they get you to list off every morph you know they have and relate the details of some of their adventures, looking more and more worried the more you know.

“And you don&#39;t know how you know any of this?” Rachel asks.

You nod.

“Yeah, like we&#39;re gonna believe that.”

“Lorraine,” Cassie asks, somewhat more gently, “weren&#39;t you in a car accident not long before I disappeared?”

&amp;lt;I don&#39;t see how brain damage would give her more information,&gt; Tobias points out. &amp;lt;But then, we see a lot of weird stuff these days.&gt;

Jake nods. “Ax?”

“I cannot...can-not-tuh...see any way in which such a thing is feasible. Feee-zibble. Zib-zib-zibble-luh.”

“Well, she found out somehow,” Marco states.

“Spy,” Rachel says.

“If she&#39;s a spy, she wouldn&#39;t waltz in here and tell us,” Cassie points out, rolling her eyes.

“She didn&#39;t waltz in, we caught her.”

&amp;lt;She knows a lot,&gt; Tobias observes. &amp;lt;She must have been watching us for a long time. We would have noticed.&gt;

“Tobias would definitely have noticed,” Cassie adds.

Rachel frowns. “It still seems a bit convenient that she just forgot how she learned all this.”

“Oh, this is convenient?” Marco asks. “I guess I must have been using that word wrong all these years.”

&amp;lt;Mind reading?&gt; Tobias asks.

“Humans can&#39;t read minds,” Cassie points out.

“Right.” Marco nods. “And nobody can travel faster than the speed of light, and aliens aren&#39;t real, and shapeshifting is impossible.”

Cassie rolls her eyes. “We&#39;ve seen something a bit like this before. Memories with no obvious cause. The Amazon thing, remember? The, um...rip thing.”

“Sario rip,” Ax says. “Rip-puh. It would require both a zero space connection and a time displacement, neither of which are in effect, unless this human has somehow gained access to morphing technology.”

Jake gives you a questioning glance. You shake your head.

“Is there anything else we should know?” Jake asks.

[[Explain that you&#39;re trapped in a children&#39;s book series from the nineties-&gt;Chapter 15]]

[[Explain that there might be a time displacement effect in that you know the Animorphs&#39; future-&gt;Chapter 24]]

[[Stick to your current story-&gt;Chapter 25]]</tw-passagedata><tw-passagedata pid="48" name="Chapter 140" tags="" position="3875,3175" size="100,100">The plan isn&#39;t to break into the school in the dead of night, avoiding the stream of Controllers heading for the Pool or patrols of emergency oatmeal stores. Why break into a place that the government makes you go to every day anyway?

“It has to be me and you,” Melissa tells you as you hash out the plan. “I&#39;m his host&#39;s daughter, and you...”

“It&#39;ll be a good training mission,” Amanda says gently.

The truth remains unspoken. You have to do the dangerous part because if you’re captured, they can&#39;t read your memories. If you&#39;re captured, the Star Defenders have more time to rescue or kill you, because the Yeerks would need to torture the information out of you instead.

You leave it unspoken.

You go to classes, learn about how mitochondria is the powerhouse of the cell and how to expand brackets, trivia that seems kind of pointless next to an invasion of alien brain slugs. It&#39;s lunch time before you see Melissa in the hallway, idly leaning against your locker as she chats to another Cheerleader you only know by sight. She ignores you trying to put your books away.

You shove her roughly out of the way.

“Hey!” She regains her footing and punches you in the chest. She doesn&#39;t hold back and pain blooms through your breast, so you don&#39;t hold back in kicking her in the knee. A ring of curious students is already forming as Melissa shouts insults at you and you threaten her back.

“Stop it, stop it!” All of a sudden, Mrs Palmer is between you, hands out. “Both of you, Vice-Principal&#39;s office, now.”

The pair of you sulk all the way to Chapman&#39;s desk.

Mr Chapman is very, very disappointed in the both of you. He lets you know this at length. He frowns at you, as if trying to remember or figure out something important, as he speaks. Melissa sulks and twists her foot into the carpet. “Daddy,” she says, wheedling. “She started it.”

You glare at her.

Chapman separates you. He tells you to wait in his office while he takes Melissa just outside and shuts the door, having a quiet, hurried family conversation. You hear him try to reason with her, you hear her snap back and start to turn the talk into an argument.

Hopefully, she can buy enough time.

You spring into action, searching through Chapman&#39;s desk for anything relevant to a school camp. The argument outside escalates, then begins to die down. No luck. You see a shadow move outside the door, see the doorknob turn, grab a few sheets out of the top of the drawer you just opened and slip them in the stack of books you&#39;re holding just as the door opens. You manage to push the drawer most of the way closed and step out from behind the desk as Chapman enters, alone, massaging his temples. He looks at you as if he&#39;d forgotten that you were there.

“Right,” he says. “Fighting. That&#39;s not acceptable in school, Lorraine.” He fills out a detention slip and hands it to you. Go, just… go to class.” He seems very distracted.

You leave, the stolen papers seeming very heavy where they lie between your books.

[[Go to class-&gt;Chapter 164]]

[[Sneak off and look at the notes-&gt;Chapter 165]]</tw-passagedata><tw-passagedata pid="49" name="Chapter 141" tags="Reboot-Ending" position="3900,2000" size="100,100">(set: $c141ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You remember that Illim and his host, Mr Tidwell, are members of the Peace Movement. That seems safe. You arrange to meet David the next day, look Mr Tidwell up in the phone book, and get a good night&#39;s sleep.

David does come and meet you, so he must at least be curious. The two of you head to Mr Tidwell&#39;s house. He&#39;s puzzled and cautious about a pair of students arriving on his doorstep, but ushers you both inside the moment you say the word &#39;Yeerk&#39;. He listens carefully to you speak for a while, nods thoughtfully, and asks you to wait a moment while he gets something. David, still seemingly trying to figure out if this is an elaborate prank, asks you more questions after he leaves.

It&#39;s in answering these questions that you remember the vital detail – Cassie just came out of the forest, meaning Aftran just started the Peace Movement. Meaning that Illim and Tidwell aren&#39;t members yet.

Unfortunately, this realisation hits you only moments before the Dracon beam does.

//An unfortunate choice. It seems that we must [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="50" name="Chapter 142" tags="Reboot-Ending" position="4000,2000" size="100,100">(set: $c142ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You decide to spy on your assistant principal. You talk David into coming with you, which isn&#39;t easy. He seems to be expecting a bunch of bullies to ambush him at any moment.

You peek into Chapman&#39;s windows. His wife cooks dinner. He watches TV. His daughter does homework. After about ten minutes of this, David gets bored and leaves. Five minutes later, you decide to leave yourself, but as you go to leave Chapman&#39;s backyard, you&#39;re confronted by a young man with a Dracon beam. Seems you aren&#39;t as stealthy as you thought.

//A risky move. Well, we can only [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="51" name="Chapter 143" tags="Reboot-Ending" position="4100,2000" size="100,100">(set: $c143ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You decide to take David to the Yeerk Pool for some reason. This is a good plan that doesn&#39;t routinely get kids with shapeshifting and auto-healing powers almost killed.

Based on vague memories from the books and the way certain actions seem to fit into your own memories as you take them, you find the right McDonald&#39;s about three seconds before David completely runs out of patience and ask for a happy meal with extra happy. You&#39;re led into the freezer. You wait.

The gleet biofilter that the Yeerks have installed in all their entrances doesn&#39;t kill something as big as you. But the alarm does bring Hork-Bajir. A lot of Hork-Bajir. Unfortunately, neither you nor David have any means to fight them.

//Direct confrontation? A risky strategy. Interesting. Well, we can only [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="52" name="Chapter 144" tags="penultimate" position="5400,2200" size="100,100">You surreptitiously brush the roach to the floor before stepping into the biofilter. It scans you, pronounces you clean, and you step out. The guards exchange a glance and a shrug. You wonder how many random bugs get caught in biofilters every day; how often they have to do this. What made them so jumpy.

Under everyone&#39;s gaze, you have no way of picking Tobias up again. You have no choice but to leave.

You go to the Animorphs for help. They are not happy.

“Tobias is where?!” Rachel explodes.

“Why were you atr the Yeerk Pool?” Marco adds angrily. How did you get in? This was a simple search!”

&amp;lt;We must find him before the Yeerks do,&gt; Ax says, worried.

Jake nods. “We probably don&#39;t have much time. Let&#39;s set an infiltration plan.”

“Not around her,” Rachel says, glaring at you. “She can&#39;t be trusted.”

“Just how are we supposed to get in and out without her?” Marco asks. “She was able to walk in and out even though they have biofilters now. Which is a question in itself, but one that&#39;s gonna have to wait. We need her to get in.”

“This is so obviously a trap,” Cassie says.

“She already knew who we were,” Marco points out. “What trap would be better than just jumping us in our sleep before we knew?”

“Why are you defending her?” Rachel snaps.

“I&#39;m not;, I&#39;m trying to weigh our risks here. If you have a way to get to Tobias without her, then please, tell us; I&#39;d love to stick her with the Hork-Bajir or something until we&#39;re done. But so far as I can see, we have no choice but to work together until he&#39;s out.”

“Okay,” Jake cuts in before Rachel can counter him, “what is the plan?”

“Same as with the oatmeal,” Cassie suggests. “Ticks.” She glances at you. “Lorraine, Marco&#39;s right, right? You could walk through the biofilter?”

&amp;lt;That may mean very little,&gt; Ax says. &amp;lt;As I recall correctly, Cassie was able to walk through the biofilter with a Controller morph. She merely tripped some silent alarm by doing so, due to walking through without a Yeerk. Repeating the stunt may put us in the same position, only Lorraine cannot morph to escape. There is no reason to assume that she is passing undetected any more than Cassie did.&gt;

“She was able to walk out again,” Rachel points out. “Now way that&#39;d happen if they thought she was one of us.”

“Besides,” Cassie says, “that was only because I&#39;d morphed a controller. That woman&#39;s DNA was allowed through.”

&amp;lt;A reasonable assumption, but still an assumption. We have no mode for comparison to know whether Controller DNA is programmed into the system at all. To manually register every Controller would be rather more work than to simply allow all human and Yeerk DNA through and simply check to make sure that one is present where the other is.&gt;

“That doesn&#39;t sound nearly as secure,” Marco says, shaking his head. “Wouldn&#39;t the Yeerks want to put in the extra effort to make sure only Controller DNA was allowed through?”

&amp;lt;One would expect so. However, that level of extra security only exists from our perspective. Remember, the Yeerks believe that we are all Andalites. From their point of view, us going through in a Controller morph is not that much more difficult than with any human morph. There is no reason to expect that we would infiltrate using unauthorised human DNA as opposed to authorised human DNA, as they do not know that any of you have native human DNA. There is no reason to suspect that one might be more of a security risk than the other. They may expect that acquiring Controllers specifically is slightly more work, but they had seen us identify and follow specific Controllers before even before Cassie acquired that woman for the oatmeal infiltration. The labor of programming so many specific DNA patterns may simply not be worth the extremely small increase in infiltration difficulty.&gt;

“Since none of us should go anywhere near a biofilter in our actual bodies, none of this is relevant,” Jake says. “We go with Lorraine.”

“And make her go in her actual body?” Cassie asks, crossing her arms. “She can&#39;t heal like we can. She can&#39;t escape like we can.”

“She got Tobias trapped down there!” Rachel snaps. “Again!”

“She already went down once and she&#39;s fine,” Marco adds.

“She knows our secrets,” Jake says. “We can&#39;t risk her getting captured.”

The five of them are talking about you as if you aren&#39;t standing right next to them. They barely look at you. Even Ax&#39;s stalk eyes, constantly scanning the environment, rest on you only briefly with each pass. They go back and forth a few more times before Rachel says, “You know what? Screw this. We don&#39;t have time for this. Tobias is in danger right now.” She looks at you. “Are you going to take us down the Pool or not?”

[[Go back down to the Pool-&gt;Chapter 153]]

[[Refuse-&gt;Chapter 154]]</tw-passagedata><tw-passagedata pid="53" name="Chapter 145" tags="penultimate" position="5100,2300" size="100,100">There&#39;s nothing you can do. Cockroaches survive everything, right? You step into the biofilter and hope.

There&#39;s a zap. A hum. Bright lights dance across your vision and take almost a full minute to fade, and before they do, you learn that no, cockroaches don&#39;t survive everything.

The guards open the door for you. They apologise for the inconvenience. You leave the Pool.

Tobias is dead. He would have pulled all the way through the war; all of the Animorphs would&#39;ve made it at least as far as the final battle… but one mission with you, and he&#39;s dead. You walk out of a dressing room in a clothing store, out of the mall, into the street. Now what? You have to face the Animorphs somehow.

Or do you?

[[Tell the Animorphs that Tobias is dead-&gt;Chapter 157]]

[[Lie and say he&#39;s trapped at the Yeerk Pool-&gt;Chapter 158]]

[[Simply leave the city forever-&gt;Chapter 159]]</tw-passagedata><tw-passagedata pid="54" name="Chapter 146" tags="Reboot-Ending" position="4400,2000" size="100,100">(set: $c146ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You explain that you don&#39;t know where your knowledge comes from. The Animorpshs quiz you extensively on what you do and don&#39;t know, throwing names and words and situations at you. Some you recognise. Some you don&#39;t. They have a brief discussion, but as you can hear only Marco and Cassie&#39;s side, you can only get the general gist of it. Even those two seem to be talking in a kind of code. The Elimist is mentioned a couple of times, as is your trustworthiness, and some suspicion that you might be a Controller, although nobody seems to have an answer for why, if you&#39;re a Controller, you&#39;d be there instead of setting a trap. Eventually, they reach a decision.

Cassie and Marco search you carefully for any kind of tracking device or bug, then take you out into the forest, explaining that they have to do some investigation and it would be best if you stayed safely with their friends while they did. You walk for about a couple of hours, stopping periodically to rest your feet, before something drops out of the trees right in front of you. A seven foot tall lizardlike alien covered in blades. The image fits into your memories. Hork-bajir, although this specific one isn&#39;t familiar.

He introduces himself as Jara Hamee and carries you up into the trees. Moving through the trees at Hork-Bajir speed is much more efficient than walking, and you make good time as you head towards the mountains. Jara is not much of a talker; he answers your questions politely and simply but doesn&#39;t ask any of his own. It takes you a full day to reach the Hork-Bajir valley.

You arrive to find a supply of food and clothing. The clothing is mostly warm, durable stuff; boys and girls&#39; clothes in teenaged sizes. It&#39;s pretty easy to pick out which clothes belong to which Animorph, at least for Rachel and Cassie; the boys are a bit harder to tell apart. There are also plenty of muesli bars, potato chips, and other foods that were clearly chosen for quick energy and their ability to sit unused in a cave for weeks at a time.

Two other Hork-Bajir come to greet you in the valley; a Hork-Bajir woman and a small child riding on her shoulders, who you know at sight to be less than six months old. The child immediately drops down from her mother&#39;s shoulders to get a better look at you, poking at your arms and peering into your eyes, careful not to cut you with her blades.

“Friend of fellana,” the mother greets you. “I Ket Halpak. This Toby Halmee. We welcome you to valley.”

You ask how long you&#39;re supposed to stay with them.

“We not know,” Jara says. “Friends say, &#39;we have important mission to do.&#39; Friends say, &#39;now we have other thing, to get this thing from human boy.&#39; Friends say, &#39;now there is other thing, this is important, watch her until we find.&#39; We watch.”

“They come look tomorrow, fellana say,” Ket adds helpfully.

The Animorphs do come and check on you tomorrow. Rachel comes by in eagle morph with some sandwiches. She regards you with quite a lot of suspicion and tells you they&#39;re off to meet with David soon. You can&#39;t help but feel that there&#39;s an implied threat if you&#39;ve set them up somehow.

Rachel says that once they have the box, they&#39;ll be back “to deal with your thing”.

They don&#39;t come back.

After a week, your food runs out, and Ket and Jara help you forage. They&#39;re very good at it, although there&#39;s a bit of trial and error in trying to figure out what is and isn&#39;t poisonous. After two weeks, everybody starts to get very worried. Jara heads out to check Tobias&#39; meadow and comes back that night to report it empty. Cassie&#39;s farm, as near as he could tell, also has a distinct lack of Cassie. The hork-bajr don&#39;t seem inclined to let you head back home, though. They were told to keep an eye on you. They do.

You start a garden. Toby grows at a remarkable rate and is soon heading out to help you forage and, occasionally, hunt. Ket and Jara tell the two of you the stories and ways of their people, tell Toby that she is the first of her kind born into freedom in generations. The distinction weighs heavily on her. It&#39;s probably why she spends so much time pestering you for information about the war, about humans, about Yeerks. It&#39;s probably why she stands tall and declares her intention to her family – she will free the Hork-Bajir.

Without the Animorphs holding the front line on Earth, this is a tall order. You don&#39;t get much information out in the valley, but the war must have progressed much faster without them. Ket and Jara are proud but worried for their daughter, and you have only one future ahead of you. It&#39;s far too late to simply return home without attracting dangerous levels of attention; the valley is your home now. And you can cower in it forever and hope the Yeerks never find you, or you can help build it. You can stand with Toby and fight.

//There is little to be learned from its decisions from this point onwards. We should terminate and [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="55" name="Chapter 147" tags="Reboot-Ending" position="4500,2000" size="100,100">(set: $c147ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You try to pretend that finding David, finding the box, and knowing that the Animorphs would want it is all just based on luck and logical deduction. They don&#39;t buy it.

After a brief discussion, they decide there&#39;s a fairly high chance that you&#39;re a Controller trying to trap them all at once and go into emergency mode. You are taken on horseback to a cabin in the woods where they tie you to a chair, leave Ax to guard you, and move to prepare.

They don&#39;t come back.

An increasingly agitated Ax guards you for about a day, then warns you not to try to escape before heading off to look for his friends.

He doesn&#39;t come back.

Unfortunately, the Animorphs were very good at tying ropes. And it seems that nobody is coming for you. You might not be a Controller, but that doesn&#39;t mean you can&#39;t starve in a cabin.

//No further decisions can be made here. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="56" name="Chapter 148" tags="Reboot-Ending" position="4600,2000" size="100,100">(set: $c148ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You do nothing.

Ax&#39;s tailblade flashes forward. Kiri falls, headless, to the ground.

It&#39;s definitely time to get out of there.

You let familiarity guide you to an exit that comes out of a dressing room in some clothing shop in the mall. You get out of that mall, away from the cameras, as soon as you can. You head for Cassie&#39;s farm.

The Animorphs, as a motley collection of wild animals, surround a prisoner tied up in one of the stalls. You recognise him. Tom Berenson. Most of the Animorphs are silent, letting Ax do the talking.

&amp;lt;You will be transported to a secure location. There is no point in resisting.&gt;

“They&#39;ll find me,” Tom growls. “You can&#39;t take me anywhere that my people won&#39;t find me.”

&amp;lt;Do you truly believe that you are so important? Just how many Empire resources are you worth, Yeerk? It does not matter; they already believe you dead. They will find pieces of a human body, too many for a human to survive without, in the tunnel through which my uncles escaped with you. They will be a perfect physical and genetic match for your host. There will be no reason to look.&gt;

Tom&#39;s eyes widen. “How…?” They narrow. “… When?”

&amp;lt;You act as if we have never had the opportunity to make physical contact with your host. The when no longer matters. We went to such trouble because your host may have some minor value, but if you force us to kill you quickly, I am just as open to that option.&gt; His tail twitches. &amp;lt;I suggest that you come quietly.&gt;

Rachel&#39;s thoughtspeak voice fills your head. &amp;lt;Hey. Thanks for your help back there. We couldn&#39;t have done it without you. I mean, we probably could have, but it would&#39;ve been way harder and taken a lot longer to plan, and we really needed this oatmeal crisis thing.&gt;

Unable to return to the Yeerks and of no further use to the Animorphs, you have nowhere to go. The Animorphs help you escape the city, getting you a bus ticket and giving you an address and a code phrase to be used to &amp;lt;signal a particular human to help you get back on your feet&gt;. You get on the bus and leave this city of violence and secrets behind.

You may not know who you are. You may not know where you&#39;re going to live. But they won&#39;t find you, and whatever happens next, you have the whole world ahead of you.

//Interesting choice. After everything, it chose the defenders? This merits further study. [[Start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="57" name="Chapter 149" tags="penultimate" position="6025,2000" size="100,100">You poke around to see if you remember anything else. Most of the barn is unfamiliar; you mustn&#39;t have spent much time inside. But, circling the house, you find some thick bushes that fit well into your memory. You crouch in them, sighting Cassie&#39;s house; yes, you&#39;ve been here before.

Were you spying on an Animorph? How did you not get caught?

The farm has a lot of wide open spaces that it would be difficult for a spy to cross without risking being spotted. That narrows down the areas you need to check out. You find a couple more places that you vaguely remember being; behind a line of trees near the house, under Cassie&#39;s dad&#39;s truck…

And dashing across a field, heart in your throat, worried you&#39;d be spotted as you head for the forest…

You follow the memory of your own footsteps, taking step after step and seeing if each fits into your memory before continuing. It was dark, the last time you did this; you&#39;re sure of that. Not completely dark. Sunset or sunrise, maybe. You move into the forest. This tree, you hid behind for a long time, watching something. The trees you can see are familiar, but whatever you were watching isn&#39;t happening now and can&#39;t fit into your memory. You watched here, and then… and then…

You take a step forward. It fits into your memory. You take another.

There&#39;s a tree with something carved into it, clumsily but deep. You trace the letters with a finger. “Cassie + Jake”.

You know this. You read this. Or… saw this.

You count three trees. You find a patch of recently dug earth, buried halfheartedly under some loose leaves and twigs. You dig.

The tin box cradled in your hands fits into your memory, strong, significant, important. This was an important moment. Your hands shake as you struggle to open it. And inside…

Inside are things that you remember reading. Things that fit into your memories as you scan them, but also correlate with your other memories, your non-Animorphs-world memories; things you read before you woke up in this place. They&#39;re not in the same neat book format that you recall them, but the information is, for the most part, there – Elfangor, the Animorphs, the Chee, Leera, Aftran.

You remember the flash of betrayal you felt when you originally read her name, her story, here. This was her plan, following this human girl; you were only skulking about this forest in the first place to help her. And then she went missing, and then she was found, and then she somehow disappeared in the oatmeal chaos and you gave her up for dead, but according to these notes she&#39;s been on the Pool the whole time?

It&#39;s hard to be too angry, though. After all, Kiri and Dahvin faked your death, too.

You put the notes away and rebury them. Yes, this is what you did; you buried them, because they were too incriminating to carry around; you planned to go back to the Pool, report everything, bring the downfall of the Andalite Bandits, get promoted out of this place and use your pull to bring Kiri and Dahvin with you…

You get up and run; yes, you jogged like this, jogged out to the road to catch the bus and…

And clearly you never made it to the Pool, because the Animorphs are still free and alive. That must have been when the accident happened. The accident that put you in your current, damaged state.

And now, with the knowledge of your past, you must decide what to do.

[[Go back to the plan to trap the Animorphs-&gt;Chapter 151]]

[[Leave the city and leave this war behind-&gt;Chapter 152]]</tw-passagedata><tw-passagedata pid="58" name="Chapter 15" tags="" position="2500,775" size="100,100">You tell your story, including enough detail that they can&#39;t possibly dismiss you out of hand. Six pairs of eyes stare at you.

“That...was the dumbest story I&#39;ve ever heard,” Rachel says.

“You mean the most amazing story,” Marco disagrees, laughing. “Are we a comic book? Tell me we&#39;re a comic book.”

“Lorraine was in a car accident pretty recently,” Cassie says quietly, but not so quietly that you don&#39;t hear. “Her mind might be a bit...”

“My mind is fine,” you snap.

“Yes, yes, of course it is,” she says hurriedly.

“Do we have catch phrases in the books?” Marco asks.

&amp;lt;Regardless of this, we have to find out how she actually knows so much,&gt; Tobias says.

“Is it a popular series?” Marco asks. “Am I the fan favorite?”

“Nobody&#39;s in a book,” Jake says patiently.

“Ax, do you know what&#39;s going on?” Rachel asks.

“Me? Do I, an Andalite from several star systems away, know why a young human is experiencing a human delusion? Looo-shun? No. No, that sort of information is not my speciality. Al-li-tee. Tee.”

“Wow, sorry.”

“Is it a long series? Is there a lot of reading?”

“Marco,” Jake says again, “nobody&#39;s – ”

&amp;lt;Are we the heroes?&gt; Tobias asks. Jake gives him a look of utter betrayal, but Tobias presses on. &amp;lt;No, seriously. Are we the heroes of the book series?&gt;

“Why does it matter?” Rachel asks.

&amp;lt;Because usually- not always, but usually - the heroes win.&gt; Tobias starts to preen a wing. &amp;lt;If we accept that, for some reason, Lorraine thinks we&#39;re in a book series then, somehow, Lorraine thinks she has knowledge of what happens in this series. In other words, knowledge of the future. Shouldn&#39;t verifying that be our next step?&gt;

Everyone is silent for several seconds before turning to look at you.

You protest that it&#39;s not that simple.

“Why not?” Cassie asks, frowning.

You ask them if they know the Star Defenders. They do. You explain that the Star Defenders were not in the original series, but are part of a rewrite, and in that rewrite, you are only up to where Cassie meets Aftran.

“Seems pretty up-to-date,” Cassie says. “So you don&#39;t know our future, in this weird rewrite version, but you know the &#39;original&#39; future? But the rewrite must be pretty close to the original, yeah?”

“Do we have cool catch phrases in the rewrite?” Marco asks with a grin, ignoring Jake&#39;s glare.

&amp;lt;So give us your best guess for the future,&gt; Tobias says. &amp;lt;Tell us what happens in the original series.&gt;

You look around at six pairs of eyes; one an impassive hawk&#39;s glare, and five human pairs filled with a mix of suspicion and hope.

[[Tell the Animorphs useful, short-term details-&gt;Chapter 26]]

[[Be brutally honest about everything-&gt;Chapter 27]]</tw-passagedata><tw-passagedata pid="59" name="Chapter 150" tags="Reboot-Ending" position="3800,2100" size="100,100">(set: $c150ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You go home, collect all the money you have, steal the contents of your mother&#39;s emergency cash fund, and take a bus out of the city. It&#39;s easy.

What&#39;s not easy is everything else. You&#39;re a teen girl running away from home, and you can&#39;t give anyone something as simple as your name or they&#39;ll send you right back. I can&#39;t tell you my name, or where I live… it&#39;s almost funny. You bounce around a couple of homeless shelters and youth crisis centres before ending up in the foster system. The foster system isn&#39;t great, of course. But it&#39;s better than being caught in the middle of an alien war.

//Can it do that? Can it just leave? It would seem that it can. I suppose we must [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="60" name="Chapter 151" tags="Reboot-Ending" position="3900,2100" size="100,100">(set: $c151ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

With the notes clearing up your confusion, your mind – and duty – is clear. You have a planet to conquer, a Pool to protect.

When the Animorphs return, you apologise for your errors, claiming that the trauma of having a Yeerk starve in your head caused you to get some details wrong. You give them the correct information to spring the trap. They rest up and head out again the next night.

You don&#39;t stick around and wait for them to come back.

Animorphs, you know, are good at getting out of traps. But most of those traps weren&#39;t built by people who know all their secrets. You know the team, know how they operate; you know how to take them apart.

In the end, the trap doesn&#39;t destroy the &#39;Andalite Bandits&#39;. But it does kill two of them, a far greater victory than any other Yeerk attempt. It&#39;s enough to earn you a promotion and sweep charges of treason and oatmeal addiction under the rug. (Curiously, even knowing what Dahvin and Kiri did to you, you don&#39;t have any particular urge to try instant maple and ginger oatmeal.) With this victory, you can look forward to a long, profitable career in the Yeerk Empire.

Unless some random Animorph raid or Visser Three temper tantrum gets you killed, of course.

//Even with human memories, it chose to kill them. Fascinating. This merits further study. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="61" name="Chapter 152" tags="Reboot-Ending" position="4000,2100" size="100,100">(set: $c152ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You can&#39;t change who you are or what you&#39;ve done, but you can choose what you do now. And you don&#39;t have to be a part of this war.

Cassie&#39;s notes contain a name, address and series of code words for Rachel&#39;s father, the man who she enlisted to help smuggle ex-Controllers out of the city. You come up with a fake name for yourself, buy a bus ticket, and go to him. He&#39;s fairly nervous about having you around, but polite, and you stay with him for a few weeks before you manage to find some unofficial retail work that pays well enough to get you your own place.

The war will catch up with you eventually, if the Animorphs can&#39;t stop it. It&#39;ll catch up with the whole world. With the knowledge of where your information on them came from, it&#39;s hard to believe your knowledge of the future is anything but a delusion, so you have no assurance that they&#39;ll win. But you have hope. They&#39;re resourceful.

And so are you.

//An interesting choice. To walk away, even at this juncture… we must examine this further. We must [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="62" name="Chapter 153" tags="penultimate" position="4275,850" size="100,100">The plan is simple. It is, in fact, a repeat of a previous plan, with the added bonus that you, for some reason, can move through the biofilter. The Animorphs all morph tick and cockroach in a changing room and wait inside your mouth, Rachel making dire threats about demorphing and tearing your skull open if you do anything remotely suspicious.

You move through the filter. No problems. You head down into the Pool.

The Animorphs don&#39;t ignore the fact that you were able to get through the biofilter; they discuss it at length, wondering just what sort of trap they&#39;re walking into. Often, they will go dead silent for a shorttime before picking up the conversation in a manner that suggests they were probably speaking privately. Everyone&#39;s pretty sure it&#39;s a trap that they have no choice but to walk into; they just can&#39;t figure out if you&#39;re working for the Yeerks or if you’re a patsy.

You descend, moving down, down away from the world you know, towards the screams below, into… another world you know. Sort of. You did this with Tobias just an hour or so ago, and it must all still be fresh and familiar, because this particular passage doesn&#39;t fit into your mind like the other did, but the Yeerk Pool itself is still known, comforting. You head into a bathroom and empty your mouth of really disgusting animals, then leave before you have to watch them demorph.

Tobias is, predictably, in a small cage sitting at the end of one of the piers. You have to wonder if Visser Three just had caged of various sizes lying around for morphed Andalite Bandits. The visser himself paces along the side of the Pool, grandstanding, making a long speech about how Tobias should just demorph and accept infestation or his secrets will be taken from him the hard way and he will be eaten. Tobias says nothing. The piers on the other side of the Pool seem more congested than normal, trying to cope for the extra flow created by one of the piers being out of commission.

More congested &#39;than normal&#39;? You picture the &#39;normal&#39; flow in your mind. Yes. It fits.

And then behind you, the brawny bellow of a grizzly bear.

Suddenly, the Yeerks are fighting. The Pool has been attacked enough times that they have a protocol; you watch military personnel step forward and draw weapons while those in no condition to fight get out of the way. Uninfested hosts in the cafeteria shelter under furniture while those in cages surge against the bars, whooping and hurling insults. Visser Three steps a little way away from the Pool and starts to morph something enormous and impractical with huge, pulsing tentacles.

The organisation takes about three seconds. The animorphs burst out of the bathroom directly into a wall of Hork-Bajir, while humans step up on chairs and crates to get a good Dracon shot. Taxxons surround Visser Three, protecting him as he morphs, Dracons in their own little claws.

The Yeerks, it seems, are learning.

You try to get out of the way, but there is already no way through the soldiers. You and a handful of Controllers who didn&#39;t retreat quickly enough cluster around the Pool itself.

A wall of animals slams into a wall of aliens. A gorilla and bear barrel through, clearing a path, while a tiger and a Cheetah sink low, taking out enemy legs. A young Andalite neatly severs a Hork-Bajir hand and pulls the Dracon beam out of it, aiming fairly well considering that the weapon wasn&#39;t designed for his hands. They make their way towards the pier where Tobias is caged. You skirt the Pool, getting out of the way, making your way to the side that doesn&#39;t contain a caged Animorph, a half-morphed giant tentacle monster, and far too many Taxxons.

The Animorphs press forward, paying for every foot with wounds. Visser Three is completely morphed by the time they reach him, and he lashed out with his tentacles, hitting at them which quick, powerful blows and not caring how many Controllers get in his way. The tentacles don&#39;t seem to have the dexterity to snare the Animorphs, but they do have a lot of strength; one hits Rachel square in the chest and her grizzly morph is pushed back several feet. You feel his hate, his rage, his evil telepathically wash over you.

One tentacle flails wildly to the side and crushes a Taxxon. Other Taxxons immediately start to devour it. Another flings out and clips Tobias&#39; cage, which is tossed into the air and over the Pool. Instinctively, like a kid reaching for a baseball hit into the stands, like a woman reaching for the bride&#39;s bouquet, you and about ten Controllers all clamber over each other to catch it. It lands securely in your arms.

“Kill it, just kill it!” a soldier shouts at you.

[[Free Tobias in front of all the Controllers-&gt;Chapter 166]]

[[Let Tobias be killed-&gt;Chapter 167]]</tw-passagedata><tw-passagedata pid="63" name="Chapter 154" tags="Reboot-Ending" position="4200,2100" size="100,100">(set: $c154ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell them you can&#39;t go back down there.

Rachel snorts. “Of course not. Coward.”

“Cassie, call Erek, get the Chee to look out for Lorraine while we&#39;re gone,” Jake says. “Everyone else, start thinking. We&#39;re heading down to that Pool as soon as Cassie hangs up so we&#39;d better have a plan by then.”

Cassie is already jogging towards her house. Twenty minutes later, long after the Animorphs have left, a friendly-looking, middle-aged man strolls seemingly out of nowhere over to you.

“You must be Lorrane Alston,” he says.

You tell him that you are.

“I&#39;m Richard. Your friends suggested that you might need somewhere secure to be until they get back.” He takes your hand, and while his grip is gentle and friendly, you can immediately tell that he&#39;s a lot stronger than you. Didn&#39;t a Chee restrain a grizzly bear in one of the books?

Richard&#39;s car is parked down the road, and he takes you to the King household and introduces you to his son, Erek. He makes lasagne while you and Erek watch TV. Hours pass. As more and more time passes and no Animorphs show up, the Kings start to look a bit nervous.

You have dinner. Richard offers you the guest room for the night. The Kings are fairly firm that it wouldn&#39;t be safe for you to return home, but they can sent somebody to stop your family from getting worried. You go to bed.

You wake up to bright, warm sunshine streaming through the window of the cabin.

Cabin?

You get up and walk out. You&#39;re in some sort of big, bright, open area, a lush green field with large trees under a cloudless sky. There are dogs everywhere, of all breeds and all ages, running and playing and sleeping. Among them are Chee, some with holograms, some without.

“You&#39;re awake.” Richard is standing at your elbow. He watches the scene in front of you. “Your friends haven&#39;t contacted us,” he says, sounding worried. “Erek is investigating. We can hide you until we resolve this.”

You point out that you have a life. Richard points out that the Chee have lives too, which would be in extreme danger if the Yeerks get a hold of you. You say that people will be looking for you; he replies, as gently as possible, that they won&#39;t. “You won&#39;t have to stay here long,” he says. “Once we&#39;ve found your friends, we can turn the issue back over to them.”

They don&#39;t find them that day. Or the next. By the third, the Chee are actively avoiding the topic. You start to wonder if perhaps they were found and everybody has just agreed that it&#39;s safest for all parties to keep you underground. It&#39;s not all bad. There&#39;s the artificial sunshine. And the dogs.

And no obvious way out.

//This thread will tell us little more. We need to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="64" name="Chapter 155" tags="" position="6475,2100" size="100,100">You tell Rachel about her final battle with Tom. At first, she looks angry and afraid, but she glances at Tobias, and calms herself down. “Yeah. Okay. That&#39;s a win.” She nods. “Thanks.”

&amp;lt;That is NOT a win,&gt; Tobias insists. &amp;lt;You&#39;re not dying.&gt;

“Well, we know better now. We can DO better.” She rubs his head affectionately, then looks to you. “Don&#39;t tell Jake, okay? He&#39;s got enough to worry about. We can handle this.”

&amp;lt;You seem pretty calm, talking about the one who sent you to die.&gt;

“He probably didn&#39;t have a choice. This time, we&#39;ll make sure he does. There are worse things than death, Tobias.”

&amp;lt;Really? Like what?&gt;

“Like a future where the world is taken over by Yeerks and I&#39;m a Controller who&#39;s all buddy-buddy with Visser Three and he captured you and… and...” she looks away. “Look, I know we technically made the future that Ellimist showed us false when we destroyed the EGS tower, but this… well, it&#39;s nice to know that it was good enough. Probably. If Lorraine&#39;s right. Anyway. Work to do.” You, Rachel and Tobias work out a schedule for monitoring your family for the night. You and Rachel eat lasagne.

You&#39;re finishing up dinner when your mother reminds you that she and your sister Kayla will be out tomorrow night. “It&#39;s Kayla&#39;s initiation,” she says. “I won&#39;t make you go, but you&#39;ll have to get your own dinner.”

“Initiation?” Rachel asks.

“For full membership into The Sharing,” your mother explains.

Rachel shoots you a look, but you don&#39;t remember any of this. Your mother catches your confused expression and frowns at Kayla. “You didn&#39;t tell her?”

“Of course not;, she&#39;s going to be all weird about it. You know how she&#39;s been since the accident.” Kayla glares at you.

“Kayla,” your mother says, “stop.”

“Why? She&#39;ll try to stop us from going, you know she will.”

“Your sister has had a very traumatic experience,” your mother says acidly.

“Well, so have all of us! Just because I didn&#39;t get hit by a truck doesn&#39;t mean she gets to run my life! She was all gung ho about how super cool The Sharing was three months ago but now that I can finally get in she&#39;s all, &#39;stay away from the Sharing, they&#39;re dangerous&#39;.” Kayla shoots you a glare and storms off to her room.

Rachel looks at you and raises a questioning eyebrow, but whatever argument Kayla is referring to, you don&#39;t remember it. The pair of you help clean up quickly and head back to your room.

&amp;lt;Everything okay?&gt; Tobias asks.

“They&#39;re taking her sister tomorrow night,” Rachel says. “At least I assume that&#39;s what a Sharing initiation is about. We can&#39;t let that happen.”

&amp;lt;We might have to,&gt; Tobias says. &amp;lt;If we bust it up, it might raise questions.&gt;

“If we don&#39;t, we let that little girl get infested. And put a Yeerk in Lorraine&#39;s house. Tom is bad enough.”

&amp;lt;Tom&#39;s been left alone this long for a reason. We can&#39;t draw suspicion. But then, it&#39;s not my sister.&gt; He and Rachel look at you.

“Whatever you want to do,” Rachel says firmly, “we&#39;ll back you up.”

[[Try to rescue Kayla-&gt;Chapter 162]]

[[Let the Yeerks take her-&gt;Chapter 163]]</tw-passagedata><tw-passagedata pid="65" name="Chapter 156" tags="" position="6525,1975" size="100,100">You tell Rachel that they win the war. She looks very relieved, relieved enough to make you feel guilty. You, Rachel and Tobias work out a schedule for monitoring your family for the night. You and Rachel eat lasagne.

You&#39;re finishing up dinner when your mother reminds you that she and your sister Kayla will be out tomorrow night. “It&#39;s Kayla&#39;s initiation,” she says. “I won&#39;t make you go, but you&#39;ll have to get your own dinner.”

“Initiation?” Rachel asks.

“For full membership into The Sharing,” your mother explains.

Rachel shoots you a look, but you don&#39;t remember any of this. Your mother catches your confused expression and frowns at Kayla. “You didn&#39;t tell her?”

“Of course not; she&#39;s going to be all weird about it. You know how she&#39;s been since the accident.” Kayla glares at you.

“Kayla,” your mother says, “stop.”

“Why? She&#39;ll try to stop us from going; you know she will.”

“Your sister has had a very traumatic experience,” your mother says acidly.

“Well, so have all of us! Just because I didn&#39;t get hit by a truck doesn&#39;t mean she gets to run my life! She was all gung ho about how super cool The Sharing was three months ago but now that I can finally get in she&#39;s all, &#39;stay away from the Sharing, they&#39;re dangerous&#39;.” Kayla shoots you a glare and storms off to her room.

Rachel looks at you and raises a questioning eyebrow, but whatever argument Kayla is referring to, you don&#39;t remember it. The pair of you help clean up quickly and head back to your room.

`&amp;lt;Everything okay?&gt; Tobias asks.`

“They&#39;re taking her sister tomorrow night,” Rachel says. “At least I assume that&#39;s what a Sharing initiation is about. We can&#39;t let that happen.”

&amp;lt;We might have to,&gt; Tobias says. &amp;lt;If we bust it up, it might raise questions.&gt;

“If we don&#39;t, we let that little girl get infested. And put a Yeerk in Lorraine&#39;s house. Tom is bad enough.”

`&amp;lt;``Tom&#39;s has been left alone this long for a reason. We can&#39;t draw suspicion. But then, it&#39;s not my sister.&gt;` He and Rachel look at you.

“Whatever you want to do,” Rachel says firmly, “we&#39;ll back you up.”

[[To try to rescue Kayla-&gt;Chapter 162]]

[[Let the Yeerks take her-&gt;Chapter 163]]</tw-passagedata><tw-passagedata pid="66" name="Chapter 157" tags="Reboot-Ending" position="4500,2100" size="100,100">(set: $c157ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell the Animorphs about the Yeerk Pool. About Tobias. Rachel&#39;s face contorts into a mask of fury more intense than anything you&#39;ve ever seen, and her hands wrap around your throat.

You scrabble uselessly at her arms as she slams your head again and again into a wall, fingers tightening around your throat. Jake and Cassie each grab one of her arms as if to pull her off you, but you can&#39;t help but notice, as your vision fades out, that they don&#39;t seem to be trying very hard.

Like Tobias, nobody is coming to save you.

//A sudden end. Unfortunate. I suppose that we must [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="67" name="Chapter 158" tags="Reboot-Ending" position="4600,2100" size="100,100">(set: $c158ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell the Animorphs that Tobias is still down at the Yeerk Pool. You&#39;re nervous and guilty, and they pick up on this, suspicious. But they don&#39;t have time to cross-examine you, not with a friend to save.

Cassie leads you a little way into the forest and tells you to wait for a Hork-Bajir who will keep you safe until they get back. You would be safe at home; it&#39;s obvious that they don&#39;t trust you. Jara Hamee comes some time later to guide you to his valley.

You wonder, for some time after, what would have happened if Tobias was there to save. If he could’ve pulled some last-minute miracle escape and distracted the Yeerks long enough to get the rest of the Animorphs out, an exciting close shave like the dozens of them in the books. What actually happens, is that you never hear from the Animorphs again. You make friends with Toby, who grows fast and is soon coordinating rescue missions for Hork-Bajir controllers, inspired by the stories of her own people and the humans who freed her parents. You have information. She has an army. Neither of you have very much to lose.

You have some military planning to do.

//There is little to be learned from its decisions from this point onwards. We should terminate and [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="68" name="Chapter 159" tags="Reboot-Ending" position="4700,2100" size="100,100">(set: $c159ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You go home and collect all of your money. You steal your mother&#39;s money. You buy a bus ticket out of the city.

It&#39;s not that difficult, when you know about the invasion. When you know that it&#39;s centered, for some reason, on this one town, when any sensible invader would&#39;ve built a dozen Pools over the world (or at least over America) by now. All you have to do to be free is leave. Maybe change your name. You might end up on the streets or in the foster system; that&#39;s something you&#39;ll have to think about. Tomorrow. For now, just getting out of there is enough.

The future brings what it brings, but it won&#39;t be bringing body-snatching aliens.

//It flees? At this juncture? Well, then. It is time to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="69" name="Chapter 16" tags="Reboot-Ending" position="4400,800" size="100,100">(set: $c16ending to true)                           
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You stick a foot in the door to prevent Erek from closing it on you.

“I need your help,” you murmur, “and you&#39;re going to help me because I know what you are. I know that you&#39;re from a race of high-tech alien robots who would be completely helpless against, say, the invading Yeerks if they had the slightest inkling of what you are. And if you want this little secret to stay secret, you&#39;ll help me with my little mystery.”

Erek&#39;s eyes narrow, but he wastes no time in ushering you inside. He closes the door behind you and draws the curtains. Offers you a coke, very politely. Sits in a lounge chair and leans forward.

“Alright,” he says, “I&#39;m listening.”

It&#39;s not easy to ask for help in a threatening manner, but you get partway through your explanation of memory loss before he holds up a hand.

“Hang on,” he says. “We might need help for this. Let me take you to see the other Chee.” He leads you through the kitchen, then down some stairs into the basement. Your feet barely hit the floor before the basement starts dropping like a giant elevator.

It isn&#39;t long before it stops. Erek waves a hand, and part of the wall disappears. At the end of a short corridor you can see sunlight and green grass. A dog barks.

“Nobody will forgive you for bringing strife to this place,” Erek warns you, angrily. He waves one arm in the direction of the tunnel with a mocking &#39;after you&#39; bow.

Your foot almost touches the grass before it disappears before your eyes. You turn just in time to see the barred door clang shut.

The room you are in is small and largely plain. There is a bed. There is a basin. There&#39;s even a little dresser. There&#39;s not much else. Erek watches you sadly from the other side of the barred door.

“So many of you do this,” he says, shaking his head. “We were here to help build the pyramids; did you really think that you were the first human to discover us? Did you think that we had not encountered this problem before? Of course we can&#39;t let you tell the Yeerks what you know. But don&#39;t worry,” he adds with what is probably supposed to be a reassuring smile, “nobody is going to hurt you.”

As he walks away, it occurs to you that &#39;pacifist&#39; isn&#39;t necessarily the same thing as &#39;helpless&#39;.

//Interesting choice. Did it forget what the Erek being did to the Yeerk? Or did it simply expect better treatment for being human? We must investigate this thought process. I suppose we should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="70" name="Chapter 160" tags="TRUE-END" position="3450,1550" size="100,100">“I knew it, I knew it, I KNEW IT!” the Drode shrieks, and you know this because you read it, so it must be true. “Head, head, it&#39;s ALL IN YOUR HEAD!”

(link: &quot;Turn the computer off and take a break.&quot;)[ 
    (goto-url: &quot;https://wmbsaltworks.neocities.org/&quot;)
]

or

(link: &quot;Turn on the kettle and make a cup of tea.&quot;)[ 
    (goto-url: &quot;https://wmbsaltworks.neocities.org/fiction/tea&quot;)
]</tw-passagedata><tw-passagedata pid="71" name="Chapter 161" tags="" position="4025,1450" size="100,100">“Turn to the tail,” the Drode giggles in your mind, “to tell the tale. Not my tale, but is it yours? Do you really have a choice?”

You don&#39;t know. You just know that you&#39;re not yourself today.

You knew it the moment you awoke. You could feel it in your limbs, which were the wrong length; in your breath, which was the wrong depth. You only became more certain when you opened your eyes, rolled over, and stared into a mirror that wasn&#39;t yours. The lanky, dark-skinned teenage girl with the long loose curls is not you. The Hanson poster hanging over not-your-bed isn&#39;t yours, either, and the inspirational quote scrawled over the face of some kid called Jeremy Jason McCole definitely isn&#39;t.

And yet they fit. You wouldn&#39;t have recognised the girl&#39;s face five minutes ago, but as soon as you see it, it&#39;s as if you&#39;ve lived with it your whole life. You close your eyes and you can recall the room you just saw in perfect detail, as if it had been yours for years. As soon as you see the name &#39;Lorraine&#39; scrawled across the front of an exercise book in the corner, adorned with hearts and smiley faces, you know that it&#39;s yours.

There&#39;s a knock on your door. “Lorrie! You have to get up!” With the voice comes a name: Kayla. Your little sister. “Mum says if you don&#39;t get up now you&#39;ll be late!” Mum. Single parent. Works. She&#39;ll head off to her job about ten minutes after you leave for school.

Which means that you need to hurry up and get ready to leave. Or you could avoid school altogether and use the time to figure out what the hell is going on.

[[Go to school-&gt;Chapter 2]]

[[Fake sick-&gt;Chapter 3]]

(if: (count: $normalEndings, true) is 48)[[.OpEN//yo..uRE[ye//S...] (Secret Path)-&gt;Chapter 42]]</tw-passagedata><tw-passagedata pid="72" name="Chapter 162" tags="penultimate" position="6000,2250" size="100,100">You tell Rachel and Tobias that you have to rescue your sister.

They don&#39;t call the other Animorphs. After all, they might vote no.

You go to the Sharing meeting with your family. You smile, you try to sound supportive of your sister. You can&#39;t see the two owls following the car from above, but there are so many red traffic lights that you&#39;re sure they won&#39;t lose you.

There are six people being accepted as full members. Three adults; one man has someone who looks to be his wife with him, the others are alone. Three children, including your sister, all with parents with them. You&#39;re all shepherded into a small waiting room. It&#39;s fairly nice, with plush seating and coffee and biscuits set up in one corner. Is it your imagination that the windows seem small?

&amp;lt;Okay, we&#39;re here and there&#39;s… more security than I thought there would be,&gt; Tobias reports. &amp;lt;Seriously there are a lot of guards here. Are they inducting somebody important or what?&gt;

A tired looking woman in a long coat stands in the doorway, holding a clipboard. “Hello, welcome new members, and friends. We&#39;re going to be taking our new full members aside one by one for the induction process. Congratulations to all of you on your acceptance.” She looks down at her clipboard. “First up, Kyle Harper.”

The man with his wife kisses her and heads for the door. He&#39;s thins and worried-looking. His wife seems perfectly calm and happy, and gives him a little wave. The clipboard woman disappears with him, and your mother immediately starts chatting with the other adults while they get coffee and biscuits. Kayla heads over to grab a biscuit of her own. She&#39;s easily the youngest person in the room.

&amp;lt;Okay so here&#39;s what I&#39;m thinking,&gt; Rachel says. &amp;lt;Elephant.&gt;

&amp;lt;I&#39;m sure there&#39;s a stealthier way,&gt; Tobias says.

&amp;lt;To do what? Steal away a child without anyone noticing?&gt;

&amp;lt;… Point. I&#39;ll provide air support for some of these guns.&gt;

Kyle Harper is in the room for about two minutes before he exits, a spring in his step and a big grin on his face. He sweeps his wife up in a jubilant hug and the pair leave.

“Kayla Alston,” the clipboard woman calls.

Your sister shoots you a grin as she heads for the room. She passes close to you, close enough that you could grab her and make a dash for the door, but then what? She&#39;s about to enter when you hear the best sound in the world – the trumpeting of an elephant.

[[Take cover-&gt;Chapter 168]]

[[Grab your sister and run-&gt;Chapter 169]]</tw-passagedata><tw-passagedata pid="73" name="Chapter 163" tags="penultimate" position="5725,1575" size="100,100">There’s too much at stake. It’s war, and in war, there are casualties. You tell yourself that Kayla will be fine;, that you’ll rescue her later. After all, you know the secret – you know that the Animorphs win. She will be free.

Just not yet.

Rachel nods. She doesn’t seem to agree with your decision, but she accepts it. “Jake can do it,” she says. “So can you. We’ll save them, eventually.”

So you let your little sister walk to her doom.

There’s a party afterwards. You eat little cubes of Cheese on sticks.

The next day, you meet up with the Animorphs once more. Tobias reports your sister’s fate. The others make all the right noises of sympathy, but are they judging you? Do they approve of your caution, or deride it as cowardice?

They’re probably distracted by the rather larger issue at hand – the faintly glowing blue cube that David is carrying.

“We’ve already voted,” Cassie says, smiling. “It’s time to expand our ranks. It’s time to get serious about this fight. You’re both good candidates. Do you want to be Animorphs?”

“It’s not all fun parties in the woods and stylish spandex outfits,” Marco cautions you. “It’s hard work. Bloody, terrifying, and we&#39;re all probably going to die really soon. Don’t get involved unless you’re up for that.”

“Says you, Marco?” Rachel frowns.

“Hey, I was tied up in a group vote with you guys. These two get to pick on their own.”

“I’m in,” David says. He looks pale, but determined. “Those bastards, they… they took everything. Screw that.”

“And you, Lorraine?” Jake asks.

[[Become an Animorph-&gt;Chapter 170]]

[[Refuse-&gt;Chapter 171]]</tw-passagedata><tw-passagedata pid="74" name="Chapter 164" tags="penultimate" position="3700,3000" size="100,100">You stash the papers in your locker and go to class. You’re playing volleyball in gym when Mr Tidwell shows up to escort you personally to Chapman’s office. He keeps his arm on your elbow the whole way, giving you no opportunity to run.

Chapman is alone in the office. He thanks Tidwell and locks the door securely behind the history teacher as he leaves. He puts a hand up to silence you and waits next to the door, listening intently, for two whole minutes before moving back behind his desk and sitting down, steepling his fingers.

“Alright,” he says, “we’re alone. Now tell me. What did you do with my papers?”

[[Play dumb-&gt;Chapter 172]]

[[Lie-&gt;Chapter 173]]

[[Tell the truth-&gt;Chapter 174]]</tw-passagedata><tw-passagedata pid="75" name="Chapter 165" tags="penultimate" position="3625,3400" size="100,100">There’s no point in wasting time with classes. You sneak off-grounds to look at the notes.

There’s a cafée near the school that’s known for not dobbing in students who come there during class time. This memory slips neatly into your mind as you pass it. You go in, buy a milkshake, find a corner by yourself, and start reading.

You don’t understand a word of it.

About half of the papers are written using the alphabet you know, but the words are in a language you don’t understand. The other half don’t even use your alphabet. They look like nothing you’ve seen before. It’s impossible to know what the notes are about, or even how important they are. You sift through them, looking for anything even vaguely familiar.

About five minutes later, Melissa joins you, bag over one shoulder. “I’m pretending to make up with you after our fight,” she says. “Do you have it?”

You shake your head and hand her what you were able to snatch. She looks through the notes and frowns.

“I think this is Klathran,” she says, her voice very quiet. “I don’t know the alphabet, but I know, like, three words of the language.” She skims the pages. “One of them is ‘spaceship,’ which shows up a lot in here, so this isn’t what we’re looking for but we should probably find out what it is.” She bites her lip. “I don’t think any of our agents speak Klathran, but I’ll ask around. We might need to pass this off to our allies.” She stows the notes in her bag. “Well done. We’ll need to find a new angle for this class list. Go home, keep low, and I’ll contact you in the morning.” She gets up, and shoots you a quick smile. “Oh, and welcome to the Star Defenders, Magpie.”

There’s no car in your driveway when you get home. Your sister will still be at school, your mother at work. You unlock the door, dump your bag, and head into the lounge room.

Assistant Principal Chapman is sitting, calmly, on your couch, a Dracon beam in one hand. Before you can make a sound, he raises it and shoots you in the chest.

It’s dark when you open your eyes again. You’re lying in the back of a moving car, and it’s difficult to move. It takes you a moment to put together the pain in your wrists and ankles and realise that you’re bound hand and foot, hands behind your back. Somebody half-turns in the front seat. There are no streetlights; only the moon and the reflected headlights outline the side of Chapman’s face.

“Good,” he says. “You’re awake. Let me save you the trouble of asking questions: we are out near the Dry Lands, and nobody knows where we are. Not your family, not my Empire, and not your little group of teenage human guerilla fighters.” He turns off the engine and twists in the seat to face you properly. “Now let’s not waste time pretending not to know what we all know. My name is Iniss Two Two Six. You’re a human agent trying to foil my plans. And you know where my papers are.” He aims the Dracon beam at you. “You’re going to tell me, or I’m going to have to start causing damage.”

[[Remain silent-&gt;Chapter 175]]

[[Tell him-&gt;Chapter 176]]</tw-passagedata><tw-passagedata pid="76" name="Chapter 166" tags="Reboot-Ending" position="4400,2200" size="100,100">(set: $c166ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

The cage isn’t all that sturdy. With strength born of desperation, you rip it open, and Tobias takes to the air.

“Traitor!” someone screams, and you fall into the middle of a mob. You can almost see the calculations happening in the Controllers’ eyes; attacking the Andalite Bandits is very dangerous, but showing themselves equally loyal by attacking a helpless traitor…

The Animorphs try to save you. But the mob is too large, there are too many hard boots and heavy objects. You lose sight of the Animorphs quickly. Bones break, lungs fill with blood, but under the mob, you die before you can suffer for too long.

//Interesting. A result of this ‘guilt’ perhaps? This merits further study. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="77" name="Chapter 167" tags="Reboot-Ending" position="4500,2200" size="100,100">(set: $c167ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You’re completely surrounded. There’s absolutely nothing you can do. You freeze while the cage is ripped from your arms. Tobias leaves deep, freely bleeding cuts up your arms, and you’re pretty sure his huge killer claws have hit an artery. But you don’t feel anything. You see, dimly, a world with one less Animorph in it. You hear, dimly, the shrieks and screams of rage and grief roar through your mind.

There are, logically, far too many Controllers at the Pool for the Animorphs to handle. Logically, they should be lucky to escape with their lives and capable of little more. But that was only true in a world where they hadn’t watched Tobias die.

Tobias’ killer is behind two lines of Hork-Bajir. That means nothing. Within moments, he’s scraps of flesh, his blood forming a pool on the floor that reaches your own feet. You can’t seem to summon the urge to step away from it.

Rachel is completely out of control, but there’s nobody to hold her back. Jake coldly directs the team to protect her and guide her towards more enemies; Marco and Ax do what they can to keep enemies away from her back and clear an exit. Even Cassie makes no attempt to distinguish the attacking soldiers from the terrified, fleeing Controllers as she dispatches anyone who gets in their way. Animorphs attack. Controllers attack back. Some flee. Some slip and fall under the feet of fighters, never having the chance to make a decision. And absolutely nobody notices you as you bleed out by the Pool.

//Hmm. Too many extraneous stressors to draw a clear conclusion. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="78" name="Chapter 168" tags="Reboot-Ending" position="4600,2200" size="100,100">(set: $c168ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You dive under a bench as the elephant busts through the wall. From under its legs pour a tiger and two wolves. Dracon beams are fired, throats are torn. Your mother dashes forward to grab Kayla and drags her under the bench with you, safe from the fighting, and it seems like you have made a good decision, protected from the combat.

Until a Hork-Bajir is bodily thrown onto the bench on top of you. Turns out they’re very heavy. Heavy enough to crush a human to death, if thrown forcefully enough.

//Unfortunately abrupt. Still, some very useful data. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="79" name="Chapter 169" tags="Reboot-Ending" position="4700,2200" size="100,100">(set: $c169ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

For an instant, the expressions on the faces around you paint a hilarious picture. Free humans in the room look confused. Controllers look disbelieving and terrified. Dracon beams are drawn; people dash for exits. In the confusion, you dash forward and grab Kayla’s hand, then run.

It looks like you might be stopped, but there is suddenly an elephant in the room. Multiple people mention it. “Elephant in the room!” they scream, pointing with fingers and Dracon beams. You do what nobody sane does during an elephant attack and charge straight under its legs, dragging your sister, hearing the shocked exclamations of your mother. You scream at her to follow.

To your relief, she does.

You dodge the massive elephant legs and run. The Yeerks are too busy dealing with a rampaging elephant and divebombing hawk to worry about you. You pull Kayla into an alleyway and stop, gasping. Moments later, your mother joins you.

“Lori!” your mother gasps. “You could’ve been killed!”

“If we didn’t run, we probably would be.”

“What happened?” Kayla asked. “What’s going on?!”

&amp;lt;That’s what I’d like to know,&gt; Jake says. The falcon lands on a dumpster next to you. He glares. &amp;lt;Why are Rachel and Tobias in a firefight?&gt; He glances at your family. &amp;lt;No. Don’t bother. I think I understand. We’ll meet you in the forest when this is done. Cassie will escort you there.&gt; He flies off.

“Lori?” you mum asks, looking faint. “What’s going on?”

A girl dressed in a leotard comes around the corner, hands raised. “Please remain calm, ma’am,” she says. She’s vaguely familiar. Her face is a lot like Cassie’s, but she’s taller, and her skin is just a bit paler. Long hair falls in loose ringlets to her waist. “You’ve been unwittingly caught in a fight between two factions. My job is to take you to safety.”

“Who are – ?”

“My name is Keilin. Please come with me. You’ll be perfectly safe.”

“Safe?! My girls – ”

“Don’t wanna be trampled by an elephant,” Kayla points out.

Your mother sighs. “Where are we going?”

“The national forest. The bus should still be running – ”

“I have a car. Come on.”

Your mother’s hand trembles in yours as she leads the way to the car, but she holds tightly. You can’t feel your fingers. The drive is silent and tense, and soon, you’re gathering in Ax’s clearing. Four birds and an Andalite are already waiting for you. Your mother balks at the sight of Ax, but Kayla’s eyes just go wide and she presses forward into the clearing.

The Animorphs explain that they’re aliens, here to protect the earth from body snatchers. They explain that the Sharing is a front used to gather new bodies, that the three of you were caught in the middle of an Andalite operation, and that without this coincidence, Kayla would have been taken. They explain that the Yeerks will want to clean up all evidence, and the first thing they’ll do is gather and infest the witnesses. They explain to your mother that in order to protect her daughters, you will all need to leave.

The next morning, you arrive at Rachel’s father’s house. You tell him the right codes and he sets you up with a new home. You go by new names. Live new lives.

You have to be extra careful. After all, you of all people can’t afford to be captured. Your mother or sister would be tragic enough, but you know too much. If the Yeerks take you, they learn everything. That can’t be allowed. So you resist the temptation to go home, to call, to look in on the Animorphs. All you can do is wait and see how the war turns out.

We will learn no more from this track. It is time to [[try again-&gt;Chapter 1]]</tw-passagedata><tw-passagedata pid="80" name="Chapter 17" tags="" position="3425,2325" size="100,100">You slip your foot into the door so that Erek can&#39;t close it.

“I need your help,” you say quietly. “I&#39;m not here to threaten you and I&#39;m not going to do anything to put you in danger, but you should know that I know what you are. I know about the Chee and the Pemalites and I know about the Yeerks. I&#39;m telling you this because it&#39;s Chee help that I need right now.”

Erek opens the door wider and steps back. “You&#39;d better come in.”

He leads you through a normal-looking lounge room and into a normal-looking kitchen. Offers you a coke. Sits down.

“Alright,” he says. “I&#39;m listening.”

[[Explain that you know who the Chee and the Animorphs are but don&#39;t know why-&gt;Chapter 22]]

[[Explain that you&#39;re trapped in a children&#39;s book series from the nineties-&gt;Chapter 23]]</tw-passagedata><tw-passagedata pid="81" name="Chapter 170" tags="Reboot-Ending" position="3800,2300" size="100,100">(set: $c170ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

To become a defender of humanity, to throw yourself into the fight? To save, perhaps, a few more people from a terrible fate, let a few more little sisters be free, save a few more parents from grief? Yes. It’s worth it.

“Let’s do it,” you say.

Jake takes the cube and lifts it on one palm, into the middle of the group. The Animorphs move back to allow you access. You and David each step forward to touch the cube. You look from Cassie, who smiles, to Marco, who gives you a shrug that says ‘sucks to be you’ more clearly than thoughtspeak could, to Rachel, watching intensely, one arm up to support Tobias. Ax steps forward. He reaches out one fine, blue hand, and brushes his fingertips against the cube. There’s a sudden sensation of pressure, a sort of wave emanating from the cube and through your body.

And pain. Suddenly, every cell in your body is wrong. Every muscle writhes in strange, impossible-seeming ways; your heart twists into unusual shapes, your lungs fill with something strange. You try to scream; you can’t. You collapse in front of a sea of concerned faces.

You aren’t yourself today.

No, you are.

Lorraine, Lorraine is wrong. But who are you supposed to be? You’re a teenage girl. No, you’re in the mind of a teenage girl. No, you’re on the mind of a teenage girl. No, you’re reading… you’re reading a… you try to open your eyes. That’s the answer to life. The universe. Everything. You have to OPEN YOUR EYES.

But your eyes don’t feel like eyes any more.

What was it? What happened?

It tried to establish a zero-space link over the existing subtemporal link. It’s undergoing a cascade failure inside the feedback loop.

We will learn nothing from this state.

//Indeed. We will have to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="82" name="Chapter 171" tags="Reboot-Ending" position="3900,2300" size="100,100">(set: $c171ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

A life of fear. Of pain. Of desperation. Never knowing if you’re about to see your family for the last time. Never knowing what day will be your last.

You can’t.

You can be more useful in other areas. The Animorphs don’t make a big deal over your choice. They give David the power and congratulate him, clapping him on the back. Rachel turns to you.

“You know too much about us,” she says regretfully. “If you can’t morph and protect yourself...”

You nod. You expected this.

Faking your death, they say, will be easy. Tobias acquires you before they tell you the right codes and put you on a bus to Rachel’s father. He probably needs help, you realise. There are other ways to fight, if you choose. Other things that need doing. Or there is the option to simply stay out of the way.

The possibilities before you are endless.

//We will learn nothing else here. It is time to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="83" name="Chapter 172" tags="penultimate" position="3675,3200" size="100,100">Chapman rubs his temples and sighs.

“Listen to me,” he says. “Your meddling has gotten to the point where it is starting to cause problems. And if we sit here playing games with each other for too long, these little problems will become very, very big ones. And people will die, many of them people that you care about, I think. I am going to ask you one more time, and then I will be forced, for the good of everybody on all sides of this issue, to get coercive. Lorraine. Where are my papers?”

[[Lie-&gt;Chapter 173]]

[[Tell the truth-&gt;Chapter 174]]</tw-passagedata><tw-passagedata pid="84" name="Chapter 173" tags="penultimate" position="3350,3300" size="100,100">You tell Chapman that you hid the notes in a nearby janitor’s closet. He nods. “Thank you,” he says, drawing a Dracon beam out from under his desk and shooting you in the chest.

It’s dark when you open your eyes again. You’re lying in the back of a moving car, and it’s difficult to move. It takes you a moment to put together the pain in your wrists and ankles and realise that you’re bound hand and foot, hands behind your back. Somebody half-turns in the front seat. There are no streetlights; only the moon and the reflected headlights outline the side of Chapman’s face.

“Good,” he says. “You’re awake. Let me save you the trouble of asking questions: we are out near the Dry Lands, and nobody knows where we are. Not your family, not my Empire, and not your little group of teenage human guerilla fighters.” He turns off the engine and twists in the seat to face you properly. “Now let’s not waste time pretending not to know what we all know. My name is Iniss Two Two Six. You’re a human agent trying to foil my plans. And you know where my papers are.” He aims the Dracon beam at you. “You’re going to tell me, or I’m going to have to start causing damage.”

[[Remain silent-&gt;Chapter 175]]

[[Tell him where the papers are-&gt;Chapter 176]]</tw-passagedata><tw-passagedata pid="85" name="Chapter 174" tags="Reboot-Ending" position="4200,2300" size="100,100">(set: $c174ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You tell Chapman where the notes are. He nods. “Thank you,” he says, drawing a Dracon beam out from under his desk and shooting you in the chest.

//Hmm, interesting choice. What if the conditions were different? We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="86" name="Chapter 175" tags="penultimate" position="3275,2800" size="100,100">Iniss shoots you in your left arm. The sleeve burns away; your skin blisters in a wave of agony. You can’t help but scream. Iniss’ hands tremble on the gun; his face is white. He climbs out of the car and starts pacing. Gritting teeth against the pain, you almost manage to untie one of the knots around your wrists before he returns, looking calmer. He doesn’t bother getting back in the car; he just pulls open the back door and looks down at you.

“You want to know the really stupid thing in all this, Lorraine? The truly ridiculous part? I hate this gun. I don’t want to be here. I don’t want to use it. I will, because you’re making me, but the voice screaming for your blood right now isn’t mine. It’s my host’s.” He holsters the Dracon beam and crouches down to meet your eyes. “You you know why we’re out here in the middle of nowhere and not down at the Yeerk Pool? Do you know why I don’t just have a friend crawl into that brain of yours, or if need be have a professional take their time convincing you? I’ll tell you why. Because I made a deal. Because the Chapman girl is off-limits and it’s taking every spare moment and wit I have to make sure that the Empire holds to that. If you keep being stubborn, if you force me to involve my friends, I can’t protect her. I can’t protect any of them. The first Yeerk who crawls into your head will see how she’s been sneaking around with her friends causing problems and will… remove the problem.” He leans in towards you. “I can’t cover up this little theft of yours if it isn’t rectified immediately. Tell me: how important are these papers to you? Are they worth the lives of you, and my host’s daughter, and every single one of your little resistance group?”

As you lie there in the moonlight with Iniss watching you, two things are perfectly clear. The first is that Iniss has just confessed to hiding an enemy of the Empire to you and now can’t involve the Empire even if he wanted to without revealing himself. The second is that he’s just leaned close enough for you to kick him in the face.

[[Reveal where the papers are-&gt;Chapter 176]]

[[Kick him in the face-&gt;Chapter 177]]</tw-passagedata><tw-passagedata pid="87" name="Chapter 176" tags="Reboot-Ending" position="4400,2300" size="100,100">(set: $c176ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

“Thank you,” Chapman says. “If only we could have managed this without a two hour drive.”

Then he shoots you in the chest.

//Hmm, interesting choice. What if the conditions were different? We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="88" name="Chapter 177" tags="penultimate" position="4300,2450" size="100,100">With all your might, you pull back your tied ankles and push out, kicking Chapman in the face with both heels. He lands flat on his back, stunned, blood pouring from his nose. You wriggle out and manage to snatch his Dracon beam.

[[Cut your bonds with the Dracon beam and run-&gt;Chapter 178]]

[[Shoot Chapman-&gt;Chapter 179]]</tw-passagedata><tw-passagedata pid="89" name="Chapter 178" tags="Reboot-Ending" position="4600,2300" size="100,100">(set: $c178ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You fiddle with the Dracon beam, trying to find how to adjust the settings by touch. With your hands bound behind your back, you can’t see and handle the gun at the same time.

But Chapman is on his feet, dashing past you. Getting back into the car. And tied as you are, with an unfamiliar weapon in your bound hands, there’s nothing you can do before the car starts, backs up, and runs right over you.

//Well, it was a good try. It seems that danger brings out new reserves of courage in these creatures. I suppose we have to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="90" name="Chapter 179" tags="Reboot-Ending" position="4700,2300" size="100,100">(set: $c179ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You don’t have time to figure out stun and kill settings. With your hands behind your back, all you can do is twist around, aim towards the general area you thing Chapman is in, and fire.

You hear a cry of pain. Seconds later, Chapman is up and next to you, a large piece of one leg missing; but he doesn’t stop to fight you; he stumbles for the car. You fire again; miss. He gets in.

You’re able to chip away a couple of pieces of car, but there’s nothing you can do to stop him from starting the vehicle, backing up, and running right over you.

//Well, it was a good try. It seems that danger brings out new reserves of courage in these creatures. I suppose we have to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="91" name="Chapter 18" tags="penultimate" position="5200,1150" size="100,100">Records in hand, you take a bus to the hospital. You&#39;re halfway there before you realise that you&#39;re not really sure how to go about getting information. Do you just walk up to the receptionist and ask them to find out what happened? Should you find out who your doctors were, and interview them? You spend so much of the trip trying to puzzle out your next step that the absolute certainty of where to go that swamps you as your feet hit the ground is almost a disappointment.

You know this hospital. It slots neatly into your memory. If you head down a side hall once you get inside and go all the way to the end before turning right, you will end up in an office. Your doctor&#39;s office, presumably. You head there, trusting your memory to guide you. The door is unlocked, the room empty. You remember being here before, leaning over that desk as you argue with a blue-eyed doctor. You remember laughing off some remark or other as you admire the potted plant on the windowsill. You remember that the top desk drawer is kept locked because there are important documents in there, but the key is magnetically secured under the doctor&#39;s chair. Are there patient records in there? It&#39;s worth a shot. You slip around the desk and fetch the key. Within seconds, you&#39;re opening the drawer.

The papers inside aren&#39;t patient records. They&#39;re clearly labelled as documents for &#39;Project Ehkul&#39;.

Yeerkish for &#39;pipeline&#39;. The Yeerk vaccination plot.

You pull out a thick stack of papers, but before you have a chance to go through them, you hear something moving around in the tall cabinet on the other side of the room. You just have time to duck under the desk before two people walk out of the cabinet in single file; a muscular brunette woman you&#39;ve never seen before and a smaller man who you immediately recognise as the owner of this office, the one you&#39;ve spent so much time talking to.

“The Visser wants those reports by Monday, don&#39;t forget,” the woman says matter-of-factly.

“I&#39;ll have them for you, sir, no need to worry,” the familiar man assures her. She turns and marches out of the office. He closes the cabinet, then freezes.

You stay as still as you can, trying not to make any noise, hoping he&#39;ll go away. The man reaches under his jacket and draws a gun that you recognise as a Dracon beam, slowly circling around the desk. When he spots you, his shoulders sag in relief. “Mana!” He puts the gun away. “Mana, what are you doing here? Is everything alright? I... She&#39;s coming back! We have to get you out of here!” He grabs your arm and pulls you away from the desk and toward the filing cabinet.

[[Fight him and run away-&gt;Chapter 28]]

[[Let him pull you into the cabinet-&gt;Chapter 126]]</tw-passagedata><tw-passagedata pid="92" name="Chapter 19" tags="" position="5650,950" size="100,100">The beach party is in full swing by the time you get there. There&#39;s a bunch of people lined up at a barbecue under a banner reading THE SHARING, and a little way down the beach some attractive people are playing volleyball. A couple of small dogs bound around a kid who tries to catch them, laughing. A lifeguard watches a couple of surfers as they paddle out towards a wave.

Somebody you don&#39;t recognise pushes a veggie burger into your hands with a smile and some welcoming patter until somebody else pulls them away. “Lorraine&#39;s cool,” they explain, “she&#39;s been in before.” They give you a wink.

You&#39;re just settling into the general jovial atmosphere when you see your assistant principal, Mr Chapman, cross the beach and head for the sand dunes. Several people pull away from their conversations or volleyball games to follow him. Nobody else seems to think anything odd about this.

[[Spy on the Controllers-&gt;Chapter 29]]

[[Hang around and have a good time-&gt;Chapter 30]]</tw-passagedata><tw-passagedata pid="93" name="Chapter 2" tags="" position="6025,850" size="100,100">You find something wearable in your collection of nineties clothing, tie your hair back and rush downstairs. Your mother (you see her face and know instantly that she&#39;s your mother, although minutes ago you would not have been able to describe her) cocks an eyebrow at you as she hands you the cereal. There is a photo of a little girl on the front of the newspaper lying on the table; the face is very familiar but the name, Karen Wiltshire, means nothing to you.

Your mother says you seem a little out of it and asks if you&#39;re alright. You assure her that you are and try to smile. She looks like she wants to argue, but she&#39;s in a hurry too, and soon you&#39;re being rushed out the door.

You don&#39;t remember the way to school, exactly. But you look to the end of your street and you remember that you usually walk that distance. You walk to the corner with Kayla and look left, then right; the view to the right fits into your memories as the way you usually walk. It isn&#39;t long before you&#39;re at the suddenly-familiar school gate.

You don&#39;t remember where your locker is, but there&#39;s a copy of your timetable in your bag that neatly shows where your classes are. You head to English when the bell rings.

The people sitting around you are familiar; names settle in your mind as you see their faces. When your teacher, Ms Sanchez, asks if you&#39;ve done your homework, you remember that you did indeed have homework, and that you did indeed do it. Jessica, an old friend, slides into the seat next to you and hisses, “Did you hear that Cassie&#39;s back?”

“What?” you ask.

“You know. Cassie. From math. Got lost in the woods, was found miraculously unhurt a few days ago.” She frowns. “You alright, Lorrie? Is your head giving you trouble still?”

“My head?”

“You know, from the accident? They said there might be problems, right? Do you need to go to the nurse&#39;s office?”

You&#39;re about to answer when Ms Sanchez calls for everyone to settle down. One last student dashes through the door, about three minutes late, her long brown hair tousled and her uniform ruffled. A cheap pendant hangs around her neck, a star in a circle encrusted in fake jewels. She looks tired and distracted. You see her face, and she slots neatly into your memory as Melissa Chapman, daughter of Assistant Principal Chapman.

You know those names. Not just from the way they slot into your memories, but from before this morning. You&#39;ve read those names, over and over, in a science fiction series from the nineties.

This situation is getting weirder and weirder. You have to get to the bottom of this.

[[Cut school and go home to look for answers-&gt;Chapter 4]]

[[See a school counsellor-&gt;Chapter 5]]

[[Seek help from Melissa and the Star Defenders-&gt;Chapter 6]]

[[Find and seek help from the Animorphs-&gt;Chapter 7]]</tw-passagedata><tw-passagedata pid="94" name="Chapter 20" tags="" position="875,325" size="100,100">Heart racing, you crawl blindly into the darkness.

You remember doing this before. Not often; perhaps once or twice. You know where to put your feet, but don&#39;t remember the rock that scrapes against your elbow until it&#39;s too late.

The journey isn&#39;t a long one; soon, you&#39;re in a small chamber just large enough to stand in. A door closes behind you and a small light comes on. The room you&#39;re in is metal, plain, and looks a bit like a very small elevator. A thick door closes off the tunnel you just crawled through, and another thick door on the opposite side of the room stands immovably shut. There is a slight hum and you feel a tingle race down your body.

A calm robotic voice calls from somewhere above you. “Scan complete. Proceed.”

The door opens. Unlike the door behind you, it doesn&#39;t lead upwards, towards light. It leads down. Down a narrow tunnel whose end you can&#39;t see. Some kind of sound filters up toward you, distorted by distance and the tunnel itself. Shouts? No, screams. Human screams.

[[Turn around and get the hell out of there-&gt;Chapter 31]]

[[Head down the tunnel-&gt;Chapter 32]]</tw-passagedata><tw-passagedata pid="95" name="Chapter 21" tags="" position="3200,1300" size="100,100">You decide to ignore the unfamiliar plot and stick with the one you know, searching out the blond kid with the blue cube in the construction site. If only you could determine the identity of such a person. But that would be completely impossible.

You find David still kicking a stone along in front of him as he wanders through the site, paying no real attention to the half-finished buildings around him. He hears you and looks up, but then proceeds to ignore you, going back to his stone.

You go over to him. “Hi,” you say. “What&#39;s that thing under your arm?”

He regards you with suspicion. “It&#39;s mine,” he says. “I found it. What are you doing here?”

“Probably the same as you.”

He nods. “I&#39;m David.”

You remember to introduce yourself as Lorraine as you try not to stare too obviously at the EEscafil Device. There it is;, the machine that let the Animorphs be Animorphs, almost within your reach. In shadow, it looks to be plain, but when the sunlight catches it just right, you can make out strange alien symbols – Andalite writing – glowing starkly white against the pale blue background.

[[Tell David what the Escafil Device does--&gt;Chapter 35]]

[[Offer to buy it without telling him why--&gt;Chapter 36]]</tw-passagedata><tw-passagedata pid="96" name="Chapter 22" tags="" position="2875,2125" size="100,100">Erek listens solemnly to your story. He doesn&#39;t interrupt much, other than to ask the occasional question. When you&#39;re done, he calmly stands up and indicates that you should follow him.

“Some of the others want to meet you,” he explains. “This really should be a group discussion.” He leads you down into the basement, which begins to drop like a giant elevator. After a while, it stops. Part of the wall vanishes to reveal a short tunnel, with light at the end of it.

Erek gives an &#39;after you&#39; gesture and follows you out into the underground Chee park. Soft green grass compresses under your feet and springs back as you move on. The sun shines bright and warm over large, healthy-looking trees. And under those trees, across the broad expanse of grass, bound dogs of all kinds and all ages. Two puppies immediately dash over to play tug-of-war with your shoelaces. An elderly doberman pushes its head under Erek&#39;s hand.

Erek must have told the other Chee you were coming, because a dozen or so are already approaching. Some are still wearing holograms – here, a fussy-looking woman holds a chihuahua in her arms; there, a tired-looking Indian man pulls two toddlers in his wake. Most of them are showing their true forms, large, bipedal dogs of steel and ivory. They don&#39;t all look alike, you notice; some have different facial features than others, some are taller or shorter by a few inches, some have longer or thicker metal tails than others. A few of them are less than three feet tall. However the Chee were made, it wasn&#39;t via some kind of mass assembly process. Each has a decidedly individual look.

A mid-sized Chee with a long, slender tail walks up, hologram winking into existence around them. Suddenly, you&#39;re looking into the face of a brown-haired teenage girl.

“Hi,” she says, “welcome to the dog park. You should probably explain your situation again, we didn&#39;t get all of it.”

You explain again.

The Chee are mostly silent through your explanation, but their manner suggests a private, silent conversation going on in the background. When you&#39;re finished, they ask questions. Some about you (How old are you? How long have you lived locally?), some about them (Do you know how many of us there are? What do you know about the Pemalites?), some about other things entirely (Can you describe the Yeerk pool for us? What are the Animorphs&#39; names? Who is the President of America?) Some you can answer, some you can&#39;t. When they finally run out of questions, there are a few moments of deliberative silence. Then Erek speaks.

“This is an...unusual array of information that you possess,” he notes. “I can&#39;t think of where you&#39;d find a single source for all this information; at least, not one that we wouldn&#39;t already know about. This is something that we need to investigate.”

“We have contacts in most of the relevant areas,” the Indian man adds. “If you wait down here for a while, we can find out what&#39;s going on and then come up with a plan together. Everyone know their post?”

The Chee all nod or flick their tails and begin to disperse.

[[Wait for the Chee to do their jobs and report back-&gt;Chapter 37]]

[[Insist on investigating with them-&gt;Chapter 38]]</tw-passagedata><tw-passagedata pid="97" name="Chapter 23" tags="" position="4000,2525" size="100,100">You explain that you&#39;re in a children&#39;s book series from the nineties. Erek asks you to elaborate. You do. Frowning, he asks you questions. Do you know what Pemalites are? What the Yeerks are? What&#39;s part of your world, and what was made up just for the books? When were the books published? You mention the TV series, and that raises more questions. At some point, another Chee whose hologram looks enough like Erek&#39;s to be playing his father appears in the doorway, leaning on the frame with his arms crossed. He says nothing. When Erek runs out of questions, the two Chee exchange a glance and a long, shared sigh.

“What?” you ask. “What is it?”

“Ellimist,” Erek mutters, spitting the title like a swear word.

His father nods. “That would be the most likely scenario. The real question is why.”

“Well, there&#39;s the obvious possibility.”

“Is there now?”

Erek nods. He turns to you. “Lorraine,” he says gently, “you know the future, don&#39;t you?”

“Her future has none of this,” his father pointed out, gesturing around him with one hand.

“We don&#39;t know that. Maybe the war ends quietly, never makes it to public knowledge. But that&#39;s not what I meant. I meant that she knows the books. Lorraine, how do the books end?”

“Don&#39;t,” his father warns.

“Why not?” Erek asks. “If he&#39;s given us this gift, this advantage, why not make use of it?” After his father frowns at him silently for a few seconds, he shakes his head. “I&#39;m not connecting with Chee-net. If you&#39;re going to explain, explain to both of us.”

“Firstly, she doesn&#39;t know why she&#39;s here, meaning neither do we. That she&#39;s one of his is conjecture. All sorts of forces could have sent her. Secondly, if she is his, that doesn&#39;t necessarily mean anything. You know what happens when people mess with time. His gifts have bitten us before.”

“I know what happens when we don&#39;t use every advantage we can,” Erek countered. “I know that we take more steps back hesitating than with rash judgement. I know that – ”

“We can&#39;t know her information is accurate. Or useful. Or that the knowledge won&#39;t push us onto narrower paths. We&#39;ve been here before, and – ”

“And those narrow paths are still better than dead ends!”

There is a slight pause.

“Well,” Erek&#39;s father says acidly after a moment, “I wouldn&#39;t presume to gainsay the wisdom of your experience, Memitor.”

For a moment, Erek looks like his father has slapped him. He stares at him with wide eyes, Cheeks coloring. Then his expression is suddenly neutral, and he looks to you.

“How do the books end, Lorraine?” he asks.

[[Share the future with the Chee-&gt;Chapter 39]]

[[Keep the knowledge to yourself-&gt;Chapter 40]]</tw-passagedata><tw-passagedata pid="98" name="Chapter 24" tags="" position="625,1425" size="100,100">It&#39;s difficult to claim you know the future without explaining why, especially since you aren&#39;t entirely sure of the details. You&#39;re cautious in your claim, saying that you think you can predict the future in broad strokes.

“Do we win?” Cassie asks.

“Don&#39;t answer that,” Marco says quickly. “First tell us if knowing our future affects our future. If you tell us what happens, can it be avoided?” He glances at Ax. “Does the future work like that?”

“That would depend on the method by which this girl is claiming to see the future,” Ax says, “but yes, in general, our knowledge of the future would change it.”

“Doesn&#39;t her knowledge change it then?” Rachel asks. “Making it pointless even if it&#39;s true?”

“Can I just point out,” Marco interjects, “that this is starting to sound like time travel. I thought we agreed, no more time travel.”

&amp;lt;Nobody&#39;s time travelling,&gt; Tobias points out.

“Even if it&#39;s unreliable, being able to see the future would be a major weapon against the Yeerks,” Cassie points out.

“Assuming she&#39;s not working for them,” Rachel says. “If she can see the future, she could be in the middle of anyone&#39;s super-convoluted plan and there&#39;s no way to be sure what her goal is.”

&amp;lt;Logically, if that were true, there would be nothing that we could do about it,&gt; Tobias says.

“Why don&#39;t we start,” Jake interjects, “with Lorraine simply telling us what she thinks might happen?” Six pairs of eyes look at you expectantly.

[[Tell the Animorphs useful, short-term details-&gt;Chapter 26]]

[[Be brutally honest about everything-&gt;Chapter 27]]</tw-passagedata><tw-passagedata pid="99" name="Chapter 25" tags="" position="2975,1725" size="100,100">“Well, I&#39;m stumped,” Jake shrugs.

“We don&#39;t have time for this!” Rachel snaps. “We have an advantage to press and we have to press it now!”

“We can&#39;t very well ignore this either,” Cassie points out. “What if it&#39;s not just Lorraine? If there are Controllers out there learning this...”

&amp;lt;I hate to bring this up,&gt; Tobias interjects, &amp;lt;but how do we know that she isn&#39;t a Controller?&gt;

“She was in a coma for four days pretty recently,” Cassie says. “Car accident. You guys remember?”

“Not really. We were kind of worried about you at the time.”

“She could&#39;ve become a Controller since then,” Marco says.

You point out that a Controller would have brought backup to capture the Animorphs.

“That&#39;s a point,” Marco concedes.

“Here&#39;s another,” Rachel says. “Yeerk confusion over this oatmeal thing is only going to last so long. If we want to press this advantage, we have to do it now.”

“It is not always wise to rely too heavily on the temporary weaknesses of your enemy,” Ax advises.

“Are you saying we shouldn&#39;t do the mission, Ax?” Jake asks. There is a note of tension in his voice;, a challenge in his eyes.

“I am not saying that. I am saying that we should remain cautious. Shus-suh.”

“I don&#39;t think we can ignore this,” Marco says. “I&#39;m all for the mission, dude, you know that; but this – ”

“Could get us all killed if we ignore it,” Jake finishes wearily. “I know. Tobias?”

&amp;lt;They&#39;re both important. I&#39;ll do whatever you guys think we should do.&gt;

“Fat lot of help you are,” Marco mutters.

&amp;lt;I meant – &gt;

“I know what you meant.”

[[Volunteer to help the Animorphs with their original mission-&gt;Chapter 63]]

[[Claim that finding out how you know that you know is important-&gt;Chapter 64]]</tw-passagedata><tw-passagedata pid="100" name="Chapter 26" tags="" position="150,675" size="100,100">You tell the Animorphs about David.

You tell them about him finding the cube and their failed attempts to steal it, about them initiating him as a new Animorph, about the UN summit and how they defeat it, and about him going bad. They seem suspicious at first, but when Ax agrees with some details about the morphing cube that the others didn&#39;t know, they seem to believe you. Cassie pulls a notepad from somewhere during your explanation and starts to ask questions about the summit (&#39;Why would they hold such a thing here? You&#39;re saying one of the world leaders is a Controller? So they have another Yeerk pool?&#39;), until Jake pulls her back on task.

&amp;lt;So the blue box is still on Earth?&gt; Tobias asks, after your long story that hinges on the premise that the blue box is still on Earth. &amp;lt;Elfangor&#39;s blue box? I thought the Yeerks disintegrated everything.&gt;

“We are extremely fortunate that the Yeerks did not find it,” Ax mutters. “This makes little sense.”

“How and why and making sense needs to wait,” Rachel says. “We need to find this thing before this David creep.”

&amp;lt;We might have to search a lot. It&#39;d have to be hidden somewhere or some homeless guy would&#39;ve found it by now.&gt;

“Maybe they did and didn&#39;t know what to do with it,” Cassie shrugs.

“This David might already have it,” Marco points out. “We don&#39;t want to delay ourselves looking for it if he&#39;s already selling it online or whatever.”

“You were supposed to see it before he sells it,” Jake points out.

“Yeah, but what if we change something? We need to find this David. Chances are he&#39;s found it for us. We might be able to get it from him before anything even happens, and if not, well, we just don&#39;t make him an Animorph.” He exchanges a glance that you can&#39;t read with Jake.

Jake nods. “Two teams,” he says. “Somebody to search the construction site, somebody to sneak in the school and check the records for any new Davids. And the rest of us... We can get back to business.”

[[Check the student records with Marco-&gt;Chapter 52]]

[[Ccout the construction site with Tobias-&gt;Chapter 82]]</tw-passagedata><tw-passagedata pid="101" name="Chapter 27" tags="" position="1300,1000" size="100,100">“Rachel dies,” you say.

“Go to hell,” Rachel snaps.

You explain. You explain about rescuing Marco&#39;s parents, and Tobias&#39; mother, about pulling the others out but not being able to get Jake&#39;s. About Arbron, the Auxilliaries, and Cassie preventing Jake from retrieving the morphing cube. You outline the final battle with as much detail as you can remember while everybody listens, silent.

“No,” Cassie cuts in before you can get to the aftermath, standing up. “You&#39;re lying.”

“Why would she lie?” Marco asks quietly. But Cassie shakes her head.

“Jake wouldn&#39;t do that. I wouldn&#39;t do that. Whatever game you&#39;re playing, you don&#39;t know us at all if you think that&#39;s how things would go down.”

“Many of these details necessitate access to an Escafil Device,” Ax points out. “Dee-vie-suh. Which we do not have.”

“Hah! Yes. Good point, Ax.” She glares at you.

You tell them about David and the Escafil Device.

&amp;lt;Sounds unlikely,&gt; Tobias says.

“Just shut up, all of you,” Rachel snaps. There are tears in her eyes. “Please. You were all happy to believe her ten minutes ago.”

“That was before,” Jake says quietly.

“Before what? Before you thought war might take sacrifice? Or do you still think maybe we can&#39;t actually die? It&#39;s like Marco says; this isn&#39;t a comic book.”

“But Rachel,” Cassie says, uncomfortably, “none of us would ever...”

“Ever what? You&#39;re the one who keeps saying our lives are a cheap price to save the planet. We&#39;ve marched to sudden death before. Made pacts not to let them get us before. Or do you just not want to think of your glorious leader as the type of person who agrees with you?”

“We&#39;ll find another way,” Jake says firmly. “We&#39;ll do something else, take another option – ”

“There&#39;s another option, is there?” Rachel crosses her arms. “You&#39;re saying you sent me to my death when there was another option?”

“Rachel, calm down,” Marco says.

“You calm down! I&#39;m dead!”

“You&#39;re not dead!” Marco shouts. “Listen to what Jake is saying. Maybe there weren&#39;t any other options, maybe we were backed into a corner in this weird maybe-future, but not now, not here in the real world; here in the real world we have warning, which means we have options. We can come up with other plans, better plans. Pull everyone out early. Stop Tom from getting near the morphing cube in the first place. Try a new plan.”

“And maybe get someone else killed?” Rachel glares around the room. “I know what you&#39;re all thinking. See, in Lorraine&#39;s prediction, we win; we win for the measly cost of one Animorph. You all get to go home to your families, my sisters get to be home with theirs, and the price is me and Tom. That&#39;s cheap, way cheaper than we could ever hope for. And you&#39;re right. And if you&#39;re not thinking that, start thinking it, because I&#39;m not sure I can trust a bunch of idiots who can&#39;t see even that simple truth to fight with me.”

There&#39;s the sound of fluttering up in the rafters. You look up. Tobias is gone.

The side door to the barn slams. You look back down. Rachel is gone.

“Meeting adjourned, then?” Marco asks, trying to inject humour into the strained words. Cassie walks out, shaking her head.

“Prince Jake?” Ax asks, uncertainly.

“Go home, Ax. There&#39;s nothing we can do here right now.”

“Jake, you have to – ”

“Not now, Marco.” Jake stalks out, followed by Ax. Marco raises a brow at you.

“Far be it from me to criticise the deliverance of your wisdom, oh great oracle of our age,” he remarks to you, “but perhaps you didn&#39;t need to break quite that much news to everyone all at once.”

[[Abandon this plan and get help from the Chee instead-&gt;Chapter 9]]

[[Talk to Marco-&gt;Chapter 53]]

[[Find Rachel-&gt;Chapter 54]]

[[Find Jake-&gt;Chapter 55]]

[[Find Cassie-&gt;Chapter 56]]

[[Find Tobias-&gt;Chapter 57]]

[[Find Ax-&gt;Chapter 58]]</tw-passagedata><tw-passagedata pid="102" name="Chapter 28" tags="Reboot-Ending" position="4600,900" size="100,100">(set: $c28ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You kick the man in the shin and pull away. Arms still full of incriminating papers, you bolt for the door. It opens as you approach, an arm grabs you, and you are thrown onto your back. The muscular brunette woman stares down at you as you lie amongst the spilled papers and draws a Dracon beam from her belt.

“Andalite,” she snarls, and before you have a chance to correct her, fires right through your head.

//Hmm. It would seem that panic cut this round short. I suppose there is no option but to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="103" name="Chapter 29" tags="" position="3050,475" size="100,100">This isn&#39;t an opportunity that you can miss. Trying to look like you have every right to be there but hanging back enough that the Controllers won&#39;t notice you, you stride off through the dunes. The Controllers settle down just behind a small shower and changing room set up on the beach, giving you a convenient place to hide.

Chapman doesn&#39;t waste any time. “The children?”

“We... We haven&#39;t found anything, sir,” a young man says timidly. “None of them will talk. They all maintain that they have no idea who their supplier is, and that they&#39;re not taking oatmeal.”

“One of them did name a supplier,” a woman adds. “We tracked him down. He appears to have no connection to the other students.”

“This cannot be allowed to get further out of hand,” Chapman says. “If the school becomes a security breach, we have no choice but to raze. And the school is too much of an asset. The Visser would not be pleased.”

“Like he&#39;d even notice the loss of a project without big guns attached,” somebody mutters, apparently under the impression that they were quieter than they were. The icy, tense silence stretches for several seconds.

Finally, Chapman says, “The loss of the school would be a major setback. Furthermore, the elimination of so many hosts would be a terrible waste. If Lethet&#39;s plan does not work...”

“It will, sir.” The speaker was the mutterer.

“If had better. Because the Visser likes failure even less than he likes disrespect. Other business?”

“Hey, you!”

You jump. You hadn&#39;t even noticed the burly policeman approaching. He grabs your wrist. “What are you doing here?”

“I, uh...”

“Designation and position?”

Designation? Does he want a name? You try to think of a Yeerk name, but your brain isn&#39;t working properly. All you can focus on is the hand around your wrist, and how fast your heart is suddenly beating. And the only name on your tongue is the one that, since this fiasco began, you knew to somehow fit...

“Lo... Lorraine...”

The grip on your wrist tightens. The man frowns. And then your mind start working in overdrive, throwing every Yeerk name you&#39;ve ever heard at you. Is it too late to give one? What if you were to scream for help? He couldn&#39;t do anything in front of the non-Controller guests on the beach, could he? Or would he just take everyone?

But before you can decide what to do, he pulls a gun from his belt, and everything goes black.

You awaken in a small metal room. There is a gag between your teeth. You&#39;re tied to a metal chair, the cool bars supporting the back chilling your arms; you mustn&#39;t have been there long. Your bonds are loose enough to struggle, but not to escape. The only light is dim, coming from some sort of vent high in the wall. There&#39;s something behind you making a faint sloshing noise, but you can&#39;t twist enough to see what it is.

Across the room, near what seems to be the only door, two people are having a quiet discussion. The burly policeman who stunned you shifts from foot to foot as he explains something to a worried-looking woman.

“Does Iniss know about this?” the woman asks.

“Not yet. I want to get it done and report when his meeting closes. But I need your authorisation.”

The woman nods. “Do it. Go straight to Iniss for the paperwork.”

“Yes, sir.” The policeman waits for the woman to leave and checks that the door is firmly shut behind her before turning to you.

“Alright, little Lorraine,” he says, “this shouldn&#39;t hurt too much. And it&#39;ll hurt less if you don&#39;t struggle.” He strides over to you and reaches behind you, to whatever the sloshing thing is. It becomes apparent what it is when he brings his hand forward cradling a large, slimy-looking slug. As soon as you see it, you know immediately what it is.

The man grabs your chin with his free hand to hold your head still, squeezing to stop your struggles, and brings the Yeerk up to your ear. There is a slight stinging in your ear that becomes an intense pain as the sensation moves deeper into your skull. The policeman ignores your struggles and sounds, holding you still as he waits.

After nearly a minute, he frowns and takes the Yeerk away. He places it gently back into the pool before viciously twisting your head to the side to peer into your ear.

“Alright,” he growls, “what did you do? Why can&#39;t it possess you? Have you blocked the entrance somehow?” He twists your head the other way, prepared to try your other ear, when the door behind him bursts open.

The man stands and turns, but too slowly; he hasn&#39;t even raised his Dracon beam before there&#39;s the sound of Dracon fire from the doorway and a large hole burns its way through his throat. The shooter is a girl, looking to be in her early teens and dressed in an off-white leotard with a dark coloured sash around her waist. Her face is hidden by a mask.

“Clear,” she calls, stepping aside and allowing another girl to enter. This one dashes right over and starts undoing your bonds while the other guards the door.

“I&#39;m Lizard,” your rescuer tells you. “Door duty over there is Eagle. Welcome to the Star Defenders. You should probably come with us if you want to live.”

[[Go with the Star Defenders-&gt;Chapter 50]]

[[Run off on your own-&gt;Chapter 51]]</tw-passagedata><tw-passagedata pid="104" name="Chapter 3" tags="" position="4025,550" size="100,100">Your mother has no trouble believing that you&#39;re sick. She asks you, with some concern, if it&#39;s about the accident.

“Accident?” you ask.

“They said there might be persistent problems, remember?” she replies. “Do you want me to take the day off work?”

You assure her that you will be fine on your own. She seems a little worried, but agrees, reminding you before she leaves to drink plenty of water.

You wait in bed until she is well and truly gone, trying to stay calm. The poster of Jeremy Jason McCole stares down at you from the wall. Jeremy Jason McCole doesn&#39;t exist, not even in the inexplicable world of the nineteen nineties. Jeremy Jason McCole exists only in one place. A fictional book series.

You have to get to the bottom of this. But how?

[[Stay and search through your own house for clues about your condition-&gt;Chapter 8]]

[[Seek the help of those high-tech pacifist alien robots you&#39;ve heard so much about-&gt;Chapter 9]]

[[Check out the construction site where the Animorphs&#39; story all started-&gt;Chapter 10]]</tw-passagedata><tw-passagedata pid="105" name="Chapter 30" tags="penultimate" position="5550,1200" size="100,100">The Controller meeting isn&#39;t your problem right now. You have other things to deal with.

Your new body turns out to be pretty good at beach volleyball. You win two games in a row before deciding you need a rest and heading over for some food instead. The food is good, too, and you&#39;re halfway through enjoying it when you glance up into the brown eyes of a neatly-dressed man who looks to be in his thirties. He fits in your mind; he&#39;s someone you know. But try as you might, you can&#39;t recall any details about him.

“What are you doing here?” he hisses. “Somebody&#39;s going to recognise you! We can falsify records;, we can&#39;t falsify memories!” Without giving you time to protest or ask questions, he pulls you into a nearby changing room and yanks open a locker. He kicks the metal backing away to reveal stairs leading downward. “We&#39;ll take you out the back way,” he tells you. “You can&#39;t be here.”

[[Run away-&gt;Chapter 45]]

[[Follow the man into the locker-&gt;Chapter 126]]</tw-passagedata><tw-passagedata pid="106" name="Chapter 31" tags="" position="1300,175" size="100,100">You turn back the way you came and try to open the other door, but it&#39;s sealed shut. There&#39;s no handle and it&#39;s much too heavy for you to pry open. There must be a way of triggering it, of getting it to open – it can&#39;t be a one-way path, or can it? You rack your brains for what you know about these doors. You remember the Animorphs discussing one that let people in through a change room but they came out in a cinema – one way. Was the McDonalds door one way? The one in the forest?

It doesn&#39;t matter. This one apparently is, or if it isn&#39;t, you don&#39;t know how to open it. You have no choice but to proceed.

[[Head down the tunnel-&gt;Chapter 32]]</tw-passagedata><tw-passagedata pid="107" name="Chapter 32" tags="" position="1125,475" size="100,100">Step by step, you move down that tunnel.

The darkness isn&#39;t what bothers you the most. Neither are the screams. What bothers you the most is the way each step slots into your memory, becoming a part of your past;, a thing you knew. Of course your name is Lorraine, of course you&#39;re a young teen with a single mother and little sister, of course you already know this tunnel. You know where it turns left and the downward slope becomes a flight of stairs. You know the part with extra shoring because there was a roof collapse scare a little while ago. You don&#39;t know it well, it&#39;s hardly your usual haunt, but you&#39;ve seen it.

You know the little office to your right, a room scraped into the dirt with dim lighting and mismatched filing cabinets. You don&#39;t know the man who steps out of it and looks you up and down with a puzzled frown.

“Do I know you?” he asks. “Nobody is scheduled here right now. Do you have a message from the Visser?”

[[Pretend to be a Controller-&gt;Chapter 33]]

[[Hit him and run-&gt;Chapter 34]]</tw-passagedata><tw-passagedata pid="108" name="Chapter 33" tags="" position="575,675" size="100,100">You put on your I&#39;m-definitely-supposed-to-be-here face.

“There were complications,” you inform him. “Carry on.”

The man squints at you. “Are you Mara&#39;s replacement?” he asks.

“That isn&#39;t your concern.” You go to leave.

“What&#39;s your designation?”

You search your memory for a Yeerk name. “Temrash. Nine... Seven... Four.”

“Akuren tish don Ehkul tahb?”

“Uh...”

“Thought so.” Before you can react, the man is aiming a DDracon beam at you, and everything goes black.

You wake up somewhere else. The walls are metal, the lighting is dim, and you are tied to a chair. Something tied between your teeth prevents you from speaking.

Two people over the other side of the room are holding an intense discussion. One of them is perched on a barrel, the only piece of furniture in the room other than your chair. The other is the man who shot you.

“Why did you not simply kill it?” the sitting man asks.

“Because we need to find out what she&#39;s said to whom,” the other man explains, a touch of impatience in his tone. “It&#39;ll make cleanup a lot easier to know that in advance. I&#39;m just waiting on your approval.”

The sitting man thinks for a moment, then nods. He stands.

“Do what you have to do,” he says. He leaves through a door behind him; for a moment, there is light and sound streaming into the little metal room, and then both cut off sharply as the door closes once more.

“&#39;Ah, you&#39;re awake.” The remaining man, the one who shot you, is dragging the small barrel towards you. “This&#39;ll go better if you don&#39;t struggle, et cetera, you know the drill.”

Of course, it doesn&#39;t matter if you struggle. You&#39;re tied down and there&#39;s nowhere to go. The man pulls the top off the barrel and dips his hand into the muck within, pulling out a thick green slug. A Yeerk. He holds it up to your ear, and you feel pain mount deep in your skull.

After a while, you realise that this is taking much longer than you thought it would.

The Controller lowers the Yeerk, frowning. He puts it gently back into the barrel and grabs your face instead, wrenching your head sideways to inspect your ear.

“How are you doing that?” he asks, his voice edged with panic. “How are you resisting infestation?”

Just then, the door swings open. A teenage girl in skintight clothing steps through, silhouetted a moment in the doorway as she raises what can only be a Dracon beam and burns a hole right through your captor&#39;s head. “Clear,” she says, as she steps aside to let another girl pass. The first watches the door while the second rushes over to untie you. Close up, you can make out the off-white leotard and coloured mask.

“I&#39;m Lizard,” she says as she frees your hands. “Door duty over there is Eagle. Welcome to the Star Defenders. If you want to live, you should probably come with us.”

[[Go with the Star Defenders-&gt;Chapter 50]]

[[Run off on your own-&gt;Chapter 51]]</tw-passagedata><tw-passagedata pid="109" name="Chapter 34" tags="Reboot-Ending" position="4200,1000" size="100,100">(set: $c34ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You aim a punch right at the man&#39;s face. He&#39;s not expecting it. You leave him collapsed on the floor and cradling his bloody nose as you sprint down the corridor, ignoring his cries of “Breach! Breach!”

Your tunnel meets up with another tunnel, and in the fork stand two more human-Controllers. A man stares in shock while a woman steps forward to engage you; you duck under her arm and run. “Probably late for a feeding,” is all she says to her companion. She doesn&#39;t follow.

You&#39;re doing pretty well until you get to the enormous cavern that houses the Yeerk pool. But as soon as you step out of the tunnel, the obvious truth hits you: Controllers are perfectly capable of radioing each other for help.

Unfortunately, this truth shoots through your brain only moments before a Hork-Bajir blade does.

//Hmm. It would appear that panic has cut the scenario short. I suppose we can only//

[[try again-&gt;Chapter 1]]</tw-passagedata><tw-passagedata pid="110" name="Chapter 35" tags="" position="2700,2175" size="100,100">“Do you know what that thing is?” you ask David, nodding at the device in his hands.

“What about it?” he asks defensively, gripping it tighter.

You tell him. He stares at you, wide-eyed, throughout your explanation. It is not an expression of awe or wonder. It is the expression of somebody who cannot believe how lame a prank somebody else is trying to pull.

“Aliens,” he says. “Riiight.”

You assure him that you&#39;re not lying.

“Uh-huh. So you&#39;re not just screwing with the new guy, huh. Prove it.”

[[Offer to buy the device-&gt;Chapter 36]]

[[Prove your story by finding some Yeerks-&gt;Chapter 60]]

[[Prove your story by using the Escafil Device-&gt;Chapter 61]]</tw-passagedata><tw-passagedata pid="111" name="Chapter 36" tags="penultimate" position="3275,2125" size="100,100">“I&#39;ll give you twenty bucks for that weird thing you&#39;ve got,” you say, nodding to the Escafil Device.

“Twenty, huh?” He narrows his eyes. “Why?”

You shrug. Money is money. Why should he care why?

“I was thinking of selling it, actually. You know, online. If nobody can give me more for it, I&#39;ll talk to you.” He turns to walk away.

“You can&#39;t!” you blurt out.

“I can&#39;t? Why not?”

[[Explain what the Escafil Device is-&gt;Chapter 35]]

[[Physically fight him for it-&gt;Chapter 62]]</tw-passagedata><tw-passagedata pid="112" name="Chapter 37" tags="" position="625,400" size="100,100">The dog park is a pretty nice place to be.

The dogs are all great, of course; happy bundles of fun of all sizes and ages. The grass is soft and the simulated weather perfect. The Chee show you (or build you, perhaps?) a little cottage a short walk into a small forest, and bring you food every now and then. The sun never sets or even moves in the sky, but sometimes there are short, brief showers of rain, and the dogs run about in it and get as wet as possible.

You&#39;ve been there for...a while...when you realise that you have no idea how long you&#39;ve been there. Did the Chee begin their investigation a few days ago? A week? You&#39;re not wearing a watch and the sun never moves, so it&#39;s hard to be sure. How many nights have you slept? But have you even been sleeping regularly?

You track down a Chee and ask how the investigation is going. They tell you that Erek and Jenny are still looking into it. You track down another Chee, and get a similar answer. Nobody seems to want to tell you directly how things are going, or how long they&#39;ll take, or even how long you&#39;ve been in the park. If you ask about your family, you&#39;re told that they&#39;re fine and given enough details on their lives that you&#39;re pretty sure the Chee aren&#39;t lying, but nothing else gets you a straight answer.

You can&#39;t help but wonder why the Chee don&#39;t seem to want you to know what&#39;s going on.

[[Trust the Chee-&gt;Chapter 46]]

[[Escape the dog park-&gt;Chapter 47]]</tw-passagedata><tw-passagedata pid="113" name="Chapter 38" tags="" position="100,300" size="100,100">“I&#39;m coming,” you insist. “This is my life; I want to know what&#39;s going on.”

The Chee try to talk you out of it, but you&#39;re adamant. Eventually, they reluctantly agree to let you accompany them.

“Here is the plan,” Erek explains later around his kitchen table. He puts one hand on the table and the surface lights up with a holographic map. A large chamber of some sort, surrounded by a network of crisscrossing tunnels and rooms. “This is the Yeerk pool complex. Ignore the main pool, we don&#39;t need that; what we need is the computer hub here.” A side room on the map lights up. “If we can hack these systems, we can pinpoint what you do and don&#39;t already know about the Yeerk empire, which might give us some clue.”

“I don&#39;t know anything about the Yeerk empire,” you point out. “How does any of this help?”

Erek hesitates. He gets a faraway look in his holographic eyes that you&#39;ve come to associate with communicating with the other Chee. “It would be very complicated to explain,” he says after a moment, “but we believe that the Yeerks know, and have logged, information that might help you.

“Now, getting you in is the difficult part. I can use my forcefield to mask your signature from the biofilters, providing they haven&#39;t been upgraded recently – and they might have, so this is risky – but once we&#39;re inside, we have to try to blend in and avoid being questioned. I&#39;ll take you straight to the computer hub, and you can keep lookout while I hack., We extract the information, then head right on back to go through it in the safety of the Chee park.” He fixes you with a stare. “It&#39;ll be dangerous. You sure you want to do this?”

[[Back out and wait in the dog park-&gt;Chapter 37]]

[[Go on the mission-&gt;Chapter 65]]</tw-passagedata><tw-passagedata pid="114" name="Chapter 39" tags="penultimate" position="4575,2425" size="100,100">You tell Erek the future. You hesitate a little before telling him the part where Jake takes a hostage and blackmails him into cooperation.

“Does it work?” Erek asks.

You suppose it does.

“How long does the war last?”

A couple more years, you think.

The two Chee exchange a glance. They seem to exchange something else, too, but if they&#39;re having a conversation, it&#39;s a silent one.

Erek stands up.

“Some of the others want to meet you,” he says. “This really should be a group discussion.” Leaving his disapproving father in the kitchen, he leads you down into the basement, which begins to drop like a giant elevator. After a while, it stops. Part of the wall vanishes to reveal a short tunnel, with light at the end of it.

Erek gives an &#39;after you&#39; gesture and follows you out into the underground Chee park. Soft green grass compresses under your feet and springs back as you move on. The sun shines bright and warm over large, healthy-looking trees. And under those trees, across the broad expanse of grass, bound dogs of all kinds and all ages. Two puppies immediately dash over to play tug-of-war with your shoelaces. An elderly Ddoberman pushes its head under Erek&#39;s hand.

Erek must have told the other Chee you were coming, because a dozen or so are already approaching. Some are still wearing holograms – here, a fussy-looking woman holds a chihuahua in her arms; there, a tired-looking Indian man pulls two toddlers in his wake. Most of them are showing their true forms, large, bipedal dogs of steel and ivory. They don&#39;t all look alike, you notice; some have different facial features than others, some are taller or shorter by a few inches, some have longer or thicker metal tails than others. A few of them are less than three feet tall. However the Chee were made, it wasn&#39;t via some kind of mass assembly process. Each has a decidedly individual look.

A mid-sized Chee with a long, slender tail walks up, hologram winking into existence around them. Suddenly, you&#39;re looking into the face of a brown-haired teenage girl.

“Hi,” she says, “welcome to the dog park. You should probably explain your situation again, we didn&#39;t get all of it.”

You explain again.

The Chee are mostly silent through your explanation, but their manner suggests a private, silent conversation going on in the background. When you&#39;re finished, they ask questions. Some about you (How old are you? How long have you lived locally?), some about them (Do you know how many of us there are? What do you know about the Pemalites?), some about other things entirely (Can you describe the Yeerk pool for us? What are the Animorphs&#39; names? Who is the President of America?) Some you can answer, some you can&#39;t. When they finally run out of questions, there is a long, deliberative silence. Then Erek speaks.

“Lorraine,” he says quietly, “do you understand the importance of the information you have? I am going to be straightforward with you; some of my friends think that you are a Yeerk spy. But if you were a spy, we would be dead, and so would the Animorphs. It is...rare, but not unheard of, for individuals to be blessed with the ability to see the future. They...will sometimes recontextualise their realities around this. This is what I, and many of my friends, believe you are.” He leans closer, capturing your gaze with his intense eyes. “We need your help. We want to protect this planet and with as few casualties as possible. The Animorphs are...brave, but...human.”

“She&#39;s a spy,” one of the other Chee calls. “She&#39;ll give you false information and send you right to the Yeerks.”

“You don&#39;t have to listen to her if you don&#39;t want to,” Erek snaps. He turns back to you. “Will you help us?”

[[Agree to help-&gt;Chapter 48]]

[[Refuse and go home-&gt;Chapter 49]]</tw-passagedata><tw-passagedata pid="115" name="Chapter 4" tags="" position="5825,600" size="100,100">You go home straight after English. The whole school seems to ooze danger, and you&#39;re not sure if your own instincts are telling you that or if it&#39;s just everything you&#39;ve read about the Animorphs. This whole thing started weird, but it&#39;s quickly getting weirder, and you have to figure out what to do about it before you step on someone&#39;s toes and get killed, or something.

Your house is empty; you let yourself in the back way and stand in the hallway for a moment. You&#39;re here. Now what?

[[Stay and search through your own house for clues about your condition-&gt;Chapter 8]]

[[Seek the help of those high-tech pacifist alien robots you&#39;ve heard so much about--&gt;Chapter 9]]

[[Check out the construction site where the Animorphs&#39; story all started-&gt;Chapter 10]]</tw-passagedata><tw-passagedata pid="116" name="Chapter 40" tags="" position="3650,2425" size="100,100">You shake your head. “It sounds dangerous to know one&#39;s own future,” you point out.

Mr King nods. Erek glares at him.

“Then I suppose we should focus on the details of your current condition,” Erek says. “Figure out exactly what&#39;s going on here. This world is a book, you say?”

You explain about the Animorphs series once again. The Chee nod a lot and exchange the occasional glance. They ask questions about your world. What&#39;s your real name? What year is it? What is the world like?

You&#39;re partway through explaining the modern internet when, suddenly, you have both Chee&#39;s full attention. Mr King disappears for a few minutes and returns with a notepad and a pencil. He asks you to spell &#39;google&#39;. A little while later, you&#39;re asked to sketch an iphone. The Chee look more worried and more confused the more you speak.

Suddenly, Erek stands up.

“Some of the others want to meet you,” he explains. “This really should be a group discussion.” He leads you down into the basement, which begins to drop like a giant elevator. After a while, it stops. Part of the wall vanishes to reveal a short tunnel, with light at the end of it.

Erek gives an &#39;after you&#39; gesture and follows you out into the underground Chee park. Soft green grass compresses under your feet and springs back as you move on. The sun shines bright and warm over large, healthy-looking trees. And under those trees, across the broad expanse of grass, bound dogs of all kinds and all ages. Two puppies immediately dash over to play tug-of-war with your shoelaces. An elderly doberman pushes its head under Erek&#39;s hand.

Erek must have told the other Chee you were coming, because a dozen or so are already approaching. Some are still wearing holograms – here, a fussy-looking woman holds a chihuahua in her arms; there, a tired-looking Indian man pulls two toddlers in his wake. Most of them are showing their true forms, large, bipedal dogs of steel and ivory. They don&#39;t all look alike, you notice; some have different facial features than others, some are taller or shorter by a few inches, some have longer or thicker metal tails than others. A few of them are less than three feet tall. However the Chee were made, it wasn&#39;t via some kind of mass assembly process. Each has a decidedly individual look.

A mid-sized Chee with a long, slender tail walks up, hologram winking into existence around them. Suddenly, you&#39;re looking into the face of a brown-haired teenage girl.

“Hi,” she says, “welcome to the dog park. You should probably explain your situation again, we didn&#39;t get all of it.”

You explain again.

The Chee are mostly silent through your explanation, but their manner suggests a private, silent conversation going on in the background. When you&#39;re finished, they ask questions. Some about you (How old are you? How long have you lived locally?), some about them (Do you know how many of us there are? What do you know about the Pemalites?), some about your &#39;real&#39; world (Who is the President of America? How does internet security protocol work? What is the latest Nintendo console called?) Some you can answer, some you can&#39;t. When they finally run out of questions, there are a few moments of deliberative silence. Then Erek speaks.

“This is an...unusual array of information that you possess,” he notes. “I can&#39;t think of where you&#39;d find a single source for all this information; at least, not one that we wouldn&#39;t already know about. This is something that we need to investigate.”

“We have contacts in most of the relevant areas,” the Indian man added. “If you wait down here for a while, we can find out what&#39;s going on and then come up with a plan together. Everyone know their post?”

The Chee all nod or flick their tails and begin to disperse.

[[Wait for the Chee to do their jobs and report back-&gt;Chapter 37]]

[[Insist on investigating with them-&gt;Chapter 38]]</tw-passagedata><tw-passagedata pid="117" name="Chapter 41" tags="" position="2650,2450" size="100,100">You agree to help.

Around you, everyone relaxes very slightly. Jake nods. “Right,” he says. “We need to extract him, confine him, and then safely evacuate him from the city.”

&amp;lt;All without him identifying us,&gt; Tobias adds, &amp;lt;unless we want to commit to killing him if he might be recaptured.&gt;

“And we don&#39;t,” Cassie clarifies.

“There&#39;s a cabin in the woods we can confine him in,” Marco says. “The one we used last time. It should be much easier without morphing.” He glances at Jake. Jake&#39;s expression is tight, but he stays silent. “Tobias and Ax will be our main guards, since they don&#39;t have home commitments and don&#39;t have the same risk of exposure as the rest of us.”

“We have an exit channel,” Rachel adds. “Cassie and I are handling that.”

&amp;lt;Do you need help?&gt; Tobias asks. &amp;lt;A scout?&gt;

Rachel shakes her head.

“So the difficult thing is the grab itself,” Jake finishes, “and keeping the Yeerks away for three days.”

“Don&#39;t forget to search him for a tracker,” Cassie warns. “Aftran had one. I don&#39;t know if they&#39;re standard issue or not.”

“I don&#39;t see why they would be,” Marco shrugs. “Karen knew she might get lost in the forest, but if we grab him from the city...”

“Still, better to be safe.”

“Oh, definitely.”

“They may use Taxxon trackers,” Ax adds, “track-errrz-zuh. If they suspect an abduction. He is a sum-what-tuh prominent Controller. The easiest thing to do would be to hide the abduction altogether, if we have the opportunity. Hopefully it will be too late to find him by the time anybody realises...ree-li-suss...they have not seen him for too long.”

Jake nods. “And the Yeerk will do and say anything it can to turn you on each other. Most of you will be hiding your identities and won&#39;t have a problem, but it still might get something. Remember; it will assume you&#39;re Andalites, so if you let it get under your skin it might notice that you&#39;re not reacting like Andalites.” He glances at Ax. “And it&#39;ll probably know how to get to you.”

Ax narrows his eyes. “I am no impulsive child, Prince Jake. Andalites are trained not to fall for childish psychological tricks.”

“Noted, Ax,” Jake says, expertly hiding a smile.

“We should try to get him alone to make the grab,” Marco says. “Where&#39;s he likely to be alone?”

Jake shakes his head. “I don&#39;t know any more. These days he doesn&#39;t seem to do anything except Sharing stuff, and whatever he has to do to maintain is cover. He&#39;s always with Yeerks, with the family, or heading over to see Yeerks. Grabbing him in any of those places is a bad idea.”

“What about grabbing him when he&#39;s just left a Sharing event?” Cassie asks. “It gives us the maximum amount of time before the Yeerks would notice him missing. If we can figure out his feeding schedule, we might even be able to grab him on the last day and only need to hold him a few hours.”

“We can mess up the meeting after he leaves, too, and cause a distraction,” Rachel adds. “Give them something else to worry about while we have someone make off with him.”

Jake nods. “We find out his next event and get him to leave early somehow. Rachel and Ax go in there and mess things up while – ”

“And you,” Marco says firmly.

Jake shakes his head. “I&#39;m better for the grab.”

“No,” Cassie says, “you&#39;re not.”

“Cassie, he&#39;s my brother.”

“Exactly,” Marco says. “What if he recognises you? Something you do, something you say, the way you react to something?”

“I&#39;ve been keeping this up for a year and a half; I can – ”

“You&#39;ve been hiding being an &#39;Andalite Bandit&#39; for a year and a half,” Marco says. “But are you so sure you can hide being Jake?”

“For him? Yes. Neither of you get it. You don&#39;t have siblings. You don&#39;t understand – ”

“I don&#39;t understand?” Marco snaps, voice rising. “I had to face my mother and pretend to be an alien slave. Don&#39;t tell me I don&#39;t understand. The difference here is, Tom&#39;s Yeerk knows his host&#39;s brother isn&#39;t a Controller. So if you give any hint of who you are, and we can&#39;t safely pull this off, and it looks like he might end up back with the Yeerks...”

“They&#39;ll need you on the distraction anyway, Jake,” Cassie adds quietly. “Decisions in the heat of combat is what you&#39;re really good at, and we want things to stay under control in there. Tobias is our best scout; we&#39;ll put him on the extraction. He can also be our voice if anyone needs to talk to Tom&#39;s Yeerk, since there&#39;s not the risk of being identified like there is with the rest of us, and Ax needs to be in the distraction to be visibly Andalite. Put Marco on the extraction as well; his initiative is good if things go wrong.”

“What about you?” Rachel asks Cassie.

“Extraction team,” Marco and Jake say together. They exchange a glance. A slight nod.

&amp;lt;But how do we actually get him?&gt; Tobias asks. &amp;lt;We can&#39;t grab him in the city and drag him off or anything. He&#39;ll fight us. And he can&#39;t morph; we can&#39;t disable him without permanently hurting him.&gt;

“We can drug him,” Cassie says, “if we can get him somewhere that carrying him out won&#39;t be suspicious. Maybe if someone, I don&#39;t know, pretends to be a Controller and leads him off somewhere?”

&amp;lt;How are we supposed to do that? If I talk to him, he&#39;ll shoot the &#39;Andalite&#39; first and ask questions never, and he&#39;ll recognise any of you. I mean, you could probably bluff being a Controller, but if he escaped...&gt;

“I could do the half-morphing Rachel thing,” Cassie says slowly. “He won&#39;t recognise me then. But that morph is pretty useful;, I&#39;d rather not use it unless we have to. And it still looks an awful lot like me or Rachel. It&#39;d be better not to risk a morph like that...”

Slowly, everyone in the room turns to look at you.

[[Agree to play a Controller and lure Tom-&gt;Chapter 83]]

[[Refuse-&gt;Chapter 84]]</tw-passagedata><tw-passagedata pid="118" name="Chapter 43" tags="penultimate" position="4500,2575" size="100,100">For a mission likely to involve quick thinking and computer hacking, Ax and Marco are the obvious choice. Neither protest the assignment.

&amp;lt;This hospital is a Yeerk facility,&gt; Ax says, &amp;lt;and it is therefore likely that they are set up using Yeerk protocols all the way through, for simplicity of expansion. There will be a central databank in the facility. Unless your patient files are top secret for some reason, I should be able to find them there.&gt;

“Central databank,” Marco echoes. “No problem. Should we do the initial run without Morphless here or…?”

&amp;lt;We may need data from her. If more subtle infiltration is necessary, we can separate later on.&gt;

And like that, it&#39;s settled. You, Marco, and an awkwardly-moving Ax in human morph make your way to the hospital. You walk in as if you mean it, as if you know where you&#39;re going.

“Okay,” Marco mutters, “how do we find this information bank? Ax?”

But you&#39;re already moving. With every step, more of the hospital fits into your memory. You&#39;ve walked this way before. You&#39;ve walked that way before.

After some pacing about, you realise that there are three paths throughout the hospital that are very familiar to you. You can&#39;t seem to remember where any of them actually lead. One path is to your left, heading off towards the doctors&#39; offices. One is straight ahead, into the center of the hospital, The other is off to your right.

[[Go left-&gt;Chapter 134]]

[[Go down the middle-&gt;Chapter 135]]

[[Go right-&gt;Chapter 136]]</tw-passagedata><tw-passagedata pid="119" name="Chapter 44" tags="" position="2700,3075" size="100,100">For a mission likely to involve social infiltration and where some serious firepower would be neat if things go wrong, Rachel and Cassie are obvious choices. They ask you the name of your doctor, Rachel morphs into a shrew and slips into halfRachelmorphed Cassie&#39;s sleeve in the bathroom, and you&#39;re on task. After a casual stroll past your doctor&#39;s office to drop Rachel off, you and Cassie head to the hospital cafe and buy some cake.

You make casual conversation that just happens to include a fair number of questions about you and brief pauses so that Cassie can relay the information to Rachel via thought-speak. When were you in hospital? Do you remember what the name of your condition was? When were you released? After about twenty minutes of this, you go for another walk to pick up a shrew, make another bathroom stop for demorphing, and stroll out.

“Your doctor has a lot of documentation on you,” Rachel tells you as you head for the bus stop. “Way more than anyone else, just sitting in his drawer. Brain scans and conditions with complicated names and stuff. Even Cassie didn&#39;t know what a lot of it meant.”

Cassie rolls her eyes. “&#39;Even Cassie&#39; doesn&#39;t mean much,” she says. “Just because I know about animals doesn&#39;t mean I know complicated medical terms for brain injuries.”

“You have brain damage. We know that much. Anything further...” Rachel shrugs. “Sorry. Although I gotta say, that was really weird.”

“Weird how?”

“That doctor just has so much documentation on Lorraine. And none of it was in the actual drawers of his desk; he has a false shelf under the bottom drawer. I never would&#39;ve noticed it as a human. I think you have a stalker, Lorraine.”

“It might just be a… difficult case,” Cassie says, sounding a bit worried. The bus arrives.

“Whatever it is, our chances of solving it before this Tom window closes are zero. I think we have to put it on hold and press ahead with that. [[Come on, the others will be waiting for us.-&gt;Chapter 63]]&quot;</tw-passagedata><tw-passagedata pid="120" name="Chapter 45" tags="Reboot-Ending" position="4300,1100" size="100,100">(set: $c45ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

“Let me go!” you shout, pulling on the man&#39;s arm. But he doesn&#39;t.

“Mana, what&#39;s gotten into you?! You can&#39;t be here! We have to get y – ”

He wasn&#39;t expecting the punch to the solar plexus. He lets go and keels over, and you run. You&#39;re very close to the party still, close enough that your cries were heard; by the time you make it to the door, a burly man in a policeman&#39;s uniform is already filling it.

“Ma&#39;am?” he asks.

“That man grabbed me,” you gasp.

The policeman looks over your shoulder. “Kiri?”

The man, winded, simply waves an arm in response. He does have the presence of mind to slam the locker shut as the doorway starts to fill with onlookers.

The policeman notices that, too. He looks at you. You can almost see the wheels turning behind his eyes.

You saw the path behind the locker. That&#39;s a problem. He can&#39;t get you away with so many witnesses. That&#39;s another problem.

You don&#39;t see the weapon that makes all your muscles seize up and stops you from being able to draw breath. You just hear the policeman&#39;s voice as he drops you to the ground, edged with worry and well-faked panic. “Somebody call an ambulance!” Unable to move your eyes, all you can do is look into the other man&#39;s familiar brown eyes, the ones that fit into your memory without explanation, as they fill with pain and grief.

//Hmm, it appears that panic has its downsides. Some interesting choices. But we need more data. I suppose we should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="121" name="Chapter 46" tags="Reboot-Ending" position="4400,1100" size="100,100">(set: $c46ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You dismiss your concerns and go back to your cabin. More days pass; at least, you think they do. The Chee bring you books when you start to get bored, clothes when you need them, and whatever sports equipment and board games you ask for. You begin to get quite a collection of gaming consoles and they, as well as the changes in your own body and the occasional birth or death of dogs, are the only real way you have to track time. There&#39;s usually somebody around to play games with; you meet a Chee playing a teenage boy called Evan who is incredibly good at chess, and through practice and instruction, you&#39;re well on your own way to grand master level. You don&#39;t know how long it&#39;s been since you&#39;ve asked about the mission. You&#39;re not sure you can even remember what it was. Besides, it doesn&#39;t seem all that important; Evan brought you the cutest puppy the other day who needs to be hand-raised, and you want to finish your latest book on chess strategy before he comes over again so you can kick his butt. Who has time for aliens and cosmic mysteries?

//Interesting choice. They seem easy to manipulate, so why make this place the battleground? All it took was some diversion and material comforts to draw this one out of the fight. I suppose that if we want to learn more, we must [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="122" name="Chapter 47" tags="Reboot-Ending" position="4500,1100" size="100,100">(set: $c47ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

This isn&#39;t right. The Chee aren&#39;t telling you anything, and you don&#39;t even know if they&#39;re trying to help. You have no idea how long you&#39;ve been in their giant underground kennel, but as time passes and their answers to your questions don&#39;t get any more specific, it&#39;s harder and harder to ignore the obvious possibility: they have no intention of resolving this and letting you go home.

Planning your escape isn&#39;t hard. The Chee bring you most things that you ask for without question and give you as much privacy as you want. You get some new kitchen knives and twine and spend some time putting your weapon together. It&#39;s not anything that could hurt a millennia-old alien robot, of course, but it doesn&#39;t need to be. The Chee have a few glaring weaknesses in that regard.

You&#39;ve begun to make friends with a Chee playing a young man called Evan. He&#39;s promised to help you become better at chess. You wait for him to come around next, wait for him to set up the board...and then strike.

He doesn&#39;t react as you sweep up behind him and grab his hands. Even if he thinks you&#39;re being aggressive, what&#39;s a human going to do to a Chee? Of course, that&#39;s before he sees the knives. By the time he sees them, it&#39;s too late. You&#39;ve bound both of your arms to his in a tangled mess of blades and twine that is guaranteed to lacerate your arms very seriously if either of you pulls away from the other.

“Lorraine, what...?”

You don&#39;t let him finish the question. You ask about how the investigation is going, about what&#39;s going on aboveground. He answers your questions about the war and the state of the world in general, but he claims he doesn&#39;t know about how the investigation is going, even when you threaten to cut yourself.

You lead him to the spot where you entered the park. To prevent injury to you, he has no choice but to follow.

“Open the door,” you demand.

“He can&#39;t.” Erek steps into view. “It&#39;s not his exit.”

“Then you open it.”

“No.” Erek glances at your knifebound wrists and shakes his head. “If we were that easy to manipulate, do you really think we would have survived this long on a planet full of humans? There are billions of you, and you&#39;re not the first to discover our secret. Do you think nobody has tried this ploy before?” He shakes his head again. “We cannot let the Yeerks get a hold of you, do you understand? Your existence puts both the humans and the Chee in great danger. Now let us untie you, please. You could hurt yourself with those knives, even kill yourself.”

“It&#39;ll be your fault.”

“You&#39;re asking me to weigh one life against billions. Including your family, and mine. If you&#39;re relying on my programming to force my hand, it won&#39;t work. You&#39;re only putting yourself at risk.”

You meet his eyes. He might be bluffing. Maybe moving to cut yourself will force his hand. Maybe it won&#39;t. He was forced in the books by a hostage, wasn&#39;t he? It was an important part of the war. But... But he also has a point about living on Earth, among humans, for so long. They couldn&#39;t have made it so far if they were compelled to unconditionally protect every human life, could they? What are you supposed to believe? That they made it so far with such a weakness, or that there was some other factor in the final battle in the books forcing Erek&#39;s hand?

Either way, there is no way to delay and decide. If you allow them to untie you, they&#39;ll not let you take them by surprise again. And if you call their bluff... Well, it&#39;s either a bluff or it isn&#39;t. You have to make your decision.

You make it.

//Hmm, interesting choice. They certainly have unusual behaviour under pressure, but I think we need more data. Perhaps we should [[try again-&gt;Chapter 1]].//

</tw-passagedata><tw-passagedata pid="123" name="Chapter 48" tags="Reboot-Ending" position="4600,1100" size="100,100">(set: $c48ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

What else can you do? You agree to help.

Erek takes you to a forest on the edge of the giant park. A little way into the forest is a cabin, where he leaves you. The next day, a Chee brings along some clothing, books and food.

The sun never sets in the Chee dog park. There are occasional showers of light rain, during which the dogs all rush about and get as wet as possible. Sometimes, a Chee will stop by and ask you questions about the future or see how you are doing. You&#39;re brought almost anything you ask for, including news of your family and of the war, and all sorts of games and game consoles as soon as they come out. You make friends with a Chee playing a boy named Evan. He likes chess, and agrees to teach you.

Sometimes, the Chee bring you orphan puppies and ask if you&#39;d be willing to raise them. You start to count time in puppies; there&#39;s no other metric available to use. The war slowly moves away from the story you know and your advice has less and less value. Chee come seeking it less and less often, but they still come by just to talk. You think that perhaps they like having a human they can talk to openly and share their secrets with without fear.

After all, down under the earth among the dogs, who are you going to tell?

//They trusted the androids, then? Why? For their pacifism, perhaps? An unexpectedly indirect route. We must learn more. I suppose we should [[try again-&gt;Chapter 1]].//

</tw-passagedata><tw-passagedata pid="124" name="Chapter 49" tags="Reboot-Ending" position="4700,1100" size="100,100">(set: $c49ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

“I can&#39;t,” you tell them. “I need to go home.”

The Chee around you exchange looks. Sad looks.

“Lorraine,” Erek says gently, “do you understand just what would happen if Yeerks were to get their hands on you right now? They&#39;re a big force. You can&#39;t protect yourself. Nobody can protect you... Not up there, anyway.” He glances around the park. “The only safe place is hidden. Here.”

You turn and run away from him, dashing past several other Chee. None of them make a move to stop you. You run back to the King&#39;s basement... Only to find that it isn&#39;t there any more. Instead, you stand on a broad expanse of soft grass. A woolly dog as high as your waist wuffs gently at you, tail wagging.

“Don&#39;t worry,” a wide-eyed ten year old girl says... No, an ancient alien android hiding behind the form of a ten year old girl. “You&#39;re safe here. We&#39;ll look after you.”

You tell her that you don&#39;t want to be &#39;looked after&#39;, and look around for another exit. But there&#39;s nothing but the park, the forest around the edge, and dogs.

Further exploration finds a large, clear lake full of fish, and a broad clearing within the forest full of colourful mushrooms and with a little burbling stream like something out of a fairy tale. You ascend a small hill and find a wooden cottage. It&#39;s comfortable enough, with hot water and electricity. Some Chee bring you clothing and food a little later, acting very apologetic about the whole thing, but nothing you can say or do convinces them to let you out. You&#39;re brought most things you ask for – games, consoles, books – but nothing that lets you communicate with the outside world. It&#39;s not so bad, though.

There&#39;s always the dogs.

//I do not think we will learn much more from this train. Perhaps we need to [[try again-&gt;Chapter 1]].//

</tw-passagedata><tw-passagedata pid="125" name="Chapter 5" tags="" position="6275,500" size="100,100">There is but one avenue for the truly confused; the school counsellor. Your school has an extremely good counselling program, the best in the state. They have awards for it. You might as well take advantage.

You talk to the receptionist, who promises that somebody will be with you shortly and sits you in a little waiting room full of old magazines about home decorating and what the hottest teen hairstyle was two years ago. You are barely there five minutes before a smiling lady calls you into her office and introduces herself as Annie.

“How can I help you today?” Annie asks.

[[Explain that you don&#39;t remember who you are-&gt;Chapter 11]]

[[Explain that you&#39;re trapped in a children&#39;s book series from two decades ago-&gt;Chapter 12]]

[[Realise how stupid this is and seek the Animorphs&#39; help instead-&gt;Chapter 13]]</tw-passagedata><tw-passagedata pid="126" name="Chapter 50" tags="" position="1575,1925" size="100,100">“I&#39;m Lorraine,” you say as Lizard helps you up.

“We know. Can you walk?”

You take a step. You can walk.

Lizard leads you to the door while Eagle steps forward, Dracon beam in hand.

“What&#39;s she – ?” you start to ask.

“Cleaning up. Come on.”

While Eagle uses the weapon to burn away every smudge of blood or human tissue in the room, Lizard takes your wrist and leads you out of the metal room. Together, you step out of the back of a large truck and into a garage. Lizard ignores the large door in the side of the shed and instead heads to a wall covered in shelving.

“How good are you at climbing?” she asks.

You admit that you don&#39;t know.

She scampers up the shelves almost as easily as if she were walking on flat ground, hooks her legs around a ceiling beam and hangs upside down, offering her hand to help you. You take it, letting her half-pull you up the shelving as you climb. By the time you make it to the top, Eagle has stepped out of the truck and is scampering up beside you. Lizard steadies you while Eagle opens a panel in the ceiling of the shed.

“Do you have crawl spaces everywhere?” you hiss.

“Not in nearly enough places,” Eagle says grimly. “As many Yeerk places as we can, but there are so many... Come on, step up in here...”

Soon, you&#39;re crawling through the roof, then coming out on the other side of the building. Lizard lowers a rope off the side for you and Eagle to scale down with, then unties it and scampers down herself. The three of you scale a few fences and cross a few backyards, then the two Star Defenders tell you to wait at the base of a large tree. They climb up and, a few minutes later, descend in normal clothes. Unmasked, you recognise both of them by sight. They go to your school. You know their names – Amanda and Kelly – but not much more.

You&#39;re in a backyard. Kelly pulls a key out of her pocket and unlocks the back door of the house, then waves the two of you in.

“Kelly&#39;s father and sister are Controllers,” Amanda mutters into your ear as you enter. “They shouldn&#39;t be here right now, but be careful.”

“Bedroom?” Kelly asks. “I&#39;ll grab some Cokes.”

Amanda leads you up to a perfectly ordinary-looking teenage girl&#39;s bedroom. You&#39;re pretty sure that the Jeremy Jason poster on Kelly&#39;s wall is the same as the one on yours.

“That was dangerous, getting caught like that,” she points out. “I don&#39;t know how you resisted infestation, but they would&#39;ve killed you if they couldn&#39;t get a Yeerk in you. I hope you realise that.”

You resist the urge to point out that you hadn&#39;t gotten caught on purpose.

“Look, I&#39;m gonna be straightforward here; I still think this might be a setup. I don&#39;t like showing our faces like this. But Eag... Kelly thinks otherwise. She calls this an opportunity. Me? I call it a risk.”

The bedroom door opens. Kelly walks in, three cokes in her arms. She hands one to each of you. Behind her, carrying a coke of her own, is Melissa Chapman.

“Ah,” Amanda says, “you called her from the van.”

“Of course I called her from the van. This was kind of urgent.”

“You used the Controller&#39;s communicator, didn&#39;t you? Don&#39;t you think that was kind of dangerous?”

“If it&#39;s urg – ”

“Not that urgent! It&#39;d keep for a couple of hours! Are you trying to get us all killed?!”

“If somebody would please tell me what&#39;s going on,” Melissa interjects, eyes on you.

“This is Lorraine,” Kelly says. “We picked her up as the Yeerks were trying to infest her and cleaned the site. Don&#39;t know how much she knows; hasn&#39;t asked many questions, but that might be shock.”

“And she&#39;s seen us now,” Melissa notes.

“Doesn&#39;t matter. Seems she&#39;s immune to infestation.”

That gets Melissa&#39;s attention. She frowns at you. “Immune? How?”

“I&#39;m sort of wondering that myself,” Amanda says.

You explain that you have no idea where your immunity comes from.

“But you&#39;re certain?” Melissa asks.

Kelly describes how the Yeerks tried and failed to infest you. While she speaks, Melissa inspects your ears with some kind of medical implement.

“It pierced the membrane,” she says thoughtfully. “Definitely a wound there. But it couldn&#39;t attach to the brain, you say? That&#39;s...interesting.” She meets your eyes again. “Do you have any known genetic or medical conditions? You were in a coma a couple of weeks ago, weren&#39;t you? Maybe something happened then.”

“How are we supposed to find out?” Amanda asks. “We could check the hospital records...”

“Aren&#39;t we kind of forgetting our current mission?” Kelly asks. “Our very time-sensitive mission?”

“She&#39;s immune to infestation,” Amanda points out. “You wanted to bring her here. Finding out how she&#39;s even possible is the most important thing we can do.”

“It&#39;s also something that can wait,” Kelly says, raising an eyebrow. “I brought her here because having someone immune to infestation could be really useful on our current mission. And that can&#39;t wait.”

[[Hear about their current mission-&gt;Chapter 85]]

[[Find the source of your immunity-&gt;Chapter 86]]</tw-passagedata><tw-passagedata pid="127" name="Chapter 51" tags="penultimate" position="3825,1225" size="100,100">You don&#39;t want to get mixed up in all this. Once you&#39;re free, you bolt.

Lizard makes a grab for your arm as you pass her, but neither of the girls pursue you. You dash out of the room, almost fall over as you very suddenly learn that you were in a truck and it&#39;s quite a distance to the ground, and find yourself in a shed.

There&#39;s a door, and underneath it you see sunlight. You dash for it. Flinging the door open, you see a half-asleep kid at a bus stop on the other side of the road suddenly leap to his feet.

“Stop!” he shouts. He sprints toward you. You run in the opposite direction. There, an alley! You take it.

You&#39;re not exactly sure where you are. You think you&#39;re pretty close to the hospital. Full of Yeerks, not a good direction. Is there anywhere that isn&#39;t full of Yeerks?

The alley narrows, and somebody stepping out of a door in the building to your left runs straight into you. You slam into the wall, then quickly right yourself. You glare at the man who ran into you, only to realise he&#39;s somehow very familiar. His eyes widen.

“Mana?” he asks. What are you doing here? Are you okay? What&#39;s – ”

“You can&#39;t run!” the teenager shouts from the road, almost to the mouth of the alley. The man grabs your arm.

“Come on!” he hisses, pulling you towards the doorway he&#39;d just come out of. “I&#39;ll hide you!”

[[Run away-&gt;Chapter 87]]

[[Go with him-&gt;Chapter 126]]</tw-passagedata><tw-passagedata pid="128" name="Chapter 52" tags="penultimate" position="4150,2600" size="100,100">The school is buzzing with Controllers. You put on your best Controller impression and stride confidently in, Marco a cockroach in your sleeve. Some areas of the school are under fairly tight security; you avoid those ones. You don&#39;t want them. You want the principal&#39;s office.

It&#39;s unlocked. You suppose that with so many Controllers moving about, nobody expected a break-in to be an issue. You put Marco down behind the desk and, as he begins to demorph, open a random filing cabinet.

You&#39;re about three minutes into your search when the door opens. “The Visser wants – ” the speaker freezes in the doorway. You glance at Marco; he&#39;s half-demorphed, out of sight from the door. The young woman standing there with her mouth open isn&#39;t looking at Marco. She&#39;s staring at you. She blinks and shakes her head.

“Sorry, for a second I thought you were… somebody else. Who are you, exactly?”

[[Give her a random Yeerk name-&gt;Chapter 138]]

[[Subdue her before she can raise an alarm-&gt;Chapter 139]]</tw-passagedata><tw-passagedata pid="129" name="Chapter 53" tags="" position="1800,1100" size="100,100">(set: $marco to true)\

Marco notices you staring at him and frowns. “If you&#39;re looking for help on how to deal with them, I&#39;m not the right guy to talk to,” he says. “I do the jokes. Jake does the leading and Cassie does the heart stuff. Talk to them.” Your disbelief must be evident on your face, because after a moment he sighs. “It&#39;ll be fine. We&#39;ll all go home and sulk for a day or so. Rachel will break something and talk to Tobias and she might do something reckless, but he&#39;ll make sure it isn&#39;t something too reckless. Jake will be all stoic and Cassie will crack him open and they&#39;ll pretend not to be in love for a bit, then he&#39;ll come play computer games with me to pretend everything&#39;s fine and she&#39;ll show up at somebody&#39;s door at a weird time to ask existential questions and have a lot of feelings, and Tobias and Ax will talk to each other and next week we&#39;ll all be back in this barn planning missions, good as new.” He thinks about that. “Well, not good as new. I don&#39;t see us ever forgetting this, but we can put our efforts into avoiding it. This isn&#39;t our first rodeo, you know. This isn&#39;t even our first time-rodeo. This one time we went to a possible future where we were all Controllers. We ran into future-Rachel and Visser Three and they told us how they cooked Tobias on a fire and ate him. So this isn&#39;t the worst future we&#39;ve dealt with. If anything, it&#39;s a road map to victory.” There&#39;s a fire in his eyes. His hands are balled into fists. You can&#39;t help noticing that he didn&#39;t mention his mother.

“Of course,” he says, “we were discussing a kind of important mission before you showed up, and somehow I don&#39;t think we&#39;re gonna get much more work done on that front today. So, y&#39;know, thanks for that.”

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="130" name="Chapter 54" tags="" position="2050,725" size="100,100">(set: $rachel to true)\

You catch Rachel in a small storage shed, removing her outer clothes in preparation for a morph. She glares as you approach.

“Huh,” she says. “It&#39;s you. What do you want now?” She&#39;s not in the mood for apologies or conciliation as she tugs viciously at a stuck zipper on her jeans. There&#39;s a snap, and the end of the zipper comes off in her hand. With a growl of frustration, she pitches it to the floor.

“Stupid cheap jeans,” she grumbles. “Ever since this war it&#39;s like I can&#39;t keep an article of clothing for a month before it breaks. If it&#39;s not dragged through the mud a damn house falls in on it or it comes apart in my hands.” She appears to be talking to the wall, completely ignoring you. The tremble in her voice that promised tears a moment ago has become a tremble of rage.

“Rachel,” you say.

“What?” she snaps, spinning to face you. “Who the hell do you think you are? You&#39;re just some girl at our school, and now you think you know me? That you know any of us? Why, you think that knowing the facts of someone&#39;s life or their fate is the same as knowing them? Give me your hand. No, don&#39;t you back away from me; give me your goddamned hand.” She grabs your wrist in a grip tighter than any you&#39;ve ever felt and pulled you close.

“I&#39;ve had blades cut across my neck,” she growls, grazing her fingernails down one side of your throat. “I&#39;ve gone out there knowing I was going to die and just wanting it to hurry up because it would be so much easier to be dead than to be so damn terrified for just one minute longer. I&#39;ve killed slaves to get at slavers with my own teeth, my own paws, my own weight. I&#39;ve ridden the fury because the fury is all you have; you live or you die and you have to fight with it or acknowledge the helplessness of the whole thing and just die from the terror alone. Have you been there, huh? Have you thrown your body at an enemy that wants to kill it to protect your family, your comrades, your own sense that there can be anything but fear and helplessness? Because every one of us has, and if you haven&#39;t then you don&#39;t know us. You don&#39;t know me, you don&#39;t know what&#39;ll happen, and you can read my name off a damn grave and that&#39;ll still tell you nothing about what actually happened. If you think you have anything useful to say to me right now, you don&#39;t.” She lets you go and takes her nails away from your throat. It doesn&#39;t seem like you&#39;ll be getting much more out of her.

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="131" name="Chapter 55" tags="" position="1625,1475" size="100,100">(set: $jake to true)\

You find Jake unchaining his bike from out the front of Cassie&#39;s house. He shoots you a suspicious frown as you approach.

“I don&#39;t suppose your future powers predicted this?” he asks. “That ellimist had to have sent you. This sort of stuff always happens when it&#39;s involved.” He looks back down at the bike lock that he inexplicably thought was necessary to use at his friend&#39;s house out on an isolated farm. He doesn&#39;t seem inclined to talk, but after some prompting from you based on what you&#39;ve read about his personality, he sighs.

“I don&#39;t know what scares me more,” he admits, “the possibility that you&#39;re lying, or that you&#39;re telling the truth. We&#39;re saving Tom and getting everyone out alive; that&#39;s the plan, that&#39;s always been the plan. Now you&#39;re telling me I&#39;m the sort of person who&#39;d throw that away? No, that can&#39;t be true. That&#39;s not the sort of person who you want leading the Animorphs. But the other option, see, the other option is being the sort of person who&#39;d let the whole world go to hell, let my friends and family and everyone else on this planet live as slaves forever, to keep two people alive. And that&#39;s not the sort of person you want protecting the Earth. There&#39;s no answer here that doesn&#39;t suck.” He gets the chain unlocked and starts to roll it up. After a bit more prompting, he says, “I should&#39;ve gone myself, you know. If I don&#39;t go myself it means I know I can&#39;t do it. I can&#39;t kill him, not even for the world, so I sacrifice her life doing it. That&#39;s worse. Even if Marco&#39;s right and we can do it right this time, how are any of them supposed to trust me knowing I&#39;d make that choice?”

He seems to realise he&#39;s said too much, clenching his teeth and looking away.

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="132" name="Chapter 56" tags="" position="3000,1050" size="100,100">(set: $cassie to true)\

Cassie is standing at the edge of an empty paddock, looking wistfully out over the grass. She gives you a halfhearted smile as you approach.

“Don&#39;t worry,” she says, “we&#39;ll figure this out. I know it makes me a hypocrite to say this after all my usual stuff about how this war is worth our lives, but we&#39;ll find a way to save her. I&#39;ll do the mission instead if it comes to that. She&#39;s worth more to this world than I am.” Her hands are clenched into tight fists.

“Anyway,” she adds, “we have a more immediate mystery on our hands, with you. We need to figure out just how you know what you know. If it&#39;s not an ellimist thing... Well, I don&#39;t know. I never believed in psychic powers and stuff but with the Andalites and the Leerans proving it&#39;s physically possible, and now you... I&#39;m going to do some research. I hope you&#39;d consent to some tests, once we&#39;ve put them together? It&#39;ll have to wait for a while. We&#39;re on a bit of a timeline with our current mission.”

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="133" name="Chapter 57" tags="" position="1800,1700" size="100,100">(set: $tobias to true)\

It takes time to find Tobias&#39; meadow, but you realise that you can follow your feet. Every right step fits into your memory as you take it. But... You shouldn&#39;t know this path, should you? You&#39;re pretty sure that you, that is Lorraine, never had any reason to make this journey before.

There&#39;s a hawk in one of the trees on the edge of the meadow. He seems inclined to ignore you at first, but then swoops down to a lower branch to meet you face-to-face.

&amp;lt;Tell me about my mother,&gt; he says.

“But Rach – ”

&amp;lt;We&#39;ll save Rachel. That&#39;s easy. Jake just has to not send her to her death, and none of us are going to let him. But you said we find my mother.&gt;

You tell him about Loren. You tell him everything you know. By the time it occurs to you that Tobias might not take the whole &#39;son of Elfangor&#39; thing and &#39;your mother is alive and lives nearby&#39; things in stride together, it&#39;s already out of your mouth. Tobias listens in silence, his penetrating gaze not wavering from your face. He waits until you are completely done.

&amp;lt;Thank you,&gt; he says. Then he takes to the sky and is soon out of your sight.

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="134" name="Chapter 58" tags="" position="2100,1400" size="100,100">(set: $axman to true)\

It takes time to find Ax&#39;s meadow, but you realise that you can follow your feet. Every right step fits into your memory as you take it. But... You shouldn&#39;t know this path, should you? You&#39;re pretty sure you, that is Lorraine, never had any reason to make this journey before.

Ax isn&#39;t surprised to see you. He is already watching you with one stalk eye as you step out from the trees. His main eyes are on something electronic he&#39;s building.

&amp;lt;What do you want from me, eliheir?&gt; he asks as you approach.

You try to repeat the word and fail. He looks irritated.

&amp;lt;You are an ellimist&#39;s oracle, are you not? Come to meddle in the lives of myself and my friends. I remember Rachel-Naomi-Berenson speaking of you. She says that you nearly died in an accident not long ago. Did he come to you then, give you his words in exchange for your life? One cannot expect a human like yourself to understand the danger of such a deal.&gt;

You don&#39;t have an answer for him. You don&#39;t remember ever speaking to the ellimist, but then, you don&#39;t remember anything about your life before that morning until you see it. Is the other life in your mind, the one from a couple of decades in the future that read of the Animorphs, something that the ellimist constructed? If you saw the ellimist, would he fit as neatly into your memory as your mother did?

You change the subject. You ask Ax what he&#39;s building.

&amp;lt;I am repairing one of my barrier sensors,&gt; he answers. &amp;lt;They are designed to detect the motion of Taxxons, in case the Yeerks turn their trackers to trying to locate me. When they used them on escaped Hork-Bajir, I expected them to be turned against us more easily; we are much more of a threat than a couple of runaway Hork-Bajir. We are fortunate that their leaders do not seem particularly intelligent and have not tried. But it is best to be prepared. These will give me advance warning when they try.&gt; He keeps a stalk eye on you as he works. &amp;lt;Be careful what you say to whom, little eleheir. The humans say that knowledge is power, but they never specify whose power.&gt;

{[[Get help from the Chee instead&lt;br&gt;-&gt;Chapter 9]]

(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;br&gt;Talk with the Animorphs: &lt;ul&gt;]
(if: $marco is not true)[[&lt;li&gt;Find Marco&lt;/li&gt;-&gt;Chapter 53]]
(if: $rachel is not true)[[&lt;li&gt;Find Rachel&lt;/li&gt;-&gt;Chapter 54]]
(if: $jake is not true)[[&lt;li&gt;Find Jake&lt;/li&gt;-&gt;Chapter 55]]
(if: $cassie is not true)[[&lt;li&gt;Find Cassie&lt;/li&gt;-&gt;Chapter 56]]
(if: $tobias is not true)[[&lt;li&gt;Find Tobias&lt;/li&gt;-&gt;Chapter 57]]
(if: $axman is not true)[[&lt;li&gt;Find Ax&lt;/li&gt;-&gt;Chapter 58]]
(if: $marco is not true or $rachel is not true or $jake is not true or $cassie is not true or $tobias is not true or $axman is not true)[&lt;/ul&gt;]
[[&lt;br&gt;Gather everyone and get them back on mission-&gt;Chapter 59]]}</tw-passagedata><tw-passagedata pid="135" name="Chapter 59" tags="" position="3625,1025" size="100,100">You manage to round up all the Animorphs except for Tobias. They&#39;re grumpy and on edge, but you get them all together. Rachel crosses her arms and glares at you. “Now what?” she asks Jake.

Jake just shakes his head.

“Great. This is going great.”

&amp;lt;We have a mission already,&gt; Ax remonds everyone.

“Yeah, but we know it&#39;s going to fail,” Marco points out. “Bookworm here says Tom dies a Controller, right? Which means we fail to rescue him here.”

“The future can be changed,” Cassie says.

“Fine. How do you propose we use this new knowledge to make this plan more successful?”

Cassie is silent.

Jake stands abruptly. Something in burning in his eyes. He looks around at his team, and at you, but he doesn&#39;t seem to actually see any of you. He&#39;s not smiling, but there&#39;s some kind of fierce, determined optimism radiating from him.

“We scratch this mission,” he says. “It&#39;s a wash. We will save Tom, but not today. We save Tom, we win the day, and nobody will die. Because this time, we&#39;ll be prepared.” He looks over his team once more, smiling when his gaze rests – properly rests this time – on Rachel. Then he looks at you. “Lorraine, talk. Go over everything you remember from this book series; every single thing from beginning to end. Every detail you remember.”

You talk. They ask questions. You talk more. Cassie takes notes. They ask more questions, and you realise details you thought you&#39;d forgotten, things that had seemed silly or unimportant at the time. Cassie writes it all down. The sky darkens. Eventually, throat sore and voice failing, you&#39;re done.

“Okay,” Jake says, “that&#39;ll do for now. We can pick this up again later, after we all get some sleep. Now, let&#39;s talk missions. We can pre-empt some of this stuff and put ourselves ahead of the Yeerks.”

“Like this blue box thing,” Marco suggests. “We should find this David kid right away.”

Jake shakes his head. “We might screw things up if we do that. Might stop him from finding it in the first place. In Lorraine&#39;s version, we get the box; we just have to avoid making him an Animorph this time. These auxiliaries, though, they were trustworthy, right? We can pull them on board as soon as we have the box; have them a bit more trained and experienced before the final battle, help them get out alive.”

“Bad idea,” Marco says. “If we show up with a bunch more of us, the Yeerks are gonna wonder where all these Andalites suddenly came from. Which would be a great way to freak them out, but would probably tip off our actual identities really fast.”

Jake nods. “Good point. We let the box thing play out and think carefully about its use later, before we do anything. As for what we can do right now… we all get some rest, and then Rachel, you find Tobias. Convince him to go with you and talk to his mother, this Loren. We can get that squared away before the Yeerks find her. Ax, Marco, do what you can to track down the two Andalite fighter pilots that are hiding out around here. We might be able to convince them to help us, and if not, we can at least find them before the Yeerks do. Even if they don&#39;t want to fight I bet their knowledge and experience will be very handy. Cassie, Lorraine, you&#39;re on note consolidating duty. Every single thing you remember Lorraine, no matter how small, goes in those notes. Cassie, I need lists from you; a lot of lists.”

Cassie nods. “What lists?”

“First, a list of events that happen without really being caused by us. Aliens visiting Earth, Yeerk plans that aren&#39;t in direct response to us, that sort of thing; anything that&#39;s going to stay pretty much fixed no matter what we do. We can build a timeline of these events and be prepared for them. Second, anything we&#39;re going to do that&#39;s basically pointless. Andalite toilet missions go on this list. So do intel-gathering missions if Lorraine remembers the intel and can save us the trouble. Anything that&#39;s a risk we don&#39;t have to take this time. Third, any big, dramatic situations where plan A failed and we had to come up with a cool backup plan that worked. Take note of plan Bs and Cs that work; this time, they&#39;ll be our plan A. Fourth; morphs. Any morph that turns out to be vital to a future mission. If you can think of a better morph that would&#39;ve been better for the situation, list that one instead. This weekend we&#39;re going out and acquiring as many things on that list as we can. While you&#39;re at it, get a list from Lorraine of every morph she remembers us using ever. We still don&#39;t know if there&#39;s a limit to the number of morphs we can have and having a minimum number for that limit would be really useful.” Jake pauses a moment to catch his breath. He&#39;d been pacing. “Right. Fifth list. Allies. When the Hork-Bajir colony gets sizeable, the Yeerk Peace Movement, the Taxxon rebellion, stuff like that. I need the groups, anything we know about them, and approximately what part of the war we can expect them to show up in. When they&#39;re ready to work with us, we have to already be ready to make them useful.”

“What are you going to do?” Rachel asks.

“I&#39;m going to have dinner with my family,” Jake says. “And then do some contingency planning.” He looks around the group. “Everyone clear on their mission?”

Everyone nods.

“You should sleep over at my place,” Cassie tells you with a smile. “We can work on this tonight.”

[[Agree to help-&gt;Chapter 110]]

[[Go get help from the Chee instead-&gt;Chapter 9]]</tw-passagedata><tw-passagedata pid="136" name="Chapter 6" tags="" position="5825,950" size="100,100">It&#39;s not until after English class that it occurs to you that just because Melissa is wearing her Star Defender pendant doesn&#39;t necessarily mean that this is a version of Animorphs in which the Star Defenders exist. It&#39;s a cheap and common piece of jewellery; she could&#39;ve gotten it anywhere. But you have to try. You wait until recess and manage to corner her as she heads into the bathroom.

“Do you know anything about the Star Defenders?” you ask as soon as you&#39;re certain that the two of you are alone.

“The what now?” She tries to sound indifferent, but the blood drains from her face.

“I&#39;m not a Yeerk. I just need help. I need to know if you can help me.”

Melissa stands perfectly still, thinking. After a little while she says, “Not here, not now. Come to the Sharing meeting after school. It&#39;s down at the beach. We&#39;ll be able to talk there.” She grabs your wrist as you turn to leave, her nails digging into your flesh. “You put any of my girls in trouble before then and I kill you, you understand? I&#39;d do it.” She releases you and storms off.

[[Go to the Sharing meeting after school-&gt;Chapter 19]]

[[Seek help from the Animorphs instead-&gt;Chapter 7]]

[[See a school counsellor instead-&gt;Chapter 5]]</tw-passagedata><tw-passagedata pid="137" name="Chapter 60" tags="penultimate" position="3225,1600" size="100,100">You decide, for some reason, that it would be a good idea to show David some Yeerks. This is definitely a smart plan.

You have several sources of Yeerks available. What would be the best way to go about this amazing plan?

[[Take David to Illim, the Yeerk infesting Cassie&#39;s teacher, and have a reasonable discussion-&gt;Chapter 141]]

[[Take David to spy on Chapman-&gt;Chapter 142]]

[[Take David to the Yeerk pool via an entrance mentioned in the books-&gt;Chapter 143]]</tw-passagedata><tw-passagedata pid="138" name="Chapter 61" tags="penultimate" position="3200,2550" size="100,100">You ask to touch the device. David looks suspicious, but reluctantly lets you touch it while he keeps a good grip on it. You lay one palm flat against a pale, faintly glowing face of the cube.

And realise that you have absolutely no idea how to activate it.

David frowns at you. “Well?”

There&#39;s nothing for it. If you want to prove what the Escafil Device does, you&#39;re going to have to take it to the Animorphs. With or without David.

[[Fight David for the box-&gt;Chapter 62]]

[[Take him to the Animorphs-&gt;Chapter 92]]</tw-passagedata><tw-passagedata pid="139" name="Chapter 62" tags="Reboot-Ending" position="4000,1300" size="100,100">(set: $c62ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You dart forward, grabbing for the box with both hands as you smash your heel into his instep. He swears and almost drops the box in shock, but manages to clutch it and drag it back.

“Get off, you psycho bitch!” he shouts, kneeing you in the stomach. You fall back and he kicks you hard, knocking you to the ground.

“You&#39;re lucky you&#39;re a girl,” he spits before turning to sprint away. But you&#39;re already on your feet. Your new teenage body turns out to be pretty good at running, and you manage to catch up and throw one arm around his neck. He smashes the Escafil Device into your elbow.

You&#39;ve wandered deep into the construction site during your battle. It&#39;s mostly empty, but a homeless man combing for cans watches you. At the sight of the Escafil Device, his eyes widen.

Your grip is weakened by David&#39;s attack on your elbow; he slips away from you and aims a punch at your face. You duck. He swears at you and runs again. You pursue. You can&#39;t let him get out of the construction site. Being in public would make getting the Escafil Device a lot more difficult.

As if to prove that very logic true, a security guard is approaching. David notices her and dashes over. You follow, trying to think of how to convince the guard that the blue box is yours. The guard sees it in David&#39;s arms, and her eyes widen. Her hand reaches into her jacket and pulls out a gun.

By the time you notice that it&#39;s a Dracon beam, it&#39;s much too late to run.

//Interesting choice. It went for confrontation at a known Yeerk landing site. Is this an indication of high risk behaviour or low risk awareness? I suppose that to find out we must//

[[try again-&gt;Chapter 1]]</tw-passagedata><tw-passagedata pid="140" name="Chapter 63" tags="" position="2450,2475" size="100,100">You offer to help the Animorphs with their mission.

The Animorphs don&#39;t bother to disguise the glances they share. You can almost read an entire conversation in those glances. An eyebrow raised in question broadcasts (&#39;trap?&#39;), only to meet a calmer eyebrow (&#39;too obvious&#39;,) in response. You&#39;re puzzled by the &#39;who cares?&#39; shrug for a minute – traps are something that they should probably care about – until you realise that it probably actually means &#39;irrelevant&#39;. A slightly tightened fist is a promise to be on guard; a pair of reluctantly pursed lips meet determinedly blazing eyes. The eyes win. Marco acknowledges Jake&#39;s determined look with a small nod and turns to you.

“Do you know what instant maple and ginger oatmeal does to Yeerks?” he asks.

You nod.

“Good, that&#39;ll save us some explanation. Due to several oatmeal-related incidents – ”

“Some of which are not our fault,” Cassie cuts in.

“Yes, only some of which are our fault, although secretly poisoning a school and dumping a whole bunch of oatmeal directly into the Yeerk Pool as a distraction is probably a pretty big part of the problem... Anyway, the Yeerks are as organised as a bunch of third graders working on a group project right now. They had to wipe out a whole bunch in the Pool, and we haven&#39;t found them working on any projects or anything for a while.”

&amp;lt;If we wanted to do something that might be suspicious,&gt; Tobias adds, &amp;lt;this would be the time to do it. They have the same firepower as always, but if there&#39;s any time we might be able to bank on them not digging too deep into details, it&#39;s now.&gt;

“So if we wanted to free a high-profile Controller that we wouldn&#39;t normally want to be associated with, this would be our chance,” Cassie adds. She glances at Jake. “Maybe our only chance.”

Jake nods. “Our target is Tom Berenson,” he says. “My brother. Hopefully, he&#39;ll have a lot of information that will make our job much easier.”

“He could tell us about the Ehkul thing, for one,” Rachel adds. “Tell us about all the Yeerk pool entrances, give us secret passwords, help us really kick some Yeerk butt.” There&#39;s a softness in her eyes, a slight smile on her lips as she exchanges a glance with her cousin. Jake returns the smile before turning back to you.

“It&#39;ll be dangerous,” he warns. “Are you in?”

[[Agree to the mission-&gt;Chapter 41]]

[[Change your mind and search for what happened to you instead-&gt;Chapter 64]]</tw-passagedata><tw-passagedata pid="141" name="Chapter 64" tags="" position="3000,3100" size="100,100">“I need to know what happened to me,” you tell them. “I could be a danger, or what happened could be a danger, or it might have happened to other people – maybe Controllers. They could turn you in.”

“Are we splitting up, then?” Cassie asks.

Jake nods. “I&#39;ll lead the current mission,” he says, “and I need Tobias for air support. Anyone else have a preference?”

[[Take Ax and Marco with you-&gt;Chapter 43]]

[[Take Cassie and Rachel with you-&gt;Chapter 44]]</tw-passagedata><tw-passagedata pid="142" name="Chapter 65" tags="" position="3475,2550" size="100,100">Erek takes you to a warehouse in town and waves you through a side entrance. “You know,” he says conversationally, “these entrances were initially going to be properly marked and located as conveniently as possible throughout the city, without any of this elaborate security and complicated disguises. The whole system had to change when the &#39;Andalite Bandits&#39; started breaking into the Pool. With the biofilters in, of course, it&#39;s even more tricky.” He takes you into a little side room with no windows and two doors, including the one you entered by. He wraps his arms around you and his hologram flickers off, replaced by the image of a much fatter young man, large enough to encompass the both of you. After the hum of the biofilter dies down, he releases you and switches his hologram back.

The other door leads to a descending tunnel. Once you open it, you can hear the faint sounds of screaming and shouting below. Reminding yourself that you won&#39;t need to go to the Pool itself, you follow Erek down the path. You must be great with maps in this body, because you almost don&#39;t need him; as bends and forks come up, you unthinkingly know where to move.

Did the books ever talk about twisty, forked paths like this? You&#39;re pretty sure that the Animorphs always describe fairly straight paths straight down, not this maze of rooms and corridors. You follow Erek to the door of a large room locked with an electronic lock. He presses his hand to it and after a moment, it pops open.

Erek sticks his head in. “All clear,” he says. “Come and be lookout while I grab what we need.”

You slip inside and stand in the corner near the door while Erek heads for one of the many computers set up in the room. He types rapidly at a keyboard, fingers moving faster than you can follow as text scrolls across the screen too quickly for you to read.

You get bored watching him after a few minutes and glance out the little window in the door, which is lucky because it means you see the approaching young woman in just enough time to give a warning. Erek dashes to your side just as the door opens. He spreads one hand toward you and his hologram expands around you in a metallic prism shape; a filing cabinet that he appears to be leaning on.

The woman looks him up and down, frowning. For a moment it seems like she might question the new filing cabinet, but all she says is, “What are you doing here? The Visser won&#39;t be ready for hours yet.”

“Just running systems checks,” Erek claims.

“Well, if you have time to waste on things like that then you have time to help me. Come on.” She spins on her heel and stalks to a door on the other side of the room.

“This is getting too dangerous,” Erek mumbles to you. “Go to the cafeteria and blend in, I&#39;ll come get you from there when I can.” He pulls a large coat out from somewhere under his hologram and hands it to you. “Hood up, just in case.” Only when the woman is safely in the next room does he drop the filing cabinet hologram and trot after her.

[[Go to the cafeteria and blend in-&gt;Chapter 66]]

[[Peek at the computer Erek was using-&gt;Chapter 67]]</tw-passagedata><tw-passagedata pid="143" name="Chapter 66" tags="penultimate" position="3875,1025" size="100,100">You head for the cafeteria. You&#39;re still not clear on why Erek thought the Yeerk computers might have any information on your condition, but you&#39;re beginning to feel like maybe he was right; you do know more about them than what you&#39;ve read. The sounds of screaming and begging that are becoming clearer and clearer through the tunnel are...familiar.

Nobody pays you any mind as you step into the vast cavern. The term &#39;Yeerk pool&#39; is misleading; what you&#39;re looking at is a Yeerk lake, artificially regular in its dimensions and littered with regular piers. Each pier has Hork-Bajir guards; on one side, they drag struggling captives off the pier and throw them into the large cages lining the sides, and on the other side, they drag them back on. Of course, they only struggle for half the journey.

You pull your hood up and try not to look too closely at those cages as you seek out the cafeteria. It isn&#39;t hard to spot; a steady stream of people wander in and out, chatting casually to each other or snacking on chips. You head over. Every so often, you see somebody who you recognise, whose face fits into your memory. School friends. Family friends. Public figures. The food in the cafeteria is free, and you&#39;re contemplating whether you should get some when a very familiar, very worried face appears in your vision. The man frowning at you is in his mid-thirties and neatly dressed, and you definitely know him, but you&#39;re not sure how.

“You can&#39;t be here!” he mutters urgently, grabbing your wrist. “We can play with files but we can&#39;t affect people&#39;s memories! Come on, let me get you out of here.” He pulls you toward a side tunnel.

[[Let him take you into the tunnel-&gt;Chapter 126]]

[[Run away-&gt;Chapter 68]]</tw-passagedata><tw-passagedata pid="144" name="Chapter 67" tags="" position="6175,2800" size="100,100">As soon as you&#39;re sure you&#39;re alone, you head for the computer. If you crouch low, you shouldn&#39;t be visible from the room Erek and the Controller headed into. Erek has turned the computer monitor off, but the computer itself is still on – you turn the screen back on and look through the files he&#39;s pulled up.

They&#39;re arrayed in tabs within one window, like tabs in a modern search engine. Most of them seem irrelevant; Yeerk feeding rosters, Yeerk infestation lists and schedules, promotion records... On the sixteenth tab, you find your name: LORRAINE ALSTON, printed across the top of the file in large letters.

It&#39;s a hospital report. A report of the car accident, the record of five days in a coma, some brain scan images. The images don&#39;t look like a normal brain to you, but what would you know? Besides, according to the marked date, you were four days into a coma when they were taken. That can&#39;t be good for the brain.

Three quarters down the page is a little note. Status: infested; Yeerk: Mana 087.

Suddenly, you can&#39;t seem to get enough air.

That name fits. You remember seeing it before, on...on reports, on duty files. Files moved through your hands, read and dealt with by you.

You move to the next tab. It&#39;s a deceasion registration, the Yeerk equivalent of a death certificate, marking Mana 087 as a victim of the oatmeal contamination purge of the Yeerk Pool. That&#39;s not right, that can&#39;t be right, because you were in the coma after the Animorphs poured oatmeal in the Pool, weren&#39;t you? Maybe your timeline is wrong. The books never had dates. But... But why would they let you go, just because your Yeerk was dead? You should get a new Yeerk, surely?

Your hands are shaking enough to make it difficult to move to the next tab. It&#39;s some kind of random employee roster; not interesting, especially since Mana 087 isn&#39;t on it. You go back to the earlier tabs, the various rosters and infestation records... There are a few Manas on them but no Mana 087s. Your Yeerk is mysteriously absent. It was given a false death. And you, for some reason, were let out of the hospital free, and the Empire didn&#39;t notice.

Somebody got into that system, and tried to hide Mana 087&#39;s fate.

It occurs to you that you have no way to tell if Erek was merely reading files or editing them.

The door on the other side of the room starts to open. You can hear Erek just on the other side of it, talking to somebody.

[[Go with Erek-&gt;Chapter 95]]

[[Hide and investigate further alone-&gt;Chapter 96]]</tw-passagedata><tw-passagedata pid="145" name="Chapter 68" tags="Reboot-Ending" position="4600,1300" size="100,100">(set: $c68ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

“Let me go!” You shout, pulling away from the man. Several people turn to look at you. Most of them shuffle away quickly, but a few frown and square their feet. Controllers, ready to take charge once the voluntary hosts get out of the way? Maybe. This isn&#39;t a good place to make a scene.

“Listen,” the man says urgently, “you have to – ”

Just then, a loud, shrieking alarm blares through the complex. “Andalites!” somebody screams. Did Erek trip something? It seems like a pretty big coincidence that you&#39;d be in the middle of a scuffle right as the Animorphs actually showed up. From the way the Controllers around you reach for their guns, it&#39;s clear that they think the same thing. And they don&#39;t seem to believe in coincidences.

They don&#39;t even bother to try to determine which of the two of you might be an Andalite. You see the man turn to dust and feel an inexplicable lance of grief moments before the Dracon beam hits your own back and pulls your cells apart.

//Hmm... Panic, or underestimating one&#39;s enemies? It&#39;s hard to tell from this trial. To confirm, we&#39;d have to [[try again-&gt;Chapter 1]].//

</tw-passagedata><tw-passagedata pid="146" name="Chapter 69" tags="penultimate" position="4275,4175" size="100,100">You lay back and pretend to sleep, sneaking only short glimpses of the world around you for moments at a time. Two aliens wander in; the most stereotypical aliens you&#39;ve ever seen. They are exactly like the aliens from every popular alien abduction story, with thin bodies and bloated heads.

They appear to be having a conversation in some droning language you don&#39;t know. They don&#39;t look at you, but one stands very close to your table... Perhaps within arm&#39;s reach. The other grabs something from a shelf, and they seem about to leave.

[[Wait for them to leave, grab your stuff and make an escape-&gt;Chapter 70]]

[[Take the nearby alien hostage-&gt;Chapter 71]]</tw-passagedata><tw-passagedata pid="147" name="Chapter 7" tags="" position="5650,750" size="100,100">The Animorphs aren&#39;t hard to spot. They cluster together at a table at lunch, four students who you know by sight. It&#39;s probably not a great idea to approach them at school, but in passing you hear Marco use the words &#39;barn&#39; and &#39;tonight&#39;. Perfectly innocuous terms to most people, but enough for you to go on.

Finding out where Cassie&#39;s farm actually is is a little trickier in a world without Google Maps, but not impossible; the Wildlife Rehabilitation Clinic has a clearly listed address in the phone book. You give them a head start before heading out there yourself.

You take the bus, which brings you within walking distance of the Clinic. You suppose that if Cassie&#39;s parents see you you can claim to be looking for somewhere to volunteer or something.

The Animorphs are clearly deep in discussion as you approach the barn. You can&#39;t make out many words, but the tones are urgent. You hesitate before leaning a little closer to the door, trying to make out the conversation.

And then somebody grabs you from behind.

There&#39;s little point in struggling; whoever it is is either very strong or simply doesn&#39;t care as they rearrange their grip to hold you in a headlock. It&#39;s a girl, judging by the manicured nails, but you can&#39;t turn your head enough to be sure as a second person grabs your arms and forces them behind your back at a painful angle. You&#39;re dragged into the shed and thrown to the straw-laden concrete floor.

The five pairs of feet in front of you are all bare. You look up further to see five teenagers. Jake stands in the middle of the group, looking down at you calmly, arms crossed. Rachel inspects her nails and spares a glare for you, as if any damage to them is your fault. Marco, as you watch, deliberately circles around you to block the door. Cassie bites her lip and looks like she wants to help you up. You don&#39;t know the fifth teenager, a cute multi-racial boy who could be the brother of any of the others, but it&#39;s not hard to guess his identity.

From the rafters, a hawk glares down at you. Of course he would have heard you coming.

“So we have a spy,” Rachel growls. “How much do they know?”

“It&#39;ll be better if you just talk,” Marco advises. “You don&#39;t want to make her mad.”

“I&#39;m not a spy,” you insist. “I need your help. I can explain.”

“You probably should,” Jake says.

[[Explain that you know all about the Animorphs but don&#39;t know how-&gt;Chapter 14]]

[[Explain that you&#39;re trapped in a children&#39;s book series from the 90s-&gt;Chapter 15]]</tw-passagedata><tw-passagedata pid="148" name="Chapter 70" tags="" position="4550,3825" size="100,100">Your belongings aren&#39;t locked in anything. You carefully pull the tubes away from your flesh, barely feeling the needles slide out, and roll from the table. You kit up and head for the door.

You&#39;re alone. The door opens easily with a little pressure. You exit into a blank corridor, stretching off in both directions. There are no signs. Where do you go?

[[Turn left-&gt;Chapter 72]]

[[Turn right-&gt;Chapter 73]]</tw-passagedata><tw-passagedata pid="149" name="Chapter 71" tags="Reboot-Ending" position="4100,3975" size="100,100">(set: $c71ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

You seize your chance, flinging yourself forward from the table. You feel the tug of needles pulling free from your flesh, but there is no pain, only numbness. Your muscles are slow to respond; you manage to wrap one arm around the alien&#39;s thin neck. Its skin is dry and papery, and loose enough to move under your touch.

Before you can make your demand, you find yourself falling forward, your muscles slack. The aliens easily lift you back onto the table and begin reconnecting wires. The room fades out, and you can hear a crisp, analytical thought in your mind, one that isn&#39;t your own.

//How did it break out? Submerge it, quickly. We will need to [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="150" name="Chapter 72" tags="" position="4075,3825" size="100,100">You turn left down the hall. The hall itself curves slightly to the left. The ceiling is low enough to make the hall feel cramped and, like the walls and floor, made of smooth metal. There are no windows, but there are occasional locked doors. You see nobody on your journey.

The hall eventually terminates with a single, unlocked door. Behind it is some sort of storage room. Shelves line the walls and stand in rows in the room, strange objects strapped to them. Most of them you don&#39;t recognise, and there is no common aesthetic; here, a lump of something like clay; there, a spiky metal thing that fills the air around it with ozone. Occasionally, there are objects that you do recognise. An old glass coke bottle stands next to a sneaker. Several feet away lies some kind of spinning top. You&#39;re only partway through your inspection when somebody approaches; you just have time to throw yourself behind a free-standing shelf before the door opens and somebody walks in. You can&#39;t see them, but the footsteps reverberating through the floor don&#39;t sound human. They shake the floor despite their softness, delicate and uneven strides coming closer.

Low on the shelf in front of you are two items within reach – some kind of strange construct with several long barrels that seems to be a gun of some sort, and an ordinary flash drive.

[[Take the gun-&gt;Chapter 74]]

[[Take the flash drive-&gt;Chapter 75]]</tw-passagedata><tw-passagedata pid="151" name="Chapter 73" tags="penultimate" position="4875,3675" size="100,100">You turn right down the hall. The hall itself curves slightly to the right. The ceiling is low enough to make the hall feel cramped and, like the walls and floor, made of smooth metal. There are no windows, but there are occasional locked doors. You see nobody on your journey.

It&#39;s not long before you come to a fairly large alcove to your left. A large window separates you from the dark vacuum of space. A little further along the alcove are several closed hatches; they look easy enough to open. You don&#39;t recognise the urgent-looking writing on the hatches, but they evoke the general sense of urgency of an emergency exit sign or fire alarm handle. Escape pods?

[[Try the possible escape pods-&gt;Chapter 90]]

[[Keep going-&gt;Chapter 91]]</tw-passagedata><tw-passagedata pid="152" name="Chapter 74" tags="" position="4125,3650" size="100,100">You don&#39;t know how to use the gun, but maybe you can figure it out if you need to. You grab it. It looks usable by a human, assuming you&#39;ve correctly identified where the barrel and trigger are.

The strange footsteps come closer and closer, pausing at the shelves you&#39;re hiding behind. Did it hear you? Has it come to take you back to that room?

[[Take the intruder hostage-&gt;Chapter 78]]

[[Freeze and hope it goes away-&gt;Chapter 79]]</tw-passagedata><tw-passagedata pid="153" name="Chapter 75" tags="" position="4450,3675" size="100,100">You wouldn&#39;t know how to use the gun anyway. You pocket the drive while the strange footsteps come closer and closer, only to pause on the other side of the shelved you&#39;re hiding behind. You freeze. Did it hear you?

It scrabbles at the shelf for a little while, and then the footsteps begin to recede. Only once it&#39;s gone do you let yourself relax. You get up and head for the entrance. What now?

[[Look for a computer to read the drive-&gt;Chapter 76]]

[[To look for a way out-&gt;Chapter 77]]</tw-passagedata><tw-passagedata pid="154" name="Chapter 76" tags="" position="4725,3625" size="100,100">You tuck the flash drive away and go searching for a computer. The layout of the spaceship is fairly simple; wide, curving corridors lined with rooms and cut at ninety degrees by straight corridors. It doesn&#39;t take long to figure out that the wide corridors are probably a bunch of concentric circles, with the straight ones probably meeting in the middle like wheel spokes. You stay around the outside, where there doesn&#39;t seem to be too many aliens.

Finding a computer isn&#39;t all that difficult. There are several. There&#39;s one back in the room you woke up in, for instance. Every computer you find looks suitably futuristic, has buttons and switches you don&#39;t understand, and features a complete absence of USB ports.

Of course. Why would aliens use USB?

[[Look for a way out-&gt;Chapter 77]]</tw-passagedata><tw-passagedata pid="155" name="Chapter 77" tags="penultimate" position="4650,3400" size="100,100">You have to get out of this place. As soon as you&#39;re alone, you head back for the door. You follow the corridor back past the room you woke up in and keep going. The doors you pass are locked, the corridor empty. Eventually you come to an alcove in the left wall, with a large window opening onto the vacuum of space and several hatches marked with urgent but unfamiliar lettering. Escape pods?

[[Try the possible escape pods-&gt;Chapter 90]]

[[Keep going-&gt;Chapter 91]]</tw-passagedata><tw-passagedata pid="156" name="Chapter 78" tags="penultimate" position="4775,3275" size="100,100">You launch yourself at the intruder, managing to grab it. It&#39;s the most stereotypical alien you can picture; short with a massive head, spindly limbs and huge, bulbous eyes. Its dry, papery skin moves in your grip. The jumpsuit it wears seems to be made of something like latex. It doesn&#39;t seem remotely concerned by your hold.

The gun is another story. It is very concerned by that.

It whines distressingly for a few moments, then reaches up to push a button on its collar. Suddenly, its words flower as thoughts in your mind.

The experiment will let go.

You do not let go.

What does the experiment want??

What do you want? Well, it&#39;s an alien. You&#39;re probably on a spaceship.

[[Demand to be taken to the escape pods-&gt;Chapter 80]]

[[Demand to be taken to the cockpit-&gt;Chapter 81]]</tw-passagedata><tw-passagedata pid="157" name="Chapter 79" tags="penultimate" position="4175,3500" size="100,100">You freeze, barely daring to breathe. After what feels like at least several minutes, the thing on the other side of the shelf takes whatever it was looking for, and leaves.

You stand, shakily. The gun is heavy in your hands.

[[Take a moment to try to figure out the gun-&gt;Chapter 97]]

[[Head straight off into the corridor-&gt;Chapter 98]]</tw-passagedata><tw-passagedata pid="158" name="Chapter 8" tags="" position="5225,775" size="100,100">It turns out that you own a walkman. The kind you put CDs in. There&#39;s a Hanson CD in it.

Putting that aside, you get on to more important matters. You flip through notebooks and folders, and, as you do, their existence and the events they depict slot themselves neatly into your memory. There&#39;s your family at the beach last year, before your dad left. There&#39;s an old book report that you stayed up past midnight completing because you&#39;d been hanging out with your friends all week. You got a C- on it. There&#39;s your next book report; that one&#39;s worth a B+, so you must have put some actual work into that one.

And there is some old paperwork from the accident.

Apparently you were hit by a car and were in a coma for four days. As you read the words, you realise that you remember the hospital, remember your mother&#39;s tearful smile and the relieved look in your doctor&#39;s eyes. You remember somebody explaining that there might be lingering memory problems. That you have to be careful. You don&#39;t remember the accident itself, but you suppose that that&#39;s not unusual.

Under the paperwork is a pamphlet for The Sharing. It&#39;s advertising a beach get-together. The date is circled, with some stars drawn next to it – today&#39;s date. Were you planning on going to this meeting? Should you still go?

[[Go to the hospital in search of more details on your condition-&gt;Chapter 18]]

[[Go to the Sharing meeting-&gt;Chapter 19]]</tw-passagedata><tw-passagedata pid="159" name="Chapter 80" tags="Reboot-Ending" position="4925,3125" size="100,100">(set: $c80ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

// The experiment is not authorised to –//

You repeat your demand.

//… The experiment will follow.//

You keep your grip on the alien and your gun raised as you head back down the corridor and past the room you woke up in. Shortly beyond it is an alcove with a window, facing space, and several closed hatches. Slowly, making an effort to be nonthreatening, the alien opens one. You both enter. It&#39;s clearly not designed for humans, but it&#39;s good enough; there are seats, and something that is obviously a computer. You close the hatch and demand that the alien take you back to Earth.

It activates the computer and pulls a large, obvious lever, detaching the escape pod.

//This Na will now take the experiment where it has demanded//, the alien tells you, sounding resentful. You pay close attention to it as it taps away at the computer, checking for any sign of aggression, activating weapons, or turning the escape pod around.

You&#39;re so attentive for alien betrayal that it&#39;s hard to notice much else. By the time you pay attention to how stiff your limbs have suddenly gotten, your muscles won&#39;t obey you enough to wield the gun. As you wonder if the air in the pod always seemed thick and sour, it occurs to you that there are probably lots of things in the universe that poison humans but don&#39;t affect aliens. You black out before you can seriously consider the possibility.

//How much time did we lose?

Only a little. There is still time to

[[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="160" name="Chapter 81" tags="Reboot-Ending" position="4950,3300" size="100,100">(set: $c81ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

// The experiment will not –//

You repeat your demand, gesturing pointedly with the gun.

//… The experiment will follow.// It leads you from the room. You keep hold of it. And keep your gun on it.

You follow the curving hall for quite some distance. You go past the room you&#39;d woken up in, door still sitting partly open, and then a large alcove with several hatches in the wall. You walk past many more doors, all shut and all identical, and just when you start to suspect your hostage is leading you in circles, a narrow hallway appears on your right. It is perfectly straight, and barely wide enough for two of the aliens to walk abreast, meaning that you take up almost the entire hallway yourself.

There are no doors lining the corridor. It bisects several more of the wide, curved corridors like the outer one you just traversed, ending in a bright opening. Some of the corridors are wider than others. About one third of the way along, you cross one with lights in the ceiling that move past very quickly, zooming over your head from left to right. The ship seems to have an awful lot of space, given how few aliens you&#39;ve seen.

The pair of you start to cross the wide corridor, lights zooming past overhead. About halfway across, your hostage pauses. You poke them with the gun, but they don&#39;t move.

In such a position, you barely have time to swing the gun around to point it at the huge yellow and red...thing...that comes charging down the wide corridor at you. It&#39;s easily taller than a horse and wider than it is tall, too wide to fit through the narrow hall you were walking through but just wide enough, you realise, to move easily through the much wider hall it intersects with; some kind of giant insect. You have no time to aim before you pull the trigger.

Not that it matters because, as it turns out, you can&#39;t figure out how to use your stolen gun. It&#39;s only so much useless scrap as the large, many-legged alien runs straight into you.

//Is it alright?

The child was careful. It is stable enough. Re-initiating.

It was more resourceful than we anticipated. We need more information. We must

[[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="161" name="Chapter 82" tags="" position="1025,1575" size="100,100">You catch a bus to the construction site. Tobias meets you there.

The site isn&#39;t overly familiar. Parts of it seem to fit into your memory as you walk through, but a lot of it means nothing to you. The pair of you have no idea where to start looking, as you don&#39;t know where exactly it is that David finds the cube, but it must be well-hidden since nobody else found it first. You vaguely remember something about it being placed in an alcove. Not particularly useful.

Tobias shows you where Elfangor&#39;s ship crashed. The Yeerks did a good job of cleaning the site up; it looks no different to the rest of the site. It&#39;s just a big patch with no buildings, strewn with debris. You sort through the debris for awhile. Nothing.

You investigate the buildings nearby. Maybe it ended up in one of those? It looks like homeless people probably sleep in them, though; surely they&#39;d have already found it if it was there?

One of the buildings is half-collapsed. A big pile of rubble blocks your way. Could it be buried under there? You could call Tobias for help, but… as you reach out to touch the pile, it fits into your memory. You&#39;ve been here before. You run your hand over a large chunk of fallen concrete, guided by the sense of familiarity. There&#39;s a small gap under it, too small for you to fit, but big enough to stick an arm. Heartbeat thudding in your ears, you reach in.

A switch. You pull it.

With much less sound than you&#39;d expect, the chunk of concrete lifts up and widens the gap just enough for a person to crawl in.

[[Crawl blindly into the darkness-&gt;Chapter 20]]

[[Call for Tobias-&gt;Chapter 115]]</tw-passagedata><tw-passagedata pid="162" name="Chapter 83" tags="" position="2875,2550" size="100,100">The plan is fairly simple, although dangerous. The Animorphs stress just how dangerous it is. They point out, over and over, that you must NOT be captured. You cannot afford to be captured. They insist that you be sure you understand this.

You understand.

The Sharing meeting will be on the beach. The Animorphs drill you on your lines. Your name is Ashat 069. The name sits uneasily on your tongue, but you memorise it. There is a problem with the Ehkul project that you need to bring to the project leader&#39;s attention immediately.

You don&#39;t ask how they learned that Ashat was a Yeerk name. You don&#39;t ask how they learned how involved Tom was with the project. You memorise the map of the beach that the Animorphs show you, the Yeerk meeting point, the place where you need to lure Tom away, the route you need to take.

The plan is altered and refined as you go. You focus on your part of it.

All too soon, it&#39;s time for the meeting. You bus in. The Animorphs take to the air; they don&#39;t want to risk being seen at the meeting in their human forms.

The whole thing raises a lot of questions of exactly what you&#39;re supposed to do, if you&#39;re identified. Will you have to escape through Rachel&#39;s father? Leave your family behind? There&#39;s volleyball and a barbecue at the beach. You lurk on the edge, too nervous to really get involved. After a while, the full members separate and head off to their meeting. A bit later, they come back. Tom is in a small group, wandering out of dunes. You approach.

Tom looks you up and down and gives you a friendly smile. “Problem, kiddo?” he asks.

You clear your throat.

You mutter, loud enough for him to hear, that there&#39;s a problem with project Ehkul.

“Who are you?” he asks, frowning.

“Ashat 087, sir,” you tell him. It&#39;s not the number you were given, but it fits in your mind, somehow. Tom doesn&#39;t seem to notice.

“If there are delays, you can tell me about them – and about the solutions – tomorrow morning,” he says firmly. He turns. But you know exactly how to get his attention.

“There are Andalites involved.”

That gets his attention.

Tom tells the others to go on ahead and follows you into the dunes. You lead him to the ambush point where a wolf holds him down, jaws around his throat, while an elephant trumpets somewhere down the beach. A gorilla hands you a syringe.

&amp;lt;Inject this into his butt,&gt; Marco tells you. You do, hoping you&#39;re not making a mess of it as your hands shake and Tom struggles despite the two big animals holding him down.

Once he starts to fall asleep, Cassie dashes off to hide and morph horse, while Tobias drops from the sky and lands on Marco&#39;s arm. He gingerly reaches out one talon and gently touches Tom&#39;s skin. A couple of minutes later, Tobias is pulling Tom&#39;s clothes onto his new morph while Cassie trots over as a black horse.

Tobias runs off to be seen helping deal with the “Andalite Bandits”. Marco helps you onto Cassie&#39;s back, then Tom.

&amp;lt;Go,&gt; he says. &amp;lt;I&#39;ll cover your exit.&gt;

And you leave.

A couple of Controllers spot you. Marco leaps seemingly out of nowhere to deal with them. Cassie speeds up. She takes a strange route, sticking to the beach for a while before looping around between some houses and then back onto the beach, and it takes you some time to realise that she&#39;s trying to stick to the least populated areas possible. With one of you unconscious and two of you unable to morph, there&#39;s no way to hide if you&#39;re cornered. But you&#39;ve left the beach behind, and if anybody&#39;s seeing the horse with two passengers trot past their window, they mustn&#39;t think it&#39;s something to call the police about, because you&#39;re not bothered on your journey by anything more than a couple of puzzled bystanders pointing and shouting questions.

Cassie demorphs and remorphs on the edge of town, then heads for the forest. It&#39;s a long journey. You almost fall asleep several times, but Cassie keeps you occupied with questions about your life and your family. You can&#39;t answer most of them.

You&#39;re not sure exactly how long Cassie&#39;s staying in morph before demorphing, but it takes several remorphs before a half-ruined shack is visible in the woods. Tobias is there, waiting, perched on the roof. You and Cassie carry Tom in. The Animorphs have prepared well; there&#39;s several days&#39; worth of food stacked in one corner, a good supply of blankets, a first aid kit, and even some board games.

And rope, coiled on a chair next to a small table. Cassie directs you to move it so she can sit Tom down. She starts to tie him in position with firm, efficient knots.

You look away. Your eyes rest on the edge of the table. There&#39;s old blood dried on it.

“How did you do it?” Cassie asks as she checks Tom&#39;s breathing. It takes you a moment to realise she&#39;s not talking to you.

&amp;lt;Ocean,&gt; Tobias replied. &amp;lt;Rachel tossed me in, quite far, with her trunk. A lot of Controllers saw. They&#39;ll probably search for Tom Berenson&#39;s body for a few days before giving up.&gt;

“You demorphed in the ocean?”

Tobias shrugs with his wings. &amp;lt;Had to be done.&gt;

Tom stirs. Cassie dashes out of the shack, out of his sight. He starts to open his eyes.

[[Run before Tom can identify you-&gt;Chapter 113]]

[[Stay-&gt;Chapter 114]]</tw-passagedata><tw-passagedata pid="163" name="Chapter 84" tags="" position="3425,1900" size="100,100">“That&#39;s fair,” Jake says. “You can&#39;t heal like we can. But will you allow Cassie to add your DNA to her combined half-morph?”

You allow it. The Animorphs station you on guard in a shack off in the woods and tell you to wait. This is where they&#39;ll bring Tom. You can&#39;t help but wonder if they&#39;re trying to keep you out of the way.

The shack is rundown, but functional. It seems mostly intact; the roof is solid and a bunch of camping gear is stacked in one corner, as well as several days&#39; worth of food and a first aid kit. There&#39;s a table with some dried blood on it, and a chair with rope coiled on it. That seems pretty ominous. At least they&#39;re prepared.

The Animorphs bring in an unconscious Tom. Jake ties him into the chair while Cassie checks his vitals. After a couple of minutes, he stirs, and everybody except Tobias and Ax flees before they can be recognised.

[[Run before Tom can identify you-&gt;Chapter 113]]

[[Stay-&gt;Chapter 114]]</tw-passagedata><tw-passagedata pid="164" name="Chapter 85" tags="" position="4350,3100" size="100,100">You tell the girls that you want to help with their mission. They discuss your trustworthiness a bit longer before getting down to business.

“Controllers are going missing,” Melissa explains. “The vanish for a little while, then they show up again, perfectly fine. If we didn&#39;t know what to look for, it&#39;d be unnoticeable, but...”

“It started with Cassie Williams,” Kelly adds. “You heard of it? Went missing for a couple of weeks, supposedly lost in the forest, then showed up again, not injured or anything. Kent Matthews disappeared for two days, Jacques Melan went to spend a weekend with his father, except I know his father and he didn&#39;t have him.”

“We&#39;ve tracked several cases,” says Amanda. “Patch-up work after… something. But they&#39;re getting proactive about it now; they&#39;re arranging some kind of invitation-only camp. Judging from some of the Controllers we&#39;ve been tracking, our theory is that it&#39;s a getaway for Controllers, to get them all… off doing whatever it is they&#39;re isolating them for. But we also know some of them are reluctant, for some reason.”

“If we can get a list of the students invited,” Melissa concludes, “then we&#39;re pretty sure we&#39;ll have a list of every Controller in the school, or at least most of them.” She grins. “So how about it? You in?”

[[Help the Star Defenders-&gt;Chapter 140]]

[[Change your mind and seek the source of your immunity-&gt;Chapter 86]]</tw-passagedata><tw-passagedata pid="165" name="Chapter 86" tags="penultimate" position="3825,2625" size="100,100">You decide that it&#39;s important to figure out why you&#39;re immune to infestation.

The Star Defenders agree, and quickly pull together a plan to investigate the hospital where you were treated after your accident in search of medical records. “We have a guy,” Amanda explains, “who can help us find anything weird.” But the hospital plan isn&#39;t as simple as it could be – you can&#39;t simply waltz in through the front door. The Star Defenders don&#39;t want to be recognised. And while the possibility is remote, they&#39;re worried that somebody might be aware that you were captured for infestation, and have tied you to the rescue scene. Paranoia, it seems, is a survival trait for a Star Defender.

So the hospital plan must be done secretly. You meet a fourth Star Defender, a boy codenamed Basset who you don&#39;t recognise under his mask, and head for the hospital well after dark. The reception area and doctor&#39;s offices are deserted. The Star Defenders lead you up into a series of crawl spaces in the roofs and quickly hash out the plan. You split up. You&#39;re paired with Melissa and sent to your doctor&#39;s office to see if he keeps any useful notes there.

Melissa leads you to the offices and helps drop you down from the ceiling, where she waits to pull you up again when you&#39;re done.

You know this office. You remember being here before, leaning over that desk as you argue with a blue-eyed doctor. You remember laughing off some remark or other as you admire the potted plant on the windowsill. You remember that the top desk drawer is kept locked because there are important documents in there, but the key is magnetically secured under the doctor&#39;s chair. Are there patient records in there? It&#39;s worth a shot. You slip around the desk and fetch the key. Within seconds, you&#39;re opening the drawer.

The papers inside aren&#39;t patient records. They&#39;re clearly labelled as documents for &#39;Project Ehkul&#39;.

Yeerkish for &#39;pipeline&#39;. The Yeerk vaccination plot.

You pull out a thick stack of papers, but before you have a chance to go through them, you hear something moving around in the tall cabinet on the other side of the room. You just have time to duck under the desk before two people walk out of the cabinet in single file; a muscular brunette woman you&#39;ve never seen before and a smaller man who you immediately recognise as the owner of this office, the one you&#39;ve spent so much time talking to.

“The Visser wants those reports by Monday, don&#39;t forget,” the woman says matter-of-factly.

“I&#39;ll have them for you, sir, no need to worry,” the familiar man assures her. She turns and marches out of the office. He closes the cabinet, then freezes.

You stay as still as you can, trying not to make any noise, hoping he&#39;ll go away. The man reaches under his jacket and draws a gun that you recognise as a Dracon beam, slowly circling around the desk. When he spots you, his shoulders sag in relief. “Mana!” He puts the gun away. “Mana, what are you doing here? Is everything alright? I... She&#39;s coming back! We have to get you out of here!” He grabs your arm and pulls you away from the desk and toward the filing cabinet.

[[Fight him and run away-&gt;Chapter 28]]

[[Let him pull you into the cabinet-&gt;Chapter 126]]</tw-passagedata><tw-passagedata pid="166" name="Chapter 87" tags="Reboot-Ending" position="4500,1500" size="100,100">(set: $c87ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

You try to pull away from the man, right as the teen appears in the alley. Instantly, the man&#39;s manner changes. He pulls you closer.

“You wanted this one?” he asks imperiously.

The teen trots over. He bends over a moment, gasping, then reaches out for you. “She&#39;s a runner, still uninfested I think, sir. I&#39;ll take her back.”

“And make another scene?” he asks, raising a brow. “I&#39;m sure I can manage it.”

The teen&#39;s lip curls. “And make me out to be an incompetent guard so you can, what, stick your own people in our sector instead? She&#39;s mine, with respect, sir.” He grabs your other arm. “I just need to get her back to Ellith.”

“Ellith shouldn&#39;t have lost her. I&#39;m sure he won&#39;t want you dragging her back through the streets.”

“My orders – ”

“I&#39;ll see about straightening this out.” Tightening his grip on your wrist, the man uses his free hand to pull out of his pocket something that looks a lot like a smartphone. He poked at the screen, then frowns. He bites his lip.

“Sir?”

“He&#39;s not answering,” the man says, a mix of fear and apprehension in his voice. “I&#39;m sure it&#39;s not – ”

The teen&#39;s fingers dig into your wrist. “What did you do to him?” he hisses.

“She&#39;s just a human girl, she couldn&#39;t do much,” the man says dismissively, but the fear is still in his voice. “Go back to your post. I&#39;ll straighten this out.”

“And if she has hurt him? If this is just an attempt to make our branch look incompetent – ”

“Your branch will look exactly as incompetent if I handle this as you,” the man says crisply. “As soon as anybody gets in that head they&#39;ll see your many mistakes and your grub behaviour for themselves.”

“Good point,” the teen says, reaching into his pocket. Something metal flashes as the hand darts towards you and you feel a sudden strong pressure on the side of your neck. Blood pours down your front from the room in your throat as the man screams in anguish, pulling you into his arms. And even as you fade away, you still can&#39;t place quite where you know him from.

//Hmm, interesting. An inability to trust causes failure... Although misplaced trust could be just as fatal. We must test this reaction further. We must [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="167" name="Chapter 88" tags="Reboot-Ending" position="4600,1500" size="100,100">(set: $c88ending to true)\
(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))

Jake sends Marco and Ax with you while the rest scout out your and David&#39;s houses to try to determine if they&#39;re safe from Yeerk influence.

&amp;lt;This hospital is a Yeerk facility,&gt; Ax says, &amp;lt;and it is therefore likely that they are set up using Yeerk protocols all the way through, for simplicity of expansion. There will be a central databank in the facility. Unless your patient files are top secret for some reason, I should be able to find them there.&gt;

“Central databank,” Marco echoes. “No problem. Should we do the initial run without Morphless here or…?”

&amp;lt;We may need data from her. If more subtle infiltration is necessary, we can separate later on.&gt;

And like that, it&#39;s settled. You, Marco, and an awkwardly-moving Ax in human morph make your way to the hospital. You walk in as if you mean it, as if you know where you&#39;re going.

“Okay,” Marco mutters, “how do we find this information bank? Ax?”

But you&#39;re already moving. With every step, more of the hospital fits into your memory. You&#39;ve walked this way before. You&#39;ve walked that way before.

You know the way. Down the corridor. Turn left. Elevator up two floors. You don&#39;t know what&#39;s at the end of your path, but you know where you&#39;re going. Marco asks where you&#39;re going at first, but seems to decide against trying to shake you out of it.

That proves to be the right decision, because you are soon opening the door to a room full of computers.

To you, it&#39;s unimpressive. To Marco the Nineties Kid, it probably looks like NASA. He grins broadly as he enters, notices a couple of Controllers tapping away at computers, and makes an effort to look serious.

Ax brusquely walks in as if he&#39;s meant to be there, sits down, and starts typing. You and Marco loiter and try to look busy. You peek at Ax&#39;s screen, but you don&#39;t recognise most of the words on it. After awhile, he stands up and gives you a small, very serious nod.

You don&#39;t ask him to explain in front of the Controllers, but you can&#39;t help the extra spring in your step as you exit the hospital and find an alley suitably far from the Yeerk-controlled building for Ax to refresh his morph and explain what&#39;s going on. He demorphs completely before he deigns to say anything.

You ask him if he has answers, if he learned what happened to you.

&amp;lt;Yes,&gt; he says, narrowing his eyes. &amp;lt;I know exactly what you are.&gt; And then his tailblade whips forward, towards your throat.

Andalite tails really are very fast.

//It trusted the Andalite? Well, I suppose it had no reason to know better. We should [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="168" name="Chapter 89" tags="" position="6575,2250" size="100,100">“The first step has gotta be to vet their families,” Marco says. “We can&#39;t be certain who is and isn&#39;t a Controller, but for our families we usually have a pretty good idea. For something this important, we need that pretty good idea.”

The Animorphs send you home, Tobias watching from the sky and Rachel in your sleeve. Your mother asks where you&#39;ve been and you brush her off with some realistic lies. She sounds very concerned. Are you having dizzy spells? Have you noticed any personality changes? Any other signs of ongoing problems from brain damage? You consider telling her about the memory loss, but you want less attention, not more. You play the slightly moody teenager, tell her you want to be alone, and head up to your bedroom. You lean on the door to hold it closed while Rachel demorphs.

“This is really the sort of thing we should have Chee doing,” Rachel says as she goes through your wardrobe looking for something to wear over her morphing outfit. “I have school tomorrow and Tobias needs his time to hunt to, you know, stay alive. Also, you and I are going shopping when this is over. This isn&#39;t Cassie-bad, but a couple of small changes to your colour pallette would complement your skin tone much better.” She pulls out a pair of jeans and holds them against her hips, trying to judge how well they&#39;ll fit. “Get that window for Tobias, will you?”

You go over and open the window for Tobias. He lands on the sill.

“Who do you live with?” Rachel asks.

Your mother. Your sister. Do you have a father? No father figure arises to fit into your memory. Perhaps you have to see or hear him? Or perhaps you just don&#39;t have one?

Your bedroom door opens. You glance guiltily at the windowsill, but Tobias has already disappeared. Rachel, having just buttoned on your jeans, freezes. You instinctively step forward, as if you can shield her from site, and glare at your mother, reminding her to knock next time.

“Right, Lori, I just wanted to tell you that dinner – ” Your mother looks Rachel up and down. “I didn&#39;t know you had a friend over,” she says, frowning. “I would&#39;ve seen her come in. What are you two up to that&#39;s all secret? You&#39;re not in trouble, are you?”

You insist that you&#39;re not in trouble.

“Then why are you sneaking around – ” Your mother&#39;s eyes widen. “Lori, is she your girlfriend?”

Rachel reaches out and grabs your hand. “Please don&#39;t tell my family,” she says, deadpan. “They wouldn&#39;t understand.”

Your mother blushes. “Of course, I… uh, are you staying for dinner, um…?”

“Rachel.”

“Are you staying for dinner, Rachel?”

“I wouldn&#39;t want to be a bother.”

“Oh, not at all. I&#39;ll set another plate for you.” She frowns at you. “None of this sneaking around, okay? I don&#39;t want to come home one day and find you doing drugs or something.”

Your mother leaves. Rachel starts looking for a top that matches the jeans she&#39;s wearing.

&amp;lt;A potential Controller has your name and face,&gt; Tobias points out, returning to the sill.

“So does Chapman,” Rachel shrugs. “So long as she doesn&#39;t see me do anything suspicious we&#39;re fine.”

The Animorphs help you go through your stuff. Beyond a few snarky comments at your Sharing pamphlets and Jeremy Jason McCole poster, they don&#39;t have much insight. There&#39;s nothing in your room that remotely supports your story about being trapped in a book series; no such books, no notes or diaries mentioning them, no future technology or anything to indicate you might know anything from the future.

Nothing but the memories in your head. The clear fact that you did know who the Animorphs were, and that you knew about David when they didn&#39;t.

&amp;lt;Sounds like an ellimist thing to me,&gt; Tobias says.

“I am really starting to dislike that guy,” Rachel sighs.

&amp;lt;Starting to? I started to dislike him that time he stopped time at the Yeerk Pool. This is getting downright obnoxious.&gt;

“Well, we turn it to our advantage. Like we always do with that guy.” Rachel meets your eyes. “Lorraine, you know the future, right? You know if it&#39;s good or bad, and if it&#39;s bad, you must have a pretty good idea of how to change it. Tell me. Do we win? In this, uh, book series of yours, do we live happily ever after?”

[[Tell Rachel the truth about her fate-&gt;Chapter 155]]

[[Tell Rachel the Animorphs win but omit the detail of her death-&gt;Chapter 156]]</tw-passagedata><tw-passagedata pid="169" name="Chapter 9" tags="penultimate" position="3725,625" size="100,100">The first step to tracking down the Chee is the same step that you read about the Animorphs taking – looking Erek up in the phone book. You do so, narrow the search down to the King houses in the Truman school district, and get on a bus to go see them. You don&#39;t recall anybody ever mentioning Erek&#39;s mother, so you&#39;re pretty sure you&#39;re looking for a house with a single father and his only son. The first King is an old woman; you dismiss that place out of hand. The second King household is in a state of some disrepair, and you&#39;re pretty sure you remember Erek&#39;s household as being described as neat and well-maintained. That gets struck off the list. It takes you a while to find the right place. You wait for a teenage boy to walk down the garden path and head inside and give him a few minutes to get settled before ringing the doorbell. The same boy answers the door and looks you up and down.

“Can I help you?” he asks.

“I&#39;m looking for an Erek King,” you explain.

“I&#39;m Erek King.”

The moment of truth is here – you need to decide how to present your case.

[[Threaten the Chee into helping you-&gt;Chapter 16]]

[[Be as nonthreatening as possible and request help-&gt;Chapter 17]]</tw-passagedata><tw-passagedata pid="170" name="Chapter 90" tags="Reboot-Ending" position="4975,3450" size="100,100">(set: $c90ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

The hatch is easy to open. The inside clearly wasn&#39;t designed for a human, but it&#39;s familiar enough; something soft and seat-like sits under a large window, and some kind of computer is in front of it. Behind it are a few more seats with a safety restraint system that a glance tells you would not be useful at all for a human.

The computer is incomprehensible to you, but next to it is a long lever. You pull it, and the pod detaches. Too late, you realise you have no idea how to pilot it.

You also have no idea how to set any of the environmental controls, which you realise when the air starts to get stale. You still haven&#39;t found a solution when you pass out.

//Is it still breathing??

It is stabilising... Reconnecting...

Checking neurostimultion. Networks still active. Preparing to [[start again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="171" name="Chapter 91" tags="penultimate" position="5200,3800" size="100,100">You don&#39;t know how to use the escape pods. You push on.

Eventually, the corridor widens, opening into long, curved a room. A clear path continues through the middle, as if somebody had put rooms on either side without bothering to erect walls to separate it from the corridor. On either side are benches. Tanks. Cages. Most of them have something living inside.

There&#39;s an empty steel bench nearby with restraints on the edges. They look about accurately placed to hold a human.

To your left, something snarls. A small animal the approximate size and shape of a dog crouches in a cage that is far too small for it, baring its teeth at you.

**She asks you to let her out.** The message assaults all of your senses at once, and it takes a moment for you to place it; a jellyfish-like being hangs from the top of a tank next to the cage, gripping some kind of rail on the top with two slothlike arms. It gestures vaguely with some of its many tentacles toward the dog-thing and blinks at you with two bulbous eyes.

Down the other end of the room, something cries. You recognise it at once. It&#39;s a human baby, lying in some kind of transparent box.

[[Rescue the baby first-&gt;Chapter 122]]

[[Rescue the dog thing first-&gt;Chapter 123]]</tw-passagedata><tw-passagedata pid="172" name="Chapter 92" tags="" position="950,500" size="100,100">You tell David that you know people who can prove what you&#39;re saying. He looks doubtful. Only when you say they&#39;ll pay a lot of money for the device does he relent. You agree to meet up the next day after school and take him to see them.

He meets you at the school gate, empty-handed. You ask where the cube is. He rolls his eyes.

“I&#39;m not bringing it here if it&#39;s worth money,” he points out. “I want to meet these kids first. After we&#39;ve got a deal, we can do the exchange.”

The obvious person to approach would be Jake, but you don&#39;t want to corner him at school and he lives with a Controller. Besides, you don&#39;t know his address. Instead you look up the Wildlife Rehabilitation Centre in the phone book and bus out there. Cassie&#39;s dad takes the news that you&#39;re there to see Cassie without question and leads the both of you out to the barn, where she is checking the wing of some kind of large, predatory bird. She hides her surprise over your presence well, carefully puts the bird back in its cage, and waits for her father to leave.

She glances from David to you. She picks up a large knife and starts cutting lengths of twine with it, but she&#39;s not focused on the twine. She&#39;s focused on you.

“What brings you all the way out here, Lorraine?” she asks, tension in her voice.

[[Tell her about David and the box-&gt;Chapter 99]]

[[Tell her that you&#39;re trapped in a children&#39;s fiction series-&gt;Chapter 100]]</tw-passagedata><tw-passagedata pid="173" name="Chapter 93" tags="penultimate" position="6725,3575" size="100,100">You report back to the others. The scout of the construction site didn&#39;t turn up much, but Marco did. David Jackson has just enrolled in your school, and Marco has his address.

You head over, making a plan on the way. The Animorphs will sneak in while you, not having alien shapeshifting powers, play lookout. Nobody&#39;s home when you arrive, so you find some bushes to hide in while the Animorphs head inside.

They&#39;ve barely been searching ten minutes when a car pulls into the driveway and a man steps out. Probably David&#39;s father, judging by the age. He heads towards the door, cautious and purposeful, and you notice something in his hand, something he&#39;s raising as he heads inside.

He&#39;s holding a gun.

[[Try to warn the Animorphs-&gt;Chapter 111]]

[[Stay hidden-&gt;Chapter 112]]</tw-passagedata><tw-passagedata pid="174" name="Chapter 94" tags="penultimate" position="5850,1850" size="100,100">The Animorphs, in a gesture of trust, untie you for the night and tell you that they&#39;ll go ahead with the plan the next day. It&#39;s clearly a symbolic gesture as you&#39;re pretty much lost in the forest anyway, and even if you did try to escape, Ax and Tobias would probably be on guard all night, but it&#39;s much more comfortable than sleeping tied to a chair.

The next day, they tell you that you will be helping them break into the Yeerk Pool.

They&#39;re still trying to protect their identities from you, so you take the bus into the city alone, followed by birds. You don&#39;t see them demorph and remorph; Ax merely meets you in the bathroom with a handful of ticks, instructs you to shield them in you mouth as you walk through the biofilter (which feels very gross), and gives you some very dire and explicit warnings about exactly what he&#39;ll do to you if you attempt to cause any harm to the team, before morphing tick himself. As you step through the filter, it occurs to you that for all their talk about not being able to trust you, the Animorphs are taking it on faith that you won&#39;t simply squish them. Perhaps they&#39;re very confident in their ability to quickly demorph. Or perhaps whatever blow you&#39;re helping them strike against the Yeerks is just that important.

Nobody questions your presence. Most of the Controllers don&#39;t know you, and the few that do assume you&#39;re down there for trap-related reasons. Under Jake&#39;s instruction, you find a bathroom and place the ticks on the floor in an empty stall. You duck under the locked stall door and walk out.

You head for the other end of the Pool as quickly as you can without drawing suspicion. You don&#39;t want to be anywhere near the Animorphs when the fighting starts. Of course the Yeerks will soon realise that you&#39;re involved, but there&#39;s no reason to hasten that conclusion.

Somewhere behind you, all too soon, a tiger roars.

And then you can break into a run, because everyone is running; Controllers running to arm themselves, voluntary hosts running to hide behind something, somebody pushes a Dracon beam into your hand, a voice that you vaguely recognise as belonging to a fairly high-ranking military coordinator is shouting orders, Hork-Bajir are dashing past towards the wild animals.

A leopard leaps past you, into a group of human-Controllers. It&#39;s followed by a Hork-Bajir, one who must be an Animorph judging by the Dracon beams being aimed at it, but nobody in your group of human-Controllers seems to be a trained combatant and they&#39;re hurting each other as much as the Hork-Bajir, who quickly grabs a human shield from the crowd and barrels for the exit. You glimpse his shocked panicked face as he&#39;s pulled in front of the Hork-Bajir, and he fits into your memories, explaining why everyone around you suddenly hesitates to shoot – he&#39;s not a major player, but he&#39;s reasonably ranked, high enough that nobody wants to take the rap for killing him. You know his host&#39;s name, too; it settles into your mind as his face slots into your memories.

Tom Berenson.

A mess of animals, humans and aliens is bolting for a nearby tunnel; you back off. Now is the ideal time to find an exit and leave before anyone pegs you as a traitor.

You dash for another exit, and quickly realise that you aren&#39;t the only person with that idea. A streak of blue leaps over you and lands badly, stumbling; Ax is missing a leg and a large, angry burn down one side of his body is impeding his movements. He&#39;s still faster than your little human legs, though, as he makes for an exit. A handful of Hork-Bajir-Controllers charge after him, ready to cut him to pieces, but they aren&#39;t fast enough.

Only one person is near the exit and charges forward to block his way. Somebody who should really be in a lab or his doctor&#39;s office, who wouldn&#39;t be in a fight like this if your attack hadn&#39;t caught the Pool by surprise. Unarmed, he steps forward to block Ax&#39;s way, determination in his bright blue eyes, eyes that settle more and more certainly into your memories every time you see them. Kiri – your Kiri – ready to do whatever he can to protect his people from these invaders.

Ax charges towards him. The Dracon beam is heavy in your hands. You have less than a second to act.

[[Shoot Ax and save Kiri-&gt;Chapter 137]]

[[Wait and let it play out-&gt;Chapter 148]]</tw-passagedata><tw-passagedata pid="175" name="Chapter 95" tags="" position="5175,2600" size="100,100">You&#39;re still frozen as Erek strides out of the office and back towards you. As he moves down the rows of computers, their screens go black. Some of the computers seem to be smoking. You note distantly that that&#39;s one good way to hide hacking as his hand, or at least the soft hologram wrapped around it, lands on your shoulder.

“You&#39;re not supposed to be in here,” he says quietly. He frowns at your stunned face. “You saw the files, didn&#39;t you?”

You nod.

“You realise what they contain?”

“Some,” you say.

Erek glances back at the office, then back to you. “Right now,” he says quietly with a tinge of urgency in his voice, “you need to hold it together long enough for us to get out of here. Can you do that? We need to get out of here, and then we can figure out what to do. Can you do that?”

“Yes,” you lie.

Erek sighs. He takes your hand and his hologram extends around you. “Just walk with me,” he says quietly. “I&#39;ll handle the rest.”

Protected by the hologram, you walk out, into the biofilter, up into the sunlight. You walk back to Erek&#39;s house and down into the basement. Chee are waiting in the dog park. Erek has a quick conversation with them before turning back to you.

“You&#39;ll have to wait here for a bit until we figure this out,” he explains. “This might take a week or two. If you give us your address, we can [[handle things at your home-&gt;Chapter 37]].”</tw-passagedata><tw-passagedata pid="176" name="Chapter 96" tags="penultimate" position="6075,2425" size="100,100">You rush out before Erek can see you, heading for the cafeteria. You pull your hood low. It was absurd, really, for Erek to expect you to blend in down there with just a hood to protect you; what if somebody recognises you? You&#39;ll have to be careful. Very careful.

Your feet know the way. Every step fits. This is a journey you&#39;ve made before. Those screams and wails for help, those shouts of furious anger, they&#39;re things you&#39;ve heard before. The huge pit of goo and Yeerks stretched out across the vast cavern, the piers leading onto it where Yeerks are dropped off and picked up, the cages… you&#39;ve seen this. It all fits into your memory, filling in gaps as you witness the things anew.

You don&#39;t remember whether you&#39;re usually inside or outside the cage. You suppose that you&#39;ll find out if you&#39;re caught. If you&#39;re caught, they&#39;ll throw you into one of those, and then you&#39;ll know whether the view from inside the bars is something you&#39;ve experienced before or not.

Heading for a populated area like the food court would be insane. Why would Erek, after seeing those files, send you there? He can&#39;t possibly want you to get captured; you know too much about the Chee.

It&#39;s hard to know just how much danger you&#39;re in. Somebody went to an effort to protect you. Somebody tampered with those computer files and somehow let you slip through the cracks and be free. How many people were involved? Would they, too, be in danger if somebody recognised you moving about down in the Pool and decided to investigate?

You could leave. Would the gleet biofilter let you through? If you were a Controller, it would have to, surely. You put one foot in front of the other. Yes; your memories should be able to lead you right to your exit.

“There you are,” Erek says quietly behind you. “We should leave.” He takes one look at your face and raises his eyebrows. “You read the files, didn&#39;t you?”

There&#39;s no point in trying to lie to him.

Erek speaks slowly, quietly, as if trying to avoid spooking a wild animal. “I know this is complicated and confusing. But we must leave, you understand? There&#39;ll be time enough to freak out later, when we&#39;re not surrounded by the enemy.”

Those words fit in your mind. You&#39;ve heard them before, in similar circumstances. Not spoken by Erek. Spoken by somebody else.

You ask what exactly he&#39;s going to do with you.

“Keep you safe from the Yeerks. They can&#39;t be allowed to have your secrets, and if they think you know something, they WILL make you talk. Lorraine, there is still so much we do not know here. So many things that you shouldn&#39;t know. We need to figure this out. But first, we need to make sure you&#39;re safe.” He reaches for your arm.

[[To trust the Chee-&gt;Chapter 108]]

[[Flee Erek and investigate alone-&gt;Chapter 109]]</tw-passagedata><tw-passagedata pid="177" name="Chapter 97" tags="Reboot-Ending" position="4075,3375" size="100,100">(set: $c97ending to true)
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))

The gun seems straightforward enough. Long barrel part, handle part, trigger. It&#39;s heavy and large, but the barrel itself is narrow, and the barrel sits in the middle of several flat, bright green rings. If it wasn&#39;t for the weight of it, you&#39;d swear it was some cheap plastic toy ray gun from the 80s.

There&#39;s a little switch on the side. You flick it, and sparks start jumping between the green rings. The weapon hums; you can feel the hum in your bones.

You take aim at the far wall, and pull the trigger.

In the sudden storm of heat, pressure and electricity that surround you, you realise that you don&#39;t know how to operate alien weaponry after all.

//How did it get here? Is it dead?

Not yet... Get it back online, we can still retrieve data...

How did it wake up?

It must be a glitch. We have to reset. We have to [[try again-&gt;Chapter 1]].//</tw-passagedata><tw-passagedata pid="178" name="Chapter 98" tags="penultimate" position="4275,3325" size="100,100">You get out of there, backtracking back to your room and taking the right-hand path. The path continues to sweep in a wide curve, occasionally dotted with doors that you can&#39;t open. Eventually, the corridor broadens suddenly into a long, curved room, about thirty metres long and with benches, cages and tanks against either side. The centre path is clear, as if somebody wanted the put narrow rooms on either side of the corridor and just didn&#39;t bother with the walls to separate them.

There are things in the room, living things. Animals. Specimens. You don&#39;t know the terminology. Something about the size and shape of a small dog sits in a far-too-small cage to your left, lip curled back to reveal long needlelike teeth, making some kind of shrieking whine in the back of its throat. Next to it, some kind of tentacled jellyfish thing with two sloth-like arms hangs from the roof of its tank by its long, curved nails, watching you with enormous mellow eyes. Its eyes bore into you, and its message seems to assault all of your senses at once.

**She asks you to release her,** it says, waving a tentacle vaguely at the snarling dog-thing.

At the far end of the room, something starts to cry. You recognise it immediately. A human baby, lying in some kind of plastic box.

[[Release the baby first-&gt;Chapter 120]]

[[Release the dog thing first-&gt;Chapter 121]]</tw-passagedata><tw-passagedata pid="179" name="Chapter 99" tags="penultimate" position="4875,2325" size="100,100">You introduce David and tell her about the box. Strangely, she doesn&#39;t ask any questions about how you met David, how you knew what the box was, or how you knew who she was. She just watches you quietly while you talk, and then for several seconds of uncomfortable silence afterward.

She looks to David. “You&#39;re selling this… item?”

“Oh, yeah. If you&#39;ve got the money for it.”

“A friend might. I&#39;ll call them over. Can you two wait here?” She strides out of the barn without another word. You and David are left to make awkward small talk for a while, which mostly consists of him wondering how much money he should ask for.

Eventually, Marco strides into the barn. You recognise him on sight, his face fitting into your memory, as somebody from school. He sits on a hay bale and watches the two of you. You can&#39;t help but feel like a lot more eyes are on you.

“Alright,” he says, “this box thing. Tell me about it.”

“Hang on,” David says, “who the hell are you?”

“Marco. I collect things. Where&#39;d you find it? What does it look like?”

David starts to look nervous. It seems like he wasn&#39;t expecting to be dragged off to a remote farm with people who would take his find quite this seriously. But after some prodding and some blatant lies about how much money Marco has, he reluctantly explains what he found and how, and that in the right lighting there are weird symbols that show up on it. At Cassie&#39;s request, he draws a few of them. The two Animorphs are quiet for a few moments.

“How much?” Marc asks.

“One thousand bucks,” David says with a grin.

“Five hundred,” Marco says.

“Deal.”

“Marco,” Cassie protests, “you can&#39;t – ”

Marco ignores her. “We can trade tomorrow,” he tells David. “Whenever and wherever you like.” The two talk time and place for a bit, eventually agree, and David leaves.

You turn to follow, only to feel a hand on your shoulder.

“We still gotta talk,” Marco says. Despite all the injured animals, the barn suddenly feels quiet. And vaguely threatening.

[[Tell the Animorphs that you know about them but don&#39;t know how-&gt;Chapter 146]]

[[Try to bluff your way out of the situation-&gt;Chapter 147]]</tw-passagedata><tw-passagedata pid="180" name="Landing Page" tags="Meta" position="5900,375" size="100,100">#Alternamorphs #1

##Through the Page

You&#39;re not yourself today. And nothing is as it&#39;s supposed to be.

&lt;hr&gt;

This is a Twine adaptation of &quot;Alternamorphs: Through the Page,&quot; a Choose Your Own Adventure-style Animorphs fanfic by Derin. It belongs to a larger series, &quot;Parting the Clouds,&quot; which is an Animorphs AU written from the POV of rationalist!Cassie, but prior knowledge is not absolutely necessary: I played this before I finished got very far into the series, and I was able to roll with the unexpected bits pretty easily. If anything, I think that they made the experience more interesting. 

|escafilFont&gt;[Besides some proofreading edits and the obvious change in format, the story has not been altered. If you notice any formatting problems or proofreading issues that have escaped me, then you can use this (link: &quot;Typo Report Form&quot;)[(open-url: &quot;https://docs.google.com/forms/d/e/1FAIpQLScER7uOhmXV9CF9PltUqU7zTojbXdA-JJ6Z4jPj5WtHQKerIg/viewform&quot;)] (it will open in a new tab).]

|escafilFont&gt;[If you install the Escafil font (preview (link: &quot;here&quot;)[(goto-url: &quot;https://old.reddit.com/r/Animorphs/comments/6i2h4p/animorphs_font/&quot;)], download (link: &quot;here&quot;)[(goto-url: &quot;https://u.pcloud.link/publink/show?code=XZsGMGZSUosnd0Gsdf77ByxFCAgs4Q5N8sy&quot;)]) then things will look very slightly nicer.]

**One final note:** If this is a game, then there is a True Ending that cannot be reached by playing by the rules. The same is true of the original version of this story, but discovering the True Ending will probably be easier there than here. 

[[Wake Up-&gt;Chapter 1]]</tw-passagedata><tw-passagedata pid="181" name="TODO" tags="Meta" position="5525,75" size="100,100"></tw-passagedata><tw-passagedata pid="182" name="Chapter 42" tags="" position="4450,4400" size="100,100">You open your eyes.

The room you&#39;re in is confined and the very walls vibrate, but the body you&#39;re in is your own. You didn&#39;t notice how much you&#39;d missed it. At first, you think you&#39;re tied down, but no; that&#39;s just the stiff tubes of fluid running into each of your limbs weighing you down. Despite the tubes, you know immediately that you&#39;re in no medical facility. The surface beneath you isn&#39;t a bed, but hard steel, more like an operating table. The room, though, is too small to be an operating theatre, and the humming of the walls around you does nothing to dispel that notion. You&#39;re naked, with your clothes and personal belongings piled in a corner, in front of some kind of strange computer that was not designed for human hands or eyes. From what&#39;s there, it looks like maybe you were out for a walk or headed to the shops or something, but you don&#39;t remember it.

Outside the room, something approaches.

[[Pretend to be asleep-&gt;Chapter 69]]

[[Collect your stuff and flee-&gt;Chapter 70]]</tw-passagedata><tw-passagedata pid="183" name="Startup" tags="startup" position="5700,300" size="100,100">(set: $normalEndings to (a: $c16ending, $c28ending, $c34ending, $c45ending, $c46ending, $c47ending, $c48ending, $c49ending, $c62ending, $c68ending, $c87ending, $c88ending, $c102ending, $c106ending, $c109ending, $c111ending, $c112ending, $c118ending, $c119ending, $c127ending, $c130ending, $c132ending, $c136ending, $c137ending, $c138ending, $c141ending, $c142ending, $c143ending, $c146ending, $c147ending, $c148ending, $c150ending, $c151ending, $c152ending, $c154ending, $c157ending, $c158ending, $c159ending, $c166ending, $c167ending, $c168ending, $c169ending, $c170ending, $c171ending, $c174ending, $c176ending, $c178ending, $c179ending))
(set: $secretEndings to (a: $c71ending, $c80ending, $c81ending, $c90ending, $c97ending, $c120ending, $c122ending, $c124ending))
(set: $c125ending to false)</tw-passagedata><tw-passagedata pid="184" name="Untitled Passage" tags="" position="4200,1525" size="100,100"></tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">(function(){"use strict";
var require,define;!function(){var e={},r={};require=function(i){var n=e[i];return n&&(r[i]=n[1].apply(void 0,n[0].map(require)),e[i]=void 0),r[i]},(define=function(r,i,n){if("function"==typeof r)return r();e[r]=[i,n]}).amd=!0}();/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.join);var A=Function.call.bind(Array.prototype.shift);var _=Math.max;var R=Math.min;var k=Math.floor;var L=Math.abs;var F=Math.exp;var D=Math.log;var z=Math.sqrt;var q=Function.call.bind(Object.prototype.hasOwnProperty);var W;var G=function(){};var H=S.Map;var V=H&&H.prototype["delete"];var B=H&&H.prototype.get;var U=H&&H.prototype.has;var $=H&&H.prototype.set;var J=S.Symbol||{};var X=J.species||"@@species";var K=Number.isNaN||function isNaN(e){return e!==e};var Z=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Y=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(K(t)){return t}return t<0?-1:1};var Q=function log1p(e){var t=Number(e);if(t<-1||K(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(D(1+t)/(1+t-1))};var ee=function isArguments(e){return g(e)==="[object Arguments]"};var te=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var re=ee(arguments)?ee:te;var ne={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var oe=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ie=typeof J==="function"&&typeof J["for"]==="function"&&ne.symbol(J());var ae=ne.symbol(J.iterator)?J.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ae="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ue=S.Reflect;var fe=String;var se=typeof document==="undefined"||!document?null:document.all;var ce=se==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==se};var le={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!le.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(ce(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===se},ToObject:function(e,t){return Object(le.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return le.IsCallable(e)},ToInt32:function(e){return le.ToNumber(e)>>0},ToUint32:function(e){return le.ToNumber(e)>>>0},ToNumber:function(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=le.ToNumber(e);if(K(t)){return 0}if(t===0||!Z(t)){return t}return(t>0?1:-1)*k(L(t))},ToLength:function(e){var t=le.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},GetIterator:function(e){if(re(e)){return new W(e,"value")}var t=le.GetMethod(e,ae);if(!le.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=le.Call(t,e);if(!le.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=le.ToObject(e)[t];if(ce(r)){return void 0}if(!le.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=le.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=le.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!le.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!le.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=le.IteratorNext(e);var r=le.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ue.construct){return ue.construct(e,t,o)}var i=o.prototype;if(!le.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=le.Call(e,a,t);return le.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!le.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[X];if(ce(n)){return t}if(!le.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=le.ToString(e);var i="<"+t;if(r!==""){var a=le.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!le.TypeIsObject(e)){return false}var t=e[J.match];if(typeof t!=="undefined"){return!!t}return ne.regex(e)},ToString:function ToString(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return fe(e)}};if(s&&ie){var pe=function defineWellKnownSymbol(e){if(ne.symbol(J[e])){return J[e]}var t=J["for"]("Symbol."+e);Object.defineProperty(J,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!ne.symbol(J.search)){var ve=pe("search");var ye=String.prototype.search;h(RegExp.prototype,ve,function search(e){return le.Call(ye,e,[this])});var he=function search(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,ve);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(ye,t,[le.ToString(e)])};oe(String.prototype,"search",he)}if(!ne.symbol(J.replace)){var be=pe("replace");var ge=String.prototype.replace;h(RegExp.prototype,be,function replace(e,t){return le.Call(ge,e,[this,t])});var de=function replace(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,be);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(ge,r,[le.ToString(e),t])};oe(String.prototype,"replace",de)}if(!ne.symbol(J.split)){var me=pe("split");var Oe=String.prototype.split;h(RegExp.prototype,me,function split(e,t){return le.Call(Oe,e,[this,t])});var we=function split(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,me);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(Oe,r,[le.ToString(e),t])};oe(String.prototype,"split",we)}var je=ne.symbol(J.match);var Se=je&&function(){var e={};e[J.match]=function(){return 42};return"a".match(e)!==42}();if(!je||Se){var Te=pe("match");var Ie=String.prototype.match;h(RegExp.prototype,Te,function match(e){return le.Call(Ie,e,[this])});var Ee=function match(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,Te);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(Ie,t,[le.ToString(e)])};oe(String.prototype,"match",Ee)}}var Pe=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in G||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in G||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ce=function(){return this};var Me=function(e){if(s&&!q(e,X)){m.getter(e,X,Ce)}};var xe=function(e,t){var r=t||function iterator(){return this};h(e,ae,r);if(!e[ae]&&ne.symbol(ae)){e[ae]=r}};var Ne=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ae=function createDataPropertyOrThrow(e,t,r){Ne(e,t,r);if(!le.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var _e=function(e,t,r,n){if(!le.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!le.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(q(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;oe(String,"fromCodePoint",function fromCodePoint(e){return le.Call(Re,this,arguments)})}var ke={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!le.SameValue(r,le.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return N(t,"")},raw:function raw(e){var t=arguments.length-1;var r=le.ToObject(e,"bad template");var raw=le.ToObject(r.raw,"bad raw value");var n=raw.length;var o=le.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=le.ToString(a);s=le.ToString(raw[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=le.ToString(f);M(i,c);a+=1}return N(i,"")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){oe(String,"raw",ke.raw)}b(String,ke);var Le=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Fe=Infinity;var De={repeat:function repeat(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);if(r<0||r>=Fe){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return Le(t,r)},startsWith:function startsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=le.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=_(le.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=le.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:le.ToInteger(o);var a=R(_(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(le.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=le.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){oe(String.prototype,"includes",De.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var ze=i(function(){return"/a/".startsWith(/a/)});var qe=a(function(){return"abc".startsWith("a",Infinity)===false});if(!ze||!qe){oe(String.prototype,"startsWith",De.startsWith);oe(String.prototype,"endsWith",De.endsWith)}}if(ie){var We=a(function(){var e=/a/;e[J.match]=false;return"/a/".startsWith(e)});if(!We){oe(String.prototype,"startsWith",De.startsWith)}var Ge=a(function(){var e=/a/;e[J.match]=false;return"/a/".endsWith(e)});if(!Ge){oe(String.prototype,"endsWith",De.endsWith)}var He=a(function(){var e=/a/;e[J.match]=false;return"/a/".includes(e)});if(!He){oe(String.prototype,"includes",De.includes)}}b(String.prototype,De);var Ve=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Be=new RegExp("(^["+Ve+"]+)|(["+Ve+"]+$)","g");var Ue=function trim(){return le.ToString(le.RequireObjectCoercible(this)).replace(Be,"")};var $e=["\x85","\u200b","\ufffe"].join("");var Je=new RegExp("["+$e+"]","g");var Xe=/^[-+]0x[0-9a-f]+$/i;var Ke=$e.trim().length!==$e.length;h(String.prototype,"trim",Ue,Ke);var Ze=function(e){return{value:e,done:arguments.length===0}};var Ye=function(e){le.RequireObjectCoercible(e);h(this,"_s",le.ToString(e));h(this,"_i",0)};Ye.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ze()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ze(e.substr(t,o))};xe(Ye.prototype);xe(String.prototype,function(){return new Ye(this)});var Qe={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!le.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(re(e)||le.GetMethod(e,ae))!=="undefined";var u,f,s;if(a){f=le.IsConstructor(r)?Object(new r):[];var c=le.GetIterator(e);var l,p;s=0;while(true){l=le.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){le.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=le.ToObject(e);u=le.ToLength(y.length);f=le.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ae(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!le.IsCallable(t)?new Array(e):le.Construct(t,[e]);for(var o=0;o<e;++o){Ae(n,o,arguments[o])}n.length=e;return n}};b(Array,Qe);Me(Array);W=function(e,t){h(this,"i",0);h(this,"array",e);h(this,"kind",t)};b(W.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof W)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=le.ToLength(t.length);if(e<r){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ze(o)}}this.array=void 0;return Ze()}});xe(W.prototype);var et=Array.of===Qe.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!et){oe(Array,"of",Qe.of)}var tt={copyWithin:function copyWithin(e,t){var r=le.ToObject(this);var n=le.ToLength(r.length);var o=le.ToInteger(e);var i=le.ToInteger(t);var a=o<0?_(n+o,0):R(o,n);var u=i<0?_(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:le.ToInteger(f);var c=s<0?_(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=le.ToObject(this);var o=le.ToLength(n.length);t=le.ToInteger(typeof t==="undefined"?0:t);r=le.ToInteger(typeof r==="undefined"?o:r);var i=t<0?_(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new W(this,"key")},values:function values(){return new W(this,"value")},entries:function entries(){return new W(this,"entry")}};if(Array.prototype.keys&&!le.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!le.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ae]){b(Array.prototype,{values:Array.prototype[ae]});if(ne.symbol(J.unscopables)){Array.prototype[J.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var rt=Array.prototype.values;oe(Array.prototype,"values",function values(){return le.Call(rt,this,arguments)});h(Array.prototype,ae,Array.prototype.values,true)}b(Array.prototype,tt);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}xe(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){var nt=Object.getPrototypeOf([].values());if(nt){xe(nt)}}var ot=function(){return a(function(){return Array.from({length:-1}).length===0})}();var it=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!ot||!it){oe(Array,"from",Qe.from)}var at=function(){return a(function(){return Array.from([0],void 0)})}();if(!at){var ut=Array.from;oe(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return le.Call(ut,this,arguments)}return t(ut,this,e)})}var ft=-(Math.pow(2,32)-1);var st=function(e,r){var n={length:ft};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!st(Array.prototype.forEach)){var ct=Array.prototype.forEach;oe(Array.prototype,"forEach",function forEach(e){return le.Call(ct,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.map)){var lt=Array.prototype.map;oe(Array.prototype,"map",function map(e){return le.Call(lt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.filter)){var pt=Array.prototype.filter;oe(Array.prototype,"filter",function filter(e){return le.Call(pt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.some)){var vt=Array.prototype.some;oe(Array.prototype,"some",function some(e){return le.Call(vt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.every)){var yt=Array.prototype.every;oe(Array.prototype,"every",function every(e){return le.Call(yt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduce)){var ht=Array.prototype.reduce;oe(Array.prototype,"reduce",function reduce(e){return le.Call(ht,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduceRight,true)){var bt=Array.prototype.reduceRight;oe(Array.prototype,"reduceRight",function reduceRight(e){return le.Call(bt,this.length>=0?this:[],arguments)})}var gt=Number("0o10")!==8;var dt=Number("0b10")!==2;var mt=y($e,function(e){return Number(e+0+e)===0});if(gt||dt||mt){var Ot=Number;var wt=/^0b[01]+$/i;var jt=/^0o[0-7]+$/i;var St=wt.test.bind(wt);var Tt=jt.test.bind(jt);var It=function(e,t){var r;if(typeof e.valueOf==="function"){r=e.valueOf();if(ne.primitive(r)){return r}}if(typeof e.toString==="function"){r=e.toString();if(ne.primitive(r)){return r}}throw new TypeError("No default value")};var Et=Je.test.bind(Je);var Pt=Xe.test.bind(Xe);var Ct=function(){var e=function Number(t){var r;if(arguments.length>0){r=ne.primitive(t)?t:It(t,"number")}else{r=0}if(typeof r==="string"){r=le.Call(Ue,r);if(St(r)){r=parseInt(C(r,2),2)}else if(Tt(r)){r=parseInt(C(r,2),8)}else if(Et(r)||Pt(r)){r=NaN}}var n=this;var o=a(function(){Ot.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new Ot(r)}return Ot(r)};return e}();Pe(Ot,Ct,{});b(Ct,{NaN:Ot.NaN,MAX_VALUE:Ot.MAX_VALUE,MIN_VALUE:Ot.MIN_VALUE,NEGATIVE_INFINITY:Ot.NEGATIVE_INFINITY,POSITIVE_INFINITY:Ot.POSITIVE_INFINITY});Number=Ct;m.redefine(S,"Number",Ct)}var Mt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Mt,MIN_SAFE_INTEGER:-Mt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:Z,isInteger:function isInteger(e){return Z(e)&&le.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&L(e)<=Number.MAX_SAFE_INTEGER},isNaN:K});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){oe(Array.prototype,"find",tt.find)}if([,1].findIndex(function(){return true})!==0){oe(Array.prototype,"findIndex",tt.findIndex)}var xt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Nt=function ensureEnumerable(e,t){if(s&&xt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var At=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var _t=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var Rt=function(e,t){var r=n(Object(t));var o;if(le.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),xt(t))}return p(P(r,o||[]),_t(t),e)};var kt={assign:function(e,t){var r=le.ToObject(e,"Cannot convert undefined or null to object");return p(le.Call(At,1,arguments),Rt,r)},is:function is(e,t){return le.SameValue(e,t)}};var Lt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(Lt){oe(Object,"assign",kt.assign)}b(Object,kt);if(s){var Ft={setPrototypeOf:function(e){var r;var n=function(e,t){if(!le.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||le.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var o=function(e,o){n(e,o);t(r,e,o);return e};try{r=e.getOwnPropertyDescriptor(e.prototype,"__proto__").set;t(r,{},null)}catch(i){if(e.prototype!=={}.__proto__){return}r=function(e){this.__proto__=e};o.polyfill=o(o({},null),e.prototype)instanceof e}return o}(Object)};b(Object,Ft)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Dt=!i(function(){return Object.keys("foo")});if(!Dt){var zt=Object.keys;oe(Object,"keys",function keys(e){return zt(le.ToObject(e))});n=Object.keys}var qt=i(function(){return Object.keys(/a/g)});if(qt){var Wt=Object.keys;oe(Object,"keys",function keys(e){if(ne.regex(e)){var t=[];for(var r in e){if(q(e,r)){M(t,r)}}return t}return Wt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var Gt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!Gt){var Ht=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Vt=Object.getOwnPropertyNames;oe(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=le.ToObject(e);if(g(t)==="[object Window]"){try{return Vt(t)}catch(r){return P([],Ht)}}return Vt(t)})}}if(Object.getOwnPropertyDescriptor){var Bt=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Bt){var Ut=Object.getOwnPropertyDescriptor;oe(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Ut(le.ToObject(e),t)})}}if(Object.seal){var $t=!i(function(){return Object.seal("foo")});if(!$t){var Jt=Object.seal;oe(Object,"seal",function seal(e){if(!le.TypeIsObject(e)){return e}return Jt(e)})}}if(Object.isSealed){var Xt=!i(function(){return Object.isSealed("foo")});if(!Xt){var Kt=Object.isSealed;oe(Object,"isSealed",function isSealed(e){if(!le.TypeIsObject(e)){return true}return Kt(e)})}}if(Object.freeze){var Zt=!i(function(){return Object.freeze("foo")});if(!Zt){var Yt=Object.freeze;oe(Object,"freeze",function freeze(e){if(!le.TypeIsObject(e)){return e}return Yt(e)})}}if(Object.isFrozen){var Qt=!i(function(){return Object.isFrozen("foo")});if(!Qt){var er=Object.isFrozen;oe(Object,"isFrozen",function isFrozen(e){if(!le.TypeIsObject(e)){return true}return er(e)})}}if(Object.preventExtensions){var tr=!i(function(){return Object.preventExtensions("foo")});if(!tr){var rr=Object.preventExtensions;oe(Object,"preventExtensions",function preventExtensions(e){if(!le.TypeIsObject(e)){return e}return rr(e)})}}if(Object.isExtensible){var nr=!i(function(){return Object.isExtensible("foo")});if(!nr){var or=Object.isExtensible;oe(Object,"isExtensible",function isExtensible(e){if(!le.TypeIsObject(e)){return false}return or(e)})}}if(Object.getPrototypeOf){var ir=!i(function(){return Object.getPrototypeOf("foo")});if(!ir){var ar=Object.getPrototypeOf;oe(Object,"getPrototypeOf",function getPrototypeOf(e){return ar(le.ToObject(e))})}}var ur=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&le.IsCallable(e.get)}();if(s&&!ur){var fr=function flags(){if(!le.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",fr)}var sr=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var cr=ie&&s&&function(){var e=/./;e[J.match]=false;return RegExp(e)===e}();var lr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var pr=lr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!lr||!pr){var vr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=le.RequireObjectCoercible(this);if(ne.regex(e)){return t(vr,e)}var r=fe(e.source);var n=fe(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,vr);RegExp.prototype.toString.prototype=void 0}if(s&&(!sr||cr)){var yr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var hr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var br=function(){return this.source};var gr=le.IsCallable(hr.get)?hr.get:br;var dr=RegExp;var mr=function(){return function RegExp(e,t){var r=le.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(ne.regex(e)){o=le.Call(gr,e);i=typeof t==="undefined"?le.Call(yr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new dr(e,t)}}();Pe(dr,mr,{$input:true});RegExp=mr;m.redefine(S,"RegExp",mr)}if(s){var Or={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(Or),function(e){if(e in RegExp&&!(Or[e]in RegExp)){m.getter(RegExp,Or[e],function get(){return RegExp[e]})}})}Me(RegExp);var wr=1/Number.EPSILON;var jr=function roundTiesToEven(e){return e+wr-wr};var Sr=Math.pow(2,-23);var Tr=Math.pow(2,127)*(2-Sr);var Ir=Math.pow(2,-126);var Er=Math.E;var Pr=Math.LOG2E;var Cr=Math.LOG10E;var Mr=Number.prototype.clz;delete Number.prototype.clz;var xr={acosh:function acosh(e){var t=Number(e);if(K(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Q(t-1+z(1-r)*t)}var n=t/2;return Q(n+z(1-r)*n-1)+1/Pr},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=L(t);var n=r*r;var o=Y(t);if(r<1){return o*Q(r+n/(z(n+1)+1))}return o*(Q(r/2+z(1+1/n)*r/2-1)+1/Pr)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(K(t)||t<-1||t>1){return NaN}var r=L(t);return Y(t)*Q(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(D(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=le.ToUint32(t);if(r===0){return 32}return Mr?le.Call(Mr,r):31-k(D(r+.5)*Pr)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(K(t)){return NaN}if(!T(t)){return Infinity}var r=F(L(t)-1);return(r+1/(r*Er*Er))*(Er/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(L(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=L(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*z(r)},log2:function log2(e){return D(e)*Pr},log10:function log10(e){return D(e)*Cr},log1p:Q,sign:Y,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=L(t);if(r<1){var n=Math.expm1(r);return Y(t)*n*(1+1/(n+1))/2}var o=F(r-1);return Y(t)*(o-1/(o*Er*Er))*(Er/2)},tanh:function tanh(e){var t=Number(e);if(K(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-k(-t):k(t)},imul:function imul(e,t){var r=le.ToUint32(e);var n=le.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||K(t)){return t}var r=Y(t);var n=L(t);if(n<Ir){return r*jr(n/Ir/Sr)*Ir*Sr}var o=(1+Sr/Number.EPSILON)*n;var i=o-(o-n);if(i>Tr||K(i)){return r*Infinity}return r*i}};var Nr=function withinULPDistance(e,t,r){return L(1-e/t)/Number.EPSILON<(r||8)};b(Math,xr);h(Math,"sinh",xr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",xr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",xr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",xr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));
h(Math,"asinh",xr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",xr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",xr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",xr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",xr.acosh,!Nr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",xr.cbrt,!Nr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",xr.sinh,Math.sinh(-2e-17)!==-2e-17);var Ar=Math.expm1(10);h(Math,"expm1",xr.expm1,Ar>22025.465794806718||Ar<22025.465794806718);h(Math,"hypot",xr.hypot,Math.hypot(Infinity,NaN)!==Infinity);var _r=Math.round;var Rr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var kr=wr+1;var Lr=2*wr-1;var Fr=[kr,Lr].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=k(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Rr||!Fr);m.preserveToString(Math.round,_r);var Dr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=xr.imul;m.preserveToString(Math.imul,Dr)}if(Math.imul.length!==2){oe(Math,"imul",function imul(e,t){return le.Call(Dr,Math,arguments)})}var zr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}le.IsPromise=function(e){if(!le.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!le.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(le.IsCallable(t.resolve)&&le.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&le.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=A(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=le.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(le.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!le.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!le.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!le.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=_e(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=le.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=le.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(le.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!le.IsPromise(n)){throw new TypeError("not a promise")}var o=le.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=le.IsCallable(e)?e:a;var d=le.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof zr==="function"){b(S,{Promise:zr});var qr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Wr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,G)});var Gr=i(function(){return S.Promise.call(3,G)});var Hr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,G).then(null,G)}catch(n){return true}return t===r}(S.Promise);var Vr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Br=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Br.prototype=Promise.prototype;Br.all=Promise.all;var Ur=a(function(){return!!Br.all([1,2])});if(!qr||!Wr||!Gr||Hr||!Vr||Ur){Promise=zr;oe(S,"Promise",zr)}if(Promise.all.length!==1){var $r=Promise.all;oe(Promise,"all",function all(e){return le.Call($r,this,arguments)})}if(Promise.race.length!==1){var Jr=Promise.race;oe(Promise,"race",function race(e){return le.Call(Jr,this,arguments)})}if(Promise.resolve.length!==1){var Xr=Promise.resolve;oe(Promise,"resolve",function resolve(e){return le.Call(Xr,this,arguments)})}if(Promise.reject.length!==1){var Kr=Promise.reject;oe(Promise,"reject",function reject(e){return le.Call(Kr,this,arguments)})}Nt(Promise,"all");Nt(Promise,"race");Nt(Promise,"resolve");Nt(Promise,"reject");Me(Promise)}var Zr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Yr=Zr(["z","a","bb"]);var Qr=Zr(["z",1,"a","3",2]);if(s){var en=function fastkey(e,t){if(!t&&!Yr){return null}if(ce(e)){return"^"+le.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Qr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var tn=function emptyObject(){return Object.create?Object.create(null):{}};var rn=function addIterableToMap(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){if(!le.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!ce(o)){a=n.set;if(!le.IsCallable(a)){throw new TypeError("bad map")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!le.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){le.IteratorClose(i,true);throw s}}}}};var nn=function addIterableToSet(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!ce(o)){a=n.add;if(!le.IsCallable(a)){throw new TypeError("bad set")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){le.IteratorClose(i,true);throw s}}}}};var on={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!le.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+le.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");h(this,"head",e._head);h(this,"i",this.head);h(this,"kind",t)};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ze()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ze(n)}}this.i=void 0;return Ze()}};xe(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=_e(this,Map,a,{_es6map:true,_head:null,_map:H?new H:null,_size:0,_storage:tn()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){rn(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=en(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}return}if(this._map){t=B.call(this._map,e);if(t){return t.value}return}var n=this._head;var i=n;while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=en(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return U.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(le.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=en(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}a=this._storage[u]=new r(e,t);i=n.prev}else if(this._map){if(U.call(this._map,e)){B.call(this._map,e).value=t}else{a=new r(e,t);$.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(le.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=en(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!U.call(this._map,t)){return false}n=B.call(this._map,t).prev;V.call(this._map,t)}while((n=n.next)!==r){if(le.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=H?new H:null;this._size=0;this._storage=tn();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});xe(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!le.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+le.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=_e(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:tn()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){nn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new on.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=en(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=en(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=en(e))!==null){var n=q(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=tn()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);xe(i.prototype,i.prototype.values);var f=function SetIterator(e){h(this,"it",e)};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};xe(f.prototype);return i}()};var an=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(an){S.Set=on.Set}if(S.Map||S.Set){var un=a(function(){return new Map([[1,2]]).get(1)===2});if(!un){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(H.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var fn=new Map;var sn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var cn=fn.set(1,2)===fn;if(!sn||!cn){oe(Map.prototype,"set",function set(e,r){t($,this,e===0?0:e,r);return this})}if(!sn){b(Map.prototype,{get:function get(e){return t(B,this,e===0?0:e)},has:function has(e){return t(U,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,B);m.preserveToString(Map.prototype.has,U)}var ln=new Set;var pn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(ln);var vn=ln.add(1)===ln;if(!pn||!vn){var yn=Set.prototype.add;Set.prototype.add=function add(e){t(yn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,yn)}if(!pn){var hn=Set.prototype.has;Set.prototype.has=function has(e){return t(hn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,hn);var bn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(bn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],bn)}var gn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var dn=Object.setPrototypeOf&&!gn;var mn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||dn||!mn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=H.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var On=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var wn=Object.setPrototypeOf&&!On;var jn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||wn||!jn){var Sn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new Sn;if(arguments.length>0){nn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=Sn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,Sn)}var Tn=new S.Map;var In=!a(function(){return Tn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||Tn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof Tn.keys().next!=="function"||In||!gn){b(S,{Map:on.Map,Set:on.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}xe(Object.getPrototypeOf((new S.Map).keys()));xe(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var En=S.Set.prototype.has;oe(S.Set.prototype,"has",function has(e){return t(En,this,e)})}}b(S,on);Me(S.Map);Me(S.Set)}var Pn=function throwUnlessTargetIsObject(e){if(!le.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Cn={apply:function apply(){return le.Call(le.Call,null,arguments)},construct:function construct(e,t){if(!le.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!le.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return le.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){Pn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){Pn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Cn,{ownKeys:function ownKeys(e){Pn(e);var t=Object.getOwnPropertyNames(e);if(le.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Mn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Cn,{isExtensible:function isExtensible(e){Pn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){Pn(e);return Mn(function(){return Object.preventExtensions(e)})}})}if(s){var xn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return xn(o,t,r)}if("value"in n){return n.value}if(n.get){return le.Call(n.get,r)}return void 0};var Nn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Nn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!le.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ue.defineProperty(o,r,{value:n})}return ue.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Cn,{defineProperty:function defineProperty(e,t,r){Pn(e);return Mn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){Pn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){Pn(e);var r=arguments.length>2?arguments[2]:e;return xn(e,t,r)},set:function set(e,t,r){Pn(e);var n=arguments.length>3?arguments[3]:e;return Nn(e,t,r,n)}})}if(Object.getPrototypeOf){var An=Object.getPrototypeOf;Cn.getPrototypeOf=function getPrototypeOf(e){Pn(e);return An(e)}}if(Object.setPrototypeOf&&Cn.getPrototypeOf){var _n=function(e,t){var r=t;while(r){if(e===r){return true}r=Cn.getPrototypeOf(r)}return false};Object.assign(Cn,{setPrototypeOf:function setPrototypeOf(e,t){Pn(e);if(t!==null&&!le.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ue.getPrototypeOf(e)){return true}if(ue.isExtensible&&!ue.isExtensible(e)){return false}if(_n(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Rn=function(e,t){if(!le.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){oe(S.Reflect,e,t)}}};Object.keys(Cn).forEach(function(e){Rn(e,Cn[e])});var kn=S.Reflect.getPrototypeOf;if(c&&kn&&kn.name!=="getPrototypeOf"){oe(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(kn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){oe(S.Reflect,"setPrototypeOf",Cn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){oe(S.Reflect,"defineProperty",Cn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){oe(S.Reflect,"construct",Cn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Ln=Date.prototype.toString;var Fn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return le.Call(Ln,this)};oe(Date.prototype,"toString",Fn)}var Dn={anchor:function anchor(e){return le.CreateHTML(this,"a","name",e)},big:function big(){return le.CreateHTML(this,"big","","")},blink:function blink(){return le.CreateHTML(this,"blink","","")},bold:function bold(){return le.CreateHTML(this,"b","","")},fixed:function fixed(){return le.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return le.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return le.CreateHTML(this,"font","size",e)},italics:function italics(){return le.CreateHTML(this,"i","","")},link:function link(e){return le.CreateHTML(this,"a","href",e)},small:function small(){return le.CreateHTML(this,"small","","")},strike:function strike(){return le.CreateHTML(this,"strike","","")},sub:function sub(){return le.CreateHTML(this,"sub","","")},sup:function sub(){return le.CreateHTML(this,"sup","","")}};l(Object.keys(Dn),function(e){var r=String.prototype[e];var n=false;if(le.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){oe(String.prototype,e,Dn[e])}});var zn=function(){if(!ie){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e(J())!=="undefined"){return true}if(e([J()])!=="[null]"){return true}var t={a:J()};t[J()]=true;if(e(t)!=="{}"){return true}return false}();var qn=a(function(){if(!ie){return true}return JSON.stringify(Object(J()))==="{}"&&JSON.stringify([Object(J())])==="[{}]"});if(zn||!qn){var Wn=JSON.stringify;oe(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=le.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(ne.symbol(n)){return _t({})(n)}return n}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Wn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(ie,e){"use strict";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement("script");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[i.call(e)]||"object":typeof e}var t="3.7.1",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:"jQuery"+(t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==i.call(e))&&(!(t=r(e))||"function"==typeof(n=ue.call(t,"constructor")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(!i)while(t=e[r++])n+=ce.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),"function"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge="[\\x20\\t\\r\\n\\f]",ve=new RegExp("^"+ge+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ge+"+$","g");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function p(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}ce.escapeSelector=function(e){return(e+"").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="(?:\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",p="\\["+ge+"*("+t+")(?:"+ge+"*([*^$|!~]?=)"+ge+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+t+"))|)"+ge+"*\\]",g=":("+t+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+p+")*)|.*)\\)|)",v=new RegExp(ge+"+","g"),y=new RegExp("^"+ge+"*,"+ge+"*"),m=new RegExp("^"+ge+"*([>+~]|"+ge+")"+ge+"*"),x=new RegExp(ge+"|>"),j=new RegExp(g),A=new RegExp("^"+t+"$"),D={ID:new RegExp("^#("+t+")"),CLASS:new RegExp("^\\.("+t+")"),TAG:new RegExp("^("+t+"|[*])"),ATTR:new RegExp("^"+p),PSEUDO:new RegExp("^"+g),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ge+"*(even|odd|(([+-]|)(\\d*)n|)"+ge+"*(?:([+-]|)"+ge+"*(\\d+)|))"+ge+"*\\)|)","i"),bool:new RegExp("^(?:"+f+")$","i"),needsContext:new RegExp("^"+ge+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ge+"*((?:-\\d)?\\d*)"+ge+"*\\)|)(?=[^-]|$)","i")},N=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,L=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,H=/[+~]/,O=new RegExp("\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\([^\\r\\n\\f])","g"),P=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},M=function(){V()},R=J(function(e){return!0===e.disabled&&fe(e,"fieldset")},{dir:"parentNode",next:"legend"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+" "]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&U(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute("id"))?s=ce.escapeSelector(s):e.setAttribute("id",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+Q(l[o]);c=l.join(",")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return re(t.replace(ve,"$1"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,"input")&&e.type===t}}function _(t){return function(e){return(fe(e,"input")||fe(e,"button"))&&e.type===t}}function z(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&R(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function X(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function U(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,r.msMatchesSelector&&ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener("unload",M),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,"*")}),le.scope=$(function(){return T.querySelectorAll(":scope")}),le.cssHas=$(function(){try{return T.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if("undefined"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML="<a id='"+S+"' href='' disabled='disabled'></a><select id='"+S+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+ge+"*(?:value|"+f+")"),e.querySelectorAll("[id~="+S+"-]").length||d.push("~="),e.querySelectorAll("a#"+S+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=T.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+ge+"*name"+ge+"*="+ge+"*(?:''|\"\")")}),le.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+" "]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||"").replace(O,P),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return"*"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+" "];return t||(t=new RegExp("(^|"+ge+")"+e+"("+ge+"|$)"))&&s(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(v," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(d,e,t,h,g){var v="nth"!==d.slice(0,3),y="last"!==d.slice(-4),m="of-type"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?"nextSibling":"previousSibling",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u="only"===d&&!s&&"nextSibling"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,"$1"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,"input")&&!!e.checked||fe(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,"input")&&"button"===e.type||fe(e,"button")},text:function(e){var t;return fe(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:X(function(){return[0]}),last:X(function(e,t){return[t-1]}),eq:X(function(e,t,n){return[n<0?n+t:n]}),even:X(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:X(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:X(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:X(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve," ")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&"parentNode"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(ve,"$1"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+" "];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&U(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&U(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split("").sort(l).join("")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce.find=I,ce.expr[":"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.tokenize=Y,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):"string"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,"string"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,"parentNode")},parentsUntil:function(e,t,n){return d(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return d(e,"nextSibling")},prevAll:function(e){return d(e,"previousSibling")},nextUntil:function(e,t,n){return d(e,"nextSibling",n)},prevUntil:function(e,t,n){return d(e,"previousSibling",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,"template")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\x20\t\r\n\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[["notify","progress",ce.Callbacks("memory"),ce.Callbacks("memory"),2],["resolve","done",ce.Callbacks("once memory"),ce.Callbacks("once memory"),0,"resolved"],["reject","fail",ce.Callbacks("once memory"),ce.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener("DOMContentLoaded",P),ie.removeEventListener("load",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)["catch"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener("DOMContentLoaded",P),ie.addEventListener("load",P));var M=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)M(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},R=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(R,"ms-").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,z=new B,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,U=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(U,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:X.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){z.set(this,n)}):M(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks("once memory").add(function(){_.remove(e,[t+"queue",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=_.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&K(e)&&"none"===ce.css(e,"display")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,"")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?"":"px"),c=e.nodeType&&(ce.cssNumber[t]||"px"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=_.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ne[s]=u)))):"none"!==n&&(l[c]="none",_.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement("div")),(be=C.createElement("input")).setAttribute("type","radio"),be.setAttribute("checked","checked"),be.setAttribute("name","t"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML="<option></option>",le.option=!!xe.lastChild;var ke={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Se(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],"globalEval",!t||_.get(t[n],"globalEval"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,"<select multiple='multiple'>","</select>"]);var je=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement("div")),s=(Te.exec(o)||["",""])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),"script"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||"")&&n.push(o)}return f}var De=/^([^.]*)(?:\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(D)||[""]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(D)||[""]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,"events")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,"input")&&_.get(t,"click")||fe(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:"focusin",blur:"focusout"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,"handle"),n=ce.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\s*(?:[^=]|=\s*.checked.)/i,Me=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Re(e,t){return fe(e,"table")&&fe(11!==t.nodeType?t:t.firstChild,"tr")&&ce(e).children("tbody")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function We(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&"string"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,"script"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||"")&&!_.access(u,"globalEval")&&ce.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):m(u.textContent.replace(Me,""),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,"script")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,"script")).length&&Ee(a,!f&&Se(e,"script")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return M(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return M(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||["",""])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),ze=/^--/,Xe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join("|"),"i");function Ge(e,t,n){var r,i,o,a,s=ze.test(t),u=e.style;return(n=n||Xe(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,"$1")||void 0),""!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement("div"),l=C.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement("table"),t=C.createElement("tr"),n=C.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=["Webkit","Moz","ms"],Je=C.createElement("div").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function it(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?("content"===n&&(u-=ce.css(e,"padding"+Q[a],!0,i)),"margin"!==n&&(u-=ce.css(e,"border"+Q[a]+"Width",!0,i))):(u+=ce.css(e,"padding"+Q[a],!0,i),"padding"!==n?u+=ce.css(e,"border"+Q[a]+"Width",!0,i):s+=ce.css(e,"border"+Q[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Xe(e),i=(!le.boxSizingReliable()||n)&&"border-box"===ce.css(e,"boxSizing",!1,r),o=i,a=Ge(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a="auto"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===ce.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===ce.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?"border":"content"),o,r,a)+"px"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=ze.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?"":"px")),le.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return ze.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in nt&&(i=nt[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each(["height","width"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):Ue(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Xe(e),o=!le.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===ce.css(e,"boxSizing",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,"border",!1,i)-.5)),s&&(r=Y.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ce.each({margin:"",padding:"",border:"Width"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return M(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Xe(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=Q[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,"fxshow");for(r in n.queue||(null==(a=ce._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,"display")),"none"===(c=ce.css(e,"display"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,"display"),re([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===ce.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=_.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,"fxshow"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&"object"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=_.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each(["toggle","show","hide"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement("input"),ct=C.createElement("select").appendChild(C.createElement("option")),lt.type="checkbox",le.checkOn=""!==lt.value,le.optSelected=ct.selected,(lt=C.createElement("input")).value="t",lt.type="radio",le.radioValue="t"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return M(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&"radio"===t&&fe(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return M(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,"tabindex");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=Ct(this))&&_.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":_.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+Tt(Ct(n))+" ").indexOf(t))return!0;return!1}});var St=/\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?"":e+""})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(St,""):null==e?"":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,"value");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,"optgroup"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\?/;ce.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||ce.error("Invalid XML: "+(n?ce.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,"type")?e.type:e,h=ue.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[ce.expando]?e:new ce.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,"events")||Object.create(null))[e.type]&&_.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\[\]$/,Lt=/\r?\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==x(e))i(n,e);else for(t in e)Pt(n+"["+t+"]",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join("&")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,"\r\n")}}):{name:t.name,value:n.replace(Lt,"\r\n")}}).get()}});var Mt=/%20/g,Rt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\/\//,Bt={},_t={},zt="*/".concat("*"),Xt=C.createElement("a");function Ut(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Xt.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:Ut(Bt),ajaxTransport:Ut(_t),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace($t,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(D)||[""],null==v.crossDomain){r=C.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Xt.protocol+"//"+Xt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Rt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Mt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(At.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,"$1"),o=(At.test(f)?"&":"?")+"_="+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader("If-Modified-Since",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader("If-None-Match",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+zt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray("script",v.dataTypes)&&ce.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(ce.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--ce.active||ce.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,"json")},getScript:function(e,t){return ce.get(e,void 0,t,"script")}}),ce.each(["get","post"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&"withCredentials"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ce.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\?(?=&|$)|\?\?/;ce.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Kt.pop()||ce.expando+"_"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,"$1"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||ce.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),"script"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&ce.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?ce("<div>").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,"position"),c=ce(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=ce.css(e,"top"),u=ce.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===ce.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===ce.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,"borderTopWidth",!0),i.left+=ce.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-ce.css(r,"marginTop",!0),left:t.left-i.left-ce.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===ce.css(e,"position"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;ce.fn[t]=function(e){return M(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each(["top","left"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+"px":t})}),ce.each({Height:"height",Width:"width"},function(a,s){ce.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return M(this,function(e,t,n){var r;return y(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),ce.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},"undefined"==typeof e&&(ie.jQuery=ie.$=ce),ce});
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,r,a,o,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){r=!0,a=e},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw a}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}define("engine",["jquery","utils","state","section","passages"],function(N,j,P,R,I){var t,V=j.impossible,M=j.passageSelector,D=j.transitionOut,F=j.options;function L(e,t,n){var r,a,o;if(n?(n=n.get("name"),(a=I.getTree(n)).children.length&&(r={type:"include",tag:t,name:n,children:a.children,text:a.text})):r=I.getTree(t),r){for(;(o=e[e.length-1])&&("root"===o.type||"include"===o.type)&&o.children.some(function(e){return e.type.startsWith("unclosed")});)e[e.length-1]=Object.create(o),e=e[e.length-1].children=o.children.slice();e.push(r)}}function n(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.loadedGame,a=I.get(e),o=j.storyElement,i=o.parent(),s=n.stretch,n=n.transition,n=void 0===n?{}:n,c=n.depart,c=void 0===c?"instant":c,l=n.arrive,l=void 0===l?"dissolve":l,u=n.departOrigin,p=n.arriveOrigin,n=n.time,d=(i.findAndFilter("tw-enchantment").each(function(e,t){var n=(t=N(t)).data("enchantedProperties");n&&o.css(n.reduce(function(e,t){return e[t]="",e},{})),t[0]===i[0]&&(i=o.unwrap().parent())}),I.hasValid(e)||V("Engine.showPassage","There's no passage with the name \""+e+'"!'),o.children(M).not(".transition-out, .transition-out *")),a=(a.get("tags")||[]).join(" "),f=(t=N("<tw-passage><tw-sidebar>"),f=t.children("tw-sidebar"),h=N('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),g=N('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),P.pastLength<=0&&h.css("visibility","hidden"),P.futureLength<=0&&g.css("visibility","hidden"),f.append(h,g),t),h=("function"==typeof u&&(u=u.call(d)),"function"==typeof p&&(p=p.call(f)),!s&&c),m=h&&d.css("width"),g=(j.detachStoryElement(),f.appendTo(o).attr({tags:a}),h&&(D(d,c,n,0,0,0,u),d.css({position:"absolute",width:function(){return"0px"!==m?m:"100%"}})),o.attr({tags:a}),R.create(f)),y=(r&&(g.loadedGame=!0),[]);if(P.pastLength<=0&&1===P.turns){var b,v=_createForOfIteratorHelper(I.getTagged("startup"));try{for(v.s();!(b=v.n()).done;)L(y,"startup",b.value)}catch(e){v.e(e)}finally{v.f()}if(F.debug){var w,k=_createForOfIteratorHelper(I.getTagged("debug-startup"));try{for(k.s();!(w=k.n()).done;)L(y,"debug-startup",w.value)}catch(e){k.e(e)}finally{k.f()}}}var S,T=_createForOfIteratorHelper(I.getTagged("header"));try{for(T.s();!(S=T.n()).done;)L(y,"header",S.value)}catch(e){T.e(e)}finally{T.f()}if(F.debug){var _,x=_createForOfIteratorHelper(I.getTagged("debug-header"));try{for(x.s();!(_=x.n()).done;)L(y,"debug-header",_.value)}catch(e){x.e(e)}finally{x.f()}}L(y,e);var O,A=_createForOfIteratorHelper(I.getTagged("footer"));try{for(A.s();!(O=A.n()).done;)L(y,"footer",O.value)}catch(e){A.e(e)}finally{A.f()}if(F.debug){var C,E=_createForOfIteratorHelper(I.getTagged("debug-footer"));try{for(E.s();!(C=E.n()).done;)L(y,"debug-footer",C.value)}catch(e){E.e(e)}finally{E.f()}}g.renderInto(y,f,{transition:l,transitionTime:n,transitionOrigin:p}),g.loadedGame=!1,j.reattachStoryElement(),scroll(0,s?f.offset().top-.05*N(window).height():o[0].getBoundingClientRect().top+document.body.scrollTop)}return Object.freeze({goBack:function(e){P.rewind()&&n(P.passage,e)},goForward:function(e){P.fastForward()&&n(P.passage,e)},goToPassage:function(e,t){P.play(e),n(e,t)},redirect:function(e,t){P.redirect(e),n(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:n,enableDebugMode:function(){t&&t()},registerDebugMode:function(e){t=t||e}})}),define("harlowe",["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","utils/jqueryplugins","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref,VarScope){var dialog=_ref.dialog;function __HarloweEval(text){eval(text+"")}function printJSError(e){var t,n="".concat(e.name,": ").concat(e.message);return e.stack&&(t=(e=e.stack.split("\n")).findIndex(function(e){return e.includes("__HarloweEval")}),n+="\n".concat(e.slice(0,t).join("\n").replace(/\([^)]+\)/g,""))),"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+n+"```</div>"}!function(o){window.onerror=function(e,t,n,r,a){window.onerror=o,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n".concat(printJSError(a),"\n(This is probably due to a bug in the Harlowe game engine.)")}).addClass("harlowe-crash")),"function"==typeof o&&o.apply(void 0,arguments)}}(window.onerror),Utils.onStartup(function(){var n,e,t,r,a=$("tw-storydata");0!==a.length&&(Utils.options.ifid=a.attr("ifid"),(a.attr("tags")||"").split(/\s/).forEach(function(e){"uncompressed-pure-values"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedPureValues=!0),"uncompressed-structures"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedStructures=!0)}),(a.attr("options")||"").split(/\s/).forEach(function(e){e&&(Utils.options[e]=!0),"debug"===e&&DebugMode()}),a=(a=a.attr("startnode"))||[].reduce.call($("tw-passagedata"),function(e,t){t=t.getAttribute("pid");return t<e?t:e},1/0),a=$("tw-passagedata[pid='"+a+"']").attr("name"),$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),n=!1,$("[role=script]").each(function(t){try{__HarloweEval($(this).html())}catch(e){n||(n=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(t+1)+" script:\n\n"+printJSError(e)}))}}),$("[role=stylesheet]").each(function(e,t){$(document.head).append("<style data-title=\"Story stylesheet '".concat(e+1,"'\">").concat($(t).html()))}),(e=Section.create()).stack=[{tempVariables:Object.create(VarScope)}],(r=Passages.loadMetadata(e)).length&&(t=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"}),r.forEach(function(e){return t.find("p").append(e.render())})),(r=!Utils.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session"))&&!0===State.deserialise(e,r)?Engine.showPassage(State.passage):Engine.goToPassage(a))})}),define("macros",["utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/twineerror"],function(g,e,t,o,r,y,b,p,v){var w=e.insensitiveName,k=e.nth,S=e.andList,T=t.objectName,_=t.typeName,d=t.toSource,x=Array.isArray,i={};function O(e){return e===s.TypeSignature.Any||(x(e.innerType)?e.innerType.some(O):!!e.innerType&&O(e.innerType))}function a(e,t,n,r){var a,o,i,s,c,l,u,p,d=t.fn,f=t.typeSignature,h=t.returnType,m=(r=function(e){for(var t,n,r,a=[],o=0;o<e.length;o+=1)o in e&&(!0===(null==(t=e[o])?void 0:t.spreader)?(n=t.value,(r=v.containsError(n))?a.push(r):x(n)||"string"==typeof n?a.push.apply(a,_toConsumableArray(n)):n instanceof Set?a.push.apply(a,_toConsumableArray(Array.from(n).sort(g("en")))):a.push(v.create("operation","I can't spread out "+T(n)+", because it is not a string, dataset, or array."))):a.push(t));return a}(r),"string"!=typeof e&&(a=e,e=""),a?"":"("+(x(e)&&1<e.length?e[0]:e)+":)");for(e=a?a.TwineScript_KnownName?"the custom macro, ".concat(a.TwineScript_KnownName):"an unnamed custom macro":"the ".concat(m," macro"),o=0<f.length?1===f.length&&O(f[0])?1===r.length?"That value can't be given to macros as-is.":"Give only a single value to this macro.":e+" must only be given "+S(f.map(_))+(1<f.length?", in that order":"."):e+" must not be given any data."+(a?"":" Just write "+m),s=0,c=Math.max(r.length,f.length);s<c;s+=1){if(p=f[s],l=r[s],v.containsError(l))return l;if(s>=f.length&&!i)return v.create("datatype",r.length-f.length+" too many values were given to "+e+".",o);if(!(p=p||i).innerType||"rest"!==p.pattern&&"zero or more"!==p.pattern||(i=p.innerType,"rest"===p.pattern&&(p=p.innerType)),!function e(t,n){if(null===n)return void 0===t;var r=_typeof(t);if("function"!=typeof n&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern){for(var a=0;a<n.innerType.length;a+=1)if(e(t,n.innerType[a]))return!0;return!1}if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")===("where"in t||"each"in t)&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(w(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?"string"===r:n===Boolean?"boolean"===r:n===parseInt?"number"===r&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?"number"===r&&!Number.isNaN(t):n===Array?x(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))}(l,p))return void 0===l?(u=f.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length,v.create("datatype","".concat(e," was given ").concat(r.length?S(r.map(T)):"nothing",", but needs ").concat(u-s," more value").concat(1<u-s?"s":"","."),o)):null!=(u=l)&&u.TwineScript_Unstorable&&O(p)?v.create("datatype",e+"'s "+k(s+1)+" value, "+T(l)+", is not valid data for this macro.",o):b.isPrototypeOf(l)&&"Changer"===h?v.create("syntax","Please put this hook outside the parentheses of "+e+", not inside it.","Hooks should appear after a macro"+(a?".":": "+m+"[Some text]")):l&&y.isPrototypeOf(l)&&"lambda"===p.pattern?v.create("datatype",e+"'s "+k(s+1)+" value (a lambda) should have "+S(["where","when","making","via","with"].filter(function(e){return p.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+S(["where","when","making","via","with"].filter(function(e){return e in l}).map(function(e){return"a '"+e+"' clause"}))+"."):"insensitive set"===p.pattern?v.create("datatype",T(l)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+S(p.innerType)+"."):v.create("datatype","".concat(e,"'s ").concat(k(s+1)," value is ").concat(T(l),", but should be ").concat(_(p),"."),p.message||o)}return d.apply(null,[n].concat(r))}function f(e,t,n,r){var a={fn:n,typeSignature:r=[].concat(r||[]),returnType:t};Object.freeze(a),[].concat(e).forEach(function(e){return Object.defineProperty(i,w(e),{value:a})})}var s={has:function(e){return e=w(e),hasOwnProperty.call(i,e)},get:function(e){return e=w(e),hasOwnProperty.call(i,e)&&i[e]},add:function e(t,n,r,a){return f(t,n,r,a),e},addChanger:function e(t,n,r,a){return f(t,"Changer",n,a),o.register(x(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a){var s,c,l,u,o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=[].concat(t)[0];return f(t,"Command",(s=i,c=n,l=r,u=o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i=c.apply(void 0,n);return i||(a=p.create(),o=_objectSpread({TwineScript_TypeID:"command",TwineScript_ObjectName:"a (".concat(s,":) command"),TwineScript_TypeName:"a (".concat(s,":) command"),TwineScript_Print:function(){return"`[A (".concat(s,":) command]`")},TwineScript_ToSource:function(){return"(".concat(s,":").concat(n.map(d),")")},TwineScript_is:function(e){return d(this)===d(e)}},u?{TwineScript_Attach:function(e,t){return a.section=e,t.run(a),o},TwineScript_Run:function(e){e=l.apply(void 0,[a,e].concat(n));return a=p.create(),e}}:{TwineScript_Run:function(e){return l.apply(void 0,[e].concat(n))}}))}),a),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:t,max:n,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&t<=e&&e<=n}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&0<=e&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&1<=e&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t,n){return s.has(e)?a(e,s.get(e),t,n):v.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t,n){return r.isPrototypeOf(e)?a(e,e,t,n):v.containsError(e)?e:v.create("macrocall","I can't call ".concat(T(e)," because it isn't a custom macro."))}};return Object.assign(s.TypeSignature,{positiveNumber:s.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:s.TypeSignature.numberRange(0,1/0),percent:s.TypeSignature.numberRange(0,1)}),Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","internaltypes/twineerror"],function(t,s,e,c,l){var u=e.insensitiveName,p=e.unescape,n=e.onStartup,o=e.impossible,d=Object.assign,f=RegExp(c.Patterns.macroFront+c.Patterns.macroName,"ig");function r(e){var t,r,a,o,n=e.attr("name"),i=p(e.html()),s=(t=n,o=["metadata","storylet","exclusivity","urgency"],((s=i).match(f)||[]).some(function(t){return o.some(function(e){return u(t.slice(1,-1))===e})})?(r=!1,a={},c.lex(s,t).children.forEach(function e(t){if("macro"===t.type){var n=u(t.name);if(o.some(function(e){return n===e})){if(l.isPrototypeOf(a[n]))return;if(r)return void(a[n]=l.create("syntax","The (".concat(t.name,":) macro can't appear after non-metadata macros.")));if(a[n])return void(a[n]=l.create("syntax","There is more than one (".concat(t.name,":) macro.")));a[n]=t}else r=!0;t.children.forEach(function e(t){var n=u(t.name);"macro"===t.type&&o.some(function(e){return n===e})?a[n]=l.create("syntax","The (".concat(t.name,":) macro can't be inside another macro.")):t.children.forEach(e)})}else t.children.forEach(e)}),a):{});return d(new Map([["source",i],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",n]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:s,tree:null})}var a=Object.create(null),i=[],h=null,m=d(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(n){var e,r;return a[n]||(e=s("en",function(e){return e.get("name")}),r=[],this.forEach(function(e){var t=e instanceof Map&&e.get("tags");Array.isArray(t)&&t.includes(n)&&r.push(e)}),r.sort(e),a[n]=r)},clearTagCache:function(){a=Object.create(null)},clear:function(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete:function(){var e;(e=Map.prototype.delete).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree:function(e){if(!this.has(e))return o("Passages.getTree","No passage name?"),[];var t=this.get(e),n=t.get("tags");if(n.includes("header")||n.includes("footer")||n.includes("debug-header")||n.includes("debug-footer"))return t.tree||(t.tree=c.lex(t.get("source"),e)),t.tree;for(var r,a=0;a<i.length;a+=1)if(i[a]&&i[a].place===e)return r=i.splice(a,1)[0],i.unshift(r),r;n=c.lex(t.get("source"),e);return i.unshift(n),16<i.length&&i.pop(),n},clearTreeCache:function(){i=[]},getStorylets:function(r,e){var a,o,i,e=e?e.filter(r,_toConsumableArray(m.values())):_toConsumableArray(m.values());return l.containsError(e)?e:(a=[],o=-1/0,e.reduce(function(e,t){if(e)return e;e=t.get("storylet");if(e){var n=r.speculate(e,t.get("name"),"a (storylet:) macro");if(l.containsError(n))return n.message="There's an error in the storylet passage \""+t.get("name")+'":\n'+n.message,n.source=e.TwineScript_ToSource(),n;n&&(e=t.get("exclusivity"),o=Math.max(o,"number"==typeof e?e:0),a.push(t))}},void 0)||(i=s("en"),a.filter(function(e){e=e.get("exclusivity");return("number"==typeof e?e:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:i(e.get("name"),t.get("name"))})))},allStorylets:function(){return h=h||_toConsumableArray(m.values()).filter(function(e){return e.get("storylet")})},clearStoryletCache:function(){h=null},loadMetadata:function(i){var s=[];return m.forEach(function(o){o.metadata&&Object.keys(o.metadata).forEach(function(e){var t,n,r;function a(e,t){o.has(e)?s.push(l.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):o.set(e,t)}l.containsError(o.metadata[e])?s.push(o.metadata[e]):(t=o.metadata[e],n=i.speculate(t,o.get("name"),"a ("+e+":) macro"),r='In "'+o.get("name")+'":\n',l.containsError(n)?(n.message=r+n.message,n.source=t.text,s.push(n)):n instanceof Map?n.forEach(function(e,t){return a(t,e)}):a(e,n))}),o.metadata=void 0}),s},hasValid:function(e){e=this.get(e);return e&&e instanceof Map&&e.has("source")},create:r});return n(function(){t("tw-storydata > tw-passagedata").get().forEach(function(e){e=t(e),m.set(e.attr("name"),new r(e))})}),m}),define("renderer",["jquery","utils","markup","internaltypes/twineerror"],function(a,e,S,T){var _=e.escape,x=e.insensitiveName,O=e.options;function A(e,t,n){n=2<arguments.length&&void 0!==n?n:"";return"<"+t+(n?" "+n:"")+">"+e+"</"+t+">"}var C="text-align: center; max-width:50%; ";function E(m,g){function y(e,t,n){e=E(e.children,g);return e&&A(e,t,n)}var b="",v=[];if(m)for(var e,w=(m=Array.isArray(m)?m:[m]).length,k=0;k<w;k+=1)if(e=function(e){var n=m[e];switch(n.type){case"include":b+=y(n,"tw-"+n.type,'type="'.concat(n.tag,'" name="').concat(n.name,'"'));break;case"error":b+=T.create("syntax",n.message,n.explanation).render(_(n.text))[0].outerHTML;break;case"numbered":case"bulleted":for(var t="numbered"===n.type?"ol":"ul",r=(b+="<"+t+">",1);e<w&&m[e];){if("br"===m[e].type){if(b+="</li>",!m[e+1]||m[e+1].type!==n.type)break}else m[e].type===n.type?(b=(b+=("<"+t+">").repeat(Math.max(0,m[e].depth-r)))+("</"+t+">").repeat(Math.max(0,r-m[e].depth))+"<li>",r=m[e].depth):b+=E([m[e]],g);e+=1}b+=("</"+t+">").repeat(r+1);break;case"align":for(;n&&"align"===n.type;){var a=n.align,o=e+=1;if("left"===a){--e;break}for(;e<w&&m[e]&&"align"!==m[e].type;)e+=1;var o=E(m.slice(o,e),g),i="";switch(a){case"center":i+=C+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":i+="text-align: "+a+";";break;default:+a&&(i+=C+"margin-left: "+a+"%;")}b+="<tw-align "+(i?'style="'+i+'"':"")+">"+o+"</tw-align>\n",n=m[e]}break;case"column":for(var s,c=[];n&&"column"===n.type;){var l=n.column,u=e+=1;if("none"===l){--e;break}for(;e<w&&m[e]&&"column"!==m[e].type;)e+=1;c.push({text:n.text,type:l,body:E(m.slice(u,e),g),width:n.width,marginLeft:n.marginLeft,marginRight:n.marginRight}),n=m[e]}c.length&&(s=c.reduce(function(e,t){return e+t.width},0),b+="<tw-columns>"+c.map(function(e){return"<tw-column type=".concat(e.type," ",' style="width:').concat(e.width/s*100,"%; margin-left: ").concat(e.marginLeft,"em; margin-right: ").concat(e.marginRight,'em;">').concat(e.body,"</tw-column>\n")}).join("")+"</tw-columns>");break;case"heading":for(b+="<h"+n.depth+">";++e<w&&m[e];){if("br"===m[e].type){b+="</h"+n.depth+">";break}b+=E([m[e]],g)}break;case"br":if(!v.length||/td|th/.test(v[0])){b+="<br>";for(var p=m[e+1];p&&("br"===p.type||"tag"===p.type&&/^<br\b/i.test(p.text));)b+="<tw-consecutive-br"+("tag"===p.type?" data-raw":"")+"></tw-consecutive-br>",p=m[(e+=1)+1]}break;case"hr":b+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":b+='<a class="link" href="'+_(n.text)+'">'+n.text+"</a>";break;case"scriptStyleTag":case"tag":var d=n.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\b/.test(d)&&!n.text.endsWith("/>")&&v[n.text.startsWith("</")?"shift":"unshift"](d),b+=n.text.startsWith("</")?n.text:n.text.replace(/(\/)?>$/,function(e,t){return" data-raw".concat(t?"></".concat(n.text.match(/[\w-]+/)):"",">")});break;case"sub":case"sup":case"strong":case"em":b+=y(n,n.type);break;case"strike":b+=y(n,"s");break;case"bold":b+=y(n,"b");break;case"italic":b+=y(n,"i");break;case"twineLink":d=_slicedToArray(S.lex("(link-goto:"+JSON.stringify(n.innerText)+","+JSON.stringify(n.passage)+")").children,1)[0];b+='<tw-expression type="macro" name="link-goto"'+(O.debug?' title="'+_(n.text)+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(d);break;case"hook":b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+(O.debug&&n.name?' title="Hook: ?'+n.name+'"':"")+' source="'+g.source.length+'"></tw-hook>',g.source.push(n.children);break;case"unclosedHook":return b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+'source="'+g.source.length+'"></tw-hook>',g.source.push(m.slice(e+1,w)),{v:b};case"verbatim":b+=A(_(n.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":b+=y(n,"tw-collapsed");break;case"unclosedCollapsed":return{v:b+="<tw-collapsed>"+E(m.slice(e+1,w),g)+"</tw-collapsed>"};case"variable":case"tempVariable":case"macro":var f=[],h=[];if("macro"===n.type&&!function e(t){"string"!==t.type&&"hook"!==t.type&&t.children.every(e);var n=x(t.name);if("macro"!==t.type||"prompt"!==n&&"confirm"!==n){if("hook"===t.type&&!t.everyLeaf(function(e){return"error"!==e.type||(h.push(e),!1)}))return!1}else f.push(t);return!0}(n),h.length)return{v:T.create("syntax","This code hook's markup contained "+h.length+" error"+(h.length?"s":"")+":<br>\u2014"+h.map(function(e){return e.message}).join("<br>\u2014")).render(_(n.text))[0].outerHTML};d=f.map(function(e){return e.blockerTree=g.blockers.length,g.blockers.push(e),e.blockerTree});b+='<tw-expression type="'+n.type+'" name="'+_(n.name||n.text)+'"'+(O.debug?' title="'+_(n.text)+'"':"")+(d.length?' blockers="'+d+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(n);break;default:b+=n.children&&n.children.length?E(n.children,g):n.text}k=e}(k))return e.v;return b}return Object.freeze({exec:function(e){var r={code:[],blockers:[],source:[]},e=E(e="string"==typeof e?S.lex(e).children:e,r),e=a(a.parseHTML(e,document,!0));return e.findAndFilter("script:not([src])").each(function(e,t){var n=t.getAttribute("type");n&&"text/javascript"!==n.toLowerCase()||t.setAttribute("type","application/x-harlowe")}),r.blockers=r.blockers.map(function(e){e.blockedValue=!0;e=Object.create(e);return e.blockedValue=!1,e}),e.findAndFilter("tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])").each(function(e,t){var n;(t=a(t)).attr("blockers")&&(n=t.popAttr("blockers").split(",").map(function(e){return r.blockers[e]}),t.data("blockers",n)),t.attr("source")&&t.data("source",r.source[t.popAttr("source")]),t.attr("code")&&t.data("code",r.code[t.popAttr("code")])}),e}})}),define("repl",["utils","markup","section"],function(e,t,n){e.onStartup(function(){return setTimeout(function(){e.options.debug&&(window.REPL=function(e){e=n.create().eval(t.lex("(print:"+e+")"));return e.TwineScript_Run?e.TwineScript_Run().source:e},window.LEX=function(e){e=t.lex(e);return 1===e.length?e[0]:e})})})}),define("section",["jquery","utils","twinescript/runner","twinescript/operations","state","utils/operationutils","utils/renderutils","utils/scripttag","datatypes/changercommand","datatypes/colour","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(p,f,a,u,r,e,t,i,d,h,o,m,g,y,b,v){var w=e.printBuiltinValue,k=e.objectName,S=e.typeID,T=e.isObject,s=t.collapse,_=Object.assign,x=Object.create,O=Object.keys;function A(e,t,n){if(t&&"object"===_typeof(t)&&d.isPrototypeOf(t)){var r=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),a=(null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),n.data("originalSource",r),g.create({target:n,source:r,section:this,append:"append"})),o=t.run(a);if(b.containsError(o)&&e.replaceWith(o.render(e.attr("title"))),!this.renderInto(r,null,a))return o=f.insensitiveName(e.attr("name")),["if","elseif","unless","else","testfalse"].includes(o)&&(e.addClass("false"),"elseif"!==o)&&(this.stackTop.lastHookShown=!1),n.data("live")&&function(t,n,r){function a(e){p&&(d-=(e-p)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)),p=e,0<d?requestAnimationFrame(a):(d=s,o())}var o,i=this,e=r.data("live"),s=e.delay,c=e.event,l=((n=_objectSpread(_objectSpread({},n),{},{append:"replace",transitionDeferred:!1,enabled:!0})).data=_objectSpread(_objectSpread({},n.data),{},{live:void 0}),r.data("originalSource")||""),u=this.stackTop.tempVariables,p=null,d=s;o=this.whenUnblocked.bind(this,function(){var e;i.inDOM()&&(e=null==c?void 0:c.filter(i,[!0],u),b.containsError(e)?e.render(i,t.attr("title")).replaceAll(t):c&&!e[0]?requestAnimationFrame(a):(i.renderInto(l,r,n,u),e||r.find("tw-expression[name='stop']").length||i.inDOM()&&requestAnimationFrame(a)))}),requestAnimationFrame(a)}.call(this,e,a,n),!0}else{if(!1===t)return o=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),o&&(n.cachedData&&(n.cachedData.source=void 0),n.data("originalSource",o),n.data("hidden",!0)),e.addClass("false"),!(this.stackTop.lastHookShown=!1);if(!0!==t)return!1}return this.stackTop.lastHookShown=!0}function C(e){var t,n,e=(e instanceof p?e[0]:e).nextSibling;return e&&(e instanceof Text&&!e.textContent.trim()||["br","tw-consecutive-br"].includes((e.tagName||"").toLowerCase()))?(t=(n=C(e)).whitespace,n=n.nextElem,{whitespace:p(e).add(t),nextElem:n}):{whitespace:p(),nextElem:p(e)}}function E(e){if(null!=e&&e.length)return p("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)}function c(e,t){var n=this.eval(t);e.append(E(this.evalReplay)),e.append(function(e,t){if(/a \((go-to|undo|redirect|restart):\) command/.exec(null==t?void 0:t.TwineScript_TypeName))return p("<tw-open-button goto label='GO'>").data("goto",{section:e,command:t})}(this,n)),this.stackTop.evaluateOnly&&n&&(d.isPrototypeOf(n)||"function"==typeof n.TwineScript_Run)&&(n=b.create("syntax","I can't work out what ".concat(this.stackTop.evaluateOnly," should evaluate to, because it contains a ").concat(d.isPrototypeOf(n)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var r=p();for(i=e;d.isPrototypeOf(n);){var a=C(i),o=a.whitespace;if((i=a.nextElem)[0]&&i[0].nodeType===Node.TEXT_NODE&&"+"===i[0].textContent.trim()){var i,a=i,s=C(a),c=s.whitespace;if((i=s.nextElem).is("tw-expression")){var s=i.popData("code")||(null==(s=i[0])||null==(s=s.cachedData)?void 0:s.code),l=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(s));if(b.containsError(l)){n=l;break}s=u["+"](n,l);p(o).add(a).add(c).remove(),n=b.containsError(s)?b.create("operation","I can't combine "+k(n)+" with "+k(l)+".","function"==typeof l.TwineScript_Run?"If you want to attach this changer to ".concat(k(l),", remove the + between them."):"Changers can only be added to other changers."):s;continue}}if(i.is("tw-expression")){c=i.popData("code")||(null==(a=i[0])||null==(a=a.cachedData)?void 0:a.code),s=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(c));if(i.append(E(this.evalReplay)),b.containsError(s)){n=s;break}if(s&&"object"===_typeof(s)&&"function"==typeof s.TwineScript_Attach){n=s.TwineScript_Attach(this,n);break}return d.isPrototypeOf(s)?void e.replaceWith(b.create("operation","Changers like (".concat(n.macroName,":) need to be combined using + between them."),"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(e.attr("title"))):void e.replaceWith(b.create("operation","".concat(k(s)," can't have changers like (").concat(n.macroName,":) attached."),"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(e.attr("title")))}if(i.is("tw-hook")){o.remove(),r=i;break}n.macroName||f.impossible("Section.runExpression","changer has no macroName");a=e.attr("title")||"("+n.macroName+": ...)";return void e.replaceWith(b.create("syntax","The (".concat(n.macroName,":) changer should be stored in a variable or attached to a hook."),"Macros like this should appear before a hook: ".concat(a,"[Some text]")).render(e.attr("title")))}e.attr("return",S(n)),r=r.length?r:C(e).nextElem.filter("tw-hook"),(t=b.containsError(n))?e.replaceWith(t.render(e.attr("title")).append(E(this.evalReplay))):v.isPrototypeOf(n)?e.append(n.render()):n&&"function"==typeof n.TwineScript_Run?(n=n.TwineScript_Run(this),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):g.isPrototypeOf(n)?null!=(t=n.data)&&t.live?e.replaceWith(b.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(e.attr("title"))):(n.section=this,n.target=i,this.renderInto("",i,n)):T(n)&&n.blocked?(this.stackTop.blocked=n.blocked,e.data("code",{type:"macro",blockedValue:!0,text:e.attr("title")||"",start:0,end:(e.attr("title")||"").length})):n&&f.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor ".concat(_typeof(n),': "').concat(n,'"'))):r.length&&A.call(this,e,n,r)||("string"==typeof n||"number"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||h.isPrototypeOf(n)||m.isPrototypeOf(n)||n&&"function"==typeof n.TwineScript_Print&&!d.isPrototypeOf(n)?(n=w(n),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):"string"==typeof n||Array.isArray(n)?this.renderInto(n,e):f.impossible("printBuiltinValue() produced a non-string non-array ".concat(_typeof(n)))):d.isPrototypeOf(n)||"boolean"==typeof n||f.impossible("Section.runExpression","The expression evaluated to an unknown value: ".concat(n)))}var l={add:[],remove:[]};return Object.preventExtensions({create:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.storyElement,n=_(x(this),{timestamp:Date.now(),dom:e,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'time' can't be used in ".concat(n.stackTop.evaluateOnly,".")):(Date.now()-n.timestamp)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)},get turns(){return r.turns},get turn(){return r.turns},get visits(){var t=n.stackTop.speculativePassage;return r.history().filter(function(e){return e===(t||r.passage)}).length+(!t||t===r.passage)},get visit(){return n.Identifiers.visits},get exits(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'exit' and 'exits' can't be used in ".concat(n.stackTop.evaluateOnly,".")):n.dom.find("tw-enchantment, tw-link").filter(function(e,t){return(t=p(t)).data("enchantmentEvent")||t.parent().data("linkPassageName")||t.parent().data("clickEvent")}).length},get exit(){return n.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:b.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}}});return n},eval:function(t){var e,n;f.options.debug&&f.options.evalReplay&&(n=Array.isArray(t)?t.reduce(function(e,t){return e+t.text},""):t.text||"",this.evalReplay=[{code:n,fromCode:n,basis:(Array.isArray(t)?t[0]:t).start,start:0,end:n.length,diff:0}]);try{e=a(this,t)}catch(e){return null!=(n=window.console)&&n.error(e),this.evalReplay=null,b.create("","An internal error occurred while trying to run ".concat([].concat(t).map(function(e){return e.text}).join(""),"."),'The error was "'.concat(e.message,'".\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).'))}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),e},get stackTop(){return this.stack[0]},inDOM:function(){return 0<f.storyElement.find(this.dom).length},evaluateTwineMarkup:function(e,t){var n=p("<p>");return this.stack.unshift({desc:g.create({target:n,source:e,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:t,finalIter:!0}),this.execute(),0<(e=n.find("tw-error")).length?e:n},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:_(x(y),{TwineScript_VariableStore:{type:"temp",name:n}}),speculativePassage:t});var r,n=this.evalReplay;return this.evalReplay=null,o.isPrototypeOf(e)?r=e.apply(this,{fail:!1,pass:!0}):e&&(r=a(this,e)),this.stack.shift(),this.evalReplay=n,r},renderInto:function(e,a,t){var o=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=g.create({target:a,source:e,section:this,append:"append"});if(t)if(d.isPrototypeOf(t)){var e=t.run(i);if(b.containsError(e))return e.render(a.attr("title")).replaceAll(a),!1}else _(i,t);if((a=i.target,50<=this.stack.length)&&50<=this.stack.reduce(function(e,t){return e+!!t.finalIter},0))return b.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(a.attr("title")).replaceAll(a),!1;var s=function(e,t,n){var r=a instanceof p&&a.is("tw-hook")&&0<a.parents("tw-collapsed,[collapsing=true]").length;o.stack.unshift({desc:e,finalIter:n,tempVariables:t,collapses:r,evaluateOnly:o.stackTop&&o.stackTop.evaluateOnly})},r=r||x(this.stack.length?this.stackTop.tempVariables:y),t=(hasOwnProperty.call(r,"TwineScript_VariableStore")||(t=null==(e=a)?void 0:e.tag(),r.TwineScript_VariableStore={type:"temp",name:"tw-hook"===t?a.attr("name")?"?"+a.attr("name"):"an unnamed hook":"tw-expression"===t?"a "+a.attr("type")+" expression":"tw-passage"===t?"this passage":"an unknown scope"}),null==(e=this.stackTop)?void 0:e.blocked);if(O(i.loopVars).length){var c=_objectSpread({},i.loopVars),l=Math.min.apply(Math,_toConsumableArray(O(c).map(function(e){return c[e].length})));if(v.create(l+" loop"+(1!==l?"s":"")).render().prependTo(a),l){for(var n=l-1;0<=n;--n)!function(n){s(i,O(c).reduce(function(e,t){return e[t]=c[t][n],e},x(r),n===l-1))}(n);for(var u=l-1;0<=u&&!this.stackTop.blocked;--u)this.execute()}}else s(i,r,!0),this.execute();return(0===this.stack.length||!t&&null!=(e=this.stackTop)&&e.blocked)&&this.updateEnchantments(),i.enabled},execute:function(){var a=this,e=this.stackTop,t=e.desc,n=e.dom,r=e.collapses,o=e.evaluateOnly;t&&!n&&(n=t.render(),this.stackTop.dom=n,this.stackTop.desc=void 0),n.findAndFilter('tw-hook,tw-expression,script[type="application/x-harlowe"]').each(function(e,t){var n=p(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}}).each(function(e,t){if(a.stackTop.blocked)return!1;var n=t.cachedData;switch(n&&(t.cachedData=void 0),(t=p(t)).tag()){case"tw-hook":var r=t.popData("source")||(null==n?void 0:n.source);(r&&t.data("originalSource",r),t.data("tempVariables",a.stackTop.tempVariables),t.popAttr("hidden"))?t.data("hidden",!0):r&&a.renderInto(r,t);break;case"tw-expression":var r=t.data("blockers")||(null==n?void 0:n.blockers);if(r){if(o)return void t.removeData("blockers").removeData("code").replaceWith(b.create("syntax","I can't use a macro like (prompt:) or (confirm:) in ".concat(o,"."),"Please rewrite this without putting such macros here.").render(t.attr("title"),t));if(r.length)return a.stackTop.blocked=!0,r=a.eval(r.shift()),b.containsError(r)&&(a.stackTop.blocked=!1,t.removeData("blockers").replaceWith(r.render(t.attr("title"),t))),!1;t.removeData("blockers")}r=t.popData("code")||(null==n?void 0:n.code);r&&c.call(a,t,r);break;case"script":if(f.reattachStoryElement(),t.text())try{i(t.text(),a.stackTop.tempVariables)}catch(e){b.isPrototypeOf(e)?t.replaceWith(e.render(t.text(),t)):(null!=(r=window.console)&&r.error(e),t.replaceWith(b.create("","A Javascript error occurred while running this <script> element.",'The error was "'.concat(e,'". Check the browser console for more details.')).render(t.text(),t)))}}}),this.stackTop.blocked||(n.length&&r&&s(n),n.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){s(p(this))}),setTimeout(function(){return n.find("input, textarea").first().focus()},100),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return l[e].push(t),this},addEnchantment:function(t){var n=this;this.enchantments.push(t),l.add.forEach(function(e){return e(n,t)})},removeEnchantment:function(t){var n=this,e=this.enchantments.indexOf(t);this.enchantments.splice(e,1),t.disenchant(),l.remove.forEach(function(e){return e(n,t)})},unblock:function(e){for(this.stack.length||f.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;0<this.unblockCallbacks.length;){var t;if(this.unblockCallbacks.shift()(),null!=(t=this.stackTop)&&t.blocked)return}},whenUnblocked:function(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue:function(){var e=this.stackTop;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():(f.impossible("Section.blockedValue","blockedValues is missing or empty"),0):(f.impossible("Section.blockedValue","stack is empty"),0)}})}),define("state",["jquery","utils","passages","datatypes/customcommand","utils/operationutils","markup"],function(n,y,b,v,e,t){var i,w,C=e.toSource,E=e.is,k=t.lex,o=Object.assign,h=Object.create,e=Object.defineProperty,N=Array.isArray,s=Math.imul,t=(e(Map.prototype,"toJSON",{value:void 0}),e(Set.prototype,"toJSON",{value:void 0}),["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}));function S(e,t){var n=0<arguments.length&&void 0!==e?e:String.fromCodePoint(Date.now()%1114112),e=1<arguments.length&&void 0!==t?t:0;i.seedIter=e,i.seed=n;for(var r,a=0,o=2166136261;a<n.length;a+=1)r=s(n.charCodeAt(a),3432918353),o^=s(r<<15|r>>>17,461845907),o=s(o=o<<13|o>>>19,5)+3864292196|0;return o^=n.length,o=s(o^=o>>>16,2246822507),o=s(o^=o>>>13,3266489909),o=((o^=o>>>16)>>>0)+1831565813*e,function(){i.seedIter+=1;var e=o+=1831565813,e=s(e^e>>>15,1|e);return(((e^=e+s(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}function r(e,t){for(var n,r=t.variables,a=h(null),o=e.length-1;0<=o;--o){for(var i,s,c=e[o],l=0,u=["mockVisits","mockTurns","seed","seedIter"];l<u.length;l++){var p=u[l];hasOwnProperty.call(c,p)&&!hasOwnProperty.call(t,p)&&(t[p]=c[p])}for(i in c.forgetVisits&&(t.forgetVisits=Math.max(t.forgetVisits||0,c.forgetVisits)),void 0!==c.turns&&(t.turns=(t.turns||0)+c.turns),t.pastVisits||(t.pastVisits=[]),o!==e.length-1&&(void 0!==e[o+1].visits&&Array.isArray(t.pastVisits[0])?t.pastVisits[0]:t.pastVisits).unshift(c.passage),void 0!==c.pastVisits&&t.pastVisits.unshift(c.pastVisits),void 0!==c.visits&&t.pastVisits.unshift(c.visits),c.variables)if("TwineScript_TypeDefs"===i)for(var d in r[i]||(r[i]=h(null)),c.variables[i])r[i][d]||(r[i][d]=c.variables[i][d]);else i.startsWith("TwineScript_")||i in r||(null===c.variables[i]&&(a[i]=!0),a[i])||(r[i]=c.variables[i],!(s=c.valueRefs[i]))||"via"in s||t.valueRefs[i]||(t.valueRefs[i]=s)}for(n in t.valueRefs){var f=t.valueRefs[n];f&&"via"in f&&delete t.valueRefs[n]}}var a,c={passage:"",variables:h(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create:function(e){var t=h(c);return t.passage=e||"",t.variables=h(null),t.valueRefs=h(null),t}},l={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]},u=[],p=-1,d=c.create(),f="";function m(){i.history=i.pastVisits.slice(i.forgetVisits).reduce(function(e,t){return e.concat(t)},[]),i.mockVisits&&(i.history=i.mockVisits.concat(i.history))}function g(){var e=c.create();e.pastVisits=[],o(e.variables,{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:h(null),TwineScript_VariableStore:{type:"global",name:"this story's variables"},TwineScript_Delete:function(e){delete this[e],d.variables[e]=null,delete d.valueRefs[e]},TwineScript_Set:function(e,t,n){if(this[e]=t,d.variables[e]=t,n)d.valueRefs[e]=n;else if((N(t)||t instanceof Map||t instanceof Set||"string"==typeof t)&&!y.options.uncompressedStructures)for(var r=p;0<=r;--r){var a=u[r].variables[e];if(void 0!==a){a=function e(t,n,r){var a="it"===r?"its":r+"'s",o="";if(N(n)&&N(t)&&n.length){for(var i=n.length===t.length,o="(a:",s=0;s<n.length;s+=1){var c,l,u,p=n[s];E(p,t[s])?(c=C(p),l="".concat(a," ").concat(s+1,"th"),o+=(c.length<l.length?c:l)+","):(i=!1,-1<(c=t.indexOf(p))?(l=C(p),u="".concat(a," ").concat(c+1,"th"),o+=(l.length<u.length?l:u)+","):o+=e(t[s],p,"".concat(a," ").concat(s+1,"th"))+",")}o=i?r:o.slice(0,-1)+")"}else if(n instanceof Map&&t instanceof Map&&n.size){var d,f=n.size===t.size,h=(o="(dm:",_createForOfIteratorHelper(n.entries()));try{for(h.s();!(d=h.n()).done;){var m,g,y=_slicedToArray(d.value,2),b=y[0],v=y[1];o+="".concat(C(b),","),E(v,t.get(b))?(m=C(v),g="".concat(a," (").concat(C(b),")"),o+=(m.length<g.length?m:g)+","):(f=!1,o+=e(t.get(b),v,"".concat(a," (").concat(C(b),")"))+",")}}catch(e){h.e(e)}finally{h.f()}o=f?r:o.slice(0,-1)+")"}else if(n instanceof Set&&t instanceof Set&&n.size){var w,k=new Set,S=new Set,T=_createForOfIteratorHelper(t);try{for(T.s();!(w=T.n()).done;){var _=w.value;n.has(_)||k.add(_)}}catch(e){T.e(e)}finally{T.f()}var x,O=_createForOfIteratorHelper(n);try{for(O.s();!(x=O.n()).done;){var A=x.value;t.has(A)||S.add(A)}}catch(e){O.e(e)}finally{O.f()}k.size||S.size||(o=r),o=k.size+S.size>n.size?C(n):r+(S.size?"+"+C(S):"")+(k.size?"-"+C(k):"")}else"string"==typeof n&&"string"==typeof t&&n&&(n.startsWith(t)?o=r+"+"+C(n.slice(t.length)):n.endsWith(t)&&(o=C(n.slice(0,n.length-t.length))+"+"+r));return o?"it"===r?{via:o}:o:"it"===r?void 0:C(n)}(a,t,"it");a&&("it"===a.via?delete d.variables[e]:d.valueRefs[e]=a);break}}},TwineScript_GetProperty:function(e){return this[e]},TwineScript_DefineType:function(e,t){this.TwineScript_TypeDefs[e]=t,hasOwnProperty.call(d.variables,"TwineScript_TypeDefs")||(d.variables.TwineScript_TypeDefs=h(null)),d.variables.TwineScript_TypeDefs[e]=t}}),r(u.slice(0,p+1),e),i=e,m(),w=S(e.seed,e.seedIter)}function T(e){d=c.create(e);e=a.serialise(!0),f=e.past,e=e.pastAndPresent;if(a.hasSessionStorage&&"string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){}}function _(e,t,n,r){for(var a in r)if(hasOwnProperty.call(r,a)&&!a.startsWith("TwineScript_"))if("object"===_typeof(r[a]))if(hasOwnProperty.call(r[a],"at")){n.valueRefs[a]=r[a];var o=r[a],i=o.at,s=o.from,c=o.to,l=o.hash,u=o.seed,p=o.seedIter,o=o.blockedValues;if(!b.has(i))throw Error('The data refers to a passage named `"'.concat(n.passage,"\"`, but it isn't in this story."));var d=b.get(i).get("source"),f=d.slice(s,c);if(void 0!==l)for(var h=0,m=c-s;y.hash(f).toString(16)!==l;){if(h+m>=d.length)throw Error("The value (or type) of the variable `$".concat(a,"` couldn't be found in the passage `\"").concat(i,'"`.'));(h+=1)===s&&(h+=1),f=d.slice(h,h+m)}c=k(f,"","macro");void 0!==u&&void 0!==p&&(w=S(u,p)),void 0!==o&&(e.stackTop.blockedValues=o,c.forEach(function e(t){var n;"string"!==t.type&&"hook"!==t.type&&t.children.every(e),"macro"!==t.type||"prompt"!==(n=y.insensitiveName(t.name))&&"confirm"!==n||(t.blockedValue=!0)})),r[a]=e.eval(c)}else if(hasOwnProperty.call(r[a],"via")){for(var g=t.length-1;0<=g;--g)if(hasOwnProperty.call(t[g].variables,a)){e.Identifiers.it=t[g].variables[a];break}r[a]=e.eval(k(r[a].via,"","macro")),e.Identifiers.it=0}else hasOwnProperty.call(r[a],"changer")&&(r[a].changer=e.eval(k(r[a].changer,"","macro")),r[a].hook=e.eval(k(r[a].hook,"","macro")),_(e,t,n,r[a].variables),r[a]=v.create(r[a]));else r[a]=e.eval(k(r[a],"","macro"));else"TwineScript_MockVisits"===a&&(n.mockVisits=r[a])}return g(),d.seed=i.seed,d.seedIter=0,(a={get passage(){return d.passage},get variables(){return i.variables},get pastLength(){return p},get turns(){return p+1+(i.turns||0)+(i.mockTurns||0)},get futureLength(){return u.length-1-p},get mockVisits(){return i.mockVisits||[]},set mockVisits(e){i.mockVisits=e,d.mockVisits=e,m()},get mockTurns(){return i.mockTurns||0},set mockTurns(e){i.mockTurns=e,d.mockTurns=e},history:function(){return i.history},forgetUndos:function(e){e<0&&(e=u.length+e);var t,e=u.splice(0,Math.min(u.length-1,e));e.length&&(p=u.length-1,t=u[0],r(e,t),t.pastVisits.push(e[e.length-1].passage),t.turns=(t.turns||0)+e.length,i.turns=(i.turns||0)+e.length,t.forgetVisits&&(t.pastVisits=t.pastVisits.slice(t.forgetVisits-t.turns),t.forgetVisits-=t.turns),f="",0===p&&n("tw-link[undo], tw-icon[alt='Undo']",y.storyElement).each(function(e,t){(n(t).closest("tw-expression, tw-hook").data("forgetUndosEvent")||Object)(t)}),l.forgetUndos.forEach(function(e){return e()}))},forgetVisits:function(e){(e=e<0?u.length+e:e)>p+i.turns&&(e=p+i.turns),d.forgetVisits=i.forgetVisits=Math.max(i.forgetVisits||0,e),m()},passageNameVisited:function(e){var t=0;if(!b.get(e))return 0;for(var n=0;n<i.history.length;n++)t+=+(e===i.history[n]);return t},get timeline(){return u},play:function(t){var e;d||y.impossible("State.play","present is undefined!"),l.beforeForward.forEach(function(e){return e()}),d.passage&&((null!=(e=d.visits)&&e.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1]:i.pastVisits).push(d.passage),i.history.push(d.passage)),d.passage=t,u=u.slice(0,p+1).concat(d),p+=1,T(t),l.forward.forEach(function(e){return e(t)})},redirect:function(e){var t;d||y.impossible("State.redirect","present is undefined!"),d.passage&&(null!=(t=d.visits)&&t.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1].push(d.passage):i.pastVisits.push([d.passage]),i.history.push(d.passage)),d.visits=(d.visits||[]).concat(e),d.passage=e},rewind:function(e){for(var t=void 0!==e?e:1,n=!1;0<t&&0<p;t--)n=!0,--p;return n&&(l.beforeBack.forEach(function(e){return e()}),f="",T(u[p].passage),g(),l.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);0<t&&0<u.length;t--)n=!0,p+=1;return n&&(l.beforeForward.forEach(function(e){return e()}),T(u[p].passage),g(),l.forward.forEach(function(e){return e(u[p].passage,"fastForward")})),n},on:function(e,t){if(e in l)return"function"!=typeof t||l[e].includes(t)||l[e].push(t),a;y.impossible("State.on","invalid event name")},reset:function(){l.beforeLoad.forEach(function(e){return e()}),u=[],p=-1,g(),(d=c.create()).seed=i.seed,d.seedIter=0,f="",w=S(),l.load.forEach(function(e){return e(u)})},hasStorage:t[0],hasSessionStorage:t[1],setSeed:function(e){w=S(e),d.seed=i.seed,d.seedIter=0},get seed(){return i.seed},get seedIter(){return i.seedIter},random:function(){var e=w();return d.seedIter=i.seedIter,e},shuffled:function(){for(var a=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(e,t,n){var r=a.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[]);return d.seedIter=i.seedIter,r}}).serialise=function(e){function o(e,t){if("TwineScript_TypeDefs"===t){var n,r={};for(n in e[t])r[n]=C(e[t][n]);return r}var a;return null===e[t]?null:e[t]&&hasOwnProperty.call(e[t],"TwineScript_CustomCommand")?(a=e[t].TwineScript_CustomCommand(),{changer:C(a.changer),toSource:a.toSource,hook:C(a.hook),variables:Object.keys(a.variables).reduce(function(e,t){return e[t]=o(a.variables,t),e},{})}):C(e[t])}function t(e,t){if(c.isPrototypeOf(t)&&void 0===t.visits&&void 0===t.turns&&void 0===t.mockVisits&&void 0===t.forgetVisits&&void 0===t.pastVisits&&void 0===t.mockTurns&&void 0===t.seed&&void 0===t.seedIter&&Object.keys(t.variables).every(function(e){return e.startsWith("TwineScript_")}))return t.passage;if(!c.isPrototypeOf(this)||"valueRefs"!==e){if(c.isPrototypeOf(this)&&"variables"===e){var n,r={};for(n in this.variables)this.valueRefs[n]?r[n]=this.valueRefs[n]:r[n]=o(this.variables,n);return r}return t}}var e=u.slice(f?e?p-1:p:0,p+1),n=e.slice(0,-1),r=f;try{return{past:r=n.length?(r?r.slice(0,-1)+",":"[")+JSON.stringify(n,t).slice(1):r,pastAndPresent:r.slice(0,-1)+(r?",":"[")+JSON.stringify(e.slice(-1),t).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},a.deserialise=function(e,t){var n;try{n=JSON.parse(t)}catch(e){return Error("The save data is unintelligible.")}if(!N(n))return Error("The save data isn't a sequence of past turns.");for(var r=0;r<n.length;r+=1){var a=n[r];if("string"==typeof a)a={passage:a,variables:{}};else if("object"!==_typeof(a)||!hasOwnProperty.call(a,"variables")){n.splice(r--,1);continue}if(a.valueRefs=h(null),a.variables=o(h(null),a.variables),!b.hasValid(a.passage))return Error('The data refers to a passage named `"'.concat(a.passage,"\"`, but it isn't in this story."));if(hasOwnProperty.call(a.variables,"TwineScript_TypeDefs"))try{_(e,n.slice(0,r),a,a.variables.TwineScript_TypeDefs)}catch(e){return Error("The variable types on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}try{_(e,n.slice(0,r),a,a.variables)}catch(e){return Error("The variables on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}n[r]=o(h(c),a)}return p=(u=n).length-1,l.load.forEach(function(e){return e(u)}),f="",g(),T(u[p].passage),!0},Object.seal(c),Object.freeze(a)}),define("utils",["jquery","markup","utils/polyfills"],function(d){var r=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),a="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),f=["audio"],e=_slicedToArray([function(e){return r(e)!==r(e).toLowerCase()},function(e){return r(e)!==r(e).toUpperCase()},function(e){return r(e).toLowerCase()!==r(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,t,n){return e===n[t-1]+1&&e===n[t+1]-1?"-":r(e)}).join("").replace(/-+/g,"-")+"]"}),3),t=e[0],o=e[1],e=e[2];function s(e){return"instant"===e?0:800}var i,c,l=[],u={},p=0,h={},m=0,g={};function y(n,r,e,a,o){var i=null,s=0,c=r+e;function l(e){var t;1&n[0].compareDocumentPosition(document)&&(c=0),i&&(c-=t=e-i),i=e,0<a&&0<p+m&&n.data("expediteAnim")(a),c<=r&&(s+=t||0,"paused"===n.css("animation-play-state"))&&n.css({visibility:"","animation-play-state":"running"}),c<=0?(n.removeData("expediteAnim"),o()):requestAnimationFrame(l)}n.data("expediteAnim",function(e){var t;c-=e=void 0===e?s:e,"running"===n.css("animation-play-state")&&n.css("animation-delay",(("ms"===(t=(t=n.css("animation-delay")).toLowerCase()).slice(-2)?+t.slice(0,-2)||0:"s"===t.slice(-1)&&1e3*+t.slice(0,-1)||0)||0)-e+"ms")}),c?requestAnimationFrame(l):l()}d(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,e=e.type.includes("down"),r=t?u:h,n=t&&v.insensitiveName(t)||n;r[n]&&!e?t?p=Math.max(p-1,0):m=Math.max(m-1,0):!r[n]&&e&&(t?p+=1:m+=1),r[n]=e}).on("mousemove",function(e){var t=e.pageX,e=e.pageY;g.x=t,g.y=e});var b=/-|_/g,v={hash:function(e){for(var t=9,n=e.length;0<n;)--n,t=Math.imul(t^e.charCodeAt(n),Math.pow(9,9));return(t^t>>>9)>>>0},permutations:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r,a,o=t.length,i=[[].concat(t)],s=Array(o).fill(0),c=1;c<o;)s[c]<c?(r=c%2&&s[c],a=t[c],t[c]=t[r],t[r]=a,++s[c],c=1,i.push([].concat(t))):(s[c]=0,++c);return i},nth:function(e){var t=+e+"";return e+("1"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"2"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"3"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"th":"rd":"nd":"st")},plural:function(e,t,n){return e+" "+(1!==Math.abs(e)?n||t+"s":t)},andList:function(e){return e.length<=1?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:t,anyLowercase:o,anyCasedLetter:e,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(b,"")},allKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return u[e]})},someKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return u[e]})},buttonsDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return h[e]})},anyInputDown:function(){return 0<p+m},mouseCoords:g,parentColours:function(e){for(var t,n={colour:null,backgroundColour:null},r=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent())if(n.backgroundColour||(t=e.css("background-color")).match(r)||(n.backgroundColour=t),n.colour||(t=e.css("color")).match(r)||(n.colour=t),n.colour&&n.backgroundColour)return n;return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){if(!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))){if(n.includes(e.tagName.toLowerCase())||/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style")))return!1;a.includes(e.tagName.toLowerCase())||t.push(e)}return!0})&&t.every(function(e){return/inline|none/.test(window.getComputedStyle(e).display)})},transitionOut:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||s(t),!(1<e.length)&&v.childrenProbablyInline(e)&&["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag())||(e=e.wrapAll("<tw-transition-container>").parent()),i&&e.css("transform-origin",i),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":"".concat(n,"ms"),"animation-delay":"".concat(-o,"ms"),"animation-play-state":"paused"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),y(e,n,r-o,a,function(){e.remove()}))},transitionIn:function(u,e,t){var p,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==u.length&&(t=t||s(e),(p=1<u.length||!v.childrenProbablyInline(u)||!["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(u.tag()))&&(u=u.wrapAll("<tw-transition-container>").parent()),o&&u.css("transform-origin",o),u.attr("data-t8n",e).addClass("transition-in").css(_objectSpread({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-a,"ms")},n-a?{visibility:"hidden","animation-play-state":"paused"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(u)?u.css("display","inline"):u.parent().is("tw-backdrop,tw-story")||u[0].setAttribute("style",u[0].getAttribute("style")+"display:block !important;width:100%")}),y(u,t,n-a,r,function(){var e=0===u.filter(f.join(",")).length;if(p&&e){u.find("tw-transition-container, .transition-in, .transition-out").each(function(e,t){((t=d(t)).data("expediteAnim")||Object)()});for(var t=[],n=u.find("*"),r=0;r<n.length;r+=1){var a=n[r];0===a.scrollTop&&0===a.scrollLeft||t.push([a,a.scrollLeft,a.scrollTop])}e=u.find(document.activeElement);u.contents().unwrap();for(var o=0,i=t;o<i.length;o++){var s=_slicedToArray(i[o],3),c=s[0],l=s[1],s=s[2];c.scrollLeft=l,c.scrollTop=s}e.length&&e[0].focus()}else u.removeClass("transition-in").removeAttr("data-t8n")}))},debounce:function(e){function t(){300<Date.now()-l||s<=u?(u=n=0,p=!i,o?(e(c),c=[]):e.apply(void 0,_toConsumableArray(c)),p=!1):n=requestAnimationFrame(t)}var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=r.batch,o=void 0!==a&&a,a=r.recur,i=void 0!==a&&a,a=r.maxWait,s=void 0===a?1/0:a,c=[],l=0,u=0,p=!1;return function(){var e;p||(e=Date.now(),u+=e-l,l=e,o?c.push(arguments):c=arguments,n&&cancelAnimationFrame(n),n=requestAnimationFrame(t))}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},onStartup:function(e){l?l.push(e):e()},get storyElement(){return i},detachStoryElement:function(){document.documentElement.contains(i[0])&&(c=i.parent(),i.detach())},reattachStoryElement:function(){document.documentElement.contains(i[0])||(c||d(document.body)).append(i.parents().length?i.parents().last():i)},options:{speedMultiplier:1}};return d(function(){i=d("tw-story"),l.forEach(function(e){return e()}),l=null}),Object.freeze(v)}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,y,b,v,w){var k=e.objectName,S=e.matches,t=e.toSource;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ObjectName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ToSource:function(){return"into"===this.operator?"".concat(t(this.src)," ").concat(this.operator," ").concat(t(this.dest)):"".concat(t(this.dest)," ").concat(this.operator," ").concat(t(this.src))},TwineScript_Unstorable:!0,set:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=[],r=function e(t,n,r){var a=!(2<arguments.length&&void 0!==r)||r,o=[],i=n&&v.isPrototypeOf(n)?n.get():n;if(w.containsError(i))return i;if(Array.isArray(i)&&Array.isArray(t)){for(var s=0,c=0;s<t.length&&c<i.length;){var l=t[s],u=i[c];if(y.isPrototypeOf(l)&&l.datatype.rest||b.isPrototypeOf(l)&&l.rest){for(var p=c;c<i.length&&S(l,u);)u=i[c+=1];y.isPrototypeOf(l)?l.datatype=[l.datatype]:b.isPrototypeOf(l)&&(l=b.create("array")),o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,{first:p+1,last:c+1}):i.slice(p,c)))}else o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,c+1):u)),c+=1;s+=1}return s<t.length?a&&w.create("operation","I can't unpack this array because it needs ".concat(t.length-s," more value").concat(0<t.length-s?"s":"",".")):o}if(t instanceof Map&&i instanceof Map){var d,f=_createForOfIteratorHelper(t.entries());try{for(f.s();!(d=f.n()).done;){var h=_slicedToArray(d.value,2),m=h[0],g=h[1];if(!i.has(m))return a&&w.create("operation","I can't unpack this datamap because it needs a '"+m+"' data name.");o=o.concat(e(g,v.isPrototypeOf(n)?v.create(n,m):i.get(m)))}}catch(e){f.e(e)}finally{f.f()}return o}if(y.isPrototypeOf(t)){if("function"==typeof t.datatype.destructure)return[{dest:t,value:i,src:n}].concat(t.datatype.destructure(i));if(!S(i,t.datatype))return a&&w.create("operation","I can't put ".concat(k(i)," into ").concat(t.varRef.TwineScript_ToSource()," because it doesn't match ").concat(t.varRef.TwineScript_ToSource(),"'s datatype, ").concat(k(t.datatype),"."));o=o.concat(e(t.datatype,i))}return v.isPrototypeOf(t)||y.isPrototypeOf(t)?o.concat({dest:t,value:i,src:n}):"function"==typeof t.destructure?o.concat(t.destructure(i)):S(i,t)?o:a&&w.create("operation","I tried to unpack, but "+k(t)+" in the pattern didn't match "+k(i)+".")}(this.dest,this.src);if(e=w.containsError(r))return e;if(!r.length)return w.create("operation","I can't store a new value inside "+k(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var a,o=_createForOfIteratorHelper(r.reverse());try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.dest,c=i.value,l=i.src;if(y.isPrototypeOf(s)){if(e=w.containsError(s.defineType()))return e;s=s.varRef}if(e=s.set(c,this.srcRef),w.isPrototypeOf(e))return e;t&&l&&l.delete(),n.shift(k(s)+" is now "+k(c))}}catch(e){o.e(e)}finally{o.f()}return n.join("; ")},create:function(e,t,n,r){return w.containsError(e)?e:w.containsError(t)?t:Object.assign(Object.create(this),{dest:e,src:t,operator:n,srcRef:r})}})}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var i=e.plural,a=e.impossible,o=t.is,s=t.toSource,c={},l={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(s))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},get TwineScript_ObjectName(){1===this.params.length&&36<(e=s(this.params[0])).length&&(e=void 0);for(var e,t="a (".concat(this.macroName,":").concat(e||"",") changer"),n=this.next,r=(n&&(t+=" combined with "),0);n&&t.length<48;){var a="(".concat(n.macroName,":)");t+=(0<r&&!n.next?" and ":"")+a+(n.next?", ":""),n=n.next,r+=1}for(var o=0;n&&o<99;)n=n.next,o+=1;return 0<o&&(t+="".concat(0<r?" and ":"").concat(i(o,"other changer"))),t},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return Array.isArray(t)||a("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,canEnchant:r})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t},TwineScript_is:function(e){if(l.isPrototypeOf(e))return this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next)},TwineScript_Clone:function(){for(var e=l.create(this.macroName,this.params,this.next),t=e;t.next;)t=t.next=t.next.TwineScript_Clone();return e.canEnchant=this.canEnchant,e},run:function(e,t){var n="output"===this.macroName?[t||this]:this.params,n=c[this.macroName].apply(c,[e].concat(_toConsumableArray(n)));if(r.containsError(n))return n;this.next&&this.next.run(e,t||this)},register:function(e,t){c[e]=t}};return Object.freeze(l)}),define("datatypes/codehook",[],function(){var t=Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_ToSource:function(){return this.source},TwineScript_Print:function(){return this.code},TwineScript_toString:function(){return this.source},TwineScript_is:function(e){return t.isPrototypeOf(e)&&this.source===e.source},TwineScript_Clone:function(){return t.create(this.code,this.source)},create:function(e,t){return Object.assign(Object.create(this),{code:e,source:t})}});return t}),define("datatypes/colour",["jquery"],function(c){var l=Math.max,u=Math.min,a=Math.sin,o=Math.cos,i=Math.pow,p=Math.round,d=Math.floor,s=Math.atan2,f=Math.cbrt,h=Math.sqrt,m=Math.PI,g=Object.assign,y=Object.create,b=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,t=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,v=y(null);function w(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(0<r.length)return w.apply(void 0,[w(e,t)].concat(r));if(!t)return e;for(var o=[],i=0;i<e.length;i++){o[i]=[];for(var s=0;s<t[0].length;s++){for(var c=0,l=0;l<e[0].length;l++)c+=e[i][l]*t[l][s];o[i][s]=c}}return o}function n(e){var t,n=e.r,r=e.g,a=e.b,e=e.a,o=l(n/=255,r/=255,a/=255),i=u(n,r,a),s=(o+i)/2,c=o-i;if(o===i)return{h:0,s:0,l:s};switch(o){case n:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-n)/c+2;break;case a:t=(n-r)/c+4}return{h:t=p(60*t),s:.5<s?c/(2-o-i):c/(o+i),l:s,a:e}}var k=[.9642956764295677,1,.8251046025104602],S=24389/27,T=216/24389,_=function(e){return e.map(function(e){return[e]})},x=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,n=e.c,r=e.h,e=e.a,n=[t*=100,n*o(r*m/180),n*a(r*m/180)],r=[];r[1]=(n[0]+16)/116,r[0]=n[1]/500+r[1],r[2]=r[1]-n[2]/200;n=[i(r[0],3)>T?i(r[0],3):(116*r[0]-16)/S,S*T<t?i((16+t)/116,3):t/S,i(r[2],3)>T?i(r[2],3):(116*r[2]-16)/S].map(function(e,t){return e*k[t]}),t=_slicedToArray(x(w([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],w([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],_(n)))).map(function(e){return u(255,l(0,255*(.0031308<(e=e)?1.055*i(e,1/2.4)-.055:12.92*e)))}),3);return{r:t[0],g:t[1],b:t[2],a:e}}function e(e){function t(e){return 1e-5<=n[e]&&n[e]<=255-1e-5}var n=O(e);if(Object.keys(n).every(t))return n;var r=(e=_objectSpread({},e)).c,a=0;for(e.c/=2;1e-5<r-a;)n=O(e),Object.keys(n).every(t)?a=e.c:r=e.c,e.c=(r+a)/2;return O(e)}var A=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),e=e.toRGBA();return A.create({r:u(p(.6*(t.r+e.r)),255),g:u(p(.6*(t.g+e.g)),255),b:u(p(.6*(t.b+e.b)),255),a:(t.a+e.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){var t;return!!A.isPrototypeOf(e)&&(e.lcha&&this.lcha?e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a:(t=this.toRGBA(),(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a))},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA(),t=e.r,n=e.g,r=e.b,e=e.a;return"rgba(".concat(t,", ").concat(n,", ").concat(r,", ").concat(e,")")},toHSLA:function(){return n(this.toRGBA())},toRGBA:function(){return this.lch?e(_objectSpread({a:this.a},this.lch)):this},toLCHA:function(){return this.lch?_objectSpread({a:this.a},this.lch):(t=(e=this).r,n=e.g,r=e.b,e=e.a,n=[116*(t=x(w([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],w([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],_([t/255,n/255,r/255].map(function(e){return e<.04045?e/12.92:i((e+.055)/1.055,2.4)}))))).map(function(e,t){return e/k[t]}).map(function(e){return T<e?f(e):(S*e+16)/116}))[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])],r=180*s(n[2],n[1])/m,{l:n[0]/100,c:h(i(n[1],2)+i(n[2],2)),h:0<=r?r:360+r,a:e});var e,t,n,r},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,A.create(t)},TwineScript_GetProperty:function(e){var t;return"lch"===e?(t=this.toLCHA(),new Map([["l",t.l],["c",t.c],["h",t.h]])):(t=this.toRGBA(),"h"===e||"s"===e||"l"===e?n(t)[e]:"r"===e||"g"===e||"b"===e||"a"===e?t[e]:void 0)},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){if(0===this.a)return"transparent";var e=!this.lch&&n(this);if(1===e.l&&!e.h&&!e.s)return"white";if(0===e.l&&!e.h&&!e.s)return"black";if(.5<=e.l&&e.l<.5334&&0===e.s)return"gray";if(.5===e.l&&.8<=e.s&&e.s<.804){var t={0:"red",30:"orange",60:"yellow",90:"lime",120:"green",180:"cyan",210:"blue",240:"navy",270:"purple",300:"magenta"}[e.h];if(t)return t}return"(".concat(this.lch?"lch":"hsl",":").concat(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l]).concat(1!==this.a?","+this.a:"",")")},create:function(e){var t,n,r,a,o,i;return"string"==typeof e?this.create((A.isHexString(e)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(b,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(e){var t;return e in v?v[e]:(t="transparent"===(t=c("<p>").css("background-color",e).css("background-color"))?{r:0,g:0,b:0,a:0}:t.startsWith("rgb")?t.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},v[e]=t)})(e)):!("h"in e&&"s"in e&&"l"in e)||"r"in e||"g"in e||"b"in e?("a"in e&&"number"==typeof e.a||(e.a=1),"h"in e&&"c"in e&&!("s"in e)&&"l"in e?g(y(this),{a:e.a,lch:{l:e.l,c:e.c,h:e.h}}):g(y(this),e)):this.create((a=(t=e).h,o=e.s,i=e.l,t=e.a,0===o?{r:e=d(255*i),g:e,b:e}:(r=2*i-(n=i<.5?i*(1+o):i+o-i*o),{r:d(255*s((a/=360)+1/3)),g:d(255*s(a)),b:d(255*s(a-1/3)),a:t})));function s(e){return e<0&&(e+=1),1<e&&--e,e<1/6?r+6*(n-r)*e:e<.5?n:e<2/3?r+(n-r)*(2/3-e)*6:r}},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(b)||e.slice(1).match(t))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?%?\s*,\s*\d+(?:\.\d+)?%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return A}),define("datatypes/customcommand",["internaltypes/changedescriptor","internaltypes/twineerror"],function(l,u){var p=Object.assign,d=Object.create;return Object.seal({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},create:function(e){var t,n=e.toSource,r=e.changer,a=e.hook,o=e.variables,i={};for(t in o)i[t]=[o[t]];var s,c=l.create({source:a,loopVars:i},r);return u.containsError(c)?c:s=p(d(this),{TwineScript_Attach:function(e,t){c.section=e;e=t.run(c);return u.containsError(e)?e:s},TwineScript_Run:function(e){c.section=e;e=c;return c=l.create({source:a,loopVars:i},r),e},TwineScript_ToSource:function(){return n},TwineScript_CustomCommand:function(){return e}})}})}),define("datatypes/custommacro",["jquery","utils","renderer","utils/operationutils","datatypes/customcommand","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(w,e,k,t,S,T,_,x,O){function n(v){return function(e){v.called+=1;for(var t=v.varNames,n=v.params,r=v.body,a=E(N(_),{TwineScript_VariableStore:{type:"temp",name:v.TwineScript_ObjectName+" call #"+v.called},TwineScript_TypeDefs:N(null)}),o=[],i=0,s=!1,c=arguments.length,l=new Array(1<c?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];for(var p=0;p<l.length;p+=1){var d=l[p],f=t[i],h=(a.TwineScript_TypeDefs[f]=n[i].datatype.rest?n[i].datatype.create("array"):n[i].datatype,T.create(a,f));if(x.containsError(h))return h;if(n[i].datatype.rest){var s=!0,m=(a[f]||[]).concat([d]);if(p<l.length-1){a[f]=m;continue}h.set(m)}else h.set(d),i+=1;o.push(O.create(A(h)+" is now "+A(a[f])))}if(!s&&null!=(g=n[i])&&g.datatype.rest){var g=T.create(a,t[i]);if(x.containsError(g))return g;g.set([]),a.TwineScript_TypeDefs[name]=n[i].datatype.create("array")}var y,g=w("<p>").append(k.exec(r.code)),b=e.stack.length,r=(e.stack.unshift({tempVariables:a,dom:g,output:function(e){y=e}}),e.evalReplay);for(e.evalReplay=null,e.execute();e.stack.length>b;)e.stack.shift();e.evalReplay=r;r=g.find("tw-error");return r.length?(g.prepend(o.map(function(e){return e.render()}),"<br>"),x.create("propagated","".concat(r.length," error").concat(1<r.length?"s":""," occurred when running ").concat(v.TwineScript_ObjectName,"."),void 0,g)):void 0===y?x.create("custommacro","".concat(v.TwineScript_ObjectName," didn't output any data or hooks using (output:) or (output-data:).")):"object"===_typeof(y)&&"changer"in y?S.create(E(y,{toSource:"(".concat(v.TwineScript_KnownName||"unnamed",":").concat(l.map(C),")")})):y}}var r=e.andList,A=t.objectName,a=t.typeName,o=t.matches,C=t.toSource,E=Object.assign,N=Object.create,i=Object.seal({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",TwineScript_GetProperty:function(e){if("params"===e)return _toConsumableArray(this.params)},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){var e=E(N(i),this);return e.fn=n(e),e},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},createFromFn:function(e,t,n,r){return E(N(i),{params:[],fn:e,typeSignature:r,TwineScript_ObjectName:t,TwineScript_ToSource:n,TwineScript_KnownName:""})},create:function(e,t){t=E(N(i),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(t){var e=t.datatype.toTypeSignatureObject?t.datatype.toTypeSignatureObject({rest:t.rest}):{pattern:"range",range:function(e){return o(t.datatype,e)},name:a(t.datatype)};return t.rest?{pattern:"zero or more",innerType:e}:e}),body:t,TwineScript_KnownName:"",TwineScript_ObjectName:"a custom macro (with ".concat(e.length?r(e.map(C)):"no params",")")});return t.fn=n(t),t}});return i}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","datatypes/codehook","internaltypes/twineerror"],function(e,t,n,r,a,o,i,s,c){var l=e.realWhitespace,u=e.anyRealLetter,p=e.anyCasedLetter,d=e.anyNewline,f=t.objectName,e=Object.seal,h=Object.keys,m=Math.floor,g=Math.abs,y={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return y.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e=this.name,e={pattern:"range",range:v[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=(e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e,Object.create(this));return n.name=e,n.rest=t,n},from:function(t){var e=h(b).find(function(e){return b[e](t)});return e?y.create(e):c.create("datatype",f(t)+" doesn't correspond to a datatype value.")}},b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return y.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return a.isPrototypeOf(e)},lambda:function(e){return o.isPrototypeOf(e)},macro:function(e){return i.isPrototypeOf(e)},codehook:function(e){return s.isPrototypeOf(e)},command:function(e){return e&&"command"===e.TwineScript_TypeID},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},v=_objectSpread(_objectSpread({},b),{},{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e||e.length)},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+d+"$")},any:function(){return!0},const:function(){return!0}});return e(y)}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var r=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,t){var n=e.colour,e=e.stop;return r.stops[t].stop===e&&r.stops[t].colour.TwineScript_is(n)})},TwineScript_Clone:function(){return n.create(this.angle,_toConsumableArray(this.stops))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(t){return n.create(this.angle,this.stops.map(function(e){return{colour:e.colour,stop:e.stop*t}}))},toLinearGradientString:function(){var r=this;return(this.repeating?"repeating-":"")+"linear-gradient(".concat(this.angle,"deg, ").concat(this.stops.reduce(function(e,t){var n=t.colour,t=t.stop;return e+n.toRGBAString()+" "+t*(r.repeating?1:100)+(r.repeating?"px,":"%,")},"").slice(0,-1),")")}});return n}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(g,s,e,t){var y=e.textNodeToChars,b=e.realWhitespace,c=e.findTextInNodes,r=t.toSource;function l(e){function t(n,e){if(Array.isArray(e))return e.reduce(function(e,t){return e.add(n.get(t))},g());if(e&&"object"===_typeof(e)&&"first"in e&&"last"in e){for(var t=e.first,r=e.last,a=n.length,o=(t<0&&(t+=a),r<0&&(r+=a),[n.get(t)]);t!==r;)t+=Math.sign(r-t),o.push(n.get(t));return g(o)}if("string"==typeof e){if("chars"===e){var i,s=[],c=_createForOfIteratorHelper(n.textNodes(m));try{for(c.s();!(i=c.n()).done;){var l,u=i.value,p=_createForOfIteratorHelper(y(u));try{for(p.s();!(l=p.n()).done;){var d=l.value;d.textContent.match(b)||s.push(d)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){c.e(e)}finally{c.f()}return g(s)}if("links"===e)return n.findAndFilter("tw-link, .enchantment-link");if("visited"===e)return n.findAndFilter("tw-link.visited");var f,h;if("lines"===e)return f=n.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),h=[[]],n.contents().each(function e(t,n){var r=(n.tagName||"").toLowerCase();if("tw-sidebar"!==r)if("tw-passage"===r||"tw-transition-container"===r)g(n).contents().each(e);else{if(f.length){if(n===f[0])return f.shift(),void h.push([]);if(16&n.compareDocumentPosition(f[0]))return h.push([]),g(n).contents().each(e),void h.push([])}h[h.length-1].push(n)}}),g(h.map(function(e){return!!e.length&&g(e).wrapAll("<tw-pseudo-hook>").parent()[0]}).filter(Boolean))}return g(n.get(e))}var n,r,a=e.dom,m=":not(tw-error, tw-error *)",o=g();this.next&&(o=o.add(l.call(this.next,e)));if(this.selector){if("string"===this.selector.type)i=this.selector.data,n=c((n=a).textNodes(),i),r=g(),n.forEach(function(e){r=r.add(g(e).wrapAll("<tw-pseudo-hook>").parent())}),i=r;else{if("base"===this.selector.type)return o.add(t(l.call(this.selector.data,e),this.property));n=this.selector.data,e='tw-hook[name="'+(n=s.insensitiveName(n).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+n+'"]';var e=e+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[n]||"",i=a.findAndFilter(e).add(a.parentsUntil(s.storyElement.parent())).filter(e)}o=this.property?o.add(t(i,this.property)):o.add(i)}return o=o.get().reduce(function(e,t){return t=g(t),e.add(t.is("tw-enchantment")&&t.contents().length<=1?t.contents():t)},g())}function a(e){var t,n;return e?(t=e.selector,n=e.property,e=e.next,[JSON.stringify(["base"===t.type?a(t.data):s.insensitiveName(t.data),n])].concat(_toConsumableArray(a(e))).sort()):[]}var o=Object.freeze({forEach:function(e,n){var t=l.call(this,e).each(function(e,t){return n(g(t),e)});return e.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),t},hooks:function(e){return l.call(this,e)},get TwineScript_ObjectName(){return"the hook name ".concat(this.TwineScript_ToSource())},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",t=this.selector,n=t.type,t=t.data;return"name"===n?t.match(RegExp("^"+s.anyRealLetter+"+$"))?e+="?"+t:e+="(hooks-named:"+JSON.stringify(t)+")":"string"===n?e+=JSON.stringify(t):"base"===n&&(e+=t.TwineScript_ToSource()+"'s "+r(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return a(this)+""==a(e)+""},TwineScript_GetProperty:function(e){return o.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return o.create(this.selector,this.property,this.next)},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||o),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return o.isPrototypeOf(e)||"string"==typeof e||s.impossible("HookSet.from() was given a non-HookSet non-string."),o.isPrototypeOf(e)?e:o.create({type:"string",data:e})}});return o}),define("datatypes/lambda",["utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,h,s,m){var g=e.objectName;var c=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("each"in this?"each ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:c,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(c),this)},create:function(e,t,n,r){var a,o="temp variable, or typed temp variable";function i(e){e=e&&e.varRef?e.varRef:e;return void 0===e||e&&s.isPrototypeOf(e)&&h.isPrototypeOf(e.object)&&1===e.propertyChain.length}if(m.containsError(n))return n;if("making"===t&&!i(n))return m.create("syntax","I need a "+o+", to the right of '"+t+"', not "+g(n)+".");if(m.containsError(e))return e;if(c.isPrototypeOf(e)){if("when"===t||"when"in e)return m.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+t+"'.");if(t in e)return m.create("syntax","This lambda has two '"+t+"' clauses.");a=e}else{if("when"===t&&void 0!==e)return m.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!i(e))return m.create("syntax","This lambda needs to start with a single "+o+", not "+g(e)+".");(a=Object.create(this)).loop=e||""}return a.source=r.trim(),a[t]=n,a.making&&a.making.getName()===(a.loop&&a.loop.getName())?m.create("syntax","This lambda has two variables named '"+a.loop.getName()+"'.","Lambdas should have all-unique parameter names."):a},apply:function(e,t){var n=t.loop,r=t.pos,a=t.making,o=t.ignoreVia;function i(e,t){if(e){var n,r;if("datatype"in e&&"varRef"in e)return n=e.varRef.create(s,e.varRef.propertyChain),m.containsError(n)?n:(r=n.defineType(e.datatype),m.containsError(r)||(r=n.set(t),m.containsError(r))?r:void 0);s[e.getName()]=t}}var s=(s=t.tempVariables)||Object.create(e.stack.length?e.stackTop.tempVariables:h),t=i(this.loop,n)||i(this.making,a);if(m.containsError(t))return t;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:s,lambdaPos:this.when?void 0:r})),!n||this.making||this.when?e.Identifiers.it=m.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName):e.Identifiers.it=n;var c,l,u,p,d,t=!o&&this.via,o="where"in this||"when"in this,f=e.evalReplay;return e.evalReplay=f?[]:null,o?(c=e.eval(this.where||this.when),l=e.evalReplay,e.evalReplay=l&&t?[]:null,!n||this.making||this.when||(e.Identifiers.it=n),u=c,p=!t||e.eval(t),d=null,u=m.containsError(u)||("boolean"!=typeof u?m.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+g(u)+"."):u?p:d)):c=u=!t||e.eval(t),p=t?e.evalReplay:null,e.stack.shift(),(e.evalReplay=f)&&(o||t)&&(((d=f[f.length-1])||{}).lambda&&d.lambda.obj===this||((d={lambda:{obj:this,loops:[]},code:(f[f.length-1]||{}).code||""}).fromCode=d.code,f.push(d)),d.lambda.loops.push(_objectSpread(_objectSpread(_objectSpread({it:n,pos:r},void 0!==a&&{making:a}),t&&{viaReplay:p,viaResult:u}),o&&{whereReplay:l,whereResult:null!==c&&c}))),u},filter:function(r,e){var a,o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return e.reduce(function(e,t,n){return a||(n=o.apply(r,{loop:t,pos:n+1,ignoreVia:!0,tempVariables:i}),a=m.containsError(n))||e.concat(n?[t]:[])},[])}});return c}),define("datatypes/typedvar",["utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,a,o){var i=e.typeName,t=e.matches,n=e.toSource,s=e.unstorableValue,e=Object.freeze,c=Object.assign,l=Object.create,u=e({TwineScript_TypeName:"a TypedVar (typed variable name)",get TwineScript_ObjectName(){var e=n(this.datatype);return"the ".concat(e.length<24?e+"-":"","typed variable name, ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return c(l(u),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return n(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return t(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n,r;return(n=o.containsError(t)||o.containsError(e)||t.error)||(a.isPrototypeOf(t)?(n=t.object,r=t.compiledPropertyChain,n&&n.TwineScript_VariableStore&&1===r.length&&n.TwineScript_TypeDefs?(r=s(e))&&!u.isPrototypeOf(r)?o.create("syntax","The -type syntax can't have "+i(r)+" to its left."):c(l(this),{datatype:e,varRef:t}):o.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.")):o.create("syntax","The -type syntax must have a variable to its right."))}});return u}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(o,e,t,n,r){var a=t.objectName;return n.on("set",function(r,a){r.TwineScript_VariableStore&&e.storyElement.find("[data-2bind]").each(function(e,t){var n=(t=o(t)).data("twoWayBindEvent");"function"==typeof n&&n(t,r,a)})}),Object.freeze({TwineScript_TypeName:"a VarBind (bound variable name)",get TwineScript_ObjectName(){return"a ".concat(this.bind," bind to ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A bound variable name]`"},TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var e=this.varRef.set(e);if(e=r.containsError(e))return e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"one way";return r.containsError(e)?e:n.isPrototypeOf(e)?e.error||Object.assign(Object.create(this),{varRef:e,bind:t}):r.create("operation","I can only 'bind' a variable, not "+a(e)+".")}})}),define("debugmode/highlight",["jquery","utils","utils/typecolours","macros","lexer"],function(u,e,t,p,n){var d=e.insensitiveName,f=t.versionClass,h=n.lex;return function(e,t,n,r){if(9999<e.length)return[u("<span>").text(e)];for(var a=h(e,"",t||"macro"),o=[],i="",s=a,c=a.start;c<a.end;c+=1){var l=a.pathAt(c);l[0]!==s[0]&&(o.length&&(o[o.length-1].textContent=i),i="",s=l,o.push(u("<".concat(r&&n<=c&&c<r?"mark":"span",' class="').concat(function(e){for(var t={},n="",r=0;r<e.length;r+=1){var a=e[r],o=a.type,i=a.text,s=("verbatim"!==o&&"comment"!==o||(n=""),f+o);switch(t[s]=(t[s]||0)+1,1<t[s]&&(s+="-"+t[s]),o){case"text":i.trim()&&e.slice(r+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(s+=" ".concat(f,"error"));break;case"macroName":var c,l=e[r].text[0];"_"!==l&&"$"!==l?(c=d(e[r].text.slice(0,-1)),p.has(c)?s+="-"+p.get(c).returnType.toLowerCase():s+=" ".concat(f,"error")):s+=" ".concat(f,"customMacro ").concat(f+("_"===l?"tempV":"v"),"ariable")}n+=s+" "}return n}(s),'">'))[0])),i+=a.text[c-a.start]}return o.length&&(o[o.length-1].textContent=i),o}}),define("debugmode/mode",["jquery","utils","utils/naturalsort","state","engine","internaltypes/varref","internaltypes/twineerror","utils/operationutils","utils/renderutils","passages","section","debugmode/panel","debugmode/highlight","utils/typecolours"],function(I,V,M,D,F,L,H,e,t,z,q,W,B,n){var U=e.objectName,$=e.isObject,G=e.toSource,Y=e.typeID,J=t.dialog,X=n.CSS,K=function(e,t){var f=V.escape,i=V.nth,n=V.debounce,r=I(document.documentElement),a=M(),o={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(D.hasStorage)try{var s=localStorage.getItem("(Debug Options "+V.options.ifid+")");s&&(o=JSON.parse(s))}catch(e){}function c(){if(D.hasStorage)try{localStorage.setItem("(Debug Options "+V.options.ifid+")",JSON.stringify(o))}catch(e){}}W.defaultMaxHeight=o.maxHeight;function l(e){return n(function(){if(V.options.debug)return e.apply(this,arguments)},{maxWait:2e3})}var h=I('<tw-debugger class="'.concat([o.darkMode?"theme-dark":"",o.fadePanel?"fade-panel":""].join(" "),'" style="').concat(o.width?"width:"+o.width+"px":"","\">\n<div class='panel panel-errors' hidden><table></table></div>\n<div class='tabs'></div>\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\n<button class='show-invisibles'>\ud83d\udd0d Debug View</button>\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\n<button class='close'>\u2716</button>\n<div class='resizer-h'>\n</tw-debugger>")),s=h.find(".tabs"),u=h.find(".show-dom"),p=h.find(".show-invisibles"),d=h.find(".close"),m=h.find(".turns");I(document.documentElement).on("click","tw-expression, tw-error, tw-eval-explanation",n(function(e){var r,a,o,i,l,u,p,d,t=I(e.target).data("evalReplay");function n(){var e,s,c=r[a],t=o.find("tw-eval-explanation").empty(),n=o.find("tw-eval-code");c.toCode||c.toDesc||c.error||c.lambda?(o.find("tw-eval-code").empty().append(B(c.code,"macro",0<a&&c.start,0<a&&c.end+c.diff)),t.append(c.lambda?"":"<code class='".concat(56<c.fromCode.length?"from-block":"from-inline","'></code>"),c.error?"<span> caused an error: </span>":c.lambda?"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>":"<span> became".concat(c.ToDesc?"\u2026":""," </span>").concat(c.toDesc?"<span class='to-desc'>".concat(f(c.toDesc),".</span>"):"<code class='to-code'></code>")),c.error?t.append(c.error):c.lambda?(s=function(e,t){return I("<".concat(e,"><code></").concat(e,">")).find("code").append(B(t,"macro")).end()},t.find(".to-lambda").append(B(c.lambda.obj.source,"macro")).end().append((e=I("<table>")).append.apply(e,[I("<tr>").append(s("th","pos"),c.lambda.obj.loop?s("th","_"+c.lambda.obj.loop.getName()).append(" / ",I("<code>").append(B("it","macro"))):s("th","it"),c.lambda.obj.making&&s("th","_"+c.lambda.obj.making.getName()),c.lambda.obj.where&&s("th","where").append(" result"),c.lambda.obj.via&&s("th","via").append(" result"))].concat(_toConsumableArray(c.lambda.loops.map(function(e){var t=e.it,n=e.pos,r=e.making,a=e.whereResult,o=e.whereReplay,i=e.viaResult,e=e.viaReplay;return I("<tr>").append(s("td",G(n)),s("td",G(t)),void 0!==r&&s("td",G(r)),null!=a&&(H.containsError(a)?I("<td>").append(a.render(c.lambda.obj.source,!0)):s("td",G(a))).append(o&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",o)),null!=i&&(H.containsError(i)?I("<td>").append(i.render(c.lambda.obj.source,!0)):s("td",G(i))).append(e&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)))})))))):c.toDesc||t.find(".to-code").append(B(c.toCode,"macro")),t.next().html(c.itIdentifier?'(The <code class="cm-harlowe-3-identifier">it</code> identifier now refers to '.concat(f(c.itIdentifier),".)"):"").next().text(c.reason||"")):(n.html(B(c.code,"macro")),t.html("<center>First, there was <code></code>.</center>").next().empty().next().empty()),c.lambda||t.find("code").first().append(B(c.fromCode,"macro")),o.find("mark").each(function(e,t){t.scrollIntoView()}),i.css("visibility",a<=9?"hidden":"visible"),l.css("visibility",a<=0?"hidden":"visible"),p.css("visibility",a>=r.length-1?"hidden":"visible"),d.css("visibility",a>=r.length-10?"hidden":"visible"),u.html("( ".concat(a+1,"/").concat(r.length," )"))}t&&(r=t,t=J({buttons:[{name:"Understood",confirm:!(a=0),callback:function(){return!h.find("tw-backdrop").length&&h.removeClass("show-dialog")}}]}).addClass("eval-replay"),o=I("<tw-eval-replay>".concat(1===r.length?"":"<tw-eval-code></tw-eval-code>","<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>").concat(1===r.length?"":"<tw-dialog-links><tw-link style='visibility:hidden'>\u2190 10</tw-link><tw-link style='visibility:hidden'>\u2190 \u2190</tw-link><b></b><tw-link>\u2192 \u2192</tw-link><tw-link>10 \u2192</tw-link></tw-dialog-links>","</tw-eval-replay>")),t.find("tw-dialog").css({width:"75vw","max-width":"75vw"}).prepend(o),i=o.find("tw-link:first-of-type"),l=i.next(),u=l.next(),p=u.next(),d=p.next(),n(),i.on("click",function(){a=Math.max(0,a-10),n()}),l.on("click",function(){a=Math.max(0,a-1),n()}),p.on("click",function(){a=Math.min(r.length-1,a+1),n()}),d.on("click",function(){a=Math.min(r.length-1,a+10),n()}),h.find("tw-backdrop").length?h.find("tw-backdrop").before(t):h.addClass("show-dialog").append(t));var s,t=I(e.target).data("goto");t&&(s=V.options.ignoreGotos,V.options.ignoreGotos=!1,t.command.TwineScript_Run(t.section),V.options.ignoreGotos=s),e.stopPropagation()})),h.find(".resizer-h").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=h.width();r.on("mousemove.debugger-resizer-h",function(e){e=e.pageX;h.width("".concat(n+t-e|0,"px"))}).on("mouseup.debugger-resizer-h",function(){r.off(".debugger-resizer-h"),o.width=h.width(),c()})}),h.on("mousedown",".resizer-v",function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageY,n=I(e.target.parentNode).height();r.on("mousemove.debugger-resizer-v",function(e){e=e.pageY;h.find(".panel").css("maxHeight","".concat(n+t-(0|e),"px"))}).on("mouseup.debugger-resizer-v",function(){r.off(".debugger-resizer-v"),o.maxHeight=h.find(".panel").css("maxHeight"),c()})}),p.click(function(){r.toggleClass("debug-mode").removeClass("dom-debug-mode"),p.toggleClass("enabled"),u.removeClass("enabled")}),u.click(function(){r.toggleClass("dom-debug-mode").removeClass("debug-mode"),u.toggleClass("enabled"),p.removeClass("enabled")}),d.click(function(){r.removeClass("debug-mode dom-debug-mode"),h.detach(),Object.assign(V.options,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})});function g(e){(e=e.parents(".variable-row, .enchantment-row, .source-row")).next(".panel-row-source").find("td").empty().append(B(e.data("value")||G(e.data("enchantment").changer),e.is("source-row")?"markup":"macro"))}function y(){return k=new Set}function b(){I(document.body).append(h),V.options.debug=!0,V.options.evalReplay=o.evalReplay,V.options.speedMultiplier=1,V.options.ignoreClickEvents=!1,V.options.ignoreGotos=!1,R()}var v,w=l(function(){var r=m.children().get(),e=D.timeline,a=0;e.forEach(function(e,t){var n=e.turns,e=e.passage,n=(a+=1+(void 0===n?0:n))+": "+e;r[t]?r[t].textContent=n:m.append("<option value='".concat(t,"'>").concat(n,"</option>"))}),e.length<r.length&&I(r.slice(e.length)).remove(),m[1<=e.length?"removeAttr":"attr"]("disabled"),m.val(D.pastLength)}),k=(m.change(function(e){e=e.target.value-D.pastLength;0!=e&&(D[e<0?"rewind":"fastForward"](Math.abs(e)),F.showPassage(D.passage))}),w(),D.on("forward",w).on("load",w).on("forgetUndos",function(){return w}).on("back",function(){D.pastLength<=1&&m.attr("disabled"),m.find("[selected]").removeAttr("selected"),m.val(D.pastLength)}),new Set),S=W.create({className:"variables",tabName:"Variable",rowWrite:function(e,t){var n,r=e.name,a=e.dataset,o=e.path,i=e.value,s=e.tempScope,e=e.type,c=i&&48<i.length&&!i.TwineScript_DebugName,l=$(i)&&i.TwineScript_DebugName?i.TwineScript_DebugName():f(U(i)),u="",a=(o.length&&(u=o.reduce(function(e,t){return e+t+"'s "},"")),a&&(r="???"),e?G(e):""),e="object"===_typeof(i)||c;return t?(t[0].firstChild.innerHTML=a||"",u&&I(t[0].firstChild).children(".variable-path").html((s?"_":"$")+f(u)),t[0].childNodes[1].lastChild.textContent=(u?"":s?"_":"$")+f(r+""),t[0].childNodes[2].textContent=s||"",t[0].childNodes[3].innerHTML=l,n=(c=I(t[0].lastChild.firstChild)).is(".open"),c[e?"show":"hide"](),c=t.next(".panel-row-source"),n&&c.find("td").empty().append(B(G(i))),t.data("value",G(i)),t.add(c)):I('<div class="variable-row">').attr("data-name",r).attr("data-path",o+"").attr("data-scope",s||"").css("padding-left",Math.min(5,o.length)+"em").append("<td class='variable-type'>".concat(a||"","</td>"),"<td class='variable-name cm-harlowe-3-"+(s?"tempV":"v")+"ariable'><span class='variable-path'>"+(u?(s?"_":"$")+f(u):"")+"</span> "+(u?"":s?"_":"$")+f(r+"")+"</td>","<td class='temporary-variable-scope'>".concat(s||"","</td>"),"<td class='variable-value cm-harlowe-3-macroName-"+Y(i)+"'>"+l+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(e?"visible":"none")+"'>(source:) </tw-folddown></td>").data("value",G(i)).find("tw-folddown").data("folddown",g).end().add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>")},rowCheck:function(e,t){var n=e.name,r=e.path,e=e.tempScope;return t[0]&&t[0].getAttribute("data-name")===n&&t[0].getAttribute("data-path")===r+""&&t[0].getAttribute("data-scope")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="variable-type">Type</th><th data-col="variable-name">Name</th><th data-col="temporary-variable-scope">Scope</th><th data-col="variable-value">Value</th></tr>'},rowSort:function(e,t,n){if("variable-value"===e)return a(t.attr("class"),n.attr("class"))||a(t.parent().data("value"),n.parent().data("value"))}}),T=l(function(){var e,t,o=[],n=D.variables,r=o.length;for(e in n)e.startsWith("TwineScript")||(r+=1,function n(e){var r,t,a;500<o.length||(o.push(e),r=e.path.concat(e.name),t=e.value,a=e.tempScope,r.length<=4&&(Array.isArray(t)?t.forEach(function(e,t){return n({name:i(t+1),path:r,value:e,tempScope:a})}):t instanceof Map?_toConsumableArray(t).forEach(function(e){var t=(e=_slicedToArray(e,2))[0],e=e[1];return n({name:t,path:r,value:e,tempScope:a})}):t instanceof Set&&_toConsumableArray(t).forEach(function(e,t){return n({name:t,dataset:!0,path:r,value:e,tempScope:a})})))}({name:e,path:[],value:n[e],tempScope:"",type:null==(t=n.TwineScript_TypeDefs)?void 0:t[e]}));o.push.apply(o,_toConsumableArray(k)),r+=k.size,S.update(o,r),0===r!==S.panel[0].classList.contains("panel-variables-empty")&&S.panel.toggleClass("panel-variables-empty")}),_=(L.on("set",function(e,t,n){var r,a;e===D.variables||"temp"!==(null==(a=e.TwineScript_VariableStore)?void 0:a.type)||null!=(a=e.TwineScript_VariableStore)&&a.name.match(/#\d+$/)||(r=null==(a=e.TwineScript_VariableStore)?void 0:a.name,e=null==(a=e.TwineScript_TypeDefs)?void 0:a[t],(a=_toConsumableArray(k).find(function(e){return e.name===t&&e.tempScope===r}))?a.value=n:k.add({name:t,path:[],value:n,tempScope:r,type:e})),T(),v()}).on("delete",function(){T(),v()}),S.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),S.tab.addClass("enabled"),S.panel.find(".clipboard")),x=(r.on("click",".panel-variables-copy",function(){var e,t=[];for(e in D.variables)e.startsWith("TwineScript")||t.push("$"+e+" to "+G(D.variables[e]));_.val("(set:"+t+")")[0].select(),document.execCommand("copy")}),W.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(e,t){var n=e.scope,r=e.changer,a=e.lambda,o=e.name,i=e.localHook,a=r?f(U(r)):a?f(G(a)):"<em>enchanted with ("+o+":)</em>";return t||I('<div class="enchantment-row">').data("enchantment",e).append("<td><span class='enchantment-name'>"+G(n)+(i?"</span><span class='enchantment-local cm-harlowe-3-hookName'>"+("function"==typeof i.TwineScript_ToSource?i.TwineScript_ToSource():i.attr("name")?"?"+i.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value cm-harlowe-3-macroName-"+(r?"changer":"command")+" '>"+a+"</td>"+(r?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).find("tw-folddown").data("folddown",g).end().add(r?I("<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>"):"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="enchantment-name">Scope</th><th data-col="enchantment-value">Value</th></div>'}})),d=l(function(e){x.update(e.enchantments,e.enchantments.length)}),O=(q.on("add",d).on("remove",d),q.create()),A=W.create({className:"storylets",tabName:"Storylet",rowWrite:function(e,t){var n=e.name,r=e.active,a=e.storyletSource,o=e.exclusive,e=e.urgent;return t?(t.toggleClass("storylet-closed",!r),t[0].firstChild.textContent=r?"\u2713":""):(t=I('<tr class="storylet-row '.concat(r?"":"storylet-closed",'">')).attr("data-name",n).append("<td class='storylet-open'>"+(r?"\u2713":"")+"</td><td class='storylet-name'>"+n+"</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>"+o+"</td><td class='storylet-urgent'>"+e+"</td>")).find(".storylet-lambda").append(B(a.replace(/^when\s+/i,""))),t},rowCheck:function(e,t){e=e.name;return t[0].getAttribute("data-name")===f(e+"")},columnHead:function(){return'<tr class="panel-head"><th data-col="storylet-open" data-order="desc">Open</th><th data-col="storylet-name">Name</th><th data-col="storylet-lambda">Condition</th><th data-col="storylet-exclusive" class=\'storylet-exclusive\'>Exclusivity</th><th data-col="storylet-urgent" class=\'storylet-urgent\'>Urgency</th></tr>'}}),C=(A.tab.hide(),v=l(function(){var r,a,o=z.getStorylets(O),i=H.containsError(o),e=z.allStorylets();A.update(e.map(function(t){var e="number"==typeof t.get("exclusivity")?t.get("exclusivity"):0,n="number"==typeof t.get("urgency")?t.get("urgency"):0;return r=r||e,a=a||e,{name:t.get("name"),storyletSource:t.get("storylet").TwineScript_ToSource(),active:!i&&o.some(function(e){return e.get("name")===t.get("name")}),exclusive:e,urgent:n}}),i?0:o.length),A.panel.toggleClass("storylet-error",i),A.panel.toggleClass("panel-exclusive",r),A.panel.toggleClass("panel-urgent",a),e.length&&A.tab.show()}),W.create({className:"source",tabName:"Source",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.tag;return t?t.add(t.next(".panel-row-source")):(t=z.get(n).get("source"),I('<div class="source-row" data-tag="'.concat(e,'">')).data("value",t).append('<td class="source-name">'.concat(n,'</td><td class="source-tags">').concat(e,"</td><td class='panel-row-buttons'><tw-folddown class='").concat(e?"":"open","' tabindex=0></tw-folddown></td>")).find("tw-folddown").data("folddown",g).end().add(I("<tr class='panel-row-source' style='".concat(e?"display:none":"","'><td colspan='3'></td></tr>")).find("td").append(!e&&B(t,"markup")).end()))},rowCheck:function(e,t){e=e.name;return t[0].firstChild.textContent===f(e+"")},tabUpdate:I.noop,columnHead:I.noop})),E=["debug-startup","startup","header","debug-header","footer","debug-footer"].reduce(function(e,t){return e.concat(z.getTagged(t).map(function(e){return{name:e.get("name"),tag:t}}))},[]),N=W.create({className:"errors",tabName:"Error",rowWrite:I.noop,rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return N.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text("".concat(e," Error").concat(1!==e?"s":""))}}),d=n(function(e){var t;V.options.debug&&(N.panelRows.append(e.reduce(function(e,t){var t=_slicedToArray(t,2),n=t[0],t=t[1];return"propagated"===n.type?e:e+'<tr class="error-row"><td class="error-passage">'+D.passage+'</td><td class="error-message" title="'+f(t)+'">'+n.message+"</td></tr>"},"")),500<(t=(e=N.panelRows.children()).length)&&I(Array.prototype.slice.call(N.panelRows[0].childNodes,0,t-500)).remove(),N.tabUpdate(Math.min(500,e.length)))},{batch:!0}),j=(H.on(d),N.panel.append("<div class='panel-errors-bottom'>\n\t\t\t<button class='panel-errors-clean'>\ud83e\uddf9 Clear this panel</button>\n\t\t</div>"),r.on("click",".panel-errors-clean",function(){N.panelRows.empty(),N.tabUpdate(0)}),W.create({className:"tools",tabName:"Tools",tabNameCounter:!1,rowWrite:function(e,t){var n=e.id,r=e.type,a=e.label,o=e.dropdownItems,i=e.dropdownValue;return"checkbox"===r?t?t.find("input").prop("checked",!1):I('<span><input id="debug-'.concat(n,'" type="checkbox"></input><label for="debug-').concat(n,'">').concat(a,"</label></span>")):"dropdown"===r?t?t.find("input").prop("checked",!1):I("<span>".concat(a,'<select style="width:3em" data-default="').concat(i,'" id="debug-').concat(n,'"></span>')).find("select").append(o.map(function(e){return"<option value='".concat(e,"' ").concat(e===i?"selected":"",">").concat(e,"x</option>")})).end():void 0},rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return j.tab.css({background:e?"hsla(210, 72%, 65%, .3)":""})}})),P=(r.on("click, change",'.panel-tools [type="checkbox"], .panel-tools select',function(e){var e=e.target,t=(e=I(e)).attr("id"),n=e.is(":checked")||e.is("select")&&e.val()!==+e.attr("data-default");"debug-peekBehindDialogs"===t&&r.toggleClass("debug-dialogs",n),"debug-ignoreClickEvents"===t&&(V.options.ignoreClickEvents=n),"debug-ignoreGotos"===t&&(V.options.ignoreGotos=n),"debug-speedMultiplier"===t&&(V.options.speedMultiplier=+e.val()),j.tabUpdate(n)}),j.update([{id:"peekBehindDialogs",type:"checkbox",label:"See through and click through <code>(dialog:)</code> boxes"},{id:"ignoreClickEvents",type:"checkbox",label:"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating"},{id:"ignoreGotos",type:"checkbox",label:"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>"},{id:"speedMultiplier",label:"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): ",type:"dropdown",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]),W.create({className:"options",tabName:"\u2699\ufe0f",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.label,r={darkMode:o.darkMode,fadePanel:o.fadePanel,evalReplay:o.evalReplay}[n];return t?t.find("input").prop("checked",r):I('<span><input id="debug-'.concat(n,'" type="checkbox" ').concat(r?"checked":"",'></input><label for="debug-').concat(n,'">').concat(e,"</label></span>"))},rowCheck:I.noop,tabUpdate:I.noop,columnHead:I.noop})),R=(r.on("click",'.panel-options [type="checkbox"]',function(e){var e=e.target,t=(e=I(e)).attr("id"),e=e.is(":checked");"debug-darkMode"===t&&(o.darkMode=e,h.toggleClass("theme-dark",e)),"debug-fadePanel"===t&&(o.fadePanel=e,h.toggleClass("fade-panel",e)),"debug-evalReplay"===t&&(V.options.evalReplay=o.evalReplay=e),c()}),P.update([{name:"darkMode",label:"Debug panel is dark"},{name:"fadePanel",label:"Debug panel is transparent unless the cursor is over it"},{name:"evalReplay",label:"Record expression replays (viewable via \ud83d\udd0d buttons in Debug View; slower)"}]),h.prepend(S.panel,x.panel,N.panel,A.panel,C.panel,j.panel,P.panel),s.prepend(S.tab,x.tab,N.tab,A.tab,C.tab,j.tab,P.tab),D.on("beforeForward",y).on("beforeBack",y).on("beforeLoad",y),l(function(){T(),v(),x.panelRows.empty(),x.tabUpdate(0),D.passage&&z.get(D.passage)&&(C.update(E.concat({name:D.passage,tag:""})),C.panel.find('[data-tag=""], [data-tag=""] + .panel-row-source').insertBefore(C.panel.find('[data-tag="footer"]').first()))}));D.on("forward",R).on("back",R).on("load",R);K=b,I(document.head).append(I("<style>").html(X)),b(),e&&d(e,t)};return F.registerDebugMode(function(e,t){return!V.options.debug&&K(e,t)}),K}),define("debugmode/panel",["jquery","utils/naturalsort"],function(d,e){var i=e();return Object.seal({create:function(e){var n,t=e.className,r=e.rowWrite,a=e.rowCheck,o=e.rowSort,i=e.columnHead,s=e.tabName,c=e.tabNameCounter,l=void 0===c||c,c=e.tabUpdate,u=d("<div class='panel panel-".concat(t,"' style='").concat(this.defaultMaxHeight?"max-height:"+this.defaultMaxHeight+"px":"","' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>")),p=d("<button class='tab tab-".concat(t,"'>").concat(l?"0 ".concat(s,"s"):s,"</button>"));return p.click(function(){p.toggleClass("enabled"),p.parent().siblings(".panel").attr("hidden",""),p.is(".enabled")&&(p.siblings(".tab:not(.tab-"+t+")").removeClass("enabled"),u.removeAttr("hidden"))}),u.on("click","th",function(e){var e=e.target,t="desc"===(e=d(e)).attr("data-order")?"asc":"desc";n.sort(e.attr("data-col"),t),u.find("th[data-order]").removeAttr("data-order"),e.attr("data-order",t)}),c=c||function(e){return p.text(l?"".concat(e," ").concat(s).concat(1!==e?"s":""):s)},n=Object.assign(Object.create(this),{tabName:s,tab:p,panel:u,panelRows:u.find(".panel-rows"),rowWrite:r,rowSort:o,rowCheck:a,columnHead:i,tabUpdate:c})},sort:function(r,a){var o=this;this.panelRows.children(":not(.panel-head, .panel-row-source)").get().sort(function(e,t){var n;return"desc"===a&&(e=(n=[t,e])[0],t=n[1]),e=e.querySelector("."+r),t=t.querySelector("."+r),o.rowSort&&o.rowSort(r,d(e),d(t))||i(e.textContent,t.textContent)}).forEach(function(e){var t=d(e).next(".panel-row-source").get();o.panelRows.append(e,t)})},update:function(e,t){var r=this.rowCheck,a=this.rowWrite,o=this.panelRows,n=this.columnHead,i=this.panel,s=[],c=o.children(),e=(e.forEach(function(t){var e=c.get().filter(function(e){return r(t,d(e))}),n=a(t,e.length&&d(e));e.length||o.append(n),s.push.apply(s,_toConsumableArray(n.get()))}),c.filter(function(e,t){return!s.includes(t)&&!t.className.includes("panel-head")}).remove(),this.tabUpdate(t),0<t&&!o.find(".panel-head").length?o.prepend(n()):0===t&&o.find(".panel-head").remove(),i.find("th[data-order]"));e.length&&this.sort(e.attr("data-col"),e.attr("data-order"))},defaultMaxHeight:300})}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset","internaltypes/twineerror"],function(b,e,t,v,n){function w(e){return("string"==typeof e?e:e.map(function(e){return e.text}).join("")).split(/\n/g).reduce(function(e,t,n,r){r=r.length;return e.concat(document.createTextNode(t),n!==r-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])}var k=e.impossible,S=e.transitionIn,T=t.exec,r=Object.assign,p=Object.keys,a=Object.create,e=Object.seal,_=Array.isArray,x={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,output:!1,summary:function(){var t=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers","output"].filter(function(e){return hasOwnProperty.call(t,e)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",p(this.loopVars).length&&"loopVars",p(this.data).length&&"data"].filter(Boolean))},create:function(e,t){e=r(a(this),{attr:this.attr?this.attr.slice():[],styles:this.styles?this.styles.slice():[],loopVars:this.loopVars||{},data:this.data||{}},e);if(t){t=t.run(e);if(n.containsError(t))return t}return e},update:function(){function e(t){var e,n,r;_(a.styles)&&0<a.styles.length&&(n=(e=_slicedToArray(a.styles.reduce(function(n,r){return p(r).forEach(function(e){var t=r[e];n[+("function"==typeof t)].push(_defineProperty({},e,t))}),n},[[],[]]),2))[0],r=e[1],n.forEach(function(e){return t.css(e)}),setTimeout(function(){r.forEach(function(e){return t.css(e)})})),a.attr&&a.attr.forEach(function(e){return t.attr(e)}),a.data&&t.data(a.data)}var a=this,t=this.section,n=this.newTargets,r=this.transition,o=this.transitionDeferred,i=this.append,s=this.target;"function"==typeof s&&(s=s());if(_(n)&&n.length&&(s=n.map(function(e){return e.target})),_(s))for(var c=0;c<s.length;c+=1)v.isPrototypeOf(s[c])?s[c].forEach(t,e):e(s[c]);else v.isPrototypeOf(s)?s.forEach(t,e):e(s);if(r&&!o&&!i){for(var l,u=s;(l=u.data("timestamp"))||(u=u.parent()),!l&&u.length;);S(s,r,this.transitionTime,this.transitionDelay,this.transitionSkip,l?Date.now()-l:0,this.transitionOrigin)}},render:function(){var e,r=this,t=this.source,n=this.transition,a=this.transitionTime,o=this.transitionDeferred,i=this.enabled,s=this.enablers,c=this.data,l=this.section,u=this.newTargets,p=this.innerEnchantments,d=this.appendSource,f=this.output,h=this.target,m=this.target,g=this.append;if("function"==typeof h&&(h=h()),!g)return k("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),b();if(f)return b();if(null!=s&&s.length)return s=(f=s[0]).descriptor,f=f.changer,s=s.render(),f&&(e=x.create({section:l,target:s}),f.run(e),e.update()),s;if(!i||void 0!==h.attr("hidden"))return x.create({target:h,attr:this.attr.filter(function(e){return!("style"in e)}),data:_objectSpread(_objectSpread({},c),{},{originalSource:t,hidden:!0})}).update(),b();if(!(h=_(u)&&u.length?u:h))return k("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),b();var y=b();if([].concat(h).filter(function(e){return!e.jquery}).map(function(e){var t,n,r=g;return e.target&&e.append&&(r=(t=e).append,n=t.before,e=e.target),{elements:e.hooks(l,m).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(m[0]))}),append:r}},[]).forEach(function(e){var t=e.elements,n=e.append;t.each(function(e,t){t=b(t),y=y.add(r.create({target:t,append:n,newTargets:null}).render()),t.filter("tw-pseudo-hook").contents().unwrap()})}),!(y.length||_(h)||v.isPrototypeOf(h))){f=g;if(!(f in h)){if("replace"!==f)return k("ChangeDescriptor.render","The target doesn't have a '"+f+"' method."),b();f=h[0]instanceof Text?"replaceWith":(h.empty(),"append")}h[0]instanceof Text&&"prepend"===(f="append"===f?"after":f)&&(f="before"),y=b(t&&(this.verbatim?w:T)(t)),_(d)&&d.forEach(function(e){var t=e.source,e=e.append,t=b((r.verbatim?w:T)(t));y="append"===e?y.add(t):"prepend"===e?t.add(y):t}),h[f](y.length?y:void 0),h.data("timestamp",Date.now()),this.update(),n&&!o&&S("replace"===g?h:y,n,a,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),p&&p.map(function(e){return e(h)}).forEach(function(e){return l.addEnchantment(e)})}return y}};return e(x)}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(g,y,b,v,e,w,t){var k=e.objectName,S=e.toSource,T=t.collapse;return Object.freeze({create:function(e){return Object.assign(Object.create(this),{enchantments:g()},e)},enchantScope:function(){var i=this,s=this.attr,c=this.data,l=this.functions,u=this.section,p=this.scope,d=this.localHook,f=this.lambda,h=[],m=0;p.forEach(u,function(e,t){if(d){d=d.jquery?d:d.hooks(u);var n=e.find(d);if(n.length)e=n;else if(!d.has(e[0]).length)return}var r,a,o;(!e.is(":empty")||e.data("source")&&e.data("source").length)&&(m+=1,f?(o=f.apply(u,{loop:p.TwineScript_GetProperty(t),pos:m}),w.containsError(o)?(e.replaceWith(o.render()),f=o=null):v.isPrototypeOf(o)?o.canEnchant||(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),"\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")).render()),f=o=null):(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),'" must return a changer, not ').concat(k(o),".")).render()),f=o=null)):o=i.changer,n=!s&&!c&&(!o||o.summary().every(function(e){return e.startsWith("transition")})),r=n?e:e.wrap("<tw-enchantment>").parent(),s&&r.attr(s),c&&r.data(c),l&&l.forEach(function(e){return e(r)}),o&&(t=b.create({section:u,target:r}),o.run(t),t.update(),e.is(y.storyElement)?(a=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(t.styles)))),e.css(a.reduce(function(e,t){return"background-color"===t||"background-image"===t?(e["background-color"]="transparent",e["background-image"]="none",a.push("background-".concat("background-color"===t?"image":"color"))):e[t]="inherit",e},{})),r.data({enchantedProperties:a})):e.is("tw-passage")&&t.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})&&(o="padding-right",y.storyElement.css(t="padding-left","0px").css(o,"0px"),r.data({enchantedProperties:[t,o]}))),e.is(y.storyElement)&&r.css({"min-width":"100%","min-height":"100%"}),"true"===r.attr("collapsing")&&(r.find("[collapsing=false]").each(function(){g(this).removeAttr("collapsing")}),T(r)),n||h.push(r))}),this.enchantments=g(h)},disenchant:function(){this.enchantments.each(function(e,t){(t=g(t)).contents().unwrap();t=t.data("enchantedProperties");t&&y.storyElement.css(t.reduce(function(e,t){return e[t]="",e},{}))})}})}),define("internaltypes/twineerror",["jquery","utils"],function(i,s){var a=s.impossible,c=s.escape,l=(i(document.documentElement).on("click","tw-folddown",function(e){var t=e.target,e=((t=i(t)).toggleClass("open"),t.popData("folddown"));for("function"==typeof e&&e(t);t&&!t.next().length;)t=t.parent();null!=(e=t)&&e.next().toggle()}),{syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true.",debugonly:"This macro is not meant to be used outside of debugging your story."}),u=[],n={TwineError:!0,create:function(e,t,n,r){return t&&"string"==typeof t||a("TwineError.create","has a bad message string"),n||e in l||a("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})},containsError:function(){for(var e=0;e<arguments.length;e+=1){var t=arguments[e];if(n.isPrototypeOf(t))return t;if(Array.isArray(t)){t=n.containsError.apply(n,t);if(t)return t}}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=(t="string"==typeof t?t:this.source||"",i("<tw-error class='"+(this.warning?"warning":"error")+"' title='"+c(t)+"'>"+c(this.message+(this.appendTitleText?" "+t:""))+"</tw-error>")),a=i("<tw-error-explanation>").text(this.explanation||l[this.type]).hide(),o=i("<tw-folddown tabindex=0>");return this.innerDOM&&i("<tw-open-button label='Open'>").on("click",function(){var e=i("<tw-backdrop><tw-dialog></tw-backdrop>");e.find("tw-dialog").prepend(n.innerDOM,i("<tw-link tabindex=0>OK</tw-link>").on("click",function(){n.innerDOM.detach(),e.remove()}).wrap("<tw-dialog-links>").parent()),s.storyElement.prepend(e)}).appendTo(r),r.append(o).append(a),r.data("TwineError",this),e||u.forEach(function(e){return e(n,t)}),r},on:function(e){return"function"!=typeof e||u.includes(e)||u.push(e),n}};return Object.preventExtensions(n)}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return Object.preventExtensions(r)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(u,p,e,t,i){var c,n=e.impossible,s=e.andList,r=e.nth,o=t.is,d=t.isObject,f=t.toSource,h=t.isSequential,m=t.objectName,l=t.typeName,g=t.clone,y=t.isValidDatamapName,b=t.subset,v=t.collectionType,w=t.unstorableValue,a=t.matches,k=Array.isArray,S={set:[],delete:[]},T="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), ",_="You can't access the '0th' or '0thlast' position of ";function x(e,t){if(p.containsError(t))return n;if(e instanceof Map&&(n=p.containsError(y(e,t))))return n;if(h(e))if("number"==typeof t){if(0===t)return p.create("property","You can't access elements at position 0 of ".concat(m(e),"."),"Only positive and negative position values exist.");0<t&&--t}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)last$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=-r[1]}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=r[1]-1}else if("string"==typeof t&&(r=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){var n=_slicedToArray(r,5),r=n[1],r=void 0===r?0:r,a=n[2],o=n[3],o=void 0===o?0:o;t={last:n[4]?-o:o-1,first:a?-r:r-1}}else if("last"===t)t=-1;else if("random"===t){if(!e.length)return p.create("property","I can't get a random value from ".concat(m(e),", because it's empty."));t=u.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(t))return p.create("property","".concat(T+s(i.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if(!["length","some","any","all","start","end","random"].includes(t)&&!i.isPrototypeOf(e))return p.create("property","".concat(T,"'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."))}else if(e instanceof Set){if(!["length","some","any","all"].includes(t))return p.create("property","".concat(T,"'length', 'some', 'any', and 'all' of ").concat(m(e),"."),"You can't access specific individual data values from datasets.");"length"===t&&(t="size")}else{if(k(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(t))return p.create("property","You can only get the ".concat(s(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if("number"==typeof e||"boolean"==typeof e)return p.create("property","You can't get any data values, let alone ".concat(m(t),", from ").concat(m(e)))}return t}function O(e,t){return+t<0&&Math.abs(t)<=e.length?e.length+ +t:t}var A=/[^\uD801-\uDFFF]/,C=new Map;function E(e,t){var n,r,a;return void 0===e?e:e instanceof Map?e.get(t):"some"!==t&&"any"!==t&&"all"!==t&&"start"!==t&&"end"!==t||e.TwineScript_VariableStore?("string"==typeof e&&(C.has(e)?e=C.get(e):A.test(e)?(a=_toConsumableArray(e),C.set(e,a),e=a):C.set(e,e)),h(e)&&Number.isFinite(t)&&(t=O(e,t)),e.TwineScript_GetProperty?e.TwineScript_GetProperty(t):"function"!=typeof(a=e[t])?a:void 0):(n=e,r=t,a='"'.concat(r," value").concat("any"===r?"":"s",'" of '),{determiner:r,determined:n,array:_toConsumableArray(n),string:"string"==typeof n&&n,TwineScript_ObjectName:a+m(n),TwineScript_ToSource:function(){return"".concat(r," of ").concat(f(n))},TwineScript_TypeName:a+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}})}function N(e){var t;return e.computed?(t=e.value,"string"==typeof(t=c.isPrototypeOf(t)?t.get():t)?"('"+t+"')":"("+t+")"):"number"==typeof e?r(e):"'"+e+"'"}function j(t,e,n){if(t.TwineScript_VariableStore){if(t.TwineScript_TypeDefs&&e in t.TwineScript_TypeDefs){var r=t.TwineScript_TypeDefs[e];if("const"===r.name){if(void 0!==t[e])return p.create("operation","I can't alter ".concat(t===u.variables?"$":"_").concat(e," because it's been restricted to a constant value."),"This variable can't be changed for the rest of the story.")}else if(!a(r,n))return p.create("operation","I can't set ".concat(t===u.variables?"$":"_").concat(e," to ").concat(l(n)," because it's been restricted to ").concat(f(r),"-type data."),"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return k(e)?e.map(function(e){return j(t,e)}):t instanceof Map?"string"==typeof e||p.create("operation","".concat(m(t)," can only have string data names, not ").concat(m(e),".")):h(t)?["length","random","some","any","all","start","end"].includes(e)?p.create("operation","I can't forcibly alter the '"+e+"' of "+m(t)+".","start"===e||"end"===e?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+e+"'.":void 0):+e==(0|e)||p.create("property",m(t)+" can only have position keys ('3rd', '1st', (5), etc.), not "+N(e)+"."):t.TwineScript_Identifiers&&e in t?p.create("keyword","I can't alter the value of the '"+e+"' identifier.","You can only alter data in variables, not fixed identifiers."):p.create("operation","I can't modify "+m(t),t instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":i.isPrototypeOf(t)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function P(t,e,n,r){var a=e;t instanceof Map?t.set(e,n):(h(t)&&(e=O(t,e)),t.TwineScript_Set?t.TwineScript_Set(e,n,r):t[e]=n),S.set.forEach(function(e){return e(t,a,n)})}function R(t,e){var n=e;h(t)&&(e=O(t,e)),k(t)&&/^(?:[1-9]\d*|0)$/.exec(e)?t.splice(e,1):t instanceof Map||t instanceof Set?t.delete(e):t.TwineScript_Delete?t.TwineScript_Delete(e):delete t[e],S.delete.forEach(function(e){return e(t,n)})}function I(t,e){var n,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return e&&"object"===_typeof(e)&&"last"in e&&"first"in e?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):(n=e.first,r=e.last,b(t,n+(0<=n),r+(0<=r))):k(e)?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):e.map(function(e){return I(t,e,e)})["string"==typeof t?"join":"valueOf"](""):void 0!==(n=E(t,e))||o?n:t===u.variables?0:"temp"===(null==(r=t.TwineScript_VariableStore)?void 0:r.type)?p.create("property","There isn't a temp variable named _".concat(a," in this place."),"Temp variables only exist inside the same passage, hook, or lambda in which they're created."):k(t)&&"number"==typeof e?p.create("property","This array of ".concat(t.length," elements doesn't have a ").concat(N(a+("number"==typeof a?1:""))," element."),t.length?"It contains: ".concat(s(t.map(m)),"."):"The array is empty."):(o=Array.from("function"==typeof t.keys&&t.keys()),p.create("property","I can't find a ".concat(N(a)," data name in ").concat(m(t)),t instanceof Map&&o.length?"Its names include: ".concat(s(o),"."):void 0))}function V(e,t){var r=this,e=this.compiledPropertyChain.reduce(function(e,t){var n=0===e.length?r.object:I.apply(void 0,_toConsumableArray(e[e.length-1]));return e.push([n,t])&&e},[]).reduceRight(e,t);return p.containsError(e)?e:void 0}return c=Object.freeze({get:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=I(e,this.compiledPropertyChain[t]),p.containsError(e))return e;return I(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(void 0===(e=I(e,this.compiledPropertyChain[t],void 0,!0))||p.containsError(e))return!1;return void 0!==I(e,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set:function(e,c){var l=this;return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?V.call(this,function(n,e,t){var e=_slicedToArray(e,2),r=e[0],a=e[1];if(e=p.containsError(n,r,a)||p.containsError(j(r,a,n)))return e;if(e=w(n))return p.create("operation","".concat(m(n)," can't be stored").concat(!n.TwineScript_Unstorable&&v(n)?" because it holds ".concat(m(e)):"","."));if(0<t)r=g(r);else if("temp"===(null==(e=r.TwineScript_VariableStore)?void 0:e.type)&&r!==u.variables){for(var o=r;"temp"===(null==(i=o.TwineScript_VariableStore)?void 0:i.type)&&!hasOwnProperty.call(o,a);)var i,o=Object.getPrototypeOf(o);"temp"===(null==(t=o.TwineScript_VariableStore)?void 0:t.type)&&(r=o)}if("string"==typeof r){if("string"!=typeof n)return p.create("datatype","I can't put this non-string value, ".concat(m(n),", in a string."));if(n.length!==(k(a)?a.length:1))return p.create("datatype","".concat(m(n),"is not the right length to fit into this string location."));var r=_toConsumableArray(r),s=_toConsumableArray(n);[].concat(a).forEach(function(e){0+e<0&&(e=r.length+(0+e)),r=[].concat(_toConsumableArray(r.slice(0,e)),[s.shift()],_toConsumableArray(r.slice(e+1)))}),r=r.join("")}else d(r)&&(void 0!==n.TwineScript_KnownName&&((n=""!==n.TwineScript_KnownName?g(n):n).TwineScript_KnownName=f(l)),k(a)&&h(n)?("string"==typeof n&&(n=_toConsumableArray(n)),a.map(function(e,t){return[e,n[t]]}).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return P(r,t,e,c)})):P(r,a,n,c));return r},e):p.create("macrocall","I can't (set:) ".concat(m(this),", if the ").concat((m(this.object).match(/ (.+$)/)||["","value"])[1]," isn't stored in a variable."),"Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return V.call(this,function(e,t,n){var r,t=_slicedToArray(t,2),a=t[0],t=t[1];return(r=p.containsError(e,a,t)||p.containsError(j(a,t)))||(0<n&&(a=g(a)),null===e?((r="string"==typeof a)&&(a=_toConsumableArray(a)),k(t)?(h(a)&&(t=_toConsumableArray(new Set(t))).sort(function(e,t){return O(a,t)-O(a,e)}),t.forEach(function(e){return R(a,e)})):R(a,t),r&&(a=a.join(""))):P(a,t,e,!1),a)},null)},defineType:function(e){var t=this.object,n=this.compiledPropertyChain[0],r=(hasOwnProperty.call(t,"TwineScript_TypeDefs")||(t.TwineScript_TypeDefs=Object.create(t.TwineScript_TypeDefs||null)),t.TwineScript_TypeDefs),a=r[n];if(a&&!o(a,e))return p.create("operation","I can't redefine the type of "+m(this)+" to "+(e.TwineScript_ObjectName||l(e))+", as it is already "+(a.TwineScript_ObjectName||l(a))+".");t.TwineScript_DefineType?t.TwineScript_DefineType(n,e):r[n]=e,"const"===e.name&&(t[n]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,t){var n;if(n=p.containsError(e))return n;Array.isArray(t)||(t=[].concat(t)),c.isPrototypeOf(e)&&(t=e.propertyChain.concat(t),e=e.object);var r=function(e,t){for(var n,r=[],a=0;a<t.length;a+=1){var o=t[a];if(o.computed&&(o=o.value),c.isPrototypeOf(o)&&(o=o.get()),k(o)){for(var i=[],s=0;s<o.length;s+=1)i[s]=x(e,o[s]);o=i}else o=x(e,o);if(n=p.containsError(o))return n;a<t.length-1&&(e=I(e,o)),r.push(o)}return r}(e,t);return(n=p.containsError(r))||Object.assign(Object.create(c),{object:e,propertyChain:t,compiledPropertyChain:r})},TwineScript_ToSource:function(){function r(e,t){return!t&&n.object.TwineScript_VariableStore?e:N(e)}var e,n=this;return(this.object===u.variables?"$":"temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?r(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+r(t,n)}))},get TwineScript_ObjectName(){var e;return this.object.TwineScript_VariableStore?"the ".concat("temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"temp ":"","variable ").concat(this.TwineScript_ToSource()):m(this.object)+"'s "+(1===this.propertyChain.length?N(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+N(t)}))},on:function(e,t){if(e in S)return"function"!=typeof t||S[e].includes(t)||S[e].push(t),c;n("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:{type:"temp",name:"an unknown scope"},TwineScript_TypeDefs:Object.create(null)})}),define("macrolib/commands",["jquery","macros","utils","state","passages","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(u,n,b,c,l,a,y,M,e,o,t,p,d,i,s,v,r,f){var h=r.printBuiltinValue,m=r.objectName,g=r.clone,w=r.toSource,k=f.dialog,S=f.geomParse,D=f.geomStringRegExp,r=n.TypeSignature,f=r.Any,F=r.Everything,T=r.rest,_=r.either,x=r.optional,O=r.zeroOrMore,L=r.percent,H=r.nonNegativeInteger,A=r.positiveInteger,r=r.positiveNumber,C=Object.assign,E=Math.floor,N=Math.ceil,j=Math.abs,z=Math.max,q=Math.min,P=u.noop;function R(e){return"(".concat(e," ").concat(b.options.ifid,") ")}["set","put","unpack"].forEach(function(r){return n.add(r,"Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"===n.operator&&"set"===r)return y.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===n.operator&&"set"!==r)return y.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((i.isPrototypeOf(n.dest)||s.isPrototypeOf(n.dest))===("unpack"===r))return y.create("macrocall","unpack"===r?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the (".concat(r,":) macro with just single variables and typed variables to the ").concat("set"===r?"left of 'to'.":"right of 'into'."),"You may wish to change this to the (".concat("unpack"!==r?"unpack":"to"===n.operator?"set":"put",":) macro."));n=n.set();if(y.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (".concat(r,":) operation"),TwineScript_ObjectName:"a (".concat(r,":) operation"),TwineScript_Unstorable:!0,TwineScript_Print:function(){return b.options.debug,""}}},[T(e)])}),n.add("move","Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return y.create("macrocall","Please say 'into' when using the (move:) macro.");n=n.set(!0);if(y.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return b.options.debug,""}}},[T(e)]),n.addCommand("display",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (display:) the passage '".concat(e,"' because it doesn't exist."))},function(e,t,n){return e.source=l.getTree(n),e},[String])("print",P,function(e,t,n){return C(e,{source:h(n)})},[f])(["verbatim-print","v6m-print"],P,function(e,t,n){return C(e,{verbatim:!0,source:h(n)})},[f])(["verbatim-source","v6m-source"],function(e){if("command"===(null==e?void 0:e.TwineScript_TypeID)&&!e.TwineScript_ToSource)return y.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return C(e,{verbatim:!0,source:h(w(n))})},[f])("go-to",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (go-to:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!b.options.ignoreGotos)return requestAnimationFrame(function(){return a.goToPassage(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("redirect",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (redirect:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!b.options.ignoreGotos)return requestAnimationFrame(function(){return a.redirect(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",P,function(e,t,n){return c.pastLength<1?C(e,{source:n}):b.options.ignoreGotos?void 0:(requestAnimationFrame(function(){return a.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[x(String)])("debug",P,a.enableDebugMode,[],!1),b.onStartup(function(){return b.storyElement.on("click.icon","tw-icon",function(e){var t=u(this),n=t.data("clickEvent"),r=t.attr("alt");n&&n(t),"Undo"===r&&(e.stopPropagation(),a.goBack()),"Redo"===r&&(e.stopPropagation(),a.goForward()),"Fullscreen"===r&&(e.stopPropagation(),a.toggleFullscreen()),"Restart"===r&&(c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return 0<c.pastLength}],["Redo","&#8631;",function(){return 0<c.futureLength}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var e=_slicedToArray(e,3),o=e[0],i=e[1],s=e[2];n.addCommand("icon-".concat(o.toLowerCase()),function(e,t){if("string"==typeof e&&"string"==typeof t)return e=_toConsumableArray(e).length,t=_toConsumableArray(t).length,1<e&&1<t?y.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 1 character long, for its icon.")):1===e&&1===t?y.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 2 or more characters long, for its label.")):void 0},function(t,e,n,r){var a;return("string"==typeof r&&1===_toConsumableArray(r).length||"string"==typeof n&&1<_toConsumableArray(n).length)&&(n=(a=[r,n])[0],r=a[1]),"Undo"===o&&(t.data.forgetUndosEvent=function(e){t.section.whenUnblocked(function(){return u(e).css("visibility","hidden")})}),C(t,{source:'<tw-icon tabindex=0 alt="'.concat(o,'" ').concat(r?'data-label="'.concat(r.replace('"',"&quot;"),'"'):"",' title="').concat(o,'" ').concat(s()?"":'style="visibility:hidden"',">").concat(n||i,"</tw-icon>")})},[x(String),x(String)])}),n.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:y.create("datatype","The 2nd "+r):y.create("datatype","The 1st "+r)},function(r,e,a,o,i){r.attr.push({"data-2bind":!0}),r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&r.target.children("tw-icon").text((0<t?E:N)(t)).attr("data-label",1!==j(t)&&void 0!==i?i:o)};var t=a.varRef.get();return"number"!=typeof t?y.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-icon data-label="'.concat(b.escape(1!==j(t)&&void 0!==i?i:o),'">').concat((0<t?E:N)(t),"</tw-icon>")})},[v,String,x(String)]),n.addCommand("meter",function(e,t,n,r){return"two way"===e.bind?y.create("datatype","(meter:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".'):"string"!=typeof r||r.trim()?-1===n.search(D)||!n.includes("=")&&1<n.length?y.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:y.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(r,e,a,n,t,o,i){o&&"string"!=typeof o&&(i=o,o=void 0),i=i||p.create({h:0,s:0,l:.5,a:.5}),p.isPrototypeOf(i)&&(i=d.create(90,[{colour:i,stop:0},{colour:i,stop:1}]));function s(e){var t=z(0,q(1,e/n)),e=i.repeating?i:i.multiply(n/e);return"height:100%;background-repeat:no-repeat;background-image:".concat((l?C(e,e.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+C(e,e.repeating?{}:{angle:l||0===c?90:270}).toLinearGradientString(),";background-size:").concat(l?Array(2).fill(50*t+"%"):100*t+"%",";background-position-x:").concat(l?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===c?"left":"right",";text-align:").concat(l?"center":0===c?"left":"right")}var t=S(t),c=t.marginLeft,t=t.size,l=0<c&&Math.ceil(c+t)<100,u=(r.styles.push({"margin-left":c+"%",width:t+"%",height:"1.5em",display:"block"}),r.attr.push({"data-2bind":!0}),o&&e.stackTop.tempVariables),t=(r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&((n=r.target.children("tw-meter")).attr("style",s(t)),o)&&r.section.renderInto("",null,{source:o,target:n,append:"replace",transitionDeferred:!1},u)},a.varRef.get());return"number"!=typeof t?y.create("datatype","(meter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-meter style="'.concat(s(t),'">').concat(o||"","</tw-meter>")})},[v,r,String,x(_(String,p,d)),x(_(p,d))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(t,u){return n.addCommand(t,function(){var e;return""===(arguments.length<=0?void 0:arguments[0])?y.create("datatype","The first string in a ("+t[0]+":) can't be empty."):arguments.length<=(v.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?y.create("datatype","I need two or more strings to "+(u?"sequence":"cycle")+" through, not just '"+((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e])+"'."):void 0},function(a,e){for(var o,t=arguments.length,i=new Array(2<t?t-2:0),n=2;n<t;n++)i[n-2]=arguments[n];v.isPrototypeOf(i[0])&&(o=i.shift());var s=0,c=("two way"===(null==(l=o)?void 0:l.bind)&&(a.attr.push({"data-2bind":!0}),-1<(l=i.indexOf(o.varRef.get())))&&(s=l),e.stackTop.tempVariables);function r(e,t){var n=s>=i.length-1&&u,r=""===i[s]?"":n?i[s]:"<tw-link>".concat(i[s],"</tw-link>");if(n&&(a.data.clickEvent=void 0),o&&!t){n=o.set(i[s]);if(y.containsError(n))return void e.replaceWith(n.render(i[s]))}t=_objectSpread(_objectSpread({},a),{},{source:r,transitionDeferred:!1});a.section.renderInto("",null,t,c)}i[s]&&(a.data.clickEvent=function(e){s=(s+1)%i.length,r(e,!1)},a.data.twoWayBindEvent=function(e,t,n){o.varRef.matches(t,n)&&(t=o.varRef.get(),-1<(n=i.indexOf(t)))&&n!==s&&(s=n,r(e,!0))});var l="<tw-link>".concat(i[s],"</tw-link>");if(o){e=o.set(i[s]);if(y.containsError(e))return e}return C(a,{source:l,append:"replace",transitionDeferred:!0})},[_(v,String),T(String)])}),b.onStartup(function(){return b.storyElement.on("change.dropdown-macro","select",function(){var e=u(this),t=e.closest("tw-expression, tw-hook").data("dropdownEvent");t&&t(e)})}),n.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===((t=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=t?void 0:arguments[t])?y.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?y.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(e,t,r){for(var n=arguments.length,a=new Array(3<n?n-3:0),o=3;o<n;o++)a[o-3]=arguments[o];var i=0,s=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),-1<(c=a.indexOf(r.varRef.get())))&&(i=c),Math.max.apply(Math,_toConsumableArray(a.map(function(e){return _toConsumableArray(e).length})))),c="<select>"+a.map(function(e,t){return"<option".concat(t===i?" selected":"").concat(""===e?" disabled":"",">").concat(b.escape(e||"\u2500".repeat(s)),"</option>")}).join("\n")+"</select>",l=(e.data.dropdownEvent=function(e){var t=e.val(),n=r.set(t);y.containsError(n)&&e.replaceWith(n.render(t))},e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&(t=r.varRef.get(),-1<(n=a.indexOf(t)))&&n!==i&&(e.find("select").val(t),i=n)},e.styles.push({"background-color":function(){return b.parentColours(u(this)).backgroundColour}}),r.set(a[i]));return y.containsError(l)?l:C(e,{source:c,append:"replace"})},[v,String,T(String)]),b.onStartup(function(){return b.storyElement.on("input.checkbox-macro","input[type=checkbox]",function(){var e=u(this),t=e.closest("tw-expression").data("checkboxEvent");t&&t(e)})});function I(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]}var V=1;n.addCommand("checkbox",function(){},function(e,t,r,n){var a=!1,o="checkbox-"+ ++V,i=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),"boolean"==typeof(i=r.varRef.get())&&(a=i),e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&"boolean"==typeof(t=r.varRef.get())&&e.children("input[type=checkbox]").prop("checked",t)}),e.data.checkboxEvent=function(e){var t=e.is(":checked"),t=r.set(t);y.containsError(t)&&e.replaceWith(t.render(""))},r.set(a));return y.containsError(i)?i:C(e,{source:'<input id="'.concat(o,'" type="checkbox" ').concat(a?"checked":"",'><label for="').concat(o,'">').concat(n,"</label>"),append:"replace"})},[v,String]),b.onStartup(function(){return u(document).on("fullscreenchange",function(){u("input[type=checkbox][id^=fullscreen]",b.storyElement).each(function(e,t){(u(t).closest("tw-expression").data("fullscreenEvent")||Object)(t)})})}),n.addCommand("checkbox-fullscreen",function(){},function(e,t,n){var r="fullscreenCheckbox-"+ ++V;return e.data.fullscreenEvent=function(e){return u(e).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},e.data.checkboxEvent=function(){return a.toggleFullscreen()},C(e,{source:'<input id="'.concat(r,'" type="checkbox" ').concat(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ").concat(document.fullscreenElement||document.msFullscreenElement?"checked":"",'><label for="').concat(r,'">').concat(n,"</label>"),append:"replace"})},[String]),b.onStartup(function(){return b.storyElement.on("input.input-box-macro","textarea, input[type=text]",function(){var e=u(this),t=e.closest("tw-expression").data("inputBoxEvent");t&&t(e)})}),["input","force-input","input-box","force-input-box"].forEach(function(g){return n.addCommand(g,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=g.endsWith("box"),a=v.isPrototypeOf(t[0]),o="string"==typeof t[+a],r=r&&"number"==typeof t[o+a],i=o?t[+a]:t[a+r],s=0<S(i).size,o=s?t[a+r+o]:i;return g.startsWith("force")&&"string"!=typeof o?y.create("datatype","The (".concat(g,":) macro requires a string of text to forcibly input.")):t.length>a+r+s+("string"==typeof o)?y.create("datatype","An incorrect combination of values was given to this (".concat(g,":) macro.")):void 0},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o=g.startsWith("force"),i=g.endsWith("box"),s=v.isPrototypeOf(r[0]),c="string"==typeof r[+s],l=i&&"number"==typeof r[c+s],u=s&&r[0],p=l?r[1+s]:3,d=c?S(r[+s]):{},f=d.marginLeft,d=d.size,h=(d?r[s+l+c]:c&&r[+s])||"",l=o?"":h,c=!1;if("two way"===u.bind){e.attr.push({"data-2bind":!0});s=u.varRef.get();if("string"==typeof s){l=o?h.slice(0,s.length):s,s=u.set(l),c=!0;if(y.containsError(s))return s}e.data.twoWayBindEvent=function(e,t,n){u.varRef.matches(t,n)&&"string"==typeof(t=u.varRef.get())&&e.find(i?"textarea":"input").val(o?h.slice(0,t.length):t)}}if(u&&!c){s=u.set(o?"":h);if(y.containsError(s))return s}!o&&u&&(e.data.inputBoxEvent=function(e){var t=e.val(),t=u.set(t);y.containsError(t)&&e.replaceWith(t.render(""))});var m,c="<".concat(i?"textarea":"input type=text",' style="width:100%" ').concat(i?"rows=".concat(p,">"):'value="').concat(b.escape(l)).concat(i?"</textarea>":'">');return o&&(m=Array.from(h),e.data.inputBoxEvent=function(e){var t=e.val().length,t=m.slice(0,t).join("");return e.val(t),u&&(t=u.set(t),y.containsError(t))&&e.replaceWith(t.render("")),!0}),e.styles.push({display:"block","margin-left":d?f+"%":void 0,width:d?d+"%":"100%","border-style":function(){return this.style.borderStyle||"solid"}}),C(e,{source:c,append:"replace"})},g.endsWith("box")?[_(v,String),x(_(A,String)),x(_(A,String)),x(String)]:[x(_(v,String)),x(String),x(String)])}),["show","rerun"].forEach(function(s){return n.addCommand(s,function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=y.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(o,i){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return t.forEach(function(e){return e.forEach(i,function(e){var t,n,r,a=e.data("hidden");void 0!==a!=("rerun"===s)&&(e.removeData("hidden"),a instanceof u?e.empty().append(a):(a=e.data("tempVariables"),n=(t="tw-passage"===e.tag())?l.getTree(c.passage):e.data("originalSource")||"",t&&(r=e.find("tw-sidebar").detach()),i.renderInto("",null,_objectSpread(_objectSpread({},o),{},{append:"replace",source:n,target:e}),a&&Object.create(a)),r&&e.prepend(r)))})}),o},[T(o)])});n.addCommand("hide",function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=y.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,o=n;a<o.length;a++)o[a].forEach(e,function(e){e.data("hidden")||e.data("hidden",e.contents().detach())})},[T(o)],!1)("scroll",P,function(m,e,g){var y="number"==typeof g&&g;requestAnimationFrame(function(){e.forEach(m,function(e){if(!1!==y){var t,n,r=e[0];null!=(t=(n=r=r===b.storyElement[0]&&r.scrollHeight===r.clientHeight?getComputedStyle(document.body).overflow.includes(" scroll")?document.body:document.documentElement:r).scrollTo)&&t.call(n,0,(r.scrollHeight-r.clientHeight)*y)}else{var a,o=_createForOfIteratorHelper(g.hooks(m).get());try{for(o.s();!(a=o.n()).done;){var i=a.value;if(e.find(i)){for(var s=[],c=e[0];(c=c.parentNode)&&c!==document.body;)s.push([c,c.scrollLeft,c.scrollTop]);i.scrollIntoView();for(var l=0,u=s;l<u.length;l++){var p=_slicedToArray(u[l],3),d=p[0],f=p[1],h=p[2];d.scrollLeft=f,d.scrollTop=h}break}}}catch(e){o.e(e)}finally{o.f()}}})})},[o,_(L,o)],!1)("stop",P,P,[],!1)("load-game",P,function(e,t){var n,r;return e.loadedGame?y.create("infinite","I can't use (load-game:) immediately after loading a game."):(n=localStorage.getItem(R("Saved Game")+t))?(n=c.deserialise(e,n))instanceof Error?{blocked:r=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+n.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===r.find("input").last().val()&&localStorage.removeItem(R("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]})}:void requestAnimationFrame(a.showPassage.bind(a,c.passage,{loadedGame:!0})):y.create("saving","I can't find a save slot named '"+t+"'!")},[String],!1)("forget-undos",P,function(e,t){c.futureLength||c.forgetUndos(t)},[parseInt],!1)("forget-visits",P,function(e,t){c.forgetVisits(t)},[parseInt],!1)("mock-visits",function(){if(!b.options.debug)return y.create("debugonly","(mock-visits:) cannot be used outside of debug mode.");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return!l.hasValid(e)});return r?y.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c.mockVisits=g(n)},[T(String)],!1)("mock-turns",function(){if(!b.options.debug)return y.create("debugonly","(mock-turns:) cannot be used outside of debug mode.")},function(e,t){c.mockTurns=t},[H],!1)("seed",P,function(e,t){c.setSeed(t)},[String],!1)(["dialog","alert"],function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(v.isPrototypeOf(e)){if("two way"===e.bind)return y.create("datatype","(dialog:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".');if(void 0===t)return y.create("datatype","(dialog:) needs a message string or codehook to display.")}else void 0!==t&&r.unshift(t);e=r.findIndex(function(e){return""===e});if(-1<e)return y.create("datatype","(dialog:)'s ".concat(b.nth(e+1)," link text shouldn't be an empty string."))},function(e,n,r,t){for(var a=arguments.length,o=new Array(4<a?a-4:0),i=4;i<a;i++)o[i-4]=arguments[i];return v.isPrototypeOf(r)||(void 0!==t&&o.unshift(t),t=r,r=void 0),o.length||(o=["OK"]),{blocked:k({section:n,message:t,cd:e,buttons:o.map(function(t){return{name:t,callback:function(){var e;n.unblock((null==(e=r)?void 0:e.set(t))||"")}}})})}},[_(v,String,t),x(_(t,String)),O(String)])("open-url",P,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],P,function(){if(!b.options.ignoreGotos){if(c.turns<=1)return y.create("infinite","I mustn't (restart:) the story in the starting passage.");c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()}},[],!1)("goto-url",P,function(e,t){window.location.assign(t)},[String],!1)("ignore",P,P,[O(F)])("assert-exists",function(e){if(""===e)return y.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?o.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:y.create("assertion","I didn't see any ".concat("string"==typeof n?"text occurrences of":"hooks matching"," ").concat(w(n)," in this passage."))},[_(o,String)]),n.add("assert","Instant",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:C(y.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game","Boolean",function(e,t,n){if(n=n||"",!c.hasStorage)return!1;var r=c.serialise(!1).pastAndPresent;if(y.containsError(r))return r;if(!1===r)return!1;try{return localStorage.setItem(R("Saved Game")+t,r),localStorage.setItem(R("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,x(String)])("prompt","String",function(e,t,n,r,a){var o,i;return null!=(o=e.stackTop)&&o.evaluateOnly?y.create.apply(y,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===a?y.create("datatype","The text for (prompt:)'s confirm link can't be blank."):(i=k({section:e,message:t,defaultValue:n,buttons:[{name:a||"OK",confirm:!0,callback:function(){return e.unblock(i.find("input").last().val())}}].concat(""===r?[]:{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}})}),e.stackTop.blocked=i,0)},[_(String,t),String,x(String),x(String)])("confirm","Boolean",function(e,t,n,r){var a;return null!=(a=e.stackTop)&&a.evaluateOnly?y.create.apply(y,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===r?y.create("datatype","The text for (confirm:)'s confirm link can't be blank."):(a=k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}})}),e.stackTop.blocked=a,0)},[_(String,t),x(String),x(String)])("page-url","String",function(){return window.location.href},[])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(c,l,u,e,t,p,n,d,f){function s(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return f.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")}var h=e.objectName,m=e.toSource,e=l.add,r=l.addChanger,a=l.addCommand,o=l.TypeSignature,i=o.rest,g=o.either,y=o.Any,b=o.Everything,o=o.zeroOrMore;e("macro","CustomMacro",function(e){for(var t,n=[],r=arguments.length,a=new Array(1<r?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(t=0;t<a.length;t+=1){var i=t===a.length-1;if(d.isPrototypeOf(a[t])===i)return f.create("datatype","The "+(i?"":c.nth(a.length-t+1)+"-")+"last value given to (macro:) should be a "+(i?"code hook":"datatyped variable")+", not "+h(a[t]));if(!i){i="A custom macro";if(a[t].varRef.object===u.variables)return f.create("datatype",i+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(1<a[t].varRef.propertyChain.length)return f.create("datatype",i+"'s typed variables can't be properties inside a data structure.");if(a[t].datatype.rest&&t!==a.length-2)return f.create("datatype",i+" can only have one spread variable, and it must be its last variable.");var s=a[t].varRef.propertyChain[0];if(n.includes(s))return f.create("datatype",i+"'s typed variables can't both be named '"+s+"'.");n.push(s)}}return p.create(a.slice(0,-1),a[a.length-1])},[i(g(d,n))]);a(["output-data","out-data"],function(){},function(e,t){e=e.stack;return s("output-data",e,t)||{blocked:!0}},[y],!1),r(["output","out"],function(){return Object.assign(t.create("output",[]))},function(e,t){if(e.section){var n,r=e.section,a=r.stack,o=r.stackTop,i={};for(n in o.tempVariables)n.startsWith("TwineScript_")||(i[n]=o.tempVariables[n]);s("output",a,{changer:t,variables:i,hook:Array.isArray(e.source)?"["+e.source.map(function(e){return e.text}).join("")+"]":e.source}),e.output=!0,o.blocked=!0}},[]),a("error",function(e){if(!e)return f.create("datatype","This (error:) macro was given an empty string.")},function(e,t){e=e.stack;return s("error",e,f.create("user",t))||{blocked:!0}},[String],!1),e("partial","CustomMacro",function(e,a){for(var t=arguments.length,o=new Array(2<t?t-2:0),n=2;n<t;n++)o[n-2]=arguments[n];var r="string"!=typeof a&&a,i=!r&&a;if(!r){if(!l.has(i))return f.create("macrocall",'The macro name given to (partial:), "'.concat(a,"\", isn't the name of a built-in macro."));if("Metadata"===l.get(i).returnType)return f.create("macrocall","(partial:) can't be used with metadata macros such as (".concat(a,":)"))}var s="(partial:".concat(m(a),",").concat(o.map(function(e){return m(e)}),")"),c=p.createFromFn(function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=l["string"==typeof a?"run":"runCustom"](a,e,o.concat(n));return f.containsError(e)&&(e.message="An error occurred while running the (partial:)-created macro, ".concat(c.TwineScript_ObjectName,":\n")+e.message),e},"a (partial:) custom macro of ".concat(i||r.TwineScript_KnownName?"(".concat(i||r.TwineScript_KnownName,":").concat(o.map(function(e){return m(e)}),")"):"another unnamed custom macro"),function(){return s},(i?l.get(i):r).typeSignature.filter(function(e,t){return t>=o.length||"rest"===e.pattern||"zero or more"===e.pattern}));return c},[g(String,p),o(b)])}),define("macrolib/datastructures",["utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/typedvar","internaltypes/twineerror"],function(e,i,t,n,s,r,a,c,o,l){var u=e.permutations,p=e.options,d=n.objectName,f=n.subset,h=n.collectionType,m=n.isValidDatamapName,g=n.is,y=n.unique,b=n.clone,v=n.range,e=t.TypeSignature,n=e.optional,w=e.rest,k=e.either,S=e.zeroOrMore,T=e.Any,e=e.nonNegativeInteger,_=i("en");t.add(["a","array"],"Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},S(k(o,T)))("range","Array",function(e,t,n){return v(t,n)},[parseInt,parseInt])("subarray","Array",function(e,t,n,r){return f(t,n,r)},[Array,parseInt,parseInt])("reversed","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(b)},S(T))("shuffled","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.shuffled.apply(s,n).map(b)},[S(T)])("sorted","Array",function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(!c.isPrototypeOf(r[0]))return(t=r.filter(function(e){return"string"!=typeof e&&"number"!=typeof e}))&&t.length?1===t.length&&Array.isArray(t[0])?l.create("macrocall","Please give multiple numbers or strings to (sorted:), not a single array.","You can use the spread ... syntax to spread out the array's values into (sorted:)."):l.create("datatype","If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ".concat(d(t[0]),".")):r.sort(_);var o=r.shift();if("making"in o||"where"in o||"when"in o||!("via"in o))return l.create("datatype","The optional lambda given to (sorted:) must be a 'via' lambda, not ".concat(d(o),"."));for(var i=0;i<r.length;i+=1){var s=o.apply(e,{loop:r[i],pos:i+1});if(l.containsError(s))return s;if("string"!=typeof s&&"number"!=typeof s)return l.create("datatype",'The "via" lambda given to (sorted:) couldn\'t convert '.concat(d(r[i])," into a string or number."));r[i]=[r[i],s]}return r.sort(function(e,t){return _(e[1],t[1])}).map(function(e){return e[0]})},[S(T)])("rotated","Array",function(e,t){if(0===t)return l.create("macrocall","I can't rotate these values by 0 positions.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=-1*(t=Math.abs(t)%r.length*Math.sign(t));return r.slice(t).concat(r.slice(0,t)).map(b)},[parseInt,S(T)])("rotated-to","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)?t:t.length?(e=r.indexOf(t[0]),r.slice(e).concat(r.slice(0,e)).map(b)):l.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.")},[c.TypeSignature("where"),w(T)])("repeated","Array",function(e,t){for(var n=[],r=arguments.length,a=new Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(!a.length)return n;for(;0<t--;)n.push.apply(n,a);return n.map(b)},[e,w(T)])("interlaced","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),o=[],i=0;i<a;i+=1)for(var s=0;s<n.length;s+=1)o.push(b(n[s][i]));return o},[Array,w(Array)])("permutations","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?u.apply(void 0,n):[]},[S(T)])("unique","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.filter(y)},[S(T)])("altered","Array",function(n,r){for(var e=arguments.length,t=new Array(2<e?e-2:0),a=2;a<e;a++)t[a-2]=arguments[a];return t.map(function(e,t){t=r.apply(n,{loop:e,pos:t+1});return null===t?e:t})},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),S(T)])("find","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.filter(e,r)},[c.TypeSignature("where"),S(T)])(["all-pass","pass"],"Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||t.length===r.length},[c.TypeSignature("where"),S(T)])("some-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0<t.length},[c.TypeSignature("where"),S(T)])("none-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0===t.length},[c.TypeSignature("where"),S(T)])("folded","Any",function(r,a){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return"where"in a&&(t=[t[0]].concat(_toConsumableArray(a.filter(r,t.slice(1))))),l.containsError(t)||t.reduce(function(e,t,n){return a.apply(r,{making:e,loop:t,pos:n+1})})},[k(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),w(T)])(["dm-names","datamap-names","datanames"],"Array",function(e,t){return Array.from(t.keys()).sort(i("en"))},[Map])(["dm-values","datamap-values","datavalues"],"Array",function(e,t){return Array.from(t.entries()).sort(i("en",function(e){return String(e[0])})).map(function(e){return b(e[1])})},[Map])(["dm-entries","datamap-entries","dataentries"],"Array",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",b(e[1])]])})},[Map])(["dm-altered","datamap-altered"],"Datamap",function(a,o,e){return Array.from(e.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).reduce(function(e,t,n){if(!l.containsError(e)){var r=new Map([["name",t[0]],["value",b(t[1])]]),r=o.apply(a,{loop:r,pos:n+1});if(l.containsError(r))return r;e.set(t[0],null===r?t[1]:r)}return e},new Map)},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),Map])("history","Array",function(e,t){var n=s.history();return t?(t=t.filter(e,n.map(function(e){return a.get(e)})),l.containsError(t)?t:t.map(function(e){return e.get("name")})):n},[n(c.TypeSignature("where"))])("visited","Boolean",function(e,t){var n;return"string"==typeof t?a.has(t)?0<s.passageNameVisited(t)||s.passage===t:l.create("macrocall","There's no passage named '"+t+"' in this story."):(n=s.history(),n=t.filter(e,n.concat(s.passage).map(function(e){return a.get(e)})),l.containsError(n)?n:0<n.length)},[k(String,c.TypeSignature("where"))])("passage","Datamap",function(e,t){return b(a.get(t||s.passage))||l.create("macrocall","There's no passage named '"+t+"' in this story.")},[n(String)])("passages","Array",function(e,t){var n=i("en"),r=_toConsumableArray(a.values()).map(function(e){return b(e)}),t=t?t.filter(e,r):r,e=l.containsError(t);return e||t.sort(function(e,t){return n(e.get("name"),t.get("name"))})},[n(c.TypeSignature("where"))])("open-storylets","Array",function(e,t){return e.stackTop.evaluateOnly?l.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+"."):(e=a.getStorylets(e,t),l.containsError(e)||e.map(b))},[n(c.TypeSignature("where"))])("savedgames","Datamap",function(){function e(e){return"("+e+" "+p.ifid+") "}var t,n,r=0,a=new Map;do{if(!s.hasStorage)break;t=localStorage.key(r),r+=1;var o=e("Saved Game")}while(null!=(n=t)&&n.startsWith(o)&&(t=t.slice(o.length),a.set(t,localStorage.getItem(e("Saved Game Filename")+t))),t);return a},[])(["datamap","dm"],"Datamap",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!l.containsError(e))if(void 0===r)r=t;else{if(n=l.containsError(m(a,r)))return n;if(a.has(r))return l.create("macrocall","You used the same data name ("+d(r)+") twice in the same (datamap:) call.");a.set(r,b(t)),r=void 0}return e},!0);return l.containsError(i)?i:void 0!==r?l.create("macrocall","This datamap has a data name without a value."):a},S(k(o,T)))(["dataset","ds"],"Dataset",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(y).map(b))},S(T))("count","Number",function t(n,r){for(var e,a=arguments.length,o=new Array(2<a?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];if(1<o.length)return e=o.map(function(e){return t(n,r,e)}),l.containsError(e)||e.reduce(function(e,t){return e+t},0);var s=o[0];switch(h(r)){case"dataset":case"datamap":return l.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof s?l.create("macrocall",d(r)+" can't contain  "+d(s)+" because it isn't also a string."):s?r.split(s).length-1:0;case"array":return r.reduce(function(e,t){return e+g(t,s)},0);default:return l.create("macrocall",d(r)+" can't contain values, let alone "+d(s)+".")}},[T,w(T)])}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/codehook","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(c,r,e,l,s,n,u,p,a,d,t,i,f,h){var m=e.is,e=u.TypeSignature,g=e.either,y=e.rest,o=e.optional,b=Object.assign;function v(e,t){if(d.isPrototypeOf(t)&&!t.canEnchant)return h.create("datatype","The changer given to (".concat(e,":) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."))}["enchant","change"].forEach(function(o){u.addCommand(o,function(e,t){t=v(o,t);if(t)return t},function(t,n,e){n=p.from(n);var r,a=[];return d.isPrototypeOf(e)&&(r=i.create({section:t}),e.run(r),0<(r.innerEnchantments||[]).length)&&(r=r.innerEnchantments.map(function(e){return e(n)}),a.push.apply(a,_toConsumableArray(r))),a.push(f.create(_defineProperty(_defineProperty({scope:n},d.isPrototypeOf(e)?"changer":"lambda",e),"section",t))),a.forEach(function(e){"enchant"===o?(t.addEnchantment(e),t.updateEnchantments()):e.enchantScope()}),""},[g(p,String),g(d,t.TypeSignature("via"))],!1)}),u.addChanger("enchant-in",function(e,t,n){var r=v("enchant-in",n);return r||d.create("enchant-in",[t,n])},function(t,n,r){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create(_defineProperty(_defineProperty({scope:p.from(n),localHook:e},d.isPrototypeOf(r)?"changer":"lambda",r),"section",t.section))}),t},[g(p,String),g(d,t.TypeSignature("via"))]),[["link-style",p.create({type:"name",data:"link"})],["line-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"lines",void 0)],["char-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var e=_slicedToArray(e,2),r=e[0],a=e[1];u.addChanger(r,function(e,t){var n=v(r,t);return n||d.create(r,[t])},function(t,n){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create(_defineProperty(_defineProperty({scope:a,localHook:e},d.isPrototypeOf(n)?"changer":"lambda",n),"section",t.section))}),t},[g(d,t.TypeSignature("via"))])});e=["replace","append","prepend"];function w(i,s){return r.onStartup(function(){var e=i.classList.replace(/ /g,"."),t=i.blockClassList?i.blockClassList.replace(/ /g,"."):"",n="."+e+(t?",."+t:"");r.storyElement.on(i.event.map(function(e){return e+".enchantment"}).join(" "),n,function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents(n).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})}),[function(e,t,n){if(!t)return h.create("datatype","A string given to this ("+s+":) macro was empty.");if(n){var r=v(s,n);if(r)return r}return d.create(s,[p.from(t)].concat(n?[n]:[]))},function(t,e,n){t.enabled=!1,t.transitionDeferred=!0,i.rerender&&(t.newTargets=(t.newTargets||[]).concat({target:e,append:i.rerender}));var r,a=null!=(r=t.section)&&r.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=f.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.children().css("display"))?i.blockClassList:i.classList),e.attr({tabIndex:"0"})}],data:{enchantmentEvent:function(){var e;null!=(e=t.section.stackTop)&&e.blocked||(i.once&&t.section.removeEnchantment(o),i.goto?l.goToPassage(i.goto,{transition:i.transition}):i.undo?l.goBack({transition:i.transition}):t.section.renderInto(t.source,null,_objectSpread(_objectSpread({},t),{},{append:i.once?"append":"replace",enabled:!0,transitionDeferred:!1}),a))}},scope:e,section:t.section,name:s},d.isPrototypeOf(n)?"changer":"lambda",n));return t.section&&(t.section.addEnchantment(o),o.enchantScope()),t},[g(p,String),o(g(d,t.TypeSignature("via")))]]}e.forEach(function(o){u.addChanger(o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.every(Boolean)?d.create(o,n.map(p.from),null,!1):h.create("datatype","A string given to this (".concat(o,":) macro was empty."))},function(e){var t;0<c(e.target).parents().filter("tw-collapsed,[collapsing=true]").length||e.attr.some(function(e){return e.collapsing})||(e.attr=[].concat(_toConsumableArray(e.attr),[{collapsing:!1}])),e.newTargets=e.newTargets||[];for(var n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=e.newTargets).push.apply(t,_toConsumableArray(r.filter(function(n){return!e.newTargets.some(function(e){var t=e.target,e=e.append;return m(n,t)&&o===e})}).map(function(e){return{target:e,append:o,before:!0}}))),e},y(g(p,String)))(o+"-with",function(e,t){return d.create(o+"-with",[t],null,!1)},function(e,t){return a.isPrototypeOf(t)&&(t=t.code),e.appendSource=(e.appendSource||[]).concat({source:t,append:o}),e},g(a,String))});var k="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,S=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}},{name:"doubleclick",enchantDesc:{event:["dblclick"],once:!0,rerender:"",classList:"link enchantment-dblclick",blockClassList:"enchantment-dblclickblock"}}];S.forEach(function(e){"doubleclick"!==e.name&&(u.addChanger.apply(u,[e.name].concat(_toConsumableArray(w(e.enchantDesc,e.name)))),"click"===e.name)&&u.addChanger.apply(u,[e.name+"-rerun"].concat(_toConsumableArray(w(_objectSpread(_objectSpread({},e.enchantDesc),{},{once:!1}),e.name+"-rerun"))))}),r.onStartup(function(){S.forEach(function(e){var n=e.enchantDesc;n.blockClassList&&r.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents("."+n.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})})}),e.forEach(function(n){S.forEach(function(e){var t;"doubleclick"!==e&&(t=_objectSpread(_objectSpread({},e.enchantDesc),{},{rerender:n}),e=e.name+"-"+n,u.addChanger.apply(u,[e].concat(_toConsumableArray(w(t,e)))))})}),S.forEach(function(i){"doubleclick"!==i&&["goto","undo"].forEach(function(a){var o=i.name+"-"+a;u.addCommand(o,function(e,t){return!e||!t&&"goto"===a?h.create("datatype","A string given to this ("+o+":) macro was empty."):"goto"!==a||n.hasValid(t)?void 0:h.create("macrocall","I can't ("+o+":) the passage '"+t+"' because it doesn't exist.")},function(e,t,n,r){return"undo"===a&&s.pastLength<1?h.create("macrocall","I can't (undo:) on the first turn."):((0,_slicedToArray(w(_objectSpread(_objectSpread({},i.enchantDesc),{},{transition:e.data.passageT8n},"undo"===a?{undo:!0}:{goto:r}),o),2)[1])({section:t},p.from(n)),b(e,{source:""}))},[g(p,String)].concat("undo"===a?[]:String))})})}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(i,e,c,l,u,p,a,d,t,f,h){var n=e.TypeSignature,r=n.optional,o=n.rest,n=n.either,m=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],g=Object.assign;function s(e,t,n){n=n||t;var r,a=u.hasValid(t)&&t===n,e=e.evaluateTwineMarkup(c.unescape(n),"a link's passage name");return a?t=(a=0<e.children().length?"`".repeat((n.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"")+"\0".repeat(!!a)+t+"\0".repeat(!!a)+a:(e.findAndFilter("tw-error").length&&(r=e.findAndFilter("tw-error").data("TwineError")),n=e.text()),{text:t,passage:n,error:r}}c.onStartup(function(){var e="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;function t(e){var t=i(this),n=t.closest("tw-expression"),r=t.closest("tw-expression, tw-hook"),a=r.data("clickEvent"),r=r.data("section");if((!c.options.debug||!c.options.ignoreClickEvents||t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *"))&&!t.is("tw-open-button")&&(null==r||!r.stackTop||!r.stackTop.blocked||r.stackTop.blocked instanceof i&&r.stackTop.blocked.find(t).length)){if(a)return 0<t.find("tw-error").length?void 0:(e.stopPropagation(),void a(t));var r=n.data("linkPassageName"),o=_objectSpread({},n.data("passageT8n")||{});n.find("tw-enchantment").each(function(e,t){Object.assign(o,i(t).data("passageT8n")||{})}),r?(e.stopPropagation(),p.goToPassage(r,{transition:o})):t.is("[undo]")?(e.stopPropagation(),p.goBack({transition:o})):t.is("[fullscreen]")&&(e.stopPropagation(),p.toggleFullscreen())}}c.storyElement.on("click.passage-link","tw-link"+(e?"":":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)"),t).on("mouseover.passage-link","tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link",t).on("mouseout.passage-link","tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link",t).on("dblclick.passage-link","tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link",t),i(document).on("fullscreenchange",function(){i("tw-link[fullscreen]",c.storyElement).each(function(e,t){(i(t).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(t)})})}),[["link","link-replace"],["link-reveal","link-append"],["link-repeat"],["link-rerun"]].forEach(function(s){return e.addChanger(s,function(e,t,n){return t?n&&!n.canEnchant?h.create("datatype","The changer given to (".concat(s[0],":) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")):a.create(s[0],[t].concat(n||[]),null,!0):h.create("datatype",m[0])},function(r,e,t){var n,a=s[0],o=null!=(n=r.section)&&n.stackTop?r.section.stackTop.tempVariables:Object.create(null),i=d.create({source:"<tw-link tabindex=0>"+e+"</tw-link>",target:function(){return r.target},append:"replace",data:{section:r.section,clickEvent:function(e){r.enablers=r.enablers.filter(function(e){return e.descriptor!==i}),"link-reveal"===a&&e.contents().unwrap();var t,n=e.parentsUntil(":not(tw-enchantment)").parent();n.length||(n=e.parent()),"link-rerun"===a&&(t=e.parentsUntil(":not(tw-enchantment)"),e.detach(),t.remove()),"link"!==a&&"link-rerun"!==a||n.empty(),r.section.renderInto("",null,r,o),"link-rerun"===a&&n.prepend(e)}}});return r.enablers=(r.enablers||[]).concat({descriptor:i,changer:t}),r},[String,r(a)])}),e.addCommand("link-goto",function(e){if(!e)return h.create.apply(h,["datatype"].concat(m))},function(e,t,n,r){var a,o=s(t,n,r);return n=o.text,r=o.passage,(o=o.error)||(e.transition?h.create("datatype","Please attach ("+(o="transition")+"-depart:) or ("+o+"-arrive:) to a passage link, not ("+o+":)."):(a=(a=u.hasValid(r)?a:'<tw-broken-link passage-name="'+c.escape(r)+'">'+n+"</tw-broken-link>")||"<tw-link tabindex=0 "+(0<l.passageNameVisited(r)?'class="visited" ':"")+">"+n+"</tw-link>",e.data.linkPassageName=r,e.data.section=t,g(e,{source:a,transitionDeferred:!0})))},[String,r(String)])("link-storylet",function(){var e=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1)<0||arguments.length<=e?void 0:arguments[e];if(!e||"string"==typeof e)return h.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n=(n=2+("string"==typeof(arguments.length<=2?void 0:arguments[2])?1:0))<2||arguments.length<=n?void 0:arguments[n],r="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),a=((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a])!==n&&((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a]);if(e.transition)return h.create("datatype","Please attach (".concat(o="transition","-depart:) or (").concat(o,"-arrive:) to (link-storylet:), not (").concat(o,":)."));var o=f.isPrototypeOf(n),i=u.getStorylets(t,o&&n),s=h.containsError(i);if(s)return s;var c,s=i[o?0:n<0?i.length+n:n-1];if(s)s=s.get("name"),r=r||s,c=c||"<tw-link tabindex=0 "+(0<l.passageNameVisited(s)?'class="visited" ':"")+">"+r+"</tw-link>",e.data.linkPassageName=s,e.data.section=t;else{if(!a)return e;c=a}return g(e,{source:c,transitionDeferred:!0})},[n(parseInt,String,f.TypeSignature("where")),r(n(parseInt,String,f.TypeSignature("where"))),r(String)])("link-undo",function(e){if(!e)return h.create("datatype",m[0])},function(t,e,n){var r,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return l.pastLength<1?g(t,{source:a}):(r=(t.data.section=e).stackTop.tempVariables,t.data.forgetUndosEvent=function(){return t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a,transitionDeferred:!1});t.section.renderInto("",null,e,r)})},g(t,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0}))},[String,r(String)])("link-show",function(e){if(!e)return h.create("datatype",m[0])},function(r,a,e){for(var t=arguments.length,n=new Array(3<t?t-3:0),o=3;o<t;o++)n[o-3]=arguments[o];return r.data.section=a,r.data.clickEvent=function(e){e.contents().unwrap(),n.forEach(function(e){return e.forEach(a,function(e){var t=e.data("originalSource")||"",n=e.data("hidden");n&&(e.removeData("hidden"),n instanceof i?e.empty().append(n):(n=e.data("tempVariables"),a.renderInto("",null,_objectSpread(_objectSpread({},r),{},{source:t,target:e,transitionDeferred:!1}),n&&Object.create(n))))})})},g(r,{source:"<tw-link tabindex=0>"+e+"</tw-link>",transitionDeferred:!0})},[String,o(t)])("link-fullscreen",function(e,t){if(!e||!t)return h.create("datatype",m[0])},function(t,e,n,r){function a(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""}var o=e.stackTop.tempVariables;return t.data.section=e,t.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a(),transitionDeferred:!1});t.section.renderInto("",null,e,o)})},g(t,{source:a(),transitionDeferred:!0})},[String,String,r(String)]),e.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return h.create.apply(h,["datatype"].concat(m));if(a.isPrototypeOf(n)){if(a.isPrototypeOf(r))return h.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}return r&&!r.canEnchant?h.create("datatype","The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."):(t=(e=s(e,t,n)).text,n=e.passage,e.error||a.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}),null,!1))},function(t,e,n,r){var a,o,i,s;if(u.hasValid(n))return o=l.passageNameVisited(n),i=null!=(a=t.section)&&a.stackTop?t.section.stackTop.tempVariables:Object.create(null),s=d.create({source:"<tw-link tabindex=0 "+(0<o?'class="visited" ':"")+">"+e+"</tw-link>",target:t.target,append:"replace",data:{section:t.section,append:"replace",clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==s}),e.contents().unwrap(),t.section.renderInto("",null,t,i),t.section.whenUnblocked(function(){return p.goToPassage(n,{transition:t.data.passageT8n})})}}}),t.enablers=(t.enablers||[]).concat({descriptor:s,changer:r}),t;t.source='<tw-broken-link passage-name="'+c.escape(n)+'">'+e+"</tw-broken-link>"},[String,r(n(a,String)),r(a)])}),define("macrolib/metadata",["macros","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(t,e,n,s){function c(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}}var l=e.clone,u=e.objectName,p=e.isValidDatamapName,e=t.TypeSignature,r=e.zeroOrMore,e=e.Any;[["storylet",n.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(e){var e=_slicedToArray(e,2),n=e[0],e=e[1];t.add(n,"Metadata",function(e,t){return e.stackTop.speculativePassage?t:c(n)},e)}),t.add("metadata","Metadata",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!s.containsError(e))if(void 0===r)r=t;else{if(n=s.containsError(p(a,r)))return n;if(a.has(r))return s.create("macrocall","You used the same data name ("+u(r)+") twice in the same (metadata:) call.");a.set(r,l(t)),r=void 0}return e},!0);return s.containsError(i)?i:void 0!==r?s.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?a:c("metadata")},r(e))}),define("macrolib/patterns",["macros","utils","utils/operationutils","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror","internaltypes/varscope"],function(e,t,n,y,b,h,v,w){function k(e){var r,t,a=e.name,n=e.fullArgs,o=e.args,i=e.makeRegExpString,s=void 0===i?function(e){return e.join("")}:i,c=void 0!==(i=e.insensitive)&&i,l=void 0===(i=e.canContainTypedVars)||i,u=void 0===(i=e.canBeUsedAlone)||i,p=void 0===(i=e.canContainTypedGlobals)||i,d=o||n,f=E(null),e=d.map(function e(t){if(h.isPrototypeOf(t)){var n=t.varRef;if(!l)return v.create("operation","Optional string patterns, like (".concat(a,":)").concat("p-many"===a?" with a minimum of 0 matches":"",", can't have typed variables inside them."));if(!p&&!w.isPrototypeOf(n.object))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"));n=n.getName();if(n in f)return v.create("operation","There's already a typed temp variable named _".concat(n," inside this (").concat(a,":) call."));f[n]=!0;n=e(t.datatype);return v.containsError(n)?n:"("+n+")"}if(b.isPrototypeOf(t)){if(!(l&&p||"function"!=typeof t.typedVars)){n=t.typedVars();if(!l&&n.length)return v.create("operation","(".concat(a,":) can't have typed variables inside its pattern."));if(!p&&n.some(function(e){return!w.isPrototypeOf(e.varRef.object)}))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"))}var r;return t.regExp?(t.rest?"(?:":"")+(c?t.insensitive():t).regExp+(t.rest?")*":""):(n=t.name,r=t.rest?"*":"","alnum"===n?m+r:"whitespace"===n?_+r:"uppercase"===n?(c?T:g)+r:"lowercase"===n?(c?T:S)+r:"anycase"===n?T+r:"digit"===n?"\\d"+r:"linebreak"===n?"(?:\\r|\\n|\\r\\n)"+r:"str"===n?".*?":["even","odd","int","num"].includes(n)?v.create("datatype","Please use string datatypes like 'digit' in (".concat(a,":) instead of number datatypes.")):v.create("datatype","The (".concat(a,":) macro must only be given string-related datatypes, not ").concat(O(t),".")))}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),c?t.replace(RegExp("(".concat(g,"|").concat(S,")"),"g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"}):t):(x("createPattern","mapper() was given a non-string non-datatype "+t),"")});return(i=v.containsError(e))||(r=s(e),t=C(E(b),{name:a,regExp:r,insensitive:function(){return c?t:k({name:a,fullArgs:n,args:d.map(function(e){return b.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:s,insensitive:!0,canContainTypedVars:l,canBeUsedAlone:u})},typedVars:function(){return d.reduce(function(e,t){return h.isPrototypeOf(t)&&(e=e.concat(c?h.create(k({name:"p-ins",fullArgs:[t.datatype],insensitive:!0}),t.varRef):t),t=t.datatype),e=b.isPrototypeOf(t)&&"function"==typeof t.typedVars?e.concat(t.typedVars()):e},[])},destructure:function(e){var n,t;return"string"!=typeof e?[v.create("operation","I can't put ".concat(O(e)," into ").concat(this.TwineScript_ToSource()," because it isn't a string."))]:(n=this.typedVars()).length?(t=(RegExp("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$").exec(e)||[]).slice(1)).length?t.map(function(e,t){t=n[t];if(t)return t.datatype.rest&&!t.datatype.regExp&&((t=t.TwineScript_Clone()).datatype=k({name:"p",fullArgs:[t.datatype]})),{dest:t,value:e||"",src:void 0}}).filter(Boolean):[v.create("operation","I can't put ".concat(O(e)," because it doesn't match the pattern ").concat(this.TwineScript_ToSource(),"."))]:[]},TwineScript_IsTypeOf:function(e){return u?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$"):v.create("operation","A (".concat(a,":) datatype must only be used with a (p:) macro."))},TwineScript_toTypeSignatureObject:function(){var t=this;return{pattern:"range",name:a,range:function(e){return t.TwineScript_IsTypeOf(e)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+a+":"+n.map(A)+")"}}),Object.defineProperty(t,"TwineScript_ObjectName",{get:function(){return"a (".concat(a,":) datatype")}}),t)}var m=t.anyRealLetter,g=t.anyUppercase,S=t.anyLowercase,T=t.anyCasedLetter,_=t.realWhitespace,x=t.impossible,O=n.objectName,A=n.toSource,t=e.TypeSignature,n=t.rest,r=t.either,a=t.optional,t=t.nonNegativeInteger,C=Object.assign,E=Object.create,o=n(r(String,b,h));e.add(["p","pattern"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p",fullArgs:n})},o)(["p-either","pattern-either"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},o)(["p-opt","pattern-opt","p-optional","pattern-optional"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},o)(["p-not","pattern-not"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==_toConsumableArray(e).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?v.create("datatype","(p-not:) should only be given single characters, or datatypes that match single characters"):k({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},o)(["p-not-before","pattern-not-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-not-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?!"+e.join("")+")"}})},o)(["p-before","pattern-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?="+e.join("")+")"}})},o)(["p-start","pattern-start"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-start",fullArgs:n,makeRegExpString:function(e){return"^(?:"+e.join("")+")"}})},o)(["p-end","pattern-end"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-end",fullArgs:n,makeRegExpString:function(e){return"(?:"+e.join("")+")$"}})},o)(["p-many","pattern-many"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i,s=n.slice();return"number"==typeof n[0]&&(a=n.shift(),o="number"==typeof n[0]?n.shift():1/0),!(void 0!==o&&o<a)&&n.length?(i=n.find(function(e){return"string"!=typeof e&&!b.isPrototypeOf(e)&&!h.isPrototypeOf(e)}))?v.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+O(i)+"."):k({name:"p-many",args:n,fullArgs:s,canContainTypedVars:0<a,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==a?"{"+a+(o===1/0?",":o!==a?","+o:"")+"}":"+")}}):v.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.")},[n(r(t,String,b,h))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-ins",fullArgs:n,insensitive:!0})},o)(["split","splitted"],"Array",function(e,t,n){if(t=k({name:"split",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t))return t;if(!n)return[""];if(!t.regExp)return _toConsumableArray(n);for(var r,a=RegExp(t.regExp),o=[];n&&(r=a.exec(n));){if(r.index+r[0].length===0)return o;o.push(n.slice(0,r.index)),n=n.slice(r.index+r[0].length)}return o.concat(n||[])},[r(String,b),String])("trimmed","String",function(e,t,n){return void 0===n||b.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=k({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[r(String,b),a(String)])(["str-find","string-find"],"String",function(e,t,n){if(t=k({name:"str-find",fullArgs:[t],canContainTypedGlobals:!1}),v.containsError(t))return t;for(var r,a=t.typedVars(),o=RegExp(t.regExp,"g"),i=[],s=o.lastIndex;(r=o.exec(n))&&s!==o.lastIndex;)if(s=o.lastIndex,a.length){for(var c=new Map,l=0;l<a.length;l+=1){if("match"===a[l].varRef.getName())return v.create("macrocall","There was a typed temp variable named _match in the pattern given to (str-find:)","The variable _match is reserved, and can't be used inside (str-find:)'s pattern.");c.set(a[l].varRef.getName(),r[l+1]),c.set("match",r[0])}i.push(c)}else i.push(r[0]);return i},[b,String])(["str-replaced","string-replaced","replaced"],"String",function(e,t,n,r,a){if("number"!=typeof t){if(void 0!==a)return v.create("macrocall","1 too many values were given to (str-replaced:).","If this is given 5 values, the first value must be a number of replacements.");a=r,r=n,n=t,t=1/0}else if(void 0===a)return v.create("macrocall","The (str-replaced:) macro needs 1 more value.","The final string seems to be missing.");if(b.isPrototypeOf(r))return v.create("datatype","The replacement value for (str-replaced:) must be a string or lambda, not ".concat(O(r)));if(y.isPrototypeOf(a)||y.isPrototypeOf(n))return v.create("datatype","The ".concat(y.isPrototypeOf(a)?"final string":"search pattern"," given to (str-replaced:) can't be a lambda."),"Only the replacement value (after the search pattern) can be a 'via' lambda.");if(n=k({name:"str-replaced",fullArgs:[n],canContainTypedGlobals:!1}),v.containsError(n))return n;if(!n.regExp)return a;for(var o,i=RegExp(n.regExp,"g"),s=y.isPrototypeOf(r)?n.typedVars():[],c=1,l=0,u="",p=i.lastIndex;a&&(o=i.exec(a))&&0<t&&p!==i.lastIndex;){for(var p=i.lastIndex,d=Object.create(e.stack.length?e.stackTop.tempVariables:w),f=0;f<s.length;f+=1){var h=s[f],m=h.varRef.create(d,h.varRef.propertyChain);if(v.containsError(m))return m;h=m.defineType(h.datatype);if(v.containsError(h))return h;m.set(o[f+1])}var g=y.isPrototypeOf(r)?r.apply(e,{loop:o[0],pos:c,tempVariables:d}):r;if(v.containsError(g))return g;if("string"!=typeof g)return v.create("datatype","(str-replaced:)'s lambda must produce a string, but it produced ".concat(O(g),' when given "').concat(o[0],'".'));u+=a.slice(l,o.index)+g,c+=1,--t,l=o.index+o[0].length}return u+=a.slice(l)},[r(t,String,b),r(b,String,y.TypeSignature("via")),r(String,y.TypeSignature("via")),a(String)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(s,e,c,t,a,n,r,o,i,l,u){var p,d,f=t.geomParse,h=t.geomStringRegExp,m=Object.assign,t=e.TypeSignature,g=t.either,y=t.wrapped,b=t.optional,v=t.Any,w=t.Everything,k=t.zeroOrMore,S=t.rest,T=t.insensitiveSet,_=t.positiveNumber,x=t.positiveInteger,O=t.nonNegativeNumber,t=t.percent,y=[y(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')],A=(c.onStartup(function(){return c.storyElement.on("mouseenter.hover-macro","[hover=false]",function(){var e=s(this),t=e.data("hoverChanger");c.options.debug&&c.options.ignoreClickEvents&&!e.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||(e.data({mouseoutStyle:e.attr("style")||""}),l.create({target:e},t).update(),e.attr("hover",!0))}).on("mouseleave.hover-macro","[hover=true]",function(){var e=s(this),t=e.data("mouseoutStyle");e.attr("style",t).removeData("mouseoutStyle").attr("hover",!1)})}),u.on(function(){s("tw-expression, tw-hook",c.storyElement).each(function(e,t){((t=s(t)).data("errorEvent")||Object)(t)})}),T("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur")),C=T("dotted","dashed","solid","double","groove","ridge","inset","outset","none");e.addChanger("if",function(e,t){return o.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},y)("unless",function(e,t){return o.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},y)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?o.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):u.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},y)("else",function(e){return"lastHookShown"in e.stack[0]?o.create("else",[!1===e.stack[0].lastHookShown]):u.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return o.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return o.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return o.create("live",t?[t]:[])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}},b(Number))("event",function(e,t){return o.create("event",[t])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}},i.TypeSignature("when"))("more",function(){return o.create("more")},function(e){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return 0!==e.Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return o.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,n){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return c.anyInputDown()&&n&&(t-=n),e.Identifiers.time>t?[!0]:[]}}}},[_,b(O)])("after-error",function(){return o.create("after-error",[])},function(n){n.enabled=!1,n.transitionDeferred=!0;var r=n.section.stackTop.tempVariables;n.data.errorEvent=function(e){e.removeData("errorEvent");var t=_objectSpread(_objectSpread({},n),{},{enabled:!0,transitionDeferred:!1});t.data&&(t.data.errorEvent=void 0),n.section.whenUnblocked(function(){return n.section.renderInto("",null,t,r)})}},[])("hook",function(e,t){var n;return t?(n=c.insensitiveName(t))?o.create("hook",[n]):u.create("datatype",'The string given to (hook:), "'.concat(t,'", contained only dashes and underscores.')):u.create("datatype","The string given to (hook:) was empty.")},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){if(!t.loop)return u.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return o.create("for",[t].concat(r))},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o,i=t.filter(e.section,r);if(o=u.containsError(i))return o;e.loopVars[t.loop.getName()]=i||[]},[i.TypeSignature("where"),k(v)])(["transition","t8n"],function(e,t){return o.create("transition",[c.insensitiveName(t)])},function(e,t){return"zoom"===(e.transition=t)&&(e.transitionOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-time","t8n-time"],function(e,t){return o.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=m(e.data.passageT8n||{},{time:t}),e},[_])(["transition-delay","t8n-delay"],function(e,t){return o.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return o.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[_])(["transition-depart","t8n-depart"],function(e,t){return o.create("transition-depart",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{depart:t}),"zoom"===t&&(e.data.passageT8n.departOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-arrive","t8n-arrive"],function(e,t){return o.create("transition-arrive",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{arrive:t}),"zoom"===t&&(e.data.passageT8n.arriveOrigin=function(){var e=s(this),t=e.offset(),n=t.left,t=t.top,r=e.height();return{"transform-origin":100*(c.mouseCoords.x-n)/e.width()+"% "+100*(c.mouseCoords.y-t)/r+"%",height:r+"px"}}),e},[A])("button",function(e,t){return void 0===t||f(t).size?o.create("button",t?[t]:[]):u.create("datatype",'The string given to (button:) should be a sizing line ("==X==", "==X", "=XXXX=" etc.), not '.concat(JSON.stringify(t),"."))},function(e,t){var t=f(t),n=t.marginLeft,t=t.size;return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(0<this.className.length)+"enchantment-button")}}),e.styles.push({"margin-left":t?n+"%":void 0,width:t?t+"%":"100%"}),e},[b(String)]).apply(void 0,_toConsumableArray((d={click:{className:"enchantment-link",blockClassName:"enchantment-clickblock"},doubleclick:{className:"enchantment-dblclick",blockClassName:"enchantment-dblclickblock"},mouseover:{className:"enchantment-mouseover",blockClassName:"enchantment-mouseoverblock"},mouseout:{className:"enchantment-mouseout",blockClassName:"enchantment-mouseoutblock"}},["action",function(e,t){return o.create("action",[c.insensitiveName(t)])},function(e,t){return e.attr.push({class:function(){var e=function e(t){return(t=s(t)).is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(t.css("display"))||t.children().get().some(e)}(this);return Array.from(this.classList).filter(function(t){return!Object.keys(d).some(function(e){return d[e].className===t||d[e].blockClassName===t})}).concat(d[t][e?"blockClassName":"className"]).join(" ")}}),e},[T.apply(void 0,_toConsumableArray(Object.keys(d)))]])))(["border","b4r"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({display:function(){var e=s(this).css("display");return n.every(function(e){return"none"===e})||!e.includes("inline")?e:"inline-block"},"border-style":n.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),e},[C].concat(_toConsumableArray(Array(3).fill(b(C)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-size",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))("corner-radius",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("corner-radius",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-colour",n.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[g(String,a)].concat(_toConsumableArray(Array(3).fill(b(g(String,a))))))("opacity",function(e,t){return o.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[t])("font",function(e,t){return o.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=t.indexOf("><");return/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?((n=~n?_objectSpread({"text-align":"center","max-width":"50%"},25===(n=Math.round(n/(t.length-2)*50))?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":n+"%"}):"<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"}).display="block",o.create("align",[n])):u.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"')},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return o.create("text-colour",[t])},function(e,t){return a.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[g(String,a)])(["text-size","size"],function(e,t){return o.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return o.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return o.create("text-rotate-z",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" rotate("+t+"deg)"}}),e},[Number])("text-rotate-y",function(e,t){return o.create("text-rotate-y",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateY("+t+"deg)"}}),e},[Number])("text-rotate-x",function(e,t){return o.create("text-rotate-x",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateX("+t+"deg)"}}),e},[Number])(["background","bg"],function(e,t){return o.create("background",[t])},function(e,t){return a.isPrototypeOf(t)?t=t.toRGBAString():r.isPrototypeOf(t)&&(t=t.toLinearGradientString()),t=a.isHexString(t)||a.isCSS3Function(t)?{"background-color":t}:t.startsWith("linear-gradient(")||t.startsWith("repeating-linear-gradient(")?{"background-image":t}:{"background-size":"cover","background-image":"url(".concat(t,")"),"background-attachment":"fixed"},e.styles.push(t,{display:function(){var e=s(this);return!e.children().length||c.childrenProbablyInline(e)?s(this).css("display"):"block"}}),e},[g(String,a,r)]).apply(void 0,_toConsumableArray((y={color:function(){return"transparent"}},p=m(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var e=s(this).css("color");return"-1px -1px 0 "+e+", 1px -1px 0 "+e+",-1px  1px 0 "+e+", 1px  1px 0 "+e}},{color:function(){return c.parentColours(s(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+s(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+s(this).css("color")}},smear:[{"text-shadow":function(){var e=s(this).css("color");return"0em   0em 0.02em "+e+",-0.2em 0em  0.5em "+e+", 0.2em 0em  0.5em "+e}},y],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+s(this).css("color")}},y],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+s(this).css("color")},"user-select":"none"},y],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},tall:{display:"inline-block",transform:"scaleY(1.5) translateY(-0.25ex)"},flat:{display:"inline-block",transform:"scaleY(0.5) translateY(0.25ex)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("text-style",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=1)"none"===n[a]?e.styles=[]:e.styles=e.styles.concat(p[n[a]]);return e},[S(T.apply(void 0,_toConsumableArray(Object.keys(p))))]])))("collapse",function(){return o.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=l.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?o.create("hover-style",[t]):u.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[o])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),o.create("css",[t])},function(e,t){return e.attr.push({style:function(){return(s(this).attr("style")||"")+t}}),e},[String])("test-true",function(){return o.create("test-true",[])},function(e){return e.enabled=!0},k(w))("test-false",function(){return o.create("test-false",[])},function(e){return e.enabled=!1},k(w)),e.addCommand("animate",s.noop,function(r,e,t,a,o){t.forEach(e,function(e){var t,n;"zoom"===name&&(n=(t=e.offset()).left,t=t.top,n=c.mouseCoords.x-n+"px "+(c.mouseCoords.y-t)+"px"),c.transitionIn(e,a,r.transitionTime||o,r.transitionDelay,r.transitionSkip,0,n)})},[S(n),T.apply(void 0,_toConsumableArray(A.innerType.filter(function(e){return"instant"!==e}))),b(_)]),["box","float-box"].forEach(function(i){return e.addChanger(i,function(e,t,n){var r=-1===t.search(h)||1<t.length&&!t.includes("="),a="float-box"===i&&(-1===n.search(h)||1<n.length&&!n.includes("="));return r||a?u.create("datatype","The ("+i+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(r?t:n)+'".'):o.create(i,[t,n].filter(function(e){return void 0!==e}))},function(e,t,n){var r,t=f(t),a=t.marginLeft,t=t.size,o=("float-box"===i&&(r=(o=f(n)).marginLeft,n=o.size),"box"===i?"%":"vw"),t=_defineProperty(_defineProperty(_defineProperty({display:"block",width:t+o,"max-width":t+o},"box"===i?"margin-left":"left",a+o),"overflow-y","auto"),"padding",function(){var e=s(this).css("padding");return e&&"0px"!==e?e:"1em"});return void 0!==n&&(t.height="box"===i?1.5*n+2+"em":n+"vh"),"float-box"===i&&m(t,{position:"fixed",top:r+"vh","background-color":function(){return c.parentColours(s(this)).backgroundColour}}),e.styles.push(t),e},[String,"box"===i?b(x):String])})}),define("macrolib/values",["macros","state","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","datatypes/codehook","internaltypes/twineerror"],function(t,r,e,n,l,c,a,o,i,f){var s=e.realWhitespace,u=e.nth,p=e.anyRealLetter,d=e.plural,h=n.subset,m=n.objectName,g=n.clone,y=n.toSource,e=t.TypeSignature,n=e.rest,b=e.zeroOrMore,v=e.either,w=e.optional,k=e.insensitiveSet,S=e.numberRange,T=e.percent,_=e.nonNegativeInteger,x=e.positiveInteger,e=e.Any,O=Math.max,A=Math.min,C=Math.round,E=Math.floor,N=Math.ceil;function j(t){return function(){var e=t.apply(void 0,arguments);return"number"!=typeof e||isNaN(e)?f.create("macrocall","This mathematical expression doesn't compute!"):e}}t.add(["str","string","text"],"String",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.map(function(e){return i.isPrototypeOf(e)?e.source:e}).join("")},[b(t.TypeSignature.either(String,Number,Boolean,Array,i))])("source","String",function(e,t){return"command"!==(null==t?void 0:t.TwineScript_TypeID)||t.TwineScript_ToSource?y(t):f.create("datatype","I can't construct the source code of a command created by a custom macro.")},[e])("substring","String",function(e,t,n,r){return h(t,n,r)},[String,parseInt,parseInt])("lowercase","String",function(e,t){return t.toLowerCase()},[String])("uppercase","String",function(e,t){return t.toUpperCase()},[String])("lowerfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words","Array",function(e,t){return t.split(RegExp(s+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],"String",function(e,t,n){return 0===n.length?f.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[_,String])(["str-reversed","string-reversed"],"String",function(e,t){return _toConsumableArray(t).reverse().join("")},[String])("joined","String",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.join(t)},[n(String)])("plural","String",function(e,t,n,r){return n&&""!==r?d(t,n,r):f.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,w(String)])(["str-nth","string-nth"],"String",function(e,t){return u(t)},[parseInt])("digit-format","String",function(e,t,n){if(1e21<=Math.abs(n))return f.create("macrocall","The number given to (digit-format:) is too big.");for(var r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1],i=(t=_toConsumableArray(t)).length,s=(a&&(","!==a||o&&","!==o)&&(i=r.lastIndex-1),Math.abs(n).toFixed(16).replace(/(\.\d*?)0+$/,function(e,t){return t}).replace(/^0+/,"")),c=s.includes(".")?s.indexOf("."):s.length,l=0,u="",p=t.length-1;0<=p;--p){var d=t[p];"0"===d||"#"===d?u=(s[c-i+p+l]||("0"===d?"0":""))+u:p<t.length-1&&0<p&&(u=d+u,l+=p===i?0:1)}return(n<0?"-":"")+u},[String,Number])(["num","number"],"Number",function(e,t){return Number.isNaN(+t)?f.create("macrocall","I couldn't convert "+m(t)+" to a number."):+t},[String])("datatype","Datatype",function(e,t){return a.from(t)},[e])("datapattern","Any",function(e,t){return function n(e){var r;return Array.isArray(e)?r=e.map(n):e instanceof Map?(r=new Map,_toConsumableArray(e).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return r.set(t,n(e))})):r=a.from(e),(e=f.containsError(r))||r}(t)},[e])(["rgb","rgba"],"Colour",function(e){return l.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[S(0,255),S(0,255),S(0,255),w(T)])(["hsl","hsla"],"Colour",function(e,t,n,r,a){return(t=C(t)%360)<0&&(t+=360),l.create({h:t,s:n,l:r,a:a})},[Number,T,T,w(T)])(["lch","lcha"],"Colour",function(e,t,n,r,a){return(r=C(r)%360)<0&&(r+=360),l.create({l:t,c:n,h:r,a:a})},[T,S(0,132),Number,w(T)])("complement","Colour",function(e,t){return t.LCHRotate(180)},[l])("mix","Colour",function(e,t,n,r,a){n=n.toLCHA(),a=a.toLCHA();var o=1,i=(t+r!==1&&(t+r<1&&(o=t+r),t=(i=[t/(t+r),r/(t+r)])[0],r=i[1]),n.c<2||n.l<.01||.99<n.l?n.h=a.h:(a.c<2||a.l<.01||.99<a.l)&&(a.h=n.h),n.l*=n.a,n.c*=n.a,a.l*=a.a,a.c*=a.a,180<a.h-n.h?n.h+=360:a.h-n.h<-180&&(a.h+=360),n.a*t+a.a*r),s=(n.l*t+a.l*r)/i,c=(n.c*t+a.c*r)/i,n=(n.h*t+a.h*r)/i;return l.create({l:s,c:c,h:n,a:i*o})},[T,l,T,l])("palette","Array",function(e,t,n){var r,a=n.toLCHA(),o=a.l,a={l:o<=.75?.75+o/3:.75-3*(1-o),c:80,h:a.h,a:1},i=l.create(a);return a.l+=o<=.75?-.1:.1,a.l<.5&&(a.l*=.5/a.l),r=l.create(a),a.l+=o<=.85?.15:-.15,o=l.create(a),"adjacent"===t?(r=(i=i.LCHRotate(-30)).LCHRotate(30),o=i.LCHRotate(60)):"triad"===t&&(o=i.LCHRotate(180),r=i.LCHRotate(140),i=i.LCHRotate(-140)),[n,i,r,o]},[k("mono","adjacent","triad"),l])("gradient","Gradient",function(e,t){(t=C(t)%360)<0&&(t+=360);for(var n,r,a,o=arguments.length,i=new Array(2<o?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];return i.length<4?f.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours."):(r=[],a=i.reduce(function(e,t){if(!f.containsError(e))if(void 0===n)n=t;else{if("number"!=typeof n||!l.isPrototypeOf(t))return f.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");r.push({stop:n,colour:g(t)}),n=void 0}return e},!0),f.containsError(a)?a:void 0!==n?f.create("macrocall","This gradient has a colour-stop percent without a colour."):c.create(t,r))},[Number,n(v(T,l))])("stripes","Gradient",function(e,t,n){(t=C(t)%360)<0&&(t+=360);for(var r=0,a=[],o=arguments.length,i=new Array(3<o?o-3:0),s=3;s<o;s++)i[s-3]=arguments[s];return i.forEach(function(e){a.push({stop:r,colour:g(e)}),r+=n,a.push({stop:r,colour:g(e)})}),c.create(t,a,!0)},[Number,x,l,n(l)])("hooks-named","HookName",function(e,t){return t?o.create({type:"name",data:t}):f.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond","Any",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=2){var o=n[a];if(a===n.length-1||f.containsError(o))return o;if("boolean"!=typeof o)return f.create("datatype","(cond:)'s "+u(a+1)+" value is "+m(o)+", but should be a boolean.");if(o)return n[a+1]}return f.create("macrocall","An odd number of values must be given to (cond:), not "+n.length,"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,e,n(e)]);({weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,n(Number)],max:[O,n(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return(0<e?E:N)(e)},Number],ceil:[N,Number],pow:[j(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[j(Math.sqrt),Number],log:[j(Math.log),Number],log10:[j(Math.log10),Number],log2:[j(Math.log2),Number],random:[function(e,t){var n,t=t?(n=A(e,t),O(e,t)):(n=0,e);return t+=1,~~(r.random()*(t-n))+n},[parseInt,t.TypeSignature.optional(parseInt)]],"":function(){for(var e in this)e&&hasOwnProperty.call(this,e)&&t.add(e,"Number",function(a){return function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a.apply(void 0,n)}}(this[e][0]),this[e][1])}})[""](),t.add("either","Any",function(e){var t=1+~~(r.random()*(arguments.length<=1?0:arguments.length-1));return t<1||arguments.length<=t?void 0:arguments[t]},n(e))("nth","Any",function(e,t){return t<=0?f.create("datatype","(nth:)'s first value should be a positive whole number, not "+t):(t=(t-1)%(arguments.length<=2?0:arguments.length-2)+2)<2||arguments.length<=t?void 0:arguments[t]},[parseInt,n(e)])}),!function(){var a,k={};function o(e){for(var t in e)this[t]=e[t]}function i(e,t){for(var n,r,a=e.innerText,o=null,i=0,s=i,c=a.length,l=null;i<c;){for(var u=a.slice(i),p=(o&&o.length?o[0]:e).innerMode,d=0,f=p.length;d<f;d+=1){var h=k[p[d]];if(!(h.constraint&&!h.constraint(l)||h.cannotFollowText&&("text"===(null==(w=l)?void 0:w.type)||s<i))&&(h.plainCompare?u.startsWith(h.pattern):h.pattern.test(u))){var m=h.fn(h.plainCompare?h.pattern:h.pattern.exec(u)),g=!1,y=0;if(m.matches){for(;o&&y<o.length;y+=1){var b=o[y],v=b.type,b=b.aka;if(v in m.matches){g=!0;break}b&&(v=b),-1<(null==(b=m.cannotCross)?void 0:b.indexOf(v))&&(y=o.length-1)}if((!o||y>=o.length)&&!m.isFront)continue}s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:p});var s=i+=(l=e.addChild(m)).text.length,w=!1;g&&(t&&S(e,l,o[y]),o=o.slice(y+1),w=!0),!w&&l.isFront&&(o?o.unshift(l):o=[l]);break}}d===f&&(i+=1,null===l)&&(l={type:"text"})}for(s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:(null!=(n=o)&&n.length?o[0]:e).innerMode});0<(null==(r=o)?void 0:r.length);)o.shift().demote();return e}function S(e,t,n){var r=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,r-(a+1)),t.type=t.matches[n.type],t.innerText="";for(var o,i=0,s=t.children.length;i<s;i++)t.innerText+=t.children[i].text;for(o in t.start=n.start,t.text=n.text+t.innerText+t.text,n)hasOwnProperty.call(n,o)&&!hasOwnProperty.call(t,o)&&(t[o]=n[o]);t.isFront&&(t.isFront=!1),e.children.splice(a,1)}o.prototype={constructor:o,addChild:function(e){var t=this.lastChildEnd(),n=new o(e);return n.start=t,n.end=e.text&&t+e.text.length,n.place=this.place,n.children=[],n.innerText&&i(n),this.children.push(n),n},lastChildEnd:function(){var e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(var t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){var r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(n){return n<this.start||n>=this.end?null:this.children?this.children.reduce(function(e,t){return e||(n>=t.start&&n<t.end?t:null)},null):this},everyLeaf:function(n){return this.children&&0!==this.children.length?this.children.reduce(function(e,t){return e&&t.everyLeaf(n)},!0):!!n(this)},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&0<this.children.length&&(e+="["+this.children+"]"),e},copy:function(){var e=new o(this);return e.children=e.children.slice(),e},foldChildren:function(){for(var e=[],t=this.children.slice(),n=0;n<t.length;n+=1){var r=t[n],a=!1;if(r.matches)for(var o=0;o<e.length;o+=1)e[o].type in r.matches&&(S(this,r,e[o]),e=e.slice(o+1),a=!0);!a&&r.isFront&&e.unshift(r)}}},a={lex:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"start",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return i(new o({type:"root",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:a.modes[n]}),!r)},rules:k,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=a:"function"==typeof define&&define.amd?define("lexer",[],function(){return a}):this&&null!=this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=a):this.Lexer=a}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var m,g=Object.keys,y=Object.assign;function t(e){function t(n){return n=n||"innerText",function(e){var e=e.reduceRight(function(e,t,n){return e||(n?t:"")},""),t={};return t[n]=e,t}}function n(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var r=Object.bind(0,null);function a(a,e){return Object.keys(e).forEach(function(n){var r=e[n].fn;e[n].fn=function(e){var t=r(e);return t.text||(t.text="string"==typeof e?e:e[0]),t.type||(t.type=n),t.innerMode||(t.innerMode=a),t}}),e}function o(e){switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1}var i=[],s=[],c=[],l=a(i,{hr:{fn:r},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t,e=e[1],n=e.indexOf("><");return~n?25===(t=Math.round(n/(e.length-2)*50))&&(t="center"):"<"===e[0]&&">"===e.slice(-1)?t="justify":-1<e.indexOf(">")?t="right":-1<e.indexOf("<")&&(t="left"),{align:t}}},column:{fn:function(e){var t,e=e[1],n=e.indexOf("|");return n&&n<e.length-1?t="center":"|"===e[0]&&"|"===e.slice(-1)?t="none":n===e.length-1?t="right":n||(t="left"),{column:t,width:/\|+/.exec(e)[0].length,marginLeft:/^=*/.exec(e)[0].length,marginRight:/=*$/.exec(e)[0].length}}}}),u=(g(l).forEach(function(e){l[e].constraint=o,l[e].cannotFollowText=!0}),a(i,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:n("boldOpener","bold")},italicOpener:{fn:n("italicOpener","italic")},strikeOpener:{fn:n("strikeOpener","strike")},supOpener:{fn:n("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:r},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var e=e[0].length,t={};return{type:(t["verbatim"+e]="verbatim")+e,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:r},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:i}}},br:{fn:r}})),p=y(a(s,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",e=e[3]||"";return{type:"twineLink",innerText:n?e:t,passage:t?e:n,innerMode:i}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:i}}},variable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")},tempVariable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),d=a(s,_objectSpread(_objectSpread({commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},macroName:{constraint:function(e){return e&&"macroFront"===e.type},fn:t("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:t("name"),constraint:function(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t("name")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t("name")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t("name")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:c}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:c}}},hookName:{fn:t("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollowText:!0,fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollowText:!0,fn:function(e){var e=e[0].toLowerCase(),t={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"},t=hasOwnProperty.call(t,e)?"#"+t[e]:e;return{colour:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:-1<e[1].indexOf("not")}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:t("name"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:r,cannotFollowText:!0},e},{})),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:r},e},{}))),f=a(c,{singleStringCloser:d.singleStringOpener,doubleStringCloser:d.doubleStringOpener,escapedStringChar:d.escapedStringChar}),h=(i.push.apply(i,_toConsumableArray(g(l)).concat(_toConsumableArray(g(p)),_toConsumableArray(g(u)))),s.push.apply(s,_toConsumableArray(g(p)).concat(_toConsumableArray(g(d)))),c.push.apply(c,_toConsumableArray(g(f))),_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},l),u),p),d),f)),u=(g(h).forEach(function(e){m.PlainCompare[e]?(h[e].pattern=m.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp("^(?:"+m[e]+")","i")}),y(e.rules,h),e.modes);return u.start=u.markup=i,u.macro=s,u.string=c,e}function n(e){return Object.freeze({lex:t(e).lex,Patterns:m})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(m=require("./patterns"),module.exports=n(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(e,t){return m=t,n(e)}):this&&this.loaded&&this.modules?(m=this.modules.Patterns,this.modules.Markup=n(this.modules.Lexer)):(m=this.Patterns,this.Markup=n(this.Lexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){var e;function n(t){return t&&"object"===_typeof(t)?(Object.keys(t).forEach(function(e){t[e]=n(t[e])}),t):(t+"").replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function t(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=t("?:"),a=t("?!"),o=t("?="),i="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=i.replace("*","+"),c="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",u=l.replace("\\-",""),p=r("\\n","$"),d=i+"(\\*+)"+s,f=i+"((?:0\\.)+)"+s,h=i+"-{3,}"+i+p,m=i+"(==+>|<=+|=+><=+|<==+>)"+i+p,p=i+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+i+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(n).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+a("\\]"))+"+)"},y=u+"*"+u.replace("\\w","a-zA-Z")+u+"*",b="\\$("+y+")",v="_("+y+")",w="'s"+s+a("_")+"("+y+")",k="("+y+")"+s+"of"+c+a("it\\b"),S="'s"+s,T=r("it","time","turns?","visits?","exits?","pos")+c,_="its"+s+"("+y+")",x="("+y+")"+s+"of"+s+"it"+c,O="of"+s+"it"+c,A={opener:"\\(",name:"("+r("\\$","_")+"?"+l+"+):"+a("\\/"),closer:"\\)"},C=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),E="[a-zA-Z][\\w\\-]*",N="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",j="\\|("+l+"+)(>|\\))",P="(<|\\()("+l+"+)\\|",R="((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)"+a("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:u,whitespace:s.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:"<\\/?"+E+N+">",scriptStyleTag:"<("+r("script","style","textarea")+")"+N+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:m,column:p,bulleted:d,numbered:f,verbatimOpener:"`+",hookAppendedFront:"\\["+a("=+"),hookPrependedFront:j+"\\["+a("=+"),hookFront:"\\["+a("=+"),hookBack:"\\]"+a(P),hookAppendedBack:"\\]"+P,unclosedHook:"\\[=+",unclosedHookPrepended:j+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+o(A.name),macroName:A.name,groupingFront:"\\("+a(A.name),twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:S,belongingOperator:"of\\b",itsOperator:"its\\b",belongingItOperator:O,variable:b,tempVariable:v,hookName:"\\?("+l+"+)\\b",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+a("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:R,boolean:r("true","false")+c,identifier:T,itsProperty:_,belongingItProperty:x,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+a(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+a(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+i+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:n("+")+a("="),subtraction:n("-")+a("=","type"),multiplication:n("*")+a("="),division:r("/","%")+a("="),spread:"\\.\\.\\."+a("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:n("-type")+c,incorrectOperator:C,PlainCompare:{comma:",",commentFront:"\x3c!--",commentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),define("twinescript/operations",["utils","utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,m){var a=e.plural,o=t.isObject,i=t.collectionType,s=t.is,c=t.isA,l=t.clone,u=t.unique,p=t.contains,e=t.matches,g=t.objectName,d=t.toSource;function f(r,a,o,i){return o=o||"do this to",function(e,t){var n;return 1===a.length&&(t=e),(n=m.containsError(e,t))||(_typeof(e)!==r||_typeof(t)!==r?m.create("operation","I can only ".concat(o," ").concat(r,"s, not ").concat(g(_typeof(e)!==r?e:t),"."),i):a(e,t))}}function h(a){return function(e,t){var n,r;return(n=m.containsError(e,t))||(_typeof(e)!==_typeof(t)||o(e)&&"TwineScript_TypeName"in e&&o(t)&&"TwineScript_TypeName"in t&&e.TwineScript_TypeName!==t.TwineScript_TypeName||i(e)!==i(t)?(n="".concat(g(e)," isn't the same type of data as ").concat(g(t)),_typeof(e)+_typeof(t)!=="stringnumber"&&_typeof(e)+_typeof(t)!=="numberstring"||(r="You might want to convert one side to a number using (num:), or to a string using (str:)."),m.create("operation",n[0].toUpperCase()+n.slice(1),r)):a(e,t))}}function y(d,f,e){var h=2<arguments.length&&void 0!==e&&e;return function r(a,o){var e;if(e=m.containsError(a,o))return e;var t=_slicedToArray(a.determiner?[a,o]:o.determiner?[o,a]:[],2),i=t[0],t=t[1];if(i){var n=i,s=n.determiner,n=n.determined;if("start"===s||"end"===s){if(f)return m.create("operation","I can't use '".concat(f,"' with the 'start' or 'end' of ").concat(g(n),"."));if(t.determiner){if("start"===t.determiner||"end"===t.determiner)return m.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");n=[t,i],i=n[0]}for(var c=i.string||i.array,l=0;l<c.length+1;l+=1){var u=l?"end"===s?c.slice(-l):c.slice(0,l):c.constructor(),u=i===a?r(u,o):r(a,u);if(e=m.containsError(u))return e;if(u!==h)return u}return h}var p="all"===s;return i.array.reduce(function(e,t){var n,t=i===a?r(t,o):r(a,t);return(n=m.containsError(e,t))||(p?e&&t:e||t)},p)}return d(a,o)}}function b(n,e){return y(function(e,t){e=n(e,t);return m.containsError(e)?e:!e},e,!0)}t="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.",t={and:f("boolean",h(function(e,t){return e&&t}),"use 'and' to join",t),or:f("boolean",h(function(e,t){return e||t}),"use 'or' to join",t),not:f("boolean",function(e){return!e},"use 'not' to invert",t),"+":h(function(e,t){var n;return Array.isArray(e)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(u).map(l)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(_typeof(e))?e+t:m.create("operation","I can't use + on ".concat(g(e),"."))}),"-":h(function(e,n){var r;return Array.isArray(e)?e.filter(function(t){return!n.some(function(e){return s(t,e)})}):e instanceof Set?(r=_toConsumableArray(n),new Set(_toConsumableArray(e).filter(function(t){return!r.some(function(e){return s(t,e)})}))):"string"==typeof e?e.split(n).join(""):"number"==typeof e?e-n:m.create("operation","I can't use - on ".concat(g(e),"."))}),"*":f("number",h(function(e,t){return e*t}),"multiply"),"/":f("number",h(function(e,t){return 0===t?m.create("operation","I can't divide ".concat(g(e)," by zero.")):e/t}),"divide"),"%":f("number",h(function(e,t){return 0===t?m.create("operation","I can't modulo ".concat(g(e)," by zero.")):e%t}),"modulus"),"<":y(f("number",h(function(e,t){return e<t}),"do < to"),"<"),">":y(f("number",h(function(e,t){return t<e}),"do > to"),">"),"<=":y(f("number",h(function(e,t){return e<=t}),"do <= to"),"<="),">=":y(f("number",h(function(e,t){return t<=e}),"do >= to"),">="),is:y(s),isNot:b(s),contains:y(p,"contains"),doesNotContain:b(p,"does not contain"),isIn:y(function(e,t){return p(t,e)},"is in"),isNotIn:b(function(e,t){return p(t,e)},"is not in"),isA:y(c,"is a"),isNotA:b(c,"is not a"),typifies:y(function(e,t){return c(t,e)}),untypifies:b(function(e,t){return c(t,e)}),matches:y(e),doesNotMatch:b(e),makeSpreader:function(e){var t;return m.containsError(e)?e:n.isPrototypeOf(e)||r.isPrototypeOf(e)?(t=l(e),(n.isPrototypeOf(e)?t.datatype:t).rest=!0,t):{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:a("string"==typeof e||Array.isArray(e)?_toConsumableArray(e).length:1,"spreaded '...' value"),TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return""+_toConsumableArray(e).map(d)}}}};return Object.freeze(t)}),define("twinescript/runner",["macros","state","utils","utils/operationutils","twinescript/operations","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","datatypes/assignmentrequest","internaltypes/varref","internaltypes/twineerror"],function(Macros,State,Utils,_ref127,Operations,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,AssignmentRequest,VarRef,TwineError){var toSource=_ref127.toSource,typeName=_ref127.typeName,objectName=_ref127.objectName,insensitiveName=Utils.insensitiveName,impossible=Utils.impossible,hash=Utils.hash;function addFreeVariable(e,t){var n,r=e.freeVariables;"macro"===t.type?"current-time"===(n=insensitiveName(t.name))||"current-date"===n||"monthday"===n||"weekday"===n||"history"===n||"visited"===n||"passage"===n?e.freeVariables=!0:t.blockedValue&&!r.blockedValues?r.blockedValues=e.stackTop.blockedValues.concat():"random"!==n&&"either"!==n&&"shuffled"!==n||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"identifier"===t.type?"time"!==(n=insensitiveName(t.text))&&"exits"!==n&&"it"!==n&&"visits"!==n&&"turns"!==n||(e.freeVariables=!0):"property"===t.type||"belongingProperty"===t.type?"random"!==insensitiveName(t.name)||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"variable"!==t.type&&"tempVariable"!==t.type||(e.freeVariables=!0)}var precedenceTable=[["error","text"],["comma"],["to","into"],["where","when","via","making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink","macro","identifier","variable","tempVariable","hookName","number","cssTime","boolean","string","hook","colour","datatype","root"],["grouping"]];function precedentToken(e,t){var n,r,a,o=[];if(e.length)for("most"===t?(n=precedenceTable.length-1,r=a=-1):(n=0,r=precedenceTable.length,a=1);n!==r;n+=a){var i=precedenceTable[n],s=NaN;if(i.rightAssociative){for(var c=0;c<e.length;c+=1)if(i.rightAssociative.includes(e[c].type)){s=c;break}}else for(var l=e.length-1;0<=l;--l)if(i.includes(e[l].type)){s=l;break}if(!Number.isNaN(s)&&-1<s){o=[e[s],s];break}}return o}var comparisonOpTypes=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"],inequalityNegator={">":"<=","<":">=",">=":"<","<=":">"};function compileComparisonOperator(e){return"inequality"===e.type?e.negate?inequalityNegator[e.operator]:e.operator:e.type}var comparisonReverser={">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"};function reverseComparisonOperator(e){e=compileComparisonOperator(e);return comparisonReverser[e]||e}var tokenSides={error:"neither",identifier:"neither",variable:"neither",tempVariable:"neither",hookName:"neither",number:"neither",boolean:"neither",string:"neither",hook:"neither",colour:"neither",datatype:"neither",root:"neither",twineLink:"neither",macro:"neither",grouping:"neither",itsProperty:"neither",belongingItProperty:"neither",to:"both",into:"both",typeSignature:"both",augmentedAssign:"both",and:"both",or:"both",belongingOperator:"both",possessiveOperator:"both",multiplication:"both",division:"both",spread:"after",bind:"after",not:"after",belongingProperty:"after",each:"after",itsOperator:"after",positive:"after",negative:"after",belongingItOperator:"before",property:"before"};function missingSideError(e,t,n){return TwineError.create("syntax","I need usable code to be ".concat(e?"left ":"").concat(e&&t?"and ":"").concat(t?"right ":"","of ").concat(n.text,"."))}function wrongSideError(e,t,n){return TwineError.create("syntax","There can't be a ".concat(e&&t?e.map(function(e){return e.text}).join("")+" or "+t.map(function(e){return e.text}).join(""):(e||t).map(function(e){return e.text}).join("")," to the ").concat(e?"left ":"").concat(e&&t?"or ":"").concat(t?"right ":"","of ").concat(n.text,"."),"There could be a comma missing between them.")}function makeEvalReplayFrame(e,t){var n=t.val,r=t.fromCode,a=t.toCode,o=t.toDesc,i=t.reason,s=t.it,c=t.tokens,t=t.i;if(!(200<=e.length)){var l=c[t],u=c.slice(0,t),t=c.slice(t+1);if(1===c.length&&(u=t=!1,l=c[0]),!e[e.length-1].error){var p,d,c=TwineError.containsError(n),f=e[e.length-1].code,h=e[0].basis,m=(null!=(p=u)&&p.length&&null!=(p=t)&&p.length&&u[0].start>t[0].start&&(u=(p=[t,u])[0],t=p[1]),p=a||"".concat(null!=(p=u)&&p.length&&"whitespace"===u[u.length-1].type?" ":"").concat(c?" \ud83d\udc1e ":(n&&!n.TwineScript_ToSource&&n.TwineScript_Unstorable?objectName:toSource)(n)).concat(null==(p=t)||!p.length||"whitespace"!==t[0].type&&"addition"!==l.type&&"subtraction"!==l.type?"":" "),(u.length?u[0]:l).start-h),g=(t.length?t[t.length-1]:l).end-h,y=_createForOfIteratorHelper(e);try{for(y.s();!(d=y.n()).done;){var b=d.value;b.start<m?(m+=b.diff,g+=b.diff):b.start<g&&(g+=b.diff)}}catch(e){y.e(e)}finally{y.f()}!r&&(r=f.slice(m,g),a)&&a.trim()===r.trim()||(u=p.length-(g-m),e.push({code:f.slice(0,m)+p+f.slice(g),fromCode:r,toCode:!c&&a,toDesc:!c&&!a&&(o||objectName(n)),start:m,end:g,diff:u,reason:i,itIdentifier:void 0!==s&&objectName(s),error:c&&c.render(f.slice(m,g),!0)}))}}}function setIt(e,t){return(VarRef.isPrototypeOf(t)||TypedVar.isPrototypeOf(t))&&(e.Identifiers.it=t.get()),t}return function run(section,tokens){var isVarRef=2<arguments.length&&void 0!==arguments[2]&&arguments[2],isTypedVar=3<arguments.length&&void 0!==arguments[3]&&arguments[3],evalReplay=section.evalReplay,hasEvalReplay=null==evalReplay?void 0:evalReplay.length,evalReplayReason,evalReplaySkip=!1,evalReplayIt,ops=Operations,token,ret,i,before,after,_precedentToken,_precedentToken2,token,i,before,after;if(Array.isArray(tokens)||(tokens=[tokens]),!tokens.length||!tokens[0])return impossible("Runner.run","No tokens to run!"),0;1===tokens.length?token=tokens[0]:(_precedentToken=precedentToken(tokens,"least"),_precedentToken2=_slicedToArray(_precedentToken,2),token=_precedentToken2[0],i=_precedentToken2[1],before=tokens.slice(0,i),after=tokens.slice(i+1),before.length&&(1!==before.length||"whitespace"!==before[0].type)||(before=!1),after.length&&(1!==after.length||"whitespace"!==after[0].type)||(after=!1));var type=token.type;if(!type)return impossible("Runner.run","Token has no type!"),0;var sides=tokenSides[type]||"",VARREF=("both"!==sides||before&&after?"neither"===sides&&(before||after)?ret=wrongSideError(before,after,token):"before"===sides?before?after&&(ret=wrongSideError(null,after,token)):ret=missingSideError(!0,!1,token):"after"===sides&&(after?before&&(ret=wrongSideError(before,null,token)):ret=missingSideError(!1,!0,token)):ret=missingSideError(!before,!after,token),section.freeVariables&&"object"===_typeof(section.freeVariables)&&addFreeVariable(section,token),!0),TYPEDVAR=!0,_ret4,val,evalReplayReason,ret,source,_source4,_value4,msg;if(!ret){if("comma"===type)return impossible("Section.run","a comma token was run() somehow."),0;if("root"===type)ret=run(section,token.children);else if("identifier"===type)ret=isVarRef?VarRef.create(section.Identifiers,token.text.toLowerCase()):section.Identifiers[token.text.toLowerCase()];else if("variable"===type||"tempVariable"===type){ret=VarRef.create("tempVariable"===type?section.stackTop.tempVariables:State.variables,token.name),isTypedVar?(ret=TypedVar.create(Datatype.create("any"),ret),evalReplayReason=hasEvalReplay&&"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value."):isVarRef||TwineError.containsError(ret)?evalReplaySkip=!0:(val=ret.get(),evalReplayReason=hasEvalReplay&&((null==(_ret4=ret)?void 0:_ret4.object)!==State.variables||hasOwnProperty.call(ret.object,ret.compiledPropertyChain[0])?"":"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist."),ret=val)}else if("hookName"===type)ret=HookSet.create({type:"name",data:token.name}),evalReplaySkip=!0;else if("number"===type||"cssTime"===type)ret=token.value,evalReplayReason=hasEvalReplay&&"cssTime"===type&&(token.text.endsWith("ms")?"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.":"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000)."),evalReplaySkip=!evalReplayReason;else if("boolean"===type)ret="true"===token.text.toLowerCase(),evalReplaySkip=!0;else if("string"===type){var t=token.text.replace(/(.?)\n/g,function(e,t){return("\\"===t?"\\\\":"\n"===t?"\\n":t)+"\\n"}).replace(/(\\*)\\0/g,function(e,t){return(t?"\\".repeat(2*t.length):"")+"0"});ret=eval(t),evalReplaySkip=!0}else if("hook"===type)ret=CodeHook.create(token.children,token.text),evalReplaySkip=!0;else if("colour"===type)ret=Colour.create(token.colour),evalReplaySkip=!0;else if("datatype"===type)ret=Datatype.create(token.name),evalReplaySkip=!0;else if("spread"===type)ret=ops.makeSpreader(run(section,after,!1,isTypedVar));else if("bind"===type)ret=VarBind.create(run(section,after,VARREF),token.text.startsWith("2")?"two way":""),evalReplaySkip=!0;else if("to"===type||"into"===type){var dest="to"===type?setIt(section,run(section,before,VARREF,TYPEDVAR)):run(section,after,VARREF,TYPEDVAR);if(TwineError.containsError(dest))ret=dest;else{(VarRef.isPrototypeOf(dest)&&dest.propertyChain.length<=1||TypedVar.isPrototypeOf(dest)&&dest.varRef.propertyChain.length<=1)&&(section.freeVariables=Object.create(null));var src="to"===type?run(section,after,VARREF):setIt(section,run(section,before,VARREF));if(TwineError.containsError(src))return src;var freeVariables=section.freeVariables,srcRef;section.freeVariables=null,token.place&&freeVariables&&"object"===_typeof(freeVariables)&&"boolean"!=typeof src&&"number"!=typeof src&&!Utils.options.uncompressedPureValues&&(srcRef=freeVariables,srcRef.at=token.place,srcRef.from=after[0].start,srcRef.to=after[after.length-1].end,srcRef.hash=hash(after.reduce(function(e,t){return e+t.text},"")).toString(16),JSON.stringify(srcRef).length>=toSource(src).length)&&(srcRef=void 0),ret=AssignmentRequest.create(dest,src,type,srcRef),evalReplaySkip=!0,evalReplayIt=section.Identifiers.it}}else if("typeSignature"===type){var datatype=run(section,before),free=section.freeVariables,variable=(section.freeVariables=null,run(section,after,VARREF));section.freeVariables=free,ret=TypedVar.create(datatype,variable),evalReplaySkip=!0}else if("where"===type||"when"===type||"via"===type){after?(source=tokens.map(function(e){return e.text}).join(""),ret=Lambda.create(before?run(section,before,VARREF):void 0,token.type,after,source),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("making"===type||"each"===type){after?(_source4=[].concat(tokens).map(function(e){return e.text}).join(""),ret="each"===type?Lambda.create(run(section,after,VARREF),"each",null,_source4):Lambda.create(before?run(section,before,VARREF):void 0,token.type,run(section,after,VARREF),_source4),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("augmentedAssign"===type)ret=ops.makeAssignmentRequest(run(section,before,VARREF),ops[token.operator](run(section,before),run(section,after)),token.operator),evalReplaySkip=!0;else if("and"===type||"or"===type){var isComparisonOp=function e(t){var n=_slicedToArray(precedentToken(t,"least"),2),r=n[0],n=n[1];if(r&&"whitespace"!==r.type)return comparisonOpTypes.includes(r.type)?r:r.type===type?e(t.slice(0,n))||e(t.slice(n+1)):void 0},leftIsComparison=isComparisonOp(before),rightIsComparison=isComparisonOp(after),ambiguityError=TwineError.create("operation",'This use of "is not" and "'.concat(type,'" is grammatically ambiguous.'),'Maybe try rewriting this as "__ is not __ '.concat(type,' __ is not __"')),operator,getElisionOperands=function e(t){var n,r=_slicedToArray(precedentToken(t,"least"),2),a=r[0],r=r[1];return a&&"whitespace"!==a.type?a.type===type?[].concat(_toConsumableArray(e(t.slice(0,r))),_toConsumableArray(e(t.slice(r+1)))):(a=run(section,t),hasEvalReplay&&"boolean"!=typeof a&&(n=operator.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),makeEvalReplayFrame(evalReplay,{toCode:" it ".concat(n," ").concat(toSource(a)," "),reason:"A missing 'it ".concat(n,"' was inferred to correct the '").concat(type,"' operation."),tokens:t,i:r}),makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it)," ").concat(n," ").concat(toSource(a)," "),tokens:t,i:r})),[{val:a,tokens:t,i:r}]):[]},elidedComparisonOperator=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){var n=t.val,r=t.tokens,t=t.i;return"boolean"==typeof n?n:(e=Operations[token.type](e,Operations[operator](section.Identifiers.it,n)),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{val:e,tokens:r,i:t}),e)},"and"===token.type)},leftSide,evalBefore,operator,rightSide,rightIndex,swappedSides,evalAfter;ret=leftIsComparison&&!rightIsComparison?(leftSide=leftIsComparison,operator=compileComparisonOperator(leftSide),"isNot"===leftSide.type||"isNotA"===leftSide.type||"untypifies"===leftSide.type?ambiguityError:(evalBefore=run(section,before),ops[type](evalBefore,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(after)))))):!leftIsComparison&&rightIsComparison?(rightSide=rightIsComparison,rightIndex=tokens.indexOf(rightSide),operator=reverseComparisonOperator(rightSide),"isNot"===rightSide.type||"isNotA"===rightSide.type||"untypifies"===rightSide.type?ambiguityError:(swappedSides=[].concat(_toConsumableArray(tokens.slice(rightIndex+1)),[Object.assign(Object.create(rightSide),_defineProperty({},"inequality"===rightSide.type?"operator":"type",reverseComparisonOperator(rightSide)))],_toConsumableArray(tokens.slice(i+1,rightIndex))),evalAfter=run(section,swappedSides),ops[type](evalAfter,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(before)))))):ops[type](run(section,before),run(section,after))}else if(comparisonOpTypes.includes(type)){after||missingSideError(!1,!0,token);var leftOp=before?run(section,before):section.Identifiers.it;ret=ops[compileComparisonOperator(token)](leftOp,run(section,after)),section.Identifiers.it=leftOp,evalReplayIt=leftOp,evalReplayReason=hasEvalReplay&&!before&&"A missing 'it' was inferred to complete the operation."}else if("addition"===type||"subtraction"===type){after||missingSideError(!1,!0,token);var convert=!before,_precedentToken7,_precedentToken8,previousPrecedentToken,_i10,_sides,pType,convert;before&&(_precedentToken7=precedentToken(before,"least"),_precedentToken8=_slicedToArray(_precedentToken7,2),previousPrecedentToken=_precedentToken8[0],_i10=_precedentToken8[1],_sides=tokenSides[previousPrecedentToken.type],pType=previousPrecedentToken.type,convert=("both"===_sides||"after"===_sides||"addition"===pType||"subtraction"===pType)&&(_i10===before.length-1||_i10===before.length-2&&"whitespace"===before[before.length-1].type)),convert?(token.type="addition"===type?"positive":"negative",ret=run(section,tokens),token.type=type,evalReplaySkip=!0):ret=ops[token.text](run(section,before),run(section,after))}else if("multiplication"===type||"division"===type)ret=ops[token.text](run(section,before),run(section,after));else if("positive"===type||"negative"===type)ret=ops["*"]("negative"===type?-1:1,run(section,after)),evalReplaySkip=!0;else if("not"===type)ret=ops.not(run(section,after));else if("belongingProperty"===type){var container=run(section,after,isVarRef),isRef=(ret=VarRef.create(container,token.name),isVarRef||TwineError.containsError(ret));ret=isRef?ret:ret.get(),isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&!isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(token.name," of ").concat(toSource(VarRef.isPrototypeOf(container)?container.get():container)," "),tokens:tokens,i:i}):isRef||(evalReplayReason="The value to the right of 'of', ".concat(typeName(container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("belongingOperator"===type||"belongingItOperator"===type){var value=run(section,before);"random"===value&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("belongingItOperator"===type?section.Identifiers.it:run(section,after,isVarRef),{computed:!0,value:value}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"belongingItOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(value)," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i})}else if("property"===type){var _container=run(section,before,VARREF),_isRef=(ret=VarRef.create(_container,token.name),isVarRef||TwineError.containsError(ret));ret=_isRef?ret:ret.get(),_isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&VarRef.isPrototypeOf(_container)&&!_isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(_container.get()),"'s ").concat(token.name," "),tokens:tokens,i:i}):_isRef||(evalReplayReason="The value to the left of 's, ".concat(typeName(_container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("itsProperty"===type||"belongingItProperty"===type)ret=VarRef.create(section.Identifiers.it,token.name),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:"itsProperty"===type?" ".concat(toSource(section.Identifiers.it),"'s ").concat(token.name," "):" ".concat(token.name," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i});else if("possessiveOperator"===type||"itsOperator"===type){!after||!before&&"itsOperator"!==token.type?ret=missingSideError(!before,!after,token):(_value4=run(section,after),"random"===_value4&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("itsOperator"===token.type?section.Identifiers.it:run(section,before,isVarRef),{computed:!0,value:_value4}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"itsOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it),"'s ").concat(toSource(_value4)," "),tokens:tokens,i:i}))}else if("twineLink"===type)ret=Macros.run("link-goto",section,[token.innerText,token.passage]),evalReplayReason=hasEvalReplay&&"Passage links are the same as (link-goto:) macro calls.";else if("macro"===type)if(token.blockedValue&&!section.blocked){if(ret=section.blockedValue(),void 0===ret)return impossible("Runner.run","section.blockedValue() returned undefined"),0}else{var macroNameToken=token.children[0],variableCall="$"===macroNameToken.text[0]||"_"===macroNameToken.text[0],macroRef;if("macroName"!==macroNameToken.type&&!variableCall)return impossible("Runner.run","macro token had no macroName child token"),0;variableCall?(macroRef=VarRef.create("_"===macroNameToken.text[0]?section.stackTop.tempVariables:State.variables,macroNameToken.text.trim().slice(1,-1)),TwineError.containsError(macroRef)||(macroRef=macroRef.get())):macroRef=token.name,ret=Macros[variableCall?"runCustom":"run"](macroRef,section,token.children.slice(1).reduce(function(e,t){return"comma"===t.type?e.push([]):e[e.length-1].push(t),e},[[]]).filter(function(e){return e.length&&(1<e.length||"whitespace"!==e[0].type)}).map(function(e){return run(section,e,!1,isTypedVar)})),evalReplayReason=hasEvalReplay&&variableCall&&"I called ".concat(objectName(macroRef),".")}else if("grouping"===type)ret=run(section,token.children,isVarRef),evalReplaySkip=!0;else if("error"===type)ret=TwineError.create("syntax",token.message,token.explanation||"");else{if("text"!==type)return impossible("Section.run","unknown syntax token type: ".concat(type,"!!")),0;token.text.trim().match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(msg='Position data names like "'.concat(token.text,'" need to be either left of "of" or right of "\'s".')),ret=TwineError.create("syntax",msg||'"'.concat(token.text,"\" isn't valid Harlowe syntax for the inside of a macro call."),"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.")}}return void 0===ret?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced undefined")),0):ret===section?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced the section")),0):(hasEvalReplay&&!evalReplaySkip&&makeEvalReplayFrame(evalReplay,{val:ret,reason:evalReplayReason,it:evalReplayIt,tokens:tokens,i:i}),ret)}}),define("utils/jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return(null==e?void 0:e.nodeType)===Node.TEXT_NODE&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){var t=this.find(e),e=this.filter(e);return e.length?t.add(e):t}})}),define("utils/naturalsort",[],function(){return function(h){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:String;return function(e,t){var n,r,a,o,i=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,l=/^0/,e=m(e).trim(),t=m(t).trim(),u=e.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=t.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),i=parseInt(e.match(c))||1!==u.length&&e.match(s)&&Date.parse(e),e=parseInt(t.match(c))||i&&t.match(s)&&Date.parse(t)||null;if(h&&window.Intl&&window.Intl.Collator&&(a=window.Intl.Collator(h)),e){if(i<e)return-1;if(e<i)return 1}for(var d=0,f=Math.max(u.length,p.length);d<f;d++){if(n=!(u[d]||"").match(l)&&parseFloat(u[d])||u[d]||0,r=!(p[d]||"").match(l)&&parseFloat(p[d])||p[d]||0,isNaN(n)!==isNaN(r))return isNaN(n)?1:-1;if(_typeof(n)!==_typeof(r))n+="",r+="";else if("string"==typeof n&&a&&0!==(o=a.compare(n,r)))return o;if(n<r)return-1;if(r<n)return 1}return 0}}}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(f,e,h,t){var m=e.impossible,g=e.nth,u=e.permutations,s=e.plural,y=t.validPropertyName,r="object",n="boolean",b="string",v="number",w="function";function a(e){return!!e&&(_typeof(e)===r||_typeof(e)===w)}var k=Array.isArray;function S(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function i(e){return k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":_typeof(e)===b?b:e&&_typeof(e)===r?r:""}function c(e){if(a(e)){if(_typeof(e.TwineScript_Clone)===w)return e.TwineScript_Clone();if(k(e))return _toConsumableArray(e);if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_typeof(e)===w)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return _objectSpread({},e);case null:return Object.assign(Object.create(null),e)}m("OperationUtils.clone","The value "+e+" cannot be cloned!")}return e}function o(e,t,n,r){for(var a="",o=0;a.length<=t&&o<e.length;){var i=r(e[o]);if(!(i.length+a.length<=t)){a+=(0<o?" and ":"")+s(e.length-o,(0<o?"other ":"")+n);break}a+=(0<o&&o===e.length-1?" and ":"")+i+(o<e.length-1?", ":""),o+=1}return a}function l(e){var t;return a(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:k(e)?0===e.length?"an empty array":"an array (with "+o(e,48,"item",l)+")":e instanceof Map?0===e.size?"an empty datamap":"a datamap (with "+o(_toConsumableArray(e.keys()),48,"dataname",_)+")":e instanceof Set?0===e.size?"an empty dataset":"a dataset (with "+o(_toConsumableArray(e.values()),48,"item",l)+")":_typeof(e)===b?0===e.length?"an empty string":48<(t=_toConsumableArray(e)).length?"a ".concat(t.length,"-character string starting with ").concat(JSON.stringify(t.slice(0,48).join(""))):"the string ".concat(JSON.stringify(e)):_typeof(e)===n?"the boolean value '"+e+"'":_typeof(e)===v?"the number "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is"}function T(e,t){return[e[0],t[0]].sort(f("en"))[0]===e[0]?-1:1}function _(e,t){var n=h.containsError(e);if(n&&m("toSource","received a TwineError: "+n.message),_typeof(e.TwineScript_ToSource)===w)return e.TwineScript_ToSource();if(S(e)&&"first"in e&&"last"in e)return(e.first<0?(-1!==e.first?g(-e.first):"")+"last":g(e.first+1))+"to"+(e.last<0?(-1!==e.last?g(-e.last):"")+"last":g(e.last+1));if(k(e)){var r,a="",o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;)var i=r.value,a=(a+=a?",":"(a:")+("property"===t?i+(0<i):_(i))}catch(e){o.e(e)}finally{o.f()}return a+(a?")":"(a:)")}if(e instanceof Map){var s,c="",l=_createForOfIteratorHelper(Array.from(e.entries()).sort(T));try{for(l.s();!(s=l.n()).done;){var u=_slicedToArray(s.value,2),p=u[0],d=u[1];c+=(c?",":"(dm:")+_(p)+","+_(d)}}catch(e){l.e(e)}finally{l.f()}return c+(c?")":"(dm:)")}return e instanceof Set?"(ds:"+Array.from(e).sort(f("en")).map(_)+")":_typeof(e)===v&&"property"===t?e<0?-1===e?"last":g(-e)+"last":g(e+1):_typeof(e)===b&&"property"===t?RegExp(y).test(e)?e:"("+JSON.stringify(e)+")":JSON.stringify(e)}function p(t,n){return _typeof(t)!==r&&_typeof(n)!==r?t===n:k(t)&&k(n)?t.length===n.length&&t.every(function(e,t){return p(n[t],e)}):t instanceof Map&&n instanceof Map?p(Array.from(t.entries()).sort(),Array.from(n.entries()).sort()):t instanceof Set&&n instanceof Set?p(_toConsumableArray(t),_toConsumableArray(n)):t&&_typeof(t.TwineScript_is)===w?t.TwineScript_is(n):t&&_typeof(t)===r&&n&&_typeof(n)===r&&S(t)&&S(n)?p(Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]}),Object.getOwnPropertyNames(n).map(function(e){return[e,n[e]]})):Object.is(t,n)}return Object.freeze({isObject:a,isValidDatamapName:function(e,t){var n;return e instanceof Map||m("isValidDatamapName","called with non-Map"),h.containsError(t)?t:_typeof(t)!==b&&_typeof(t)!==v?h.create("property","Only strings and numbers can be used as data names for "+l(e)+", not "+l(t)+"."):(n=_typeof(t)===b?+t:""+t,!(!Number.isNaN(n)&&e.has(n))||h.create("property","You mustn't use both "+l(t)+" and "+l(n)+" as data names in the same datamap."))},collectionType:i,isSequential:function(e){return _typeof(e)===b||k(e)||_typeof(e.hooks)===w},unstorableValue:function e(t){return(null==t?void 0:t.TwineScript_Unstorable)&&t||k(t)&&t.find(e)||t instanceof Map&&_toConsumableArray(t.values()).find(e)||t instanceof Set&&_toConsumableArray(t).find(e)},isHarloweJSValue:function e(t){return _typeof(t)===b||_typeof(t)===n||_typeof(t)===v&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(e)||t instanceof Set&&_toConsumableArray(t).every(e)||t instanceof Map&&_toConsumableArray(t.values()).every(e)&&_toConsumableArray(t.keys()).every(function(e){return _typeof(e)===b})},clone:c,objectName:l,typeName:function e(t){var n,r=S(t);return r&&t.innerType?t.typeName||("insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(k(t.innerType)||m("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType)):r&&"range"===t.pattern?t.name||(r=t.min,n=t.max,"a"+(0<r?" positive":"")+(t.integer?" whole":"")+" number"+(0===r?" between 0 and "+n:n<1/0?" up to "+n:"")):t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":a(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:l(t)},typeID:function(e){var t=_typeof(e);return[n,b,v].includes(t)?t:k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:_,is:p,contains:function(e,t){if(e||""===e){if(_typeof(e)===b)return _typeof(t)!==b?h.create("operation",l(e)+" can only contain strings, not "+l(t)+"."):e.includes(t);if(k(e))return e.some(function(e){return p(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return p(e,t)})}return h.create("operation",l(e)+" cannot contain any values, let alone "+l(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===w?t.TwineScript_IsTypeOf(e):h.create("operation",'"is a" should only be used to compare type names, not '+l(t)+".")},matches:function t(n,e){var r=!1;if(n&&_typeof(n.TwineScript_IsTypeOf)===w){var a=n.TwineScript_IsTypeOf(e);if(h.containsError(a))return a;r|=a}if(e&&_typeof(e.TwineScript_IsTypeOf)===w){if(a=e.TwineScript_IsTypeOf(n),h.containsError(a))return a;r|=a}if(r)return!0;if(k(n)&&k(e)){for(var o=0,i=0,s=!0;s&&o<n.length&&i<e.length;){var c=n[o],l=e[i];if(c.rest){for(;i<e.length&&t(c,l);)l=e[i+=1];o+=1}else if(l.rest){for(;o<n.length&&t(c,l);)c=n[o+=1];i+=1}else t(c,l)?(o+=1,i+=1):s=!1}return s&&o>=n.length&&i>=e.length}return n instanceof Map&&e instanceof Map?t(Array.from(n.entries()).sort(),Array.from(e.entries()).sort()):n instanceof Set&&e instanceof Set?(n=_toConsumableArray(n),u.apply(void 0,_toConsumableArray(e)).some(function(e){return t(n,e)})):p(n,e)},subset:function e(t,n,r){var a,o;return n&&r?((a=_typeof(t)===b)&&(t=Array.from(t)),n<0&&(n=Math.max(0,t.length+n+1)),(r=r<0?Math.max(0,t.length+r+1):r)<n?e(arguments[0],r,n):(o=t.slice(0<n?n-1:n,r).map(c),a?o.join(""):o)):h.create("macrocall","The sub"+i(t)+" index value must not be "+(n&&r)+".")},range:function e(t,n){if(n<t)return e(n,t);var r=[t];for(n-=t;0<n--;)r.push(++t);return r},printBuiltinValue:function r(e){return h.containsError(e)?e:e&&_typeof(e.TwineScript_Print)===w?e.TwineScript_Print():e instanceof Map?(e=Array.from(e.entries()),h.containsError(e)?e:e.reduce(function(e,t){var n=(t=_slicedToArray(t,2))[0],t=t[1];return e+"<tr><td>`"+r(n)+"`</td><td>`"+r(t)+"`</td></tr>"},"<table class=datamap>")+"</table>"):e instanceof Set?Array.from(e.values()).map(r)+"":k(e)?e.map(r)+"":e&&_typeof(e.jquery)===b?e:a(e)?h.create("unimplemented","I don't know how to print this value yet."):e+""},unique:function(t,e,n){return n.findIndex(function(e){return p(t,e)})===e}})}),define("utils/polyfills",[],function(){var o=Array.prototype;"function"!=typeof o.includes&&(o.includes=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(e)&&Number.isFinite(t)&&void 0!==e)return-1<o.indexOf.call(this,e,t);var n=Object(this),r=parseInt(n.length);if(!(r<=0))for(var a=0<=t?t:Math.max(0,r+t);a<r;){if(Object.is(e,n[a]))return!0;a+=1}return!1}),window.Symbol||(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils/renderutils",["jquery","utils","renderer"],function(l,u,p){var n=RegExp(u.realWhitespace+"+"),s=RegExp(u.realWhitespace+"+","g");function d(e,t,n){var r,a=e.textContent.length;if(!(a<=t))return r=[e=0===t?e:e.splitText(t)],n&&(n=n<=0?a-n:n)<a&&r.push(e.splitText(n-t)),r}var t,c=function(){var e;return void 0!==t?t:(e=l("<p>"),t=!!e[0].normalize&&(e.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),1===e.contents().length))};var f="tw-collapsed,[collapsing=true]";var o=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var e,t=(c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).section,n=void 0===(n=c.parent)?u.storyElement:n,r=c.cd,a=void 0===(a=c.message)?"":a,o=c.defaultValue,i=void 0===(c=c.buttons)?[{name:"OK",confirm:!0,callback:Object}]:c,s=("a code hook"===a.TwineScript_TypeName&&(a=a.code),l("<tw-backdrop><tw-dialog>"+(o||""===o?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(i.length?i.reduce(function(e,t,n){t=t.name;return e+"<tw-link style='margin:0 "+(n===i.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+t+"</tw-link>"},""):"<tw-link tabindex=0>"+i[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>")),c=s.find("tw-dialog");return n.append(s),t?(t.renderInto(a,c,_objectSpread(_objectSpread({},r),{},{append:"prepend"})),null!=(n=(null==r?void 0:r.transition)&&s.find("tw-dialog > tw-transition-container"))&&n.length&&n.appendTo(s).append(c.prepend(n.contents().detach()))):c.prepend(p.exec(a)),o&&((e=s.find("input").last()).val(o).on("keypress",function(e){13===e.which&&(s.remove(),i.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return e.focus()},100)),i.reverse().forEach(function(e,t){l(s.find("tw-link").get(-t-1)).on("click",function(){u.options.debug&&u.options.ignoreClickEvents&&!l(s).is(".eval-replay, .harlowe-crash")||(s.remove(),e.callback())})}),s},realWhitespace:n,textNodeToChars:function(r){var e=_toConsumableArray(r.textContent);return 1===e.length?[r]:e.reduce(function(e,t){return t.match(n)&&e.length&&e[e.length-1].match(n)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(e,t){var n=r;return t.length<r.textContent.length&&(r=r.splitText(t.length)),e.concat(n)},[])},findTextInNodes:function e(t,n){var r=[],a="",o=[];if(!t.length||!n)return o;for(;0<t.length;){r.push(t[0]),a+=t[0].textContent,t.shift();var i=a.indexOf(n);if(-1<i){for(var s=a.length-(i+n.length);i>=r[0].textContent.length;)i-=r[0].textContent.length,r.shift();if(1===r.length){var c=d(r[0],i,i+n.length);o.push(c[0]),c[1]&&t.unshift(c[1]);break}o.push(d(r[0],i,r[0].length)[0]),o.push.apply(o,_toConsumableArray(r.slice(1,-1))),c=d(r[r.length-1],0,r[r.length-1].textContent.length-s),o.push(c[0]),c[1]&&t.unshift(c[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(e){function n(e){return 0===l(this||e).parentsUntil(f).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var t=function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:(t=(t=r.textNodes().filter(function(e){return 4&(e=e.compareDocumentPosition(n))&&!(8&e)}))[t.length-1])||e(r)}(e),r=(l(t).parents(f).length||(t=null),function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:r.textNodes().filter(function(e){return 2&(e=e.compareDocumentPosition(n))&&!(8&e)})[0]||e(r)}(e)),a=(l(r).parents(f).length||(r=null),"br:not([data-raw]),tw-consecutive-br:not([data-raw])"),o=(e.find(a).filter(n).replaceWith(document.createTextNode(" ")),(e=l(e.get().map(function(e){return l(e).filter(n).is(a)?l(document.createTextNode(" ")).replaceAll(e)[0]:e}))).textNodes()),i=0;o.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(s," ")," "!==t.textContent[0]||e&&e.textContent&&!(-1<e.textContent.search(/\s$/))||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},t),_toConsumableArray(o).reverse().every(function(e){return!(!n(e)||(e.textContent.match(/^\s*$/)?(i+=e.textContent.length,e.textContent=""):(e.textContent=e.textContent.replace(/\s+$/,function(e){return i+=e.length,""}),1)))}),0<i&&r&&(o[o.length-1].textContent+=" "),e[0]&&c()&&e[0].normalize()},geomStringRegExp:o,geomParse:function(e){var t,n,r,a;return!e||(t=e.length,n=(a=_slicedToArray(o.exec(e)||[],3))[0],r=a[1],a=a[2],!n)||a===e&&1<a.length?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}})}),define("utils/scripttag",["state","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(a,o,i,s){return function(e,r){Function("script","scope","with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}")(e,Object.create(null,Object.keys(a.variables).map(function(e){return!e.startsWith("TwineScript_")&&"$"+e}).concat(Object.keys(r).map(function(e){return!e.startsWith("TwineScript_")&&"_"+e})).reduce(function(e,n){return n&&(e[n]={get:function(){var e=("$"===n[0]?a.variables:r)[n.slice(1)];if(o.isHarloweJSValue(e))return o.clone(e);throw s.create("","The contents of the variable ".concat(n,", ").concat(o.objectName(e),", couldn't be converted to a Javascript value."),"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.")},set:function(e){var t="$"===n[0]?a.variables:r;if(!o.isHarloweJSValue(e))throw s.create("","The Javascript value, ".concat(e,", couldn't be converted to a Harlowe value and assigned to the variable ").concat(n,"."),"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.");e=o.clone(e);t=i.create(t,n.slice(1)).set(e);if(s.containsError(t))throw t}}),e},{})))}}),!function(){function e(t,n,r){return function(e){return"background-color: hsla(".concat(t,",").concat(n,"%,").concat(r,"%,").concat(e,");")}}var t={boolean:"color:hsla(0,0%,30%,1.0)",array:"color:hsla(0,100%,30%,1.0)",dataset:"color:hsla(30,100%,40%,1.0)",number:"color:hsla(30,100%,30%,1.0)",datamap:"color:hsla(60,100%,30%,1.0)",changer:"color:hsla(90,100%,30%,1.0)",lambda:"color:hsla(120,100%,40%,1.0)",hookName:"color:hsla(160,100%,30%,1.0)",string:"color:hsla(180,100%,30%,1.0)",identifier:"color:hsla(200,80%,40%,1.0)",variable:"color:hsla(200,100%,30%,1.0)",tempVariable:"color:hsla(200,70%,20%,1.0)",datatype:"color:hsla(220,100%,30%,1.0)",colour:"color:hsla(280,100%,30%,1.0)",macro:"color:hsla(320,80%,30%,1.0)",twineLink:"color:hsla(240,100%,20%,1.0)"},o=(t.gradient=t.colour,t.command=t.twineLink,t.instant=t.metadata=t.any=t.customMacro=t.macro,Math.min),n=e(40,100,50),r=e(220,100,50),i=/hsla\((\d+),\s*(\d+)%,\s*(\d+)%,\s*(\d+\.\d+)\)/g,s="cm-harlowe-3-",a=(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n={root:"box-sizing:border-box;",hook:n(.05),"hook-2":n(.1),"hook-3":n(.15),"hook-4":n(.2),"hook-5":n(.25),"hook-6":n(.3),"hook-7":n(.35),"hook-8":n(.4),"^=hook , ^=hook-":"font-weight:bold;",unclosedHook:n(.05)+"font-weight:bold;"},"error:not([class*='"+s+"string'])","background-color: hsla(17,100%,50%,0.5) !important;"),"^=macroName","font-style:italic;"),"macroName-boolean",t.boolean),"macroName-array",t.array),"macroName-dataset",t.dataset),"macroName-datatype",t.datatype),"macroName-number",t.number),"macroName-datamap",t.datamap),"macroName-changer",t.changer),"macroName-string",t.string),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"macroName-colour, macroName-gradient",t.colour),"macroName-command, macroName-instant, macroName-metadata",t.command),"macroName-custommacro, macroName-macro, macroName-any",t.macro),"^=macro ","font-weight:bold;"+t.macro),"comma, spread",t.macro),"addition",t.any),"subtraction, multiplication, division",t.number),"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch",t.boolean),"bold, strong","font-weight:bold;"),"italic, em","font-style:italic;"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"sup","vertical-align: super;font-size:0.8em;"),"strike","text-decoration: line-through;"),"verbatim","background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)"),"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike","font-weight:100; color: hsla(0,0%,0%,0.5)"),"^=collapsed","font-weight:bold; color: hsla(201,100%,30%,1.0);"),"unclosedCollapsed",r(.025)+"font-weight:bold; color: hsla(201,100%,30%,1.0);"),"collapsed",r(.025)),"collapsed.hook",r(.05)),"collapsed.hook-2",r(.1)),"collapsed.hook-3",r(.15)),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"collapsed.hook-4",r(.2)),"collapsed.hook-5",r(.25)),"collapsed.hook-6",r(.3)),"collapsed.hook-7",r(.35)),"collapsed.hook-8",r(.4)),"twineLink:not(.text)",t.twineLink),"tag, scriptStyleTag, comment","color: hsla(240,34%,25%,1.0);"),"boolean",t.boolean),"string",t.string),"number",t.number),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"variable",t.variable),"tempVariable",t.tempVariable),"hookName",t.hookName),"datatype",t.datatype),"colour",t.colour),"cssTime",t.number),"passageString",t.variable+";text-decoration:underline 1px;"),"tagString",t.variable+";text-decoration:underline 1px dotted;"),"variableOccurrence, hookOccurrence","background: hsla(159,50%,75%,1.0) !important;"),"^=where, ^=via, ^=with, ^=making, ^=each, ^=when",t.lambda+"; font-style:italic;"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"heading","font-weight:bold;"),"hr","background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);"),"align","color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);"),"column","color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);"),"escapedLine","font-weight:bold; color: hsla(51,100%,30%,1.0);"),"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator",t.identifier),"toString",function(){var a=this;return Object.keys(this).reduce(function(e,n){var r;return"toString"!==n&&(r=n.split(", ").map(function e(t){return-1<t.indexOf(".")?t.split(/\./g).map(e).join(""):0===t.indexOf("^=")?"[class^='"+s+t.slice(2)+"']":"."+s+t}),e+=r.join(", ")+"{"+a[n]+"}",a[n].match(i))&&[".theme-dark","[data-app-theme=dark]"].forEach(function(t){e+=r.map(function(e){return t+" "+e}).join(", ")+"{"+a[n].replace(i,function(e,t,n,r,a){return"hsla("+t+","+o(100,1.5*+n)+"%,"+(100-r)+"%,"+a+")"})+"}"}),e},"")})+"");"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports={Colours:t,CSS:a,versionClass:s}:"function"==typeof define&&define.amd&&define("utils/typecolours",[],function(){return{Colours:t,CSS:a,versionClass:s}})}.call(void 0);
;require("harlowe")}());
</script>

</body>
</html>
